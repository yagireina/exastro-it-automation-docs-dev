==============
Ansible-driver
==============

はじめに
========

| 本書では、ITAの機能および操作方法について説明します。

Ansible driver概要
==================

| 本章ではAnsible、Ansible Automation ControllerおよびAnsible driverについて説明します。

Ansible Coreについて
--------------------

| Ansible Coreとは、多数の構築管理対象に対して、アプリーケーション/システムのデプロイ作業を容易にするPF構築自動化ツールです。
| Ansible Coreは、PlaybookというYAML形式のテキストファイルに定型処理をタスクとして記述し、それをAnsible Coreに実行させることにより、さまざまな処理を実現できます。
| タスクはモジュールと呼ばれる処理プログラムと紐付いており、さまざまな機器に対する制御を行うことができます。
| Ansible Coreの詳細情報については、Ansible Coreのマニュアルを参照してください。

Ansible Automation Controllerについて
-------------------------------------

| Ansible Automation Controllerとは、PF構築自動化ツールであるAnsibleにアクセスコントロール、ジョブスケジューリング、タスクの可視化などの機能を拡張した管理プラットフォームです。
| “プロジェクト”、”インベントリ”、”認証情報”の組合せで”ジョブテンプレート”を作成しAnsibleを実行できます。
| 複数の“ジョブテンプレート”を組み合せて”ワークフロージョブテンプレート”を作成することによって、より多彩な作業フローを表現することができます。
| Ansible Automation Controllerの詳細情報については、Ansible Automation Controllerのマニュアルを参照してください。
| ITAで対応可能なAnsible Automation Controllerのバージョンは、 :doc:`../../configuration/ansible/ansible_automation_platform` を参照してください。
| 最新のバージョンに対応した記法は使えないことがありますので、ご注意ください。

Ansible driverについて
----------------------

| Ansible driverは、ITAシステムのオプションとして機能し、ITAシステムで登録した構築対象のサーバ・ストレージ・ネットワーク各機器に対し、Ansible Core、Ansible Automation Controllerのどちらを経由するかを選択し、実際の運用設定を自動的に行います。

.. image:: /images/ja/diagram/overview.png
   :width: 6.68819in
   :height: 3.35972in
   :alt: Exastro概要

.. | Ansible driverには用途に応じて以下3つのモードを用意しています。

.. #. | **Legacy モード**
..    | Ansible標準の機能を用いて各種ホストへ設定を投入します。
..    | 構築コードを単体YAMLファイルとして登録し、作業パターンをその組み合わせで構成します。
..    | OS,NWの環境設定などの作業用に使われることを想定します。

.. #. | **Legacy Role モード**
..    | Legacyモードと同じく、Ansible標準の機能を用いて各種ホストへ設定を投入します。
..    | 構築コードをパッケージとして登録し、作業パターンをRoleの組み合わせで構成します。
..    | 製品部門などが提供するRoleパッケージを用いて、製品のインストール、環境構築などを行う際に使われることを想定します。

.. #. | **Pioneer モード**
..    | Ansibleに独自モジュールを追加し、対話形式による設定投入を可能とします。
..    | サーバ、ストレージ、ネットワークを問わず、Telnet, SSH でログイン可能なあらゆる機器に対応しています。対象機器と直接やり取りが必要となるため、相応のＩＴスキルが必要となります。

| Ansible driverには以下のモードを用意しています。

-  | **Legacy Role モード**
   | Ansible標準の機能を用いて各種ホストへ設定を投入します。
   | 構築コードをパッケージとして登録し、作業パターンをRoleの組み合わせで構成します。
   | 製品部門などが提供するRoleパッケージを用いて、製品のインストール、環境構築などを行う際に使われることを想定します。


| また、Ansible driverは、Playbook中の変数を画面から設定することができます。詳細は本書「 :ref:`general_operations_variable_handling_in_ansible_driver` 」を参照してください。

.. _general_operations_variable_handling_in_ansible_driver:

Ansible driverでの変数取り扱い
==============================

.. _general_operations_variable_handling:

変数の種類
----------

| Ansible driverでは、Playbook中の変数の具体値をITAの設定画面から設定することができます。
| **※設定方法の詳細は、本書「** :ref:`general_operations_substitution_value_auto_registration_setting` **」を参照してください。**
| Playbook中の変数で、ITAの変数として扱える変数は以下の7種類があります。

通常変数
--------
概要
~~~~
| 変数名に対して具体値を1つ定義できる変数です。

playbookにおける表記
~~~~~~~~~~~~~~~~~~~~
書式
****
| 変数を使用する際、playbook内の変数を以下とする。
| ※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる

.. code-block:: yaml

   {{ VAR_xxx }}
   #xxx: 半角英数字とアンダースコア（ _ ）

正しい記述例
************
.. code-block:: yaml

   VAR_users: root

.. code-block:: yaml

   - name: ファイル内容確認
     command: cat /tmp/{{ VAR_SAMPLE }}


.. _wrong_description_example:

誤った記述例
************

-  | "{{"または"}}" と変数名の間に「半角スペース」がない

.. code-block:: yaml
     
   command: cat /tmp/{{VAR_SAMPLE }}
   command: cat /tmp/{{ VAR_SAMPLE}}



-  | "{{"または"}}" と変数名の間の「半角スペース」が2個以上ある



.. code-block:: yaml
     
   command: cat /tmp/{{  VAR_SAMPLE }}
   command: cat /tmp/{{ VAR_SAMPLE  }}
..
   -  | 接頭文字(VAR\_)が小文字になっている
    
   .. code-block:: yaml
   
      command: cat /tmp/{{ var_SAMPLE }}


   -  | 接頭文字(VAR\_)の「_」がない

   .. code-block:: yaml
   
      command: cat /tmp/{{ VARSAMPLE }}


-  | 変数名が129文字以上ある

| ルールに準拠しない記述をした場合、:menuselection:`代入値自動登録` 機能に下記の影響を及ぼします。

-  | 登録の場合
   | Movementを選択しても変数名に候補として表示しません。
   | 作業実行時に変数未定義のエラーとなります。

-  | 更新の場合 (代入値管理登録後にITA追加ルール外の記載のplaybookに更新した場合)
   | 変数名に「ID変換失敗(n)」(※nは登録時の管理番号)と表示します。
   | 作業実行時に変数未定義のエラーとなります。

-  | エラーの例(実行ログ)
   | :command:`"msg": "The task includes an option with an undefined variable. The error was: 'VAR_PAUSE_time' is undefined`

複数具体値変数
--------------
概要
~~~~
| 変数名に対して具体値を複数定義できる変数です。

playbookにおける表記
~~~~~~~~~~~~~~~~~~~~
書式
****
| 変数を使用する際、playbook内の変数を以下とする。
| ※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる

.. code-block:: yaml

   {{ VAR_xxx }}
   #xxx: 半角英数字とアンダースコア（ _ ）



正しい記述例
************
.. code-block:: yaml 
                     
   VAR_users:        
       - root        
       - mysql       

誤った記述例
************
| 通常変数の :ref:`wrong_description_example` を参照してください。


多段変数
--------
概要
~~~~
| 階層化された変数です。

playbookにおける表記
~~~~~~~~~~~~~~~~~~~~
書式
****
| 変数を使用する際、playbook内の変数を以下とする。
| ※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる

.. code-block:: yaml

   {{ VAR_xxx }}
   #xxx: 半角英数字とアンダースコア（ _ ）


正しい記述例
************

.. code-block:: yaml         
                             
   VAR_users:                
       - user-name: alice    
         authorized: password  


| メンバー変数名は、下記の7文字を除くascii文字(0x20～0x7e)が使用出来ます。      
| " . [ ] ' \\ :                    
| 尚、コーテーションで囲まないと変数名の先頭に使用出来ない文字がいくつかあります。\     
| 詳しくは、Ansibleドキュメント `Yaml syntax <https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html>`_ を参照してください。       

誤った記述例
************
| 通常変数の :ref:`wrong_description_example` を参照してください。

グローバル変数
--------------
概要
~~~~
| :menuselection:`グローバル変数` メニューから登録された変数です。
| ITAWebUI上のグローバル変数管理メニューでグローバル変数を登録する際、
| グローバル変数名の接頭文字をGBL_とし、GBL_を含め255Byte以内とする。

playbookにおける表記
~~~~~~~~~~~~~~~~~~~~
書式
****
| 変数を使用する際、playbook内の変数を以下とする。
| ※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる

.. code-block:: yaml

   {{ GBL_xxx }}
   #xxx: 半角英数字とアンダースコア（ _ ）

正しい記述例
************
.. code-block:: yaml         
                             
   - name: ファイル内容確認
     command: cat /tmp/{{ GBL_SAMPLE }}

誤った記述例
************

- | 接頭文字(GBL\_)が小文字になっている

.. code-block:: yaml
   
   command: cat /tmp/{{ gbl_SAMPLE }}

- | 接頭文字(GBL\_)の「_」がない

.. code-block:: yaml

   command: cat /tmp/{{ GBLSAMPLE }}

- | 変数名が129文字以上ある

| ルールに準拠しない記述をした場合、:menuselection:`グローバル変数管理` 機能に下記の影響を及ぼします。

- | 作業実行時にグローバル変数の置換が行われないためエラーとなります。

-  | エラーの例(実行ログ)
   | :command:`"msg": "'gbl_wait_for_delay' is undefined"`


テンプレート埋込変数
--------------------
概要
~~~~
| :menuselection:`テンプレート管理` メニューから登録された変数です。
| ITAWebUI上のテンプレート管理メニューでテンプレート素材を登録をする際、
| テンプレート埋込変数名の接頭文字をTPF_とし、TPF_を含め255Byte以内とする。

playbookにおける表記
~~~~~~~~~~~~~~~~~~~~
書式
****
| 変数を使用する際、playbook内の変数を以下とする。
| ※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる

.. code-block:: yaml

   {{ TPF_xxx }}
   #xxx: 半角英数字とアンダースコア（ _ ）

正しい記述例
************
.. code-block:: yaml         
                             
   - name: ファイル内容確認
     template: src={{ TPF_SAMPLE }} dest=/tmp/SAMPLE.txt

誤った記述例
************

- | "{{"または"}}" と変数名の間に「半角スペース」がない

.. code-block:: yaml
   

   template: src={{TPF_SAMPLE }} dest=/tmp/SAMPLE.txt
   template: src={{ TPF_SAMPLE}} dest=/tmp/SAMPLE.txt

- | "{{"または"}}" と変数名の間の「半角スペース」が2個以上ある

.. code-block:: yaml

   template: src={{   TPF_SAMPLE }} dest=/tmp/SAMPLE.txt

- | 接頭文字(TPF\_)が小文字になっている

.. code-block:: yaml

   template: src={{ tpf_SAMPLE }} dest=/tmp/SAMPLE.txt

- | 接頭文字(TPF\_)の「_」がない

.. code-block:: yaml
   
   template: src={{ TPFSAMPLE }} dest=/tmp/SAMPLE.txt

- | 変数名が129文字以上ある

| ルールに準拠しない記述をした場合、:menuselection:`テンプレート管理` 機能に下記の影響を及ぼします。

- | 登録したテンプレート素材への置換が行われません。

-  | エラーの例(実行ログ)
   | :command:`"msg": "'TPFSAMPLE' is undefined"`


ファイル埋込変数
----------------
概要
~~~~
| :menuselection:`ファイル管理` メニューから登録された変数です。
| ITAWebUI上のファイル管理メニューでファイル埋込変数を登録する際、ファイル埋込変数名の接頭文字をCPF_とし、CPF_を含め255Byte以内とする。

playbookにおける表記
~~~~~~~~~~~~~~~~~~~~
書式
****
| 変数を使用する際、playbook内の変数を以下とする。
| ※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる

.. code-block:: yaml

   {{ CPF_xxx }}
   #xxx: 半角英数字とアンダースコア（ _ ）


正しい記述例
************

.. code-block:: yaml         
                             
   - name: ファイル内容確認
     copy: src={{ CPF_SAMPLE }} dest=/tmp/SAMPLE.txt


誤った記述例
************

- | "{{"または"}}" と変数名の間に「半角スペース」がない

.. code-block:: yaml
   
   copy: src={{CPF_SAMPLE }} dest=/tmp/SAMPLE.txt
   copy: src={{ CPF_SAMPLE}} dest=/tmp/SAMPLE.txt


- | "{{"または"}}" と変数名の間の「半角スペース」が2個以上ある

.. code-block:: yaml


   copy: src={{   CPF_SAMPLE }} dest=/tmp/SAMPLE.txt

- | 接頭文字(CPF\_)が小文字になっている

.. code-block:: yaml


   copy: src={{ cpf_SAMPLE }} dest=/tmp/SAMPLE.txt

- | 接頭文字(CPF\_)の「_」がない

.. code-block:: yaml

   
   copy: src={{ CPFSAMPLE }} dest=/tmp/SAMPLE.txt

- | 変数名が129文字以上ある

| ルールに準拠しない記述をした場合、:menuselection:`ファイル管理` 機能に下記の影響を及ぼします。

- | 作業実行時にファイル埋込変数の置換が行われないためエラーとなります。

-  | エラーの例(実行ログ)
   | :command:`Template embedded variable is not registered in the template list. (Role:roles/echo PlayBook:roles/echo/tasks/main.yml line:3 Template embedded variable:TPF_aa)`

.. _ita_unique_variables:

ITA独自変数
-----------

概要
~~~~

| ITA 独自で定義された変数です。

機器一覧
~~~~~~~~

| 基本コンソールの機器一覧の下記項目を変数として扱えます。                       

.. list-table:: 
   :widths: 50 80
   :header-rows: 1
   :align: left

   * - 項目名
     - 変数名
   * - ホスト名
     - __loginhostname__
   * - プロトコル 
     - __loginprotocol__
   * - ログインユーザID 
     - __loginuser__
   * - ログインパスワード
     - __loginpassword__

                                   
| **変数名の前後の「__」は半角アンダーバー2文字です。**
| 機器一覧については、:doc:`../it_automation_base/basic_console` を参照してください。               

オペレーション
~~~~~~~~~~~~~~

| 作業実行時のオペレーションを変数として扱えます。

.. list-table:: 
   :widths: 50 80
   :header-rows: 1
   :align: left

   * - 項目名
     - 変数名 
   * - オペレーション
     - __operation__


                                  
| 設定値 : 実施予定日時「YYYY/MM/DD HH:MM」_オペレーションID:オペレーション名称                    


データ連携
~~~~~~~~~~

| 作業実行時のディレクトリパスを下記の変数として扱えます。        

.. list-table:: 
   :widths: 50 80
   :header-rows: 1
   :align: left

   * - 項目名
     - 変数名 
   * - 作業ディレクトリパス
     - __workflowdir__

                                  
| Playbook内で作業ディレクトリパス配下にファイルを作成することで、「\ *作業実行*\ 」の結果データでファイルをダウンロードすることができます。                                                                                      
| Conductor実行時の各Movementで共有するディレクトリパスを下記の変数として扱えます。        


.. list-table:: 
   :widths: 50 80
   :header-rows: 1
   :align: left

   * - 項目名
     - 変数名 
   * - Conductor作業ディレクトリパス
     - __conductor_workflowdir__


                                  
| Playbook内でConductor作業ディレクトリパス配下にファイルを作成することで、各Movement間でファイルを共有することが出来ます。また、ansible driverの作業実行から実行した場合は__workflowdir__と同じパスが設定されます。                                            

| Conductorの「Status file branch」ノードで参照するステータスファイルのファイルパスを下記の変数として扱えます。  


.. list-table:: 
   :widths: 50 80
   :header-rows: 1
   :align: left

   * - 項目名
     - 変数名 
   * - ステータスファイルパス
     - __movement_status_filepath__


..
   Playbook内で作業ディレクトリパス配下にステータスファイルを作成することができます。
  
  
  +-------------------+---------------+
  | 項目名            | 変数名        |
  +===================+===============+
  || ステー\          || __move\      |
  || \ment_status_\   || \filepath__\ |
  || イルパス         |               |
  +-------------------+---------------+
  | 項目名            | 変数名        |
  +-------------------+---------------+
  || 作業デ\          || __parame\    |
  ||                  ||              |
  || の「_pa\         ||              |
  ||                  |               |
  || 」のパス         |               |
  +-------------------+---------------+
  || __parame\        ||              |
  || \ters_file_dir_\ ||              |
  || \for_epc__\      ||              |
  || 「_para\         ||              |
  || meters\          ||              |
  || _file\           |               |
  || 」のパス         |               |
  +-------------------+---------------+
  || 作業\            || __parame\    |
  || \ter_dir__\      ||              |
  ||                  ||              |
  || （out）\         ||              |
  || の「_pa\         |               |
  ||                  |               |
  || 」のパス         |               |
  +-------------------+---------------+
  || __par\           ||              |
  || トリ（o\         ||              |
  ||                  ||              |
  ||                  |               |
  ||                  |               |
  || 」のパス         |               |
  +-------------------+---------------+
  
.. | ※パラメータの対象がファイルアップロードカラムの場合のファイル配置                                  
.. | 収集機能の詳細については、「ITA_利用手順マニュアル収集機能」を参照してください。      

..
   読替変数
   --------
   概要
   ~~~~
   | Defaults変数定義ファイルまたはITA readmeに定義されている「VAR_xxx」形式以外の変数をITAで扱う場合の変数「LCA_×××」です。       
   | 詳細は「 :ref:`general_operations_write_translation_table_ansible_legacy_role_only` 」を参照してください。                  


.. ※要確認 収集機能のマニュアルのリンク設定

変数の抜出および具体値登録
--------------------------

| ITAにアップロードしたPlaybook等の資材から変数を抜出し、各メニューから具体値を登録できます。各メニューから登録した変数の具体値は、作業実行時にホスト変数ファイルに出力されます。
| 変数の抜出方法は以下のとおりです。

.. | 各モードとも、ITAにアップロードしたPlaybook等の資材から変数を抜出し、各メニューから具体値を登録できます。各メニューから登録した変数の具体値は、作業実行時にホスト変数ファイルに出力されます。
.. | 変数の抜出方法は以下のとおりです。

.. #. | **Ansible-Legacy**
..    | 「Playbook素材集 (本書： :ref:`general_operations_playbook_file_list_ansible_legacy_only` )」でアップロードしたPlaybookより、以下の書式の変数定義を抜出します。

..    .. table::  変数の抜出および具体値登録（Ansible-Legacy）
..       :widths: 10 20
..       :align: left

..       +-----------------------+----------------------------------------------+
..       | 書式                  | 具体値の設定                                 |
..       +=======================+==============================================+
..       | {{△VAR_xxx△}}         | 具体値の登録は「\                            |
..       |                       | :ref:`general_operations_substitution_value\ |
..       | {{△VAR_xxx△|△\        | _auto_registration_setting`」\               |
..       | フィルター△}}         | や「:ref:`general_operations_substitution\   |
..       |                       | _value_list`」\                              |
..       |                       | メニューより行います。                       |
..       |                       |                                              |
..       |                       | 具体値の登録の仕\                            |
..       |                       | 方で通常変数か複数具体値変数かを決定します。 |
..       +-----------------------+----------------------------------------------+
..       | {{△GBL_xxx△}}         | 具体値の登録は「:ref:`general_operations\    |
..       |                       | _global_variable_list`」\                    |
..       | {{△GBL_xxx△|△\        | メニューより行います。                       |
..       | フィルター△}}         |                                              |
..       +-----------------------+----------------------------------------------+
..       | {{△TPF_xxx△}}         | 具体値の登録は\                              |
..       |                       | 「:ref:`general_operations_template_list`」\ |
..       | {{△TPF_xxx△|△\        | メニューより行います。                       |
..       | フィルター△}}         |                                              |
..       +-----------------------+----------------------------------------------+
..       | {{△CPF_xxx△}}         | 具体値の登録は\                              |
..       |                       | 「:ref:`general_operations_file_list`」\     |
..       | {{△CPF_xxx△|△\        | メニューより行います。                       |
..       | フィルター△}}         |                                              |
..       +-----------------------+----------------------------------------------+

..    | ※ △:半角スペース　xxx: 半角英数字とアンダースコア（ \_ ）

.. #. | **Ansible-Pioneer**
..    | 「対話ファイル素材 (本書： :ref:`general_operations_dialog_files_ansible_pioneer_only` )」でアップロードした対話ファイルより、以下の書式の変数定義を抜出します。

..    .. table::  変数の抜出および具体値登録（Ansible-Pioneer）
..       :widths: 10 20
..       :align: left

..       +-----------------------+----------------------------------------------+
..       | 書式                  | 具体値の設定                                 |
..       +=======================+==============================================+
..       | {{△VAR_xxx△}}         | 具体値の登録は「:ref:`general_operations\    |
..       |                       | _substitution_value_auto_registration\       |
..       |                       | _setting`」や「:ref:`general_operations\     |
..       |                       | _substitution_value_list`」\                 |
..       |                       | メニューより行います。                       |
..       |                       |                                              |
..       |                       | 具体値の登録の仕\                            |
..       |                       | 方で通常変数か複数具体値変数かを決定します。 |
..       +-----------------------+----------------------------------------------+
..       | {{△GBL_xxx△}}         | 具体値の登録は「:ref:`general_operations\    |
..       |                       | _global_variable_list`」\                    |
..       |                       | メニューより行います。                       |
..       +-----------------------+----------------------------------------------+
..       | {{△TPF_xxx△}}         | 具体値の登録は\                              |
..       |                       | 「:ref:`general_operations_template_list`」\ |
..       |                       | メニューより行います。                       |
..       +-----------------------+----------------------------------------------+
..       | {{△CPF_xxx△}}         | 具体値の登録は\                              |
..       |                       | 「:ref:`general_operations_file_list`」\     |
..       |                       | メニューより行います。                       |
..       +-----------------------+----------------------------------------------+

#. | **Ansible-Legacy Role**
   | 「ロールパッケージ管理 (本書： :ref:`general_operations_role_package_list_ansible_legacy_role_only` )」でアップロードしたロールパッケージ内のdefaults変数定義ファイルより変数定義の抜出を行います。
   | 詳しくは「ロールパッケージの記述(本書： :ref:`general_operations_role_package_list_ansible_legacy_role_only` )」を参照してください。
   | また、アップロードしたロールパッケージ内のplaybookより、以下の書式の変数定義を抜出します。

   ..
      | また、読替表を作成することでdefaults変数定義ファイルまたはITA readmeに定義されている「VAR_xxx」以外の変数をITAで扱うことが出来ます。詳しくは「 :ref:`general_operations_write_translation_table_ansible_legacy_role_only` 」を参照してください。
   
   .. table::  変数の抜出および具体値登録（Ansible-Legacy Role）
      :widths: 4 8 4 4 16
      :align: left

      +---------+--------------------------------------+----------------------+-------------------------------+
      | 変数名\ | 書式                                 | ロールパ\            | 具体値の設定                  |
      |         |                                      | ッケージ\            |                               |
      |         |                                      | 内のディ\            |                               |
      |         |                                      | レクトリ             |                               |
      |         |                                      +--------------+-------+                               |
      |         |                                      | **tasks**    | **そ\ |                               |
      |         |                                      |              | の\   |                               |
      |         |                                      | **tem\       | 他**  |                               |
      |         |                                      | plates**     |       |                               |
      |         |                                      |              |       |                               |
      |         |                                      | **ha\        |       |                               |
      |         |                                      | ndlers**     |       |                               |
      |         |                                      |              |       |                               |
      |         |                                      | **meta**     |       |                               |
      |         |                                      |              |       |                               |
      +=========+======================================+==============+=======+===============================+
      | グロー\ | .. code-block:: yaml                 | **○**        | **×** | 具体値の登録は\               |
      | バル\   |                                      |              |       | 「 :ref:`general_operations\  |
      | 変数    |    {{ GBL_xxx }}                     |              |       | _global_variable_list` 」\    |
      |         |                                      |              |       | メニューより行います。        |
      |         |    {{ GBL_xxx | フィルタ }}          |              |       |                               |
      +---------+--------------------------------------+              |       +-------------------------------+
      | テンプ\ | .. code-block:: yaml                 |              |       | 具体値の登録は\               |
      | レート\ |                                      |              |       | 「:ref:`general_operations\   |
      | 埋込\   |    {{ TPF_xxx }}                     |              |       | _template_list`」\            |
      | 変数    |                                      |              |       | メニューより行います。        |
      |         |    {{ TPF_xxx | フィルタ }}          |              |       |                               |
      +---------+--------------------------------------+              |       +-------------------------------+
      | ファイ\ | .. code-block:: yaml                 |              |       | 具体値の登録は\               |
      | ル埋込\ |                                      |              |       | 「:ref:`general_operations\   |
      | 変数    |    {{ CPF_xxx }}                     |              |       | _file_list`」\                |
      |         |                                      |              |       | メニューより行います。        |
      |         |    {{ CPF_xxx | フィルタ }}          |              |       |                               |
      +---------+--------------------------------------+--------------+-------+-------------------------------+

   | ※ 〇：変数定義抜出対象のplaybook　 ×：変数定義抜出対象外のplaybook

代入値登録による変数の扱い
--------------------------

| Playbookで定義した変数の値は代入値登録機能により上書きすることができます。
| Playbook中の変数と、代入値管理機能で登録した変数の値の関係を、以下の図に示します。

.. image:: /images/ja/diagram/hensu.png
   :width: 6.68819in
   :height: 3.35972in

| 代入値管理機能で登録した変数の値は、各ホスト用に変数定義ファイル(host_vars)に出力され、Ansibleで元のPlaybookと変数定義用ファイルを入力として各ホストに実行されます。
| この結果、変数の値の優先順位は以下のようになります。

#. | 代入値管理機能で登録した値
#. | Playbook中の変数に指定した値
   | 詳細は 「 :ref:`general_operations_substitution_value_list` 」を参照してください。

Ansible driver コンソールメニュー構成
=====================================

| 本章では、ITAコンソールのメニュー構成について説明します。

メニュー/画面一覧
-----------------

#. | **ITA 基本コンソールのメニュー**
   | Ansible driverで利用するITA基本コンソールのメニュー一覧を以下に記述します。

   .. table::  基本コンソール メニュー/画面一覧
      :widths: 2 6 8 18
      :align: left

      +-------+--------------+--------------+----------------------------------------+
      | **N\  | **メニュー\  | **メニュー\  | **説明**                               |
      | o**   | グループ**   | ・画面**     |                                        |
      +=======+==============+==============+========================================+
      | 1     | 基本コ\      | オペ\        | オペレーション一覧をメン\              |
      |       | ンソール     | レーション\  | テナンス(閲覧/登録/更新/廃止)できます  |
      |       |              | 一覧         |                                        |
      +-------+--------------+--------------+----------------------------------------+

#. | **Ansible共通コンソールのメニュー**
   | Ansible共通コンソールのメニュー一覧を以下に記述します。

   .. table::  共通コンソール メニュー/画面一覧
      :widths: 2 6 6 20
      :align: left

      +-------+--------------+--------------+----------------------------------------+
      | **N\  | **メニュー\  | **メニュー\  | **説明**                               |
      | o**   | グループ**   | ・画面**     |                                        |
      +=======+==============+==============+========================================+
      | 1     | Ansible\     | 機器\        | 作業対象ホストの情報を\                |
      |       | 共通コ\      | 一覧         | メンテナンス(閲覧/登録/更新/廃止)\     |
      |       | ンソール     |              | できます。                             |
      +-------+              +--------------+----------------------------------------+
      | 2     |              | インター\    | Ansible Core、Ansible Automation \     |
      |       |              | フェース情報 | Controllerサーバのどちらを実行エン\    |
      |       |              |              | ジンとし構築作業をするか選択をします。 |
      |       |              |              |                                        |
      |       |              |              | ITAシステム・Ansible\                  |
      |       |              |              | driverサーバと実行\                    |
      |       |              |              | エンジンのサーバが共有するディレクトリ\|
      |       |              |              | のパスおよび、実行エンジンのサーバへの\|
      |       |              |              | 接続インターフェース情報を管理します。 |
      +-------+              +--------------+----------------------------------------+
      | 3     |              | Ansible \    | Ansible Automation \                   |
      |       |              | Automation \ | ControllerのRestAPI実行\               |
      |       |              | Controll\    | に必要な情報、および構築資材をAnsible \|
      |       |              | erホスト一覧 | Automation                             |
      |       |              |              | Controllerにファイル\                  |
      |       |              |              | 転送するために必要な情報を管理します。 |
      +-------+              +--------------+----------------------------------------+
      | 4     |              | グロー\      | Playbookや対話ファイルなどで\          |
      |       |              | バル変数管理 | 共通利用する変数（以降、グローバル\    |
      |       |              |              | 変数と称す）と具体値を管理します。     |
      +-------+              +--------------+----------------------------------------+
      | 5     |              | ファイル管理 | Playbook内の各モジュールで使用する素\  |
      |       |              |              | 材ファイルと埋め込み変数を管理します。 |
      +-------+              +--------------+----------------------------------------+
      | 6     |              | テン\        | Playbook内のtemplateモジュール\        |
      |       |              | プレート管理 | でなどで使用するテンプレートファイ\    |
      |       |              |              | ルと埋め込み変数を管理します。         |
      +-------+              +--------------+----------------------------------------+
      | 7     |              | 共通変数\    | テンプレート管理、ファイル管理、\      |
      |       |              | 利用リスト\  | グローバル管理に登録されている変数をど\|
      |       |              | (※1)         | の素材(ロール)で使用しているかを\      |
      |       |              |              | 閲覧できます。                         |
      |       |              |              |                                        |
      +-------+              +--------------+----------------------------------------+
      | 8     |              | 管理対象外\  | ロールパッケージ管理のデフォルト変数\  |
      |       |              | 変数リスト\  | 定義やテンプレート管理の変数定義で定義\|
      |       |              | (※1)         | している変数で、代入値自動登録の変数一\|
      |       |              |              | 覧に表示したくない変数をメンテナンス\  |
      |       |              |              | (参照/更新/廃止/復活)できます。        |
      |       |              |              |                                        |
      |       |              |              | 変数名は正規表記で記載できます。       |
      |       |              |              |                                        |
      |       |              |              | (例) ansible_* \*:ワイルドカード       |
      |       |              |              |                                        |
      |       |              |              | ansible\_[0-9a-zA-Z\_]\*               |
      |       |              |              |                                        |
      |       |              |              |                                        |
      +-------+--------------+--------------+----------------------------------------+

   .. note:: | ※1 非表示メニューは、バックヤード機能でデータの登録・更新を行うメニューです。
      | Ansible Driver機能をインストールした状態では表示されないメニューに設定されています。
      | 非表示メニューを表示するには、:menuselection:`管理コンソール-->ロール・メニュー紐付管理` で各メニューの復活処理を行います。詳細は :doc:`../it_automation_base/management_console` を参照してください。



#. | **Ansibleコンソールのメニュー**
   | 各Ansibleコンソールに対応するメニュー一覧を以下に記述します。

   .. list-table::  Ansible-LegacyRoleコンソール メニュー/画面一覧
      :widths: 20 30 80
      :header-rows: 1
      :align: left
   
      * - **No**
        - **メニュー・画面**
        - **説明**
      * - 1
        - ロール名管理 (※1)
        - ロールパッケージ管理にアップロードしたロールパッケージファイル「zip」内に登録しているロール名とロールパッケージの紐付を閲覧できます。
      * - 2
        - Movement一覧
        - Movementの一覧を管理します。
      * - 3
        - ロールパッケージ管理
        - ロールパッケージを管理します。
      * - 4
        - Movement-ロール紐付
        - Movementとロールパッケージの関連付けを管理します。 
      * - 5
        - Movement-変数紐付 (※1)
        - Movementと変数名の紐付を閲覧できます。
      * - 6
        - 変数ネスト管理
        - 多段変数が繰返配列で構成されている場合の最大繰返配列数を管理します。
      * - 7
        - 代入値自動登録設定 
        - CMDBのメニューに登録されているオぺレーションとホスト毎の項目値を紐付けるMovementと変数を管理します。
      * - 8
        - 作業実行
        - 作業実行するMovementとオペレーションを選択し実行を指示します。
      * - 9
        - 作業管理  
        - 作業実行履歴を管理します。   
      * - 10
        - 作業状態確認 
        - 作業実行状態を表示します。 
      * - 11
        - 作業対象ホスト 
        - Movementで使用するホストを管理します。
      * - 12
        - 代入値管理
        - 変数の代入値を管理します。  
      * - 13
        - 多段変数メンバー管理 (※1)
        - ロールパッケージ管理にアップロードしたロールパッケージファイル「zip」内のデフォルト変数定義ファイルや ITAreadmeファイルで定義している多段変数の構造を閲覧できます。
      * - 14
        - 多段変数配列組合せ管理 (※1)
        - ロールパッケージ管理にアップロードしたロールパッケージファイル「zip」内のデフォルト変数定義ファイルや ITAreadmeファイルで定義している多段変数配列組合せを閲覧できます。
   
   
   .. note:: | ※1 非表示メニューは、バックヤード機能でデータの登録・更新を行うメニューです。
      | Ansible Driver機能をインストールした状態では表示されないメニューに設定されています。
      | 非表示メニューを表示するには、:menuselection:`管理コンソール-->ロール・メニュー紐付管理` で各メニューの復活処理を行います。詳細は :doc:`../it_automation_base/management_console` を参照してください。

   .. .. table::  Ansible driverコンソール メニュー/画面一覧
   ..    :align: left

   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | **N\  | **メニュ\             | **メニュ\   | **非表\  | **説明**                          |
   ..    | o**   | ーグループ**          | ー・\       | 示メ\    |                                   |
   ..    |       |                       | 画面**      | ニュ\    |                                   |
   ..    |       |                       |             | ー\      |                                   |
   ..    |       |                       |             | ※**      |                                   |
   ..    |       |                       |             |          |                                   |
   ..    |       +-------+-------+-------+             |          |                                   |
   ..    |       | **Ansible\            |             |          |                                   |
   ..    |       | コンソール**          |             |          |                                   |
   ..    |       |                       |             |          |                                   |
   ..    |       +-------+-------+-------+             |          |                                   |
   ..    |       | **L\  | **Le\ | **P\  |             |          |                                   |
   ..    |       | e\    | ga\   | i\    |             |          |                                   |
   ..    |       | g\    | cy**  | o\    |             |          |                                   |
   ..    |       | a\    |       | n\    |             |          |                                   |
   ..    |       | c\    |       | e\    |             |          |                                   |
   ..    |       | y**   | **Ro\ | e\    |             |          |                                   |
   ..    |       |       | le**  | r**   |             |          |                                   |
   ..    |       |       |       |       |             |          |                                   |
   ..    +=======+=======+=======+=======+=============+==========+===================================+
   ..    | 1     |       |       | **○** | OS種別      |          | Pioneerより操作対象\              |
   ..    |       |       |       |       |             |          | となる機器のOS種別を管理します。  |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 2     | **○** | **○** | **○** | Movement一覧|          | Symphonyに登録\                   |
   ..    |       |       |       |       |             |          | するMovementの一覧を管理します。  |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 3     | **○** |       |       | Playbook\   |          | Playbookファイルを管理します。    |
   ..    |       |       |       |       | 素材集      |          |                                   |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 4     |       | **○** |       | ロールパ\   |          | ロールパッケージを管理します。    |
   ..    |       |       |       |       | ッケージ管理|          |                                   |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 5     |       |       | **○** | 対\         |          | 同一目的の対話ファイルを対話種別\ |
   ..    |       |       |       |       | 話種別リスト|          | としてまとめる種別を管理します。  |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 6     |       |       | **○** | 対話フ\     |          | 対話種別に紐づけるOS種別と\       |
   ..    |       |       |       |       | ァイル素材集|          | ITAシステム独自フォーマット\      |
   ..    |       |       |       |       |             |          | の作業手順ファイル（以降、\       |
   ..    |       |       |       |       |             |          | 対話ファイルと称します。）\       |
   ..    |       |       |       |       |             |          | を管理します。                    |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 7     | **○** | **○** | **○** | Movement-\  |          | Movementとプレイブ\               |
   ..    |       |       |       |       | Playbook紐\ |          | ック素材の関連付けを管理します。  |
   ..    |       |       |       |       | 付（Moveme\ |          |                                   |
   ..    |       |       |       |       | nt-対話種別\|          |                                   |
   ..    |       |       |       |       | 紐付、Move\ |          |                                   |
   ..    |       |       |       |       | ment-ロール\|          |                                   |
   ..    |       |       |       |       | 紐付）      |          |                                   |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 8     |       | **○** |       | 変\         |          | 多段\                             |
   ..    |       |       |       |       | 数ネスト管理|          | 変数が繰返配列で構成されている場\ |
   ..    |       |       |       |       |             |          | 合の最大繰返配列数を管理します。  |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 9     | **○** | **○** | **○** | 代入値\     |          | CMD\                              |
   ..    |       |       |       |       | 自動登録設定|          | Bのメニューに登録されているオぺレ\|
   ..    |       |       |       |       |             |          | ーションとホスト毎の項目値を紐付\ |
   ..    |       |       |       |       |             |          | けるMovementと変数を管理します。  |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 10    | **○** | **○** | **○** | 作\         |          | Movem\                            |
   ..    |       |       |       |       | 業対象ホスト|          | entで使用するホストを管理します。 |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 11    | **○** | **○** | **○** | 代入値管理  |          | 変数の代入値を管理します。        |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 12    | **○** | **○** | **○** | 作業実行    |          | 作業実行するMovementとオペレー\   |
   ..    |       |       |       |       |             |          | ションを選択し実行を指示します。  |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 13    | **○** | **○** | **○** | 作業状態確認|          | 作業実行状態を表示します。        |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 14    | **○** | **○** | **○** | 作業管理    |          | 作業実行履歴を管理します。        |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 15    | **○** | **○** | **○** | 変数名一覧  | ○        | Legacy:                           |
   ..    |       |       |       |       |             |          |                                   |
   ..    |       |       |       |       |             |          | Playbook素\                       |
   ..    |       |       |       |       |             |          | 材集にアップロードしたPlaybookで\ |
   ..    |       |       |       |       |             |          | 使用している変数名を管理します。  |
   ..    |       |       |       |       |             |          |                                   |
   ..    |       |       |       |       |             |          | pioneer:                          |
   ..    |       |       |       |       |             |          |                                   |
   ..    |       |       |       |       |             |          | 対話ファイル素材集\               |
   ..    |       |       |       |       |             |          | にアップロードした対話ファイルで\ |
   ..    |       |       |       |       |             |          | 使用している変数名を管理します。  |
   ..    |       |       |       |       |             |          |                                   |
   ..    |       |       |       |       |             |          | Legacy:-role:                     |
   ..    |       |       |       |       |             |          |                                   |
   ..    |       |       |       |       |             |          | ロールパッケージ管理に\           |
   ..    |       |       |       |       |             |          | アップロードしたロールパッケージ\ |
   ..    |       |       |       |       |             |          | ファイル「zip」内のデフォルト変数\|
   ..    |       |       |       |       |             |          | 定義ファイルやITAreadmeファイルで\|
   ..    |       |       |       |       |             |          | 定義している変数名を管理します。  |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 16    | **○** | **○** | **○** | Movement\   | ○        | Movemen\                          |
   ..    |       |       |       |       | 変数紐付管理|          | tで使用している変数を管理します。 |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 17    |       | **○** |       | ロール名管理| ○        | ロール\                           |
   ..    |       |       |       |       |             |          | パッケージ管理にアップロードした\ |
   ..    |       |       |       |       |             |          | ロールパッケージファイル「zip」内\|
   ..    |       |       |       |       |             |          | に登録しているロールを管理します。|
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 18    |       | **○** |       | ロー\       | ○        | ロールパッケージ管理にアップロー\ |
   ..    |       |       |       |       | ル変数名管理|          | ドしたロールパッケージファイル「 \|
   ..    |       |       |       |       |             |          | zip」内のデフォルト変数定義ファイ\|
   ..    |       |       |       |       |             |          | ルやITAreadmeファイルで定義してい\|
   ..    |       |       |       |       |             |          | る変数名をロール毎に管理します。  |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 19    |       | **○** |       | 変\         | ○        | ロールパッケージ管理にアップ\     |
   ..    |       |       |       |       | 数具体値管理|          | ロードしたロールパッケージファイ\ |
   ..    |       |       |       |       |             |          | ル「zip」内のデフォルト変数定義フ\|
   ..    |       |       |       |       |             |          | ァイルやITAreadmeファイルで定義し\|
   ..    |       |       |       |       |             |          | ている変数の具体値を管理します。  |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 20    |       | **○** |       | メン\       | ○        | ロール\                           |
   ..    |       |       |       |       | バー変数管理|          | パッケージ管理にアップロードした\ |
   ..    |       |       |       |       |             |          | ロールパッケージファイル「zip」内\|
   ..    |       |       |       |       |             |          | のデフォルト変数定義ファイルやIT\ |
   ..    |       |       |       |       |             |          | Areadmeファイルで定義している多段\|
   ..    |       |       |       |       |             |          | 変数のメンバー変数を管理します。  |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 21    |       | **○** |       | 多段変数\   | ○        | ロールパッケージ管理にアップロ\   |
   ..    |       |       |       |       | メンバー管理|          | ードしたロールパッケージファイル\ |
   ..    |       |       |       |       |             |          | 「zip」内のデフォルト変数定義ファ\|
   ..    |       |       |       |       |             |          | イルやITAreadmeファイルで定義して\|
   ..    |       |       |       |       |             |          | いる多段変数の構造を管理します。  |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 22    |       | **○** |       | 多段変数配\ | ○        | ロー\                             |
   ..    |       |       |       |       | 列組合せ管理|          | ルパッケージ管理にアップロードし\ |
   ..    |       |       |       |       |             |          | たロールパッケージファイル「zip」\|
   ..    |       |       |       |       |             |          | 内のデフォルト変数定義ファイルや\ |
   ..    |       |       |       |       |             |          | ITAreadmeファイルで定義している多\|
   ..    |       |       |       |       |             |          | 段変数の繰り返し数を管理します。  |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+
   ..    | 23    |       | **○** |       | 読替変数一覧| ○        | ロールパッケージ管理に\           |
   ..    |       |       |       |       |             |          | アップロードしたロールパッケージ\ |
   ..    |       |       |       |       |             |          | ファイル「zip」内の読替表ファイル\|
   ..    |       |       |       |       |             |          | で定義している変数を管理します。  |
   ..    +-------+-------+-------+-------+-------------+----------+-----------------------------------+

..
   .. note:: | ※ 非表示メニューは、バックヤード機能でデータの登録・更新を行うメニューです。
      | Ansible Driver機能をインストールした状態では表示されないメニューに設定されています。
      | 非表示メニューを表示するには、:menuselection:`管理コンソール-->ロール・メニュー紐付管理` で各メニューの復活処理を行います。詳細は :doc:`../it_automation_base/management_console` を参照してください。
      | 尚、データの更新を行うとバックヤード機能が正しく動作しなくなります。データの更新はしないでください。


Ansible driver利用手順
======================

| Ansibleコンソールの利用手順について説明します。

.. | 各Ansibleコンソールの利用手順について説明します。

.. 作業フロー
.. ----------

.. | 各Ansibleコンソールにおける標準的な作業フローは以下のとおりです。
.. | 各作業の詳細は次項に記載しています。
.. | ITA基本コンソールの利用方法は、 :doc:`../it_automation_base/basic_console` を参照してください。

.. Ansible-Legacy作業フロー
.. ~~~~~~~~~~~~~~~~~~~~~~~~

.. | 以下は、Ansible-Legacyで作業を実行するまでの流れです。

.. -  **作業フロー詳細と参照先**

..    #. | **機器情報にAnsible利用情報を設定**
..       | ITA基本コンソールの機器一覧の画面から、各機器に対してAnsible利用情報を設定します。
..       | 詳細は :ref:`general_operations_device_list` を参照してください。

..    #. | **投入オペレーション名の登録**
..       | ITA基本コンソールのオペレーション一覧の画面から、作業用の投入オペレーション名を登録します。
..       | 詳細は :ref:`general_operations_input_operation_list` を参照してください。

..    #. | **インターフェース情報の登録**
..       | Ansible共通コンソールのインターフェース情報の画面から、Ansible Core、Ansible Automation Controllerサーバのどちらを実行エンジンにするかを選択し、実行エンジンのサーバへの接続情報の登録します。
..       | 詳細は :ref:`general_operations_interface_information` を参照してください。

..    #. | **作業パターン(Movement)の登録**
..       | Ansible-LegacyコンソールのMovement一覧の画面から、作業用のMovementを登録します。
..       | 詳細は :ref:`general_operations_movement_list` を参照してください。

..    #. | **Playbookの登録**
..       | Ansible-LegacyコンソールのPlaybook素材集の画面から、作業で使用するPlaybookを登録します。
..       | 詳細は :ref:`general_operations_playbook_file_list_ansible_legacy_only` を参照してください。

..    #. | **テンプレートファイルの登録（必要に応じて実施）**
..       | Ansible共通コンソールのテンプレート管理の画面から、Playbook内のtemplateモジュールなどで使用しているtemplateファイル(src)とtemplate埋め込み変数の登録／更新／廃止を行います。
..       | 詳細は :ref:`general_operations_template_list` を参照してください。

..    #. | **素材ファイルの登録 （必要に応じて実施）**
..       | Ansible共通コンソールのファイル管理の画面から、作業対象サーバに配置するファイルを登録します。
..       | 詳細は :ref:`general_operations_file_list` を参照してください。

..    #. | **Movementにプレイブック素材を指定**
..       | Ansible-LegacyコンソールのMovement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）の画面から、登録したMovementにプレイブック素材を指定します。
..       | 詳細は :ref:`general_operations_movement_details` を参照してください。

..    #. | **作業対象ホストの指定**
..       | Ansible-Legacyコンソールの作業対象ホストの画面から、作業対象ホストを指定します。
..       | 詳細は :ref:`general_operations_target_host` を参照してください。

..    #. | **変数値の設定（必要に応じて実施）**
..       | Ansible-Legacyコンソールの代入値管理の画面から、Movementに登録したPlaybook内で定義した変数の値を設定します。変数を利用していない場合、設定は不要です。
..       | 詳細は :ref:`general_operations_substitution_value_list` を参照してください。

..    #. | **作業実行**
..       | Ansible-Legacyコンソールの作業実行の画面から、実行日時、投入オペレーションを選択して設定して処理の実行を指示します。
..       | 詳細は :ref:`general_operations_execution` を参照してください。

..    #. | **作業状態確認** 
..       | Ansible-Legacyコンソールの作業状態確認の画面では、実行した作業の状態がリアルタイムで表示されます。また、作業の緊急停止や、実行ログ、エラーログを監視することができます。
..       | 詳細は :ref:`general_operations_check_operation_status` を参照してください。

..    #. | **作業履歴確認** 
..       | Ansible-Legacyコンソールの作業管理の画面では、実行した作業の一覧が表示され履歴が確認できます。
..       | 詳細は :ref:`general_operations_execution_list` を参照してください。


Ansible-LegacyRole作業フロー
----------------------------

| 以下は、Ansible-LegacyRoleで作業を実行するまでの流れです。

-  **作業フロー詳細と参照先**

   #. | **機器情報にAnsible利用情報を設定** 
      | Ansible共通コンソールの機器一覧の画面から、各機器に対してAnsible利用情報を設定します。
      | 詳細は :ref:`general_operations_device_list` を参照してください。

   #. | **投入オペレーション名の登録**
      | ITA基本コンソールのオペレーション一覧の画面から、作業用の投入オペレーション名を登録します。
      | 詳細は :ref:`general_operations_input_operation_list` を参照してください。

   #. | **インターフェース情報の登録**
      | Ansible共通コンソールのインターフェース情報の画面から、Ansible Core、Ansible Automation Controllerサーバのどちらを実行エンジンにするかを選択し、実行エンジンのサーバへの接続情報を登録します。
      | 詳細は :ref:`general_operations_interface_information` を参照してください。

   #. | **作業パターン(Movement)の登録** 
      | Ansible-LegacyRoleコンソールのMovement一覧の画面から、作業用のMovementを登録します。
      | 詳細は :ref:`general_operations_movement_list` を参照してください。

   #. | **ロールパッケージの登録** 
      | Ansible-LegacyRoleコンソールのロールパッケージ管理の画面から、作業で使用するロールパッケージを登録します。
      | 詳細は :ref:`general_operations_role_package_list_ansible_legacy_role_only` を参照してください。

   #. | **グローバル変数の登録（必要に応じて実施）**
      | Ansible共通コンソールのグローバル変数管理の画面から、Playbookで使用するグローバル変数を登録します。
      | 詳細は :ref:`general_operations_global_variable_list` を参照してください。

   #. | **素材ファイルの登録（必要に応じて実施）**
      | Ansible共通コンソールのファイル管理の画面から、作業対象サーバに配置するファイルを登録します。
      | 詳細は :ref:`general_operations_file_list` を参照してください。
   
   #. | **テンプレートファイルの登録（必要に応じて実施）**
      | Ansible共通コンソールのテンプレート管理の画面から、ロールパッケージのtemplateモジュールなどで使用しているテンプレートファイル(src: で指定する素材)とテンプレート埋込変数を登録します。
      | 詳細は :ref:`general_operations_template_list` を参照してください。
   
   #. | **管理対象外変数の登録（必要に応じて実施）**
      | Ansible共通コンソールの管理対象外変数リストの画面から、ロールパッケージ管理のデフォルト変数定義やテンプレート管理の変数定義で定義している変数で、代入値自動登録の変数一覧に表示したくない変数を登録します。
      | 詳細は :ref:`general_operations_unmanaged_var_list` を参照してください。

   #. | **Movementにロールパッケージを指定**
      | Ansible-LegacyRoleコンソールのMovement-ロール紐付の画面から、登録したMovementにロールパッケージを指定します。
      | 詳細は :ref:`general_operations_movement_details` を参照してください。

   #. | **多段変数の最大繰返数を指定（必要に応じて実施）**
      | Ansible-LegacyRoleコンソールの多段変数最大繰返管理の画面から、多段変数で配列定義されているメンバー変数の配列の最大繰返数を指定します。
      | 詳細は :ref:`general_operations_nested_variable_list_ansible_legacy_role_only` を参照してください。
   
   #. | **パラメータシートの作成**
      | メニュー作成コンソールのメニュー作成・定義の画面から、作業対象サーバの設定に使用するデータを登録するためのメニューを作成します。
      | 詳細は :doc:`../create_param/menu_creation` を参照してください。

   #. | **パラメータシートにデータを登録**
      | 入力用コンソールの前項で作成したパラメータシート画面から、作業対象サーバの設定に使用するデータを登録します。
      | 詳細は :doc:`../create_param/menu_creation` を参照してください。

   #. | **代入値自動登録設定** 
      | Ansible-LegacyRoleコンソールの代入値自動登録設定の画面から、パラメータシートに登録されているオペレーションとホスト毎の項目の設定値と、Movementの変数を紐付けます。
      | 詳細は :ref:`general_operations_substitution_value_auto_registration_setting` を参照してください。

      .. #. | **作業対象ホストの指定** 
      ..    | Ansible-LegacyRoleコンソールの作業対象ホストの画面から、作業対象ホストを指定します。
      ..    | 詳細は :ref:`general_operations_target_host` を参照してください。

      .. #. | **変数値の設定** 
      ..    | Ansible-LegacyRoleコンソールの代入値管理の画面から、Movementに登録したPlaybook内で定義した変数の値を設定します。変数を利用していない場合、設定は不要です。
      ..    | 詳細は :ref:`general_operations_substitution_value_list` を参照してください。

   #. | **作業実行** 
      | Ansible-LegacyRoleコンソールの作業実行の画面から、Movementと投入オペレーションを選択して処理の実行を行います。
      | 詳細は :ref:`general_operations_execution` を参照してください。

   #. | **作業状態確認** 
      | Ansible-LegacyRoleコンソールの作業状態確認の画面から、実行した作業の状態がリアルタイムで表示されます。また、作業の緊急停止や、実行ログ、エラーログを監視することができます。
      | 詳細は :ref:`general_operations_check_operation_status` を参照してください。

   #. | **作業履歴確認** 
      | Ansible-LegacyRoleコンソールの作業管理の画面から、実行した作業の一覧が表示され履歴が確認できます。
      | 詳細は :ref:`general_operations_execution_list` を参照してください。

.. Ansible-Pioneer作業フロー
.. ~~~~~~~~~~~~~~~~~~~~~~~~~

.. | 以下は、Ansible-Pioneerで作業を実行するまでの流れです。

.. -  **作業フロー詳細と参照先**

..    #. | **OS種別の登録**
..       | Pioneerより操作対象となる機器のOS種別を設定します。

..    #. | **機器情報にAnsible利用情報を設定** 
..       | ITA基本コンソールの機器一覧の画面から、各機器に対してAnsible利用情報を設定します。
..       | 詳細は :ref:`general_operations_device_list` を参照してください。

..    #. | **投入オペレーション名の登録**
..       | ITA基本コンソールのオペレーション一覧の画面から、作業用の投入オペレーション名を登録します。
..       | 詳細は :ref:`general_operations_input_operation_list` を参照してください。

..    #. | **インターフェース情報の登録**
..       | Ansible共通コンソールのインターフェース情報の画面から、Ansible Core、Ansible Automation Controllerサーバのどちらを実行エンジンにするかを選択し、実行エンジンのサーバへの接続情報の登録します。
..       | 詳細は :ref:`general_operations_interface_information` を参照してください。

..    #. | **作業パターン(Movement)の登録**
..       | Ansible-PioneerコンソールのMovement一覧の画面から、作業用のMovementを登録します。
..       | 詳細は :ref:`general_operations_movement_list` を参照してください。

..    #. | **対話種別の登録**
..       | Ansible-Pioneerコンソールの対話種別リストの画面から、対話種別を登録します。
..       | OS種別ごとの差異を対話ファイルごとに定義し、同一目的の対話ファイルを対話種別として纏めて機器差分を吸収(抽象化)します。
..       | 詳細は :ref:`general_operations_dialog_type_list_ansible_pioneer_only` を参照してください。

..    #. | **対話ファイルの登録**
..       | Ansible-Pioneerコンソールの対話ファイル素材集の画面から、対話種別とOS種別の組み合わせに対して対話ファイルを登録します。
..       | 詳細は :ref:`general_operations_dialog_files_ansible_pioneer_only` を参照してください。

..    #. | **テンプレートファイルの登録(必要に応じて実施)**
..       | Ansible共通コンソールのテンプレート管理の画面から、対話ファイルで使用しているtemplateファイルとtemplate埋め込み変数の登録／更新／廃止を行います。
..       | 詳細は :ref:`general_operations_template_list` を参照してください。

..    #. | **素材ファイルの登録(必要に応じて実施)**
..       | Ansible共通コンソールのファイル管理の画面から、作業対象サーバに配置するファイルを登録します。
..       | 詳細は :ref:`general_operations_file_list` を参照してください。

..    #. | **Movementに対話ファイルを指定**
..       | Ansible-PioneerコンソールのMovement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）の画面から、登録したMovementに対話ファイルに対応した対話種別リストを指定します。
..       | 詳細は :ref:`general_operations_movement_details` を参照してください。

..    #. | **作業対象ホストの指定** 
..       | Ansible-Pioneerコンソールの作業対象ホストの画面から、作業対象ホストを指定します。
..       | 詳細は :ref:`general_operations_target_host` を参照してください。

..    #. | **変数値の設定** 
..       | Ansible-Pioneerコンソールの代入値管理の画面から、Movementに登録したPlaybook内で定義した変数の値を設定します。変数を利用していない場合、設定は不要です。
..       | 詳細は :ref:`general_operations_substitution_value_list` を参照してください。

..    #. | **作業実行** 
..       | Ansible-Pioneerコンソールの作業実行の画面から、実行日時、投入オペレーションを選択して設定して処理の実行を指示します。
..       | 詳細は :ref:`general_operations_execution` を参照してください。

..    #. | **作業状態確認**
..       | Ansible-Pioneerコンソールの作業状態確認の画面では、実行した作業の状態がリアルタイムで表示されます。また、作業の緊急停止や、実行ログ、エラーログを監視することができます。
..       | 詳細は :ref:`general_operations_check_operation_status` を参照してください。

..    #. | **作業履歴確認** 
..       | Ansible-Pioneerコンソールの作業管理の画面では、実行した作業の一覧が表示され履歴が確認できます。
..       | 詳細は :ref:`general_operations_execution_list` を参照してください。

.. | **■登録画面項目一覧凡例**
.. | 次項に記載の登録画面項目一覧表の内容について説明します。

.. +--------+-------------------------------+--------+--------+-------------+
.. | **項\  | **説明…②**                    | **入力\| **入力\| **制約事項\ |
.. | 目…\   |                               | 必須\  | 方法\  | …⑤**        |
.. | ①**    |                               | …③**   | …④**   |             |
.. +========+===============================+========+========+=============+
.. |        |                               |        |        |             |
.. +--------+-------------------------------+--------+--------+-------------+

.. #. | **項目**
..    - | サブメニュー内の項目名です。

.. #. | **説明**
..    - | 項目に対する説明です。

.. #. | **入力必須**
..    - | ○：項目に対する内容の入力が必須の項目です。
..    - | ‐ ：項目に対する内容の入力が任意の項目です。

.. #. | **入力方法**
..    - | 手動入力：手動での入力が必要な項目です。
..    - | 自動入力：自動で内容が入力される項目です。
..    - | チェックボックス：チェックボックス形式の項目です。
..    - | ボタン：ラジオボタン形式の項目です。
..    - | リスト選択：リストボックス形式の項目です。

.. #. | **制約事項**
..    - | 項目に対する制約事項(文字数制限など)です。

Ansible driver機能・操作方法説明
================================


| 本章では、Ansible driverで利用する各コンソールの機能について説明します。
| 本章に記載の登録画面項目一覧表の内容について説明します。

.. table:: 登録画面項目一覧凡例
   :align: left

   +--------+-------------------------------+--------+--------+-------------+
   | **項\  | **説明…②**                    | **入力\| **入力\| **制約事項\ |
   | 目…\   |                               | 必須\  | 方法\  | …⑤**        |
   | ①**    |                               | …③**   | …④**   |             |
   +========+===============================+========+========+=============+
   |        |                               |        |        |             |
   +--------+-------------------------------+--------+--------+-------------+

#. | **項目**
   | サブメニュー内の項目名です。

#. | **説明**
   | 項目に対する説明です。

#. | **入力必須**
   | ○：項目に対する内容の入力が必須の項目です。
   | ー：項目に対する内容の入力が任意の項目です。

#. | **入力方法**

   - | 手動入力：手動での入力が必要な項目です。
   - | 自動入力：自動で内容が入力される項目です。
   - | チェックボックス：チェックボックス形式の項目です。
   - | ボタン：ラジオボタン形式の項目です。
   - | リスト選択：リストボックス形式の項目です。

#. | **制約事項**
   | 項目に対する制約事項(文字数制限など)です。

基本コンソール
--------------

| 本節では、ITA基本コンソールでの操作について記載します。
| 本作業は :doc:`../it_automation_base/basic_console` を参照して、ITA基本コンソール画面内で作業を実施してください。

.. 本作業はITA基本コンソールマニュアルを参照して、ITA基本コンソール画面内で作業を実施してください。


.. _general_operations_input_operation_list:

オペレーション一覧
~~~~~~~~~~~~~~~~~~

| :menuselection:`基本コンソール-->オペレーション一覧` では、オーケストレータで実行する作業対象ホストに対するオペレーションを管理します。作業はITA基本コンソール内メニューより選択します。
| 登録方法の詳細は、関連マニュアルの :doc:`../it_automation_base/basic_console` を参照してください。

.. figure:: /images/ja/basic_console/operation_list/register.png
   :width: 800px
   :alt: サブメニュー画面（オペレーション一覧）

   サブメニュー画面（オペレーション一覧）

Ansible共通コンソール
---------------------

| 本節では、Ansible共通コンソールでの操作について記載します。

.. _general_operations_device_list:

機器一覧
~~~~~~~~

#. | :menuselection:`Ansible共通-->機器一覧` では、作業対象ホストの情報のメンテナンス(閲覧/登録/更新/廃止)を行います。

   .. | 本書では、主にAnsible driverの動作に必要となる項目について説明します。
   .. | :doc:`../it_automation_base/basic_console` と合わせて参照してください。

   .. figure:: /images/ja/ansible_common/devaicelist/device_list.png
      :width: 800px
      :alt: サブメニュー画面（機器一覧）

      サブメニュー画面（機器一覧）

   .. #. | 「登録」-「登録開始」ボタンより、機器情報の登録を行います。
#. | :guilabel:`＋ 登録` ボタンより、機器情報の登録を行います。

   .. figure:: /images/ja/ansible_common/devaicelist/registration_device_list.gif
      :width: 800px
      :alt: 登録画面（機器一覧）

      登録画面（機器一覧）

   .. :alt: 登録画面（機器一覧 - 共通項目）

      登録画面（機器一覧）
   .. 登録画面（機器一覧 - 共通項目）

   .. .. figure:: ./general_operations/image7.png
   ..    :width: 5.97917in
   ..    :height: 1.10417in
   ..    :alt: 登録画面（機器一覧 - Ansible利用情報）

   ..    登録画面（機器一覧 - Ansible利用情報）

#. | 登録画面の共通項目一覧は以下のとおりです。

   .. | Web画面のカラム名の後ろに赤のアスタリスク（＊）が付いているカラムが必須入力になりますが、Ansible　driverを利用する場合には、Ansible利用情報を入力してください。

   | Ansible driverを利用する場合には、Ansible利用情報を入力してください。
   | 未入力で作業実行した場合、想定外エラーとなる場合があります。

   .. table:: 登録画面項目一覧（機器一覧）
      :widths: 8 8 8 8 18 12 12 12
      :align: left

      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      | **項目**                          | **説明**                                        | **入力\   | **入力方法** | **制約事項**    |
      |                                   |                                                 | 必須**    |              |                 |
      |                                   |                                                 |           |              |                 |
      +========+========+========+========+=================================================+===========+==============+=================+
      | 管理システム項番                  | 登録情報を識別する一意のIDが自動入力されます。  | ー        | 手動入力     | ー              |   
      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      | HW機器種別                        | HW機器の種別を選択します。                      | ー        | リスト選択   | ー              |   
      |                                   |                                                 |           |              |                 |     
      |                                   | ・NW(ネットワーク)                              |           |              |                 |     
      |                                   |                                                 |           |              |                 |     
      |                                   | ・ST(ストレージ)                                |           |              |                 |     
      |                                   |                                                 |           |              |                 |     
      |                                   | ・SV(サーバー)                                  |           |              |                 |     
      |                                   |                                                 |           |              |                 |     
      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      | ホスト名                          | ホスト名を記入します。                          | ○         | 手動入力     | 最大長255バイト |   
      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      | DNSホスト名                       | ＤＮＳサーバーを使用してホスト名が解決できる\   |           | 手動入力     | 最大長255バイト |   
      |                                   | 名称を入力します。                              |           |              |                 |     
      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      | IPアドレス                        | IPアドレス(xxx.xxx.xxx.xxx形式)を記入します。   |           | 手動入力     | 最大長15バイト  |               
      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      | ログイン\       | ユーザ          | ログインユーザを記入します。                    |           | 手動入力     | 最大長255バイト |   
      | パスワード      |                 |                                                 |           |              |                 |         
      |                 +--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      |                 | パスワード      | パスワードを指定します。                        |           | 手動入力     | 最大長255バイト |        
      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      | ssh\            | ssh秘密鍵\      | ssh秘密鍵ファイルを指定して鍵認証する場合の\    | ー        | ファイル選択 | 最大サイズ\     |   
      | 鍵認証\         | ファイル        | 秘密鍵ファイルを入力します。アップロード\       |           |              | 100Mバイト      |   
      | 情報            |                 | したファイルは暗号化されて保存されます。        |           |              |                 |   
      |                 |                 |                                                 |           |              |                 |   
      |                 |                 | ※登録後はダウンロード不可となります。           |           |              |                 |       
      |                 +--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      |                 | パスフレーズ    | ssh秘密鍵ファイルにパスフレーズが設定され\      | ー        | 手動入力     | 最大長255バイト |   
      |                 |                 | ている場合、パスフレーズを入力します。          |           |              |                 |        
      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      | Ansib\ | Legacy\| 認証方式        | Ansible・Ansible Automation Controller から\    |           | リスト選択   | 説明欄記載\     |   
      | le利用\| /Role\ |                 | 機器へ接続する際の認証方式を選択します。        |           |              | のとおり        |   
      | 情報   | 利用\  |                 |                                                 |           |              |                 |   
      |        | 情報   |                 | ●パスワード認証                                 |           |              |                 |     
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | ログインパスワードの管理で●の選択と、\          |           |              |                 |   
      |        |        |                 | ログインパスワードの入力が必須です。            |           |              |                 |     
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | ●鍵認証（パスフレーズなし）                     |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | ssh秘密鍵ファイル(id_ras\                       |           |              |                 |   
      |        |        |                 | )のアップロードが必須です。                     |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | ●鍵認証（パスフレーズあり）                     |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | ssh秘密鍵ファイル(id_ras)のアップロードと、\    |           |              |                 |   
      |        |        |                 | パスフレーズの入力が必須です。                  |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | ●鍵認証（鍵交換済み）※1                         |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | ssh秘密鍵ファイル(id_ras)の\                    |           |              |                 |   
      |        |        |                 | アップロードは必要ありません。                  |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | ●パスワード認証（winrm)                         |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | 必要に応じてWinRM接続情報を入力します。         |           |              |                 |     
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | 尚、パスワード認証（winrm)以外の認証方式の\     |           |              |                 |   
      |        |        |                 | 場合、機器側に以下の設定が必要です。            |           |              |                 |      
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | ログインユーザの sudo権限を NOPASSWD付で \      |           |              |                 |   
      |        |        |                 | :file:`/etc/sudoers` に設定します。             |           |              |                 |      
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | Exp)                                            |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |
      |        |        |                 | .. code-block::                                 |           |              |                 |
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 |    Demo_user ALL=(ALL) NOPASSWD:ALL             |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |   
      |        |        +--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      |        |        | WinRM\ | ポート\| WindowsServerにWinRM接続する際\                 | ー        | 手動入力     | 説明欄記載\     |   
      |        |        | 接続\  | 番号   | のポート番号を入力します。                      |           |              | のとおり        |   
      |        |        | 情報   |        |                                                 |           |              |                 |   
      |        |        |        |        | 未入力の場合はデフォルト(5985)での\             |           |              |                 |    
      |        |        |        |        | WinRM接続となります。                           |           |              |                 |     
      |        |        |        +--------+-------------------------------------------------+-----------+--------------+-----------------+
      |        |        |        | サーバ\| WinRM接続ポートでhttpsのポート番号を指定した\   | ー        | ファイル選択 | 最大サイズ\     |   
      |        |        |        | 証明書 | 場合にサーバﾞ証明書を入力します。               |           |              | 100Mバイト      |   
      |        |        |        |        |                                                 |           |              |                 |    
      |        |        |        |        | アップロードしたファイルは暗号化されて保存\     |           |              |                 |   
      |        |        |        |        | されます。                                      |           |              |                 |
      |        |        |        |        |                                                 |           |              |                 |
      |        |        |        |        | ※登録後はダウンロード不可となります。           |           |              |                 |    
      |        |        |        |        |                                                 |           |              |                 |   
      |        |        |        |        | サーバ証明書の認証を省く場合、インベントリ\     |           |              |                 |   
      |        |        |        |        | ファイル追加オプションに下記を追記してください。|           |              |                 |      
      |        |        |        |        |                                                 |           |              |                 | 
      |        |        |        |        | .. code-block:: yaml                            |           |              |                 |
      |        |        |        |        |                                                 |           |              |                 |  
      |        |        |        |        |    ansible_winrm_server_cert_validation: ignore |           |              |                 |   
      |        |        |        |        |                                                 |           |              |                 |    
      |        +--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      |        | 接続オプション           | （ssh接続の場合）                               | ー        | 手動入力     | 最大長4000バイト|   
      |        |                          |                                                 |           |              |                 |   
      |        |                          | :file:`/etc/ansible.cfg/ssh_args` に設定して\   |           |              |                 |   
      |        |                          | いるsshオプション以外のオプションを設定\        |           |              |                 |     
      |        |                          | したい場合、設定したいオプションを入力します。  |           |              |                 |     
      |        |                          |                                                 |           |              |                 |   
      |        |                          | （telnet接続の場合）                            |           |              |                 |   
      |        |                          |                                                 |           |              |                 |     
      |        |                          | telnet接続時のオプションを設定したい場合、\     |           |              |                 |   
      |        |                          | 設定したいオプションを入力します。              |           |              |                 |     
      |        +--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      |        | インベントリファイル\    | ITAが設定していないインベントリファイルの\      | ー        | 手動入力     | 最大長4000バイト|   
      |        | 追加オプション           | オプションパラメータをyaml形式で入力します。    |           |              |                 |  
      |        |                          |                                                 |           |              |                 |   
      |        |                          | Exp)                                            |           |              |                 |   
      |        |                          |                                                 |           |              |                 |
      |        |                          | .. code-block:: yaml                            |           |              |                 |
      |        |                          |                                                 |           |              |                 |   
      |        |                          |    ansible_connection: network_cli              |           |              |                 |   
      |        |                          |    ansible_network_os: ios                      |           |              |                 |   
      |        |                          |    ansible_become: yes                          |           |              |                 |   
      |        |                          |    ansible_become_method: enable                |           |              |                 |   
      |        |                          |                                                 |           |              |                 |      
      |        |                          | 各パラメータ値を変数で記述することも出来ます。  |           |              |                 |   
      |        |                          |                                                 |           |              |                 | 
      |        |                          | .. code-block:: yaml                            |           |              |                 |
      |        |                          |                                                 |           |              |                 |  
      |        |                          |    ansible_become_password: '{{ VAR_passwd }}'  |           |              |                 |   
      |        |                          |                                                 |           |              |                 |     
      |        |                          | 具体値に変数を記述する場合                      |           |              |                 |   
      |        |                          |                                                 |           |              |                 |   
      |        |                          | '{{ VAR_passwd }}'                              |           |              |                 |   
      |        |                          |                                                 |           |              |                 |          
      |        |                          | ':シングル・ダブルコーテーションで囲む「必須」  |           |              |                 |     
      |        |                          |                                                 |           |              |                 |   
      |        |                          | 変数の具体値は「 :ref:`general_operations\      |           |              |                 |   
      |        |                          | _substitution_value_auto_registration\          |           |              |                 | 
      |        |                          | _setting` 」や「 :ref:`general_operations\      |           |              |                 |  
      |        |                          | _substitution_value_list` 」\                   |           |              |                 |   
      |        |                          | メニューから登録します。                        |           |              |                 |     
      |        +--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      |        | Ansi\  | インスタンス\   | Ansible Automation Controller がクラスタ構成の\ | ー        | リスト選択   | ー              |   
      |        | ble \  | グループ名※2    | 場合、どのインスタンスグループで実行するかを選\ |           |              |                 |   
      |        | Autom\ |                 | 択します。ここで設定した、インスタンスグループ\ |           |              |                 |   
      |        | ation \|                 | はインベントリオブジェクトに設定されます。      |           |              |                 |   
      |        | Contr\ |                 |                                                 |           |              |                 |   
      |        | oller \|                 | 未選択の場合はAnsible Automation Controller の\ |           |              |                 |   
      |        | 利用\  |                 | デフォルトのインスタンスグループになります。    |           |              |                 |   
      |        | 情報   |                 |                                                 |           |              |                 |   
      |        |        |                 | Ansible Automation Controller がクラスタ構成\   |           |              |                 |   
      |        |        |                 | でない場合は、未選択で構いません。              |           |              |                 |     
      |        |        +--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      |        |        | 接続タイプ      | Ansible Automation Controller認証情報の接続\    | ○         | リスト選択   |                 |   
      |        |        |                 | タイプを設定します。通常はmachineを選択します。\|           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | ansible_connectionをlocalに設定する必要がある\  |           |              |                 |   
      |        |        |                 | Network OSの場合にNetworkを選択します。         |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | Networkを選択した場合、インベントリファイル追加\|           |              |                 |   
      |        |        |                 | オプションにPlatform Options(ansible_connection\|           |              |                 |   
      |        |        |                 | 以外)を設定する必要があります。                 |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | Exp)                                            |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | インベントリファイル追加オプションの設定例      |           |              |                 |      
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | Network OSがiosの場合の設定値                   |           |              |                 |      
      |        |        |                 |                                                 |           |              |                 | 
      |        |        |                 | .. code-block:: yaml                            |           |              |                 |
      |        |        |                 |                                                 |           |              |                 |  
      |        |        |                 |    ansible_network_os: ios                      |           |              |                 |   
      |        |        |                 |    ansible_become: yes                          |           |              |                 |   
      |        |        |                 |    ansible_become_method: enable                |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |     
      |        |        |                 | Ansible Automation Controllerの認証情報の接続\  |           |              |                 |   
      |        |        |                 | タイプについては、ドキュメント `認証情報タイ    |           |              |                 |   
      |        |        |                 | プ <https://docs.ansible.com/ansible-tower/3.   |           |              |                 |    
      |        |        |                 | 6.4/html_ja/userguide/credentials.html>`__ \    |           |              |                 |      
      |        |        |                 | を参照してください。                            |           |              |                 |   
      |        |        |                 |                                                 |           |              |                 |   
      |        |        |                 | Network OSとansible_connectionの関連やPlat\     |           |              |                 |      
      |        |        |                 | form Optionsについては、Ansibleドキュメント \   |           |              |                 |   
      |        |        |                 | `Platform Options <https://docs.ansible.com/    |           |              |                 |     
      |        |        |                 | ansible/devel/network/user_guide/platform_inde  |           |              |                 |     
      |        |        |                 | x.html>`__ \ を参照してください。               |           |              |                 |      
      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
      | 備考                              | 自由記述欄です。                                | ー        | 手動入力     | 最大長4000バイト|     
      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+

   .. +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. | **項目**                          | **説明**                                        | **入力    | **入力方法** | **制約事項**    |
   .. |                                   |                                                 | 必須**    |              |                 |
   .. |                                   |                                                 |           |              |                 |
   .. +========+========+========+========+=================================================+===========+==============+=================+
   .. | 管理システム項番                  | 登録情報を識別する一意の\                       | ー        | 自動\        | ー              |   
   .. |                                   | ＩＤが自動入力されます。                        |           | 入力         |                 |     
   .. +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. | ホスト名                          | ホスト名を記入します。                          | ○         | 手動\        | 最大長\         |   
   .. |                                   |                                                 |           | 入力         | 128バイト       |   
   .. |                                   | ※\                                              |           |              |                 |   
   .. |                                   | ホスト名をlocalhostに設定し\                    |           |              |                 |   
   .. |                                   | pioneerで作業対象ホストとし\                    |           |              |                 |   
   .. |                                   | 使用する場合、作業実行でエ\                     |           |              |                 |   
   .. |                                   | ラーになる場合があります。\                     |           |              |                 |   
   .. |                                   | その場合、インベントリファ\                     |           |              |                 |   
   .. |                                   | イル追加オプションに下記パ\                     |           |              |                 |   
   .. |                                   | ラメータでansibleサーバーに\                    |           |              |                 |   
   .. |                                   | インストールされているpyth\                     |           |              |                 |   
   .. |                                   | on3のパスを追記してください。\                    |           |              |                 |   
   .. |                                   |                                                 |           |              |                 |   
   .. |                                   | Exp)                                            |           |              |                 |
   .. |                                   |                                                 |           |              |                 |
   .. |                                   | .. code-block:: yaml                            |           |              |                 |
   .. |                                   |                                                 |           |              |                 |   
   .. |                                   |    ansible_python_interpreter: /usr/bin/python3 |           |              |                 |   
   .. |                                   |                                                 |           |              |                 |
   .. +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. | IPアドレス                        | IPアドレス(xxx.x\                               | ○         | 手動\        | 最大長\         |   
   .. |                                   | xx.xxx.xxx形式)を記入します。                   |           | 入力         | 15バイト        |    
   .. +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. | EtherWake\      | MAC\            | MACアドレスを記入します。                       | ー        | 手動\        | 最大長\         |   
   .. | OnLan           | アドレス        |                                                 |           | 入力         | 17バイト        |     
   .. |                 +--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. |                 | ネットワーク\   | ネットワ\                                       | ー        | 手動\        | 最大長\         |   
   .. |                 | デバイス名      | ークデバイス名を記入します。                    |           | 入力         | 256バイト       |     
   .. +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. | ログインユーザID                  | ログインユーザIDを記入します。                  | ○         | 手動\        | 最大長\         |   
   .. |                                   |                                                 |           | 入力         | 30バイト        |      
   .. +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. | ログイン\       | 管理            | ITAでパスワードを管\                            | ○         | リ\          | ー              |   
   .. | パスワード      |                 | 理する場合「●」を選択します。                   |           | スト\        |                 |   
   .. |                 |                 |                                                 |           | 選択         |                 |     
   .. |                 +--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. |                 | ログイン\       | パスワードを指定します。                        | ○         | 手動\        | 最大長\         |   
   .. |                 | パスワード      |                                                 |           | 入力         | 128バイト       |      
   .. +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. | ssh\            | ssh秘密鍵\      | ssh秘密鍵ファイルを\                            | ー        | ファイル\    | 最\             |   
   .. | 鍵認証\         | ファイル        | 指定して鍵認証する場合の秘\                     |           | 選択         | 大サイズ\       |   
   .. | 情報            |                 | 密鍵ファイルを入力します。\                     |           |              | 4Gバイト        |   
   .. |                 |                 | アップロ\                                       |           |              |                 |   
   .. |                 |                 | ードしたファイルは暗号化さ\                     |           |              |                 |   
   .. |                 |                 | れて保存されます。※登録後は\                    |           |              |                 |   
   .. |                 |                 | ダウンロード不可となります。                    |           |              |                 |     
   .. |                 +--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. |                 | パスフレーズ    | ssh秘密鍵ファイルにパスフレ\                    | ー        | 手動\        | 最大長\         |   
   .. |                 |                 | ーズが設定されている場合、\                     |           | 入力         | 256バイト       |   
   .. |                 |                 | パスフレーズを入力します。                      |           |              |                 |     
   .. +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. | Ansib\ | Legacy\| 認証方式        | Ansible・Ansible \                              | ○         | リ\          | 説\             |   
   .. | le利用\| /Role\ |                 | Automation \                                    |           | スト\        | 明欄記載\       |   
   .. | 情報   | 利用\  |                 | Controller \                                    |           | 選択         | のとおり        |   
   .. |        | 情報   |                 | から機器へ接続する\                             |           |              |                 |   
   .. |        |        |                 | 際の認証方式を選択します。                      |           |              |                 | 
   .. |        |        |                 |                                                 |           |              |                 |  
   .. |        |        |                 | ●パスワード認証                                 |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | ログインパスワードの管理\                       |           |              |                 |   
   .. |        |        |                 | で●の選択と、ログインパ\                        |           |              |                 |   
   .. |        |        |                 | スワードの入力が必須です。                      |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | ●鍵認証（パスフレーズなし）                     |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | ssh秘密鍵ファイル(id_ras\                       |           |              |                 |   
   .. |        |        |                 | )のアップロードが必須です。                     |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | ●鍵認証（パスフレーズあり）                     |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | ssh秘密鍵ファイル(id\                           |           |              |                 |   
   .. |        |        |                 | _ras)のアップロードと、パス\                    |           |              |                 |   
   .. |        |        |                 | フレーズの入力が必須です。                      |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | ●鍵認証（鍵交換済み）※1                         |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | ssh秘\                                          |           |              |                 |   
   .. |        |        |                 | 密鍵ファイル(id_ras)のアッ\                     |           |              |                 |   
   .. |        |        |                 | プロードは必要ありません。                      |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | ●パスワード認証（winrm)                         |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | 必要に応じて\                                   |           |              |                 |   
   .. |        |        |                 | WinRM接続情報を入力します。                     |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | 尚、パスワード認証（winrm\                      |           |              |                 |   
   .. |        |        |                 | )以外の認証方式の場合、機器\                    |           |              |                 |   
   .. |        |        |                 | 側に以下の設定が必要です。                      |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | ログインユーザの sudo \                         |           |              |                 |   
   .. |        |        |                 | 権限を NOPASSWD付で \                           |           |              |                 |   
   .. |        |        |                 | /etc/sudoers に設定します。                     |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | Exp)                                            |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |
   .. |        |        |                 | .. code-block::                                 |           |              |                 |
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 |    Demo_user ALL=(ALL) NOPASSWD:ALL             |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        +--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. |        |        | WinRM\ | ポート\| Win\                                            | ー        | 手動\        | 説\             |   
   .. |        |        | 接続\  | 番号   | dowsServerにWinRM接続する際\                    |           | 入力         | 明欄記載\       |   
   .. |        |        | 情報   |        | のポート番号を入力します。                      |           |              | のとおり        |   
   .. |        |        |        |        |                                                 |           |              |                 |   
   .. |        |        |        |        | 未\                                             |           |              |                 |   
   .. |        |        |        |        | 入力の場合はデフォルト(598\                     |           |              |                 |   
   .. |        |        |        |        | 5)でのWinRM接続となります。                     |           |              |                 |     
   .. |        |        |        +--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. |        |        |        | サーバ\| WinRM接続ポートでhttpsの\                       | ー        | ファイル\    | 最\             |   
   .. |        |        |        | 証明書 | ポート番号を指定した場合に\                     |           | 選択         | 大サイズ\       |   
   .. |        |        |        |        | サーバﾞ証明書を入力します。                     |           |              | 4Gバイト        |   
   .. |        |        |        |        | アップロ\                                       |           |              |                 |   
   .. |        |        |        |        | ードしたファイルは暗号化さ\                     |           |              |                 |   
   .. |        |        |        |        | れて保存されます。※登録後は\                    |           |              |                 |   
   .. |        |        |        |        | ダウンロード不可となります。                    |           |              |                 |   
   .. |        |        |        |        |                                                 |           |              |                 |   
   .. |        |        |        |        | サーバ証明\                                     |           |              |                 |   
   .. |        |        |        |        | 書の認証を省く場合、インベ\                     |           |              |                 |   
   .. |        |        |        |        | ントリファイル追加オプショ\                     |           |              |                 |   
   .. |        |        |        |        | ンに下記を追記してください。                      |           |              |                 |   
   .. |        |        |        |        |                                                 |           |              |                 | 
   .. |        |        |        |        | .. code-block:: yaml                            |           |              |                 |
   .. |        |        |        |        |                                                 |           |              |                 |  
   .. |        |        |        |        |    ansible_winrm_server_cert_validation: ignore |           |              |                 |   
   .. |        |        |        |        |                                                 |           |              |                 |    
   .. |        +--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. |        | P\     | プロトコル      | Pioneerから対象機器に\                          | ○         | リ\          | ー              |   
   .. |        | io\    |                 | ログインする際のプロトコル\                     |           | スト\        |                 |   
   .. |        | ne\    |                 | (ssh/telnet)を選択します。                      |           | 選択         |                 |
   .. |        | er\    |                 |                                                 |           |              |                 |   
   .. |        | 利用\  |                 | ●sshを選択した場合                              |           |              |                 |   
   .. |        | 情報   |                 |                                                 |           |              |                 |   
   .. |        |        |                 | 認\                                             |           |              |                 |   
   .. |        |        |                 | 証方式はパスワード認証（win\                    |           |              |                 |   
   .. |        |        |                 | rm)以外を選択してください。                     |           |              |                 | 
   .. |        |        |                 |                                                 |           |              |                 |  
   .. |        |        |                 | ●telnetを選択した場合                           |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | 認証方式に設定した値は使用\                     |           |              |                 |   
   .. |        |        |                 | せずにtelnetで接続します。                      |           |              |                 |   
   .. |        |        +--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. |        |        | OS種別          | 対象機器のOSを選択します。                      | ○         | リ\          | ー              |   
   .. |        |        |                 |                                                 |           | スト\        |                 |
   .. |        |        |                 | OS種別マスタで\                                 |           | 選択         |                 |   
   .. |        |        |                 | 登録されているOS種別が\                         |           |              |                 |   
   .. |        |        |                 | リスト表示されます。                            |           |              |                 |   
   .. |        |        +--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. |        |        | LANG            | Pioneer\                                        | ー        | リ\          | ー              |   
   .. |        |        |                 | の対話ファイルを実行するユ\                     |           | スト\        |                 |   
   .. |        |        |                 | ーザーのLANGを選択します。                      |           | 選択         |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | 空白の\                                         |           |              |                 |   
   .. |        |        |                 | 場合はutf-8扱いとなります。                     |           |              |                 |   
   .. |        +--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. |        | 接続オプション           | （ssh接続の場合）                               | ー        | 手動\        | 最大長\         |   
   .. |        |                          |                                                 |           | 入力         | 512バイト       |   
   .. |        |                          | /etc/ansible.c\                                 |           |              |                 |   
   .. |        |                          | fg/ssh_argsに設定しているss\                    |           |              |                 |   
   .. |        |                          | hオプション以外のオプション\                    |           |              |                 |   
   .. |        |                          | を設定したい場合、設定した\                     |           |              |                 |   
   .. |        |                          | いオプションを入力します。                      |           |              |                 |   
   .. |        |                          |                                                 |           |              |                 |   
   .. |        |                          | （telnet接続の場合）                            |           |              |                 |   
   .. |        |                          |                                                 |           |              |                 |     
   .. |        |                          | telnet接続時のオプション\                       |           |              |                 |   
   .. |        |                          | を設定したい場合、設定した\                     |           |              |                 |   
   .. |        |                          | いオプションを入力します。                      |           |              |                 |   
   .. |        +--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. |        | インベントリファイル\    | ITAが設\                                        | ー        | 手動\        | 最大長\         |   
   .. |        | 追加オプション\          | 定していないインベントリフ\                     |           | 入力         | 512バイト       |   
   .. |        | 「Pioneer利用時は、\     | ァイルのオプションパラメー\                     |           |              |                 |   
   .. |        | 本項目は適用\            | タをyaml形式で入力します。                      |           |              |                 |   
   .. |        | されません。」           |                                                 |           |              |                 |   
   .. |        |                          | Exp)                                            |           |              |                 |   
   .. |        |                          |                                                 |           |              |                 |
   .. |        |                          | .. code-block:: yaml                            |           |              |                 |
   .. |        |                          |                                                 |           |              |                 |   
   .. |        |                          |    ansible_connection: network_cli              |           |              |                 |   
   .. |        |                          |    ansible_network_os: ios                      |           |              |                 |   
   .. |        |                          |    ansible_become: yes                          |           |              |                 |   
   .. |        |                          |    ansible_become_method: enable                |           |              |                 |   
   .. |        |                          |                                                 |           |              |                 |      
   .. |        |                          | 各パラメータ値を変数で記述することも出来ます。  |           |              |                 |   
   .. |        |                          |                                                 |           |              |                 | 
   .. |        |                          | .. code-block:: yaml                            |           |              |                 |
   .. |        |                          |                                                 |           |              |                 |  
   .. |        |                          |    ansible_become_password: '{{ VAR_passwd }}'  |           |              |                 |   
   .. |        |                          |                                                 |           |              |                 |     
   .. |        |                          | 具体値に変数を記述する場合                      |           |              |                 |   
   .. |        |                          |                                                 |           |              |                 |   
   .. |        |                          | '{{△\ VAR_passwd\ △}}'                          |           |              |                 |   
   .. |        |                          |                                                 |           |              |                 |   
   .. |        |                          | △:半角スペース                                  |           |              |                 |   
   .. |        |                          |                                                 |           |              |                 |     
   .. |        |                          | ':シングル・ダブルコ\                           |           |              |                 |   
   .. |        |                          | ーテーションで囲む「必須」                      |           |              |                 |   
   .. |        |                          |                                                 |           |              |                 |   
   .. |        |                          | 変数の具体値は「 :ref:`general_operations\      |           |              |                 |   
   .. |        |                          | _substitution_value_auto_registration\          |           |              |                 | 
   .. |        |                          | _setting` 」や「 :ref:`general_operations\      |           |              |                 |  
   .. |        |                          | _substitution_value_list` 」\                   |           |              |                 |   
   .. |        |                          | メニューから登録します。                        |           |              |                 |     
   .. |        +--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. |        |        | イ\             | Ansible Automation \                            | ー        | リ\          | ー              |   
   .. |        | A\     | ン\             | Controller \                                    |           | スト\        |                 |   
   .. |        | ns\    | ス\             | がクラスタ構成の場合\                           |           | 選択         |                 |   
   .. |        | ib\    | タ\             | 、どのインスタンスグループ\                     |           |              |                 |   
   .. |        | le     | ン\             | で実行するかを選択します。\                     |           |              |                 |   
   .. |        |        | ス\             | ここで設定した、インスタン\                     |           |              |                 |   
   .. |        |        | グ\             | スグループはインベントリオ\                     |           |              |                 |   
   .. |        | Au\    | ル\             | ブジェクトに設定されます。                      |           |              |                 |   
   .. |        | to\    | ー\             |                                                 |           |              |                 |   
   .. |        | ma\    | プ\             | 未選択の場合はAnsible \                         |           |              |                 |   
   .. |        | ti\    | 名\             | Automation \                                    |           |              |                 |   
   .. |        | on     | ※\              | Controller \                                    |           |              |                 |   
   .. |        |        | 2               | のデフォルトのインス\                           |           |              |                 |   
   .. |        |        |                 | タンスグループになります。                      |           |              |                 |   
   .. |        | Co\    |                 |                                                 |           |              |                 |   
   .. |        | nt\    |                 | Ansible Automation \                            |           |              |                 |   
   .. |        | ro\    |                 | Controller \                                    |           |              |                 |   
   .. |        | ll\    |                 | がクラスタ構成でない場\                         |           |              |                 |   
   .. |        | er     |                 | 合は、未選択で構いません。                      |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        | 利\    |                 |                                                 |           |              |                 |   
   .. |        | 用\    |                 |                                                 |           |              |                 |   
   .. |        | 情\    |                 |                                                 |           |              |                 |   
   .. |        | 報     |                 |                                                 |           |              |                 |   
   .. |        |        +--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. |        |        | 接\             | Ansible Automation \                            | ○         | リ\          |                 |   
   .. |        |        | 続\             | Controller認証情\                               |           | スト\        |                 |   
   .. |        |        | タ\             | 報の接続タイプを設定します\                     |           | 選択         |                 |   
   .. |        |        | イ\             | 。通常はmachineを選択します\                    |           |              |                 |   
   .. |        |        | プ              | 。ansible_cnnectionをlocal\                     |           |              |                 |   
   .. |        |        |                 | に設定する必要があるNetwork \                   |           |              |                 |   
   .. |        |        |                 | OSの\                                           |           |              |                 |   
   .. |        |        |                 | 場合にNetworkを選択します。                     |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | Networkを選択し\                                |           |              |                 |   
   .. |        |        |                 | た場合、インベントリファイ\                     |           |              |                 |   
   .. |        |        |                 | ル追加オプションにPlatform \                    |           |              |                 |   
   .. |        |        |                 | Op\                                             |           |              |                 |   
   .. |        |        |                 | tions(ansible_cnnection以外\                    |           |              |                 |   
   .. |        |        |                 | )を設定する必要があります。                     |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | Exp)                                            |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | インベントリファ\                               |           |              |                 |   
   .. |        |        |                 | イル追加オプションの設定例                      |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | Network \                                       |           |              |                 |   
   .. |        |        |                 | OSがiosの場合の設定値                           |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 | 
   .. |        |        |                 | .. code-block:: yaml                            |           |              |                 |
   .. |        |        |                 |                                                 |           |              |                 |  
   .. |        |        |                 |    ansible_network_os: ios                      |           |              |                 |   
   .. |        |        |                 |    ansible_become: yes                          |           |              |                 |   
   .. |        |        |                 |    ansible_become_method: enable                |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |     
   .. |        |        |                 | Ansible Automation \                            |           |              |                 |   
   .. |        |        |                 | Controllerの認\                                 |           |              |                 |   
   .. |        |        |                 | 証情報の接続タイプについて\                     |           |              |                 |   
   .. |        |        |                 | は、ドキュメント `認証情報                      |           |              |                 |   
   .. |        |        |                 | タイプ <https://docs.ansibl                     |           |              |                 |   
   .. |        |        |                 | e.com/ansible-tower/3.6.4/h                     |           |              |                 |   
   .. |        |        |                 | tml_ja/userguide/credential                     |           |              |                 |   
   .. |        |        |                 | s.html>`__ \                                    |           |              |                 |   
   .. |        |        |                 | を参照してください。                              |           |              |                 |   
   .. |        |        |                 |                                                 |           |              |                 |   
   .. |        |        |                 | Network \                                       |           |              |                 |   
   .. |        |        |                 | OSとansible\                                    |           |              |                 |   
   .. |        |        |                 | _connectionの関連やPlatform \                   |           |              |                 |   
   .. |        |        |                 | Optionsにつ\                                    |           |              |                 |   
   .. |        |        |                 | いては、Ansibleドキュメント \                   |           |              |                 |   
   .. |        |        |                 | `Platform                                       |           |              |                 |   
   .. |        |        |                 | Options <https://docs.ansi                      |           |              |                 |   
   .. |        |        |                 | ble.com/ansible/devel/netwo                     |           |              |                 |   
   .. |        |        |                 | rk/user_guide/platform_inde                     |           |              |                 |   
   .. |        |        |                 | x.html>`__ \                                    |           |              |                 |   
   .. |        |        |                 | を参照ください。                                |           |              |                 |   
   .. +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   .. | 備\                               | 自由記述欄です。                                | ー        | 手動\        | 最大長4\        |   
   .. | 考                                |                                                 |           | 入力         | 000バイト       |   
   .. +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-----------------+
   
 
   .. note:: | ※1 認証方式が鍵認証（鍵交換済み）に設定する為に必要な公開鍵ファイルの配布
   
      - | Ansible Coreの場合
        | ansibleがインストールされているサーバーの実行ユーザー「Ansible共通コンソール=>インターフェース情報に設定されている実行ユーザー」から作業対象ホストにssh接続します。
        | 実行ユーザーの公開鍵ファイルをログイン先ユーザーのauthorized_keysにコピーしてください。
   
      - | Ansible Automation Controllerの場合
        | Ansible Automation Controllerのawxユーザーから作業対象ホストにssh接続しています。
        | awxユーザーの公開鍵ファイルをログイン先ユーザーのauthorized_keysにコピーしてください。ブラウザよりAnsible Automation Controllerにログインし、「設定」→「ジョブ」→「分離されたジョブに公開するパス」に :file:`/var/lib/awx/.ssh/` を設定します。
      
        .. image:: /images/ja/diagram/ansible_automationcontroller.png
           :width: 4.97986in
           :height: 1.51304in
           :align: center
         
        | 尚、AnsibleTower4.x以降、awxユーザーの.sshディレクトリが扱えない為、作業対象ホストと鍵認証（鍵交換済み）での接続は出来ません。

   .. note:: | ※2 Ansible driverのバックヤード機能 「Ansible Automation Controllerデータ同期」により取得したデータから選択します。

.. _general_operations_interface_information:

インターフェース情報
~~~~~~~~~~~~~~~~~~~~

#. | :menuselection:`Ansible共通-->インターフェース情報` では、Ansible Core、AnsibleTower、Ansible Automation Controllerのいずれかを実行エンジンに選択し、ITAシステム・Ansible driverサーバと実行エンジンのサーバが共有するディレクトリのパスのおよび実行エンジンのサーバへの接続インターフェース情報のメンテナンス(閲覧/更新)を行います。

   .. figure:: /images/ja/ansible_common/Interface_information/interface_information.png
      :width: 800px
      :alt: サブメニュー画面（インタフェース情報）

      サブメニュー画面（インタフェース情報）

#. | :guilabel:`編集` ボタンより、インターフェース情報の登録を行います。

   .. figure:: /images/ja/ansible_common/Interface_information/registration_interface_information.gif
      :width: 800px
      :alt: 登録画面（インタフェース情報）

      登録画面（インタフェース情報）

#. | インタフェース情報画面の項目一覧は以下のとおりです。
   | インタフェース情報が未登録または、複数レコード登録されている状態で作業実行した場合、作業実行は想定外エラーとなります。

   .. table:: 登録画面項目一覧（インタフェース情報）
      :widths: 8 8 8 24 8 8 10
      :align: left

      +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
      | **項目**                          | **説明**                     | **入力\   | **入力方法** | **制約事項**    |
      |                                   |                              | 必須**    |              |                 |
      |                                   |                              |           |              |                 |
      +=================+========+========+==============================+===========+==============+=================+
      | 実行エンジン                      | 実行するエンジンを\          | ○         | リ\          |                 |
      |                                   | 下記の2種類から選択します。  |           | スト\        |                 |
      |                                   |                              |           | 選択         |                 |
      |                                   | ・Ansible Core               |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   | ・Ansible Automation \       |           |              |                 |
      |                                   | Controller                   |           |              |                 |
      +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
      | Ansible         | 代\             | Ansible Automation \         | ー        | リ\          | 実行エンジ\     |
      |                 | 表\             | Controllerホスト一覧に\      |           | スト\        | ンがAnsible \   |
      | Automation      | ホ\             | 登録されているホストの一覧\  |           | 選択         | Cor\            |
      |                 | ス\             | より、ITAと通信するAnsible \ |           |              | e以外の場合\    |
      | Controller      | ト              | Automation \                 |           |              | に入力必須      |
      |                 |                 | Controllerを選択します。     |           |              |                 |
      | インターフェース|                 |                              |           |              |                 |
      |                 |                 |                              |           |              |                 |
      |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
      |                 | プ\             | Ansible Automation \         | ー        | 手動\        | 実行エンジ\     |
      |                 | ロ\             | Contr\                       |           | 入力         | ンがAnsible \   |
      |                 | ト\             | ollerサーバとのプロトコルを \|           |              | Cor\            |
      |                 | コ\             | http / \                     |           |              | e以外の場合\    |
      |                 | ル              | https \                      |           |              | に入力必須      |
      |                 |                 | のどちらかを入力します。     |           |              |                 |
      |                 |                 |                              |           |              |                 |
      |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
      |                 | ポ\             | Ansible Automation \         | ー        | 手動\        | 実行エンジ\     |
      |                 | ー\             | Controllerサーバの接\        |           | 入力         | ンがAnsible \   |
      |                 | ト              | 続ポート(80/443)を入力しま\  |           |              | Cor\            |
      |                 |                 | す。通常はHTTPS(443)です。   |           |              | e以外の場合\    |
      |                 |                 |                              |           |              | に入力必須      |
      |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
      |                 | 組\             | Ansible Automation \         | ー        | リ\          |                 |
      |                 | 織\             | Controllerサーバに登録され\  |           | スト\        |                 |
      |                 | 名              | ている組織名を選択します。   |           | 選択         |                 |
      |                 |                 |                              |           |              |                 |
      |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
      |                 | 認\             | ITAからAnsible Automation \  | ー        | 手動\        | 最大\           |
      |                 | 証\             | Controlle\                   |           | 入力         | 長255バイト     |
      |                 | ト\             | rサーバに接続するユーザーの\ |           |              |                 |
      |                 | ー\             | 認証トークンを入力します。   |           |              | 実行エンジ\     |
      |                 | ク\             |                              |           |              | ンがAnsible \   |
      |                 | ン              |                              |           |              | Cor\            |
      |                 |                 |                              |           |              | e以外の場合\    |
      |                 |                 |                              |           |              | に入力必須      |
      |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
      |                 | 実\             | 作業実行時にITAとAnsible \   | ー        | リ\          | 実行エンジ\     |
      |                 | 行\             | Automation Controller \      |           | スト\        | ンがAnsible \   |
      |                 | 時\             | 内に一時的に生成した\        |           | 選択         | Cor\            |
      |                 | デ\             | データリソースを作業終了後\  |           |              | e以外の場合\    |
      |                 | ー\             | に削除するかを選択します。   |           |              | に入力必須      |
      |                 | タ\             | 「削\                        |           |              |                 |
      |                 | 削\             | 除する」を選択した場合に削\  |           |              |                 |
      |                 | 除              | 除されるデータリソースは「 \ |           |              |                 |
      |                 |                 | :ref:`general_operations\    |           |              |                 |
      |                 |                 | _data_resources_deleted\     |           |              |                 |
      |                 |                 | _when_executing` \           |           |              |                 |
      |                 |                 | 」を参照してください。       |           |              |                 |
      +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
      |                 | A\              | プロキシサー\                | ー        | 手動\        | 最\             |
      |                 | dd\             | バのアドレスを入力します。   |           | 入力         | 大255バイト     |
      |                 | r\              |                              |           |              |                 |
      | P\              | e\              | ITAがプロキシ\               |           |              |                 |
      | r\              | s\              | 環境下にある場合、Ansible/\  |           |              |                 |
      | o\              | s               | Ansible Automation \         |           |              |                 |
      | x\              |                 | Controlle\                   |           |              |                 |
      | y               |                 | rサーバまでの疎通のために設\ |           |              |                 |
      |                 |                 | 定が必要な場合があります。   |           |              |                 |
      |                 |                 |                              |           |              |                 |
      |                 |                 | プロキシサーバのURLが\       |           |              |                 |
      |                 |                 |                              |           |              |                 |
      |                 |                 | \http://\                    |           |              |                 |
      |                 |                 | procy.gate.co.jp:8080の場合\ |           |              |                 |
      |                 |                 |                              |           |              |                 |
      |                 |                 | Address\                     |           |              |                 |
      |                 |                 | にはhttp://procy.gate.co.jp\ |           |              |                 |
      |                 |                 | を入力します。               |           |              |                 |
      |                 |                 |                              |           |              |                 |
      |                 |                 | Portには 8080を入力します。  |           |              |                 |
      |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
      |                 | P\              | プロキシサ\                  | ー        | 手動\        |                 |
      |                 | o\              | ーバのポートを入力します。   |           | 入力         |                 |
      |                 | r\              |                              |           |              |                 |
      |                 | t\              | ITAがプロキシ\               |           |              |                 |
      |                 |                 | 環境下にある場合、Ansible/\  |           |              |                 |
      |                 |                 | Ansible Automation \         |           |              |                 |
      |                 |                 | Controlle\                   |           |              |                 |
      |                 |                 | rサーバまでの疎通のために設\ |           |              |                 |
      |                 |                 | 定が必要な場合があります。   |           |              |                 |
      +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
      | Ansible-vaultパスワード           | ansible-vaultコマンドで変数\ | ー        | 手動\        | 最大\           |
      |                                   | の具体値を暗号化する場合の\  |           | 入力         | 長64バイト      |
      |                                   | パスワードを入力します。     |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   | 空白の場合は、デフォルト値\  |           |              |                 |
      |                                   | が使用します。               |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   |                              |           |              |                 |
      +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
      | オ\                               | Movement共通のオプショ\      | ー        | 手動\        | 最大\           |
      | プ\                               | ンパラメータを入力します。   |           | 入力         | 長4000バイト    |
      | シ\                               |                              |           |              |                 |
      | ョ\                               | 実行エンジンがAnsible \      |           |              |                 |
      | ン\                               | Coreの場合はansible-playboo\ |           |              |                 |
      | パ\                               | kコマンドのオプションパラメ\ |           |              |                 |
      | ラ\                               | ータ、実行エンジンが\        |           |              |                 |
      | メ\                               | Ansible Core以外\            |           |              |                 |
      | ー\                               | の場合はジョブテンプレート\  |           |              |                 |
      | タ                                | のパラメータを入力します。   |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   | Movement固\                  |           |              |                 |
      |                                   | 有のオプションパラメータは\  |           |              |                 |
      |                                   | Movement一覧で入力します。   |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   | オプションパ\                |           |              |                 |
      |                                   | ラメータの詳細については、\  |           |              |                 |
      |                                   | 「 :ref:`general_operations\ |           |              |                 |
      |                                   | _option_parameter_list` 」\  |           |              |                 |
      |                                   | を参照してください。         |           |              |                 |
      +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
      | N\                                | 代入値自動登録\              | ○         | リ\          | ー              |
      | U\                                | 設定でパラメータシートの具\  |           | スト\        |                 |
      | L\                                | 体値がNULL(空白)の場合に、\  |           | 選択         |                 |
      | L\                                | 代入値管理への登録をNULL(空\ |           |              |                 |
      | 連\                               | 白)の値で行うか設定します。  |           |              |                 |
      | 携                                |                              |           |              |                 |
      |                                   | 代入値自動登録設定メニ\      |           |              |                 |
      |                                   | ューの「NULL連携」が空白の\  |           |              |                 |
      |                                   | 場合この値が適用されます。   |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   | ・「有効」\                  |           |              |                 |
      |                                   | の場合、パラメータシートの\  |           |              |                 |
      |                                   | 値がどのような値でも代入値\  |           |              |                 |
      |                                   | 管理への登録が行われます。   |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   | ・「無効」の\                |           |              |                 |
      |                                   | 場合、パラメータシートに値\  |           |              |                 |
      |                                   | が入っている場合のみ代入値\  |           |              |                 |
      |                                   | 管理への登録が行われます。   |           |              |                 |
      +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
      | 状態監視周期(単位ミリ秒)          | 「:ref:`general_operations_c\| ○         | 手動\        | 最小値1000\     |
      |                                   | heck_operation_status`」で\  |           | 入力         | ミリ秒          |
      |                                   | 表示されるログのリフレッシ\  |           |              |                 |
      |                                   | ュ間隔を入力します。通常は3\ |           |              |                 |
      |                                   | 000ミリ秒程度が推奨値です。  |           |              |                 |
      |                                   |                              |           |              |                 |
      +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
      | 進\                               | 「:ref:`general_operations_c\| ○         | 手動\        | ー              |
      | 行\                               | heck_operation_status`」\    |           | 入力         |                 |
      | 状\                               | での進行ログ・エラーログの\  |           |              |                 |
      | 態\                               | 最大表示行数を入力します。   |           |              |                 |
      | 表\                               |                              |           |              |                 |
      | 示\                               | ステータスが[未実\           |           |              |                 |
      | 行\                               | 行]、[準備中]、[実行中]、[\  |           |              |                 |
      | 数                                | 実行中(遅延)]の場合、指定し\ |           |              |                 |
      |                                   | た行数でログを出力します。   |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   | ステータス\                  |           |              |                 |
      |                                   | が[完了]、[完了(異常)]、[想\ |           |              |                 |
      |                                   | 定外エラー]、[緊急停止]、[\  |           |              |                 |
      |                                   | 未実行(予約)]、[予約取消]の\ |           |              |                 |
      |                                   | 場合、指定した行数ではなく\  |           |              |                 |
      |                                   | すべてのログを出力します。   |           |              |                 |
      |                                   |                              |           |              |                 |
      |                                   | 環境毎にチュ\                |           |              |                 |
      |                                   | ーニングを要しますが、通常\  |           |              |                 |
      |                                   | は1000行程度が推奨値です。   |           |              |                 |
      +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
      | 備\                               | 自由記述欄です。             | ー        | 手動\        | 最大長\         |
      | 考                                |                              |           | 入力         | 4000バイト      |
      +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+

   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. | **項目**                          | **説明**                     | **入力    | **入力方法** | **制約事項**    |
   .. |                                   |                              | 必須**    |              |                 |
   .. |                                   |                              |           |              |                 |
   .. +=================+========+========+==============================+===========+==============+=================+
   .. | 実\                               | 実行するエンジンを\          | ○         | リ\          |                 |
   .. | 行\                               | 下記の3種類から選択します。  |           | スト\        |                 |
   .. | エ\                               |                              |           | 選択         |                 |
   .. | ン\                               | ・Ansible Core               |           |              |                 |
   .. | ジ\                               |                              |           |              |                 |
   .. | ン\                               | ・Ansible Tower              |           |              |                 |
   .. |                                   |                              |           |              |                 |
   .. |                                   | ・Ansible Automation \       |           |              |                 |
   .. |                                   | Controller                   |           |              |                 |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. | Ansible Core    | ホ\             | Ansi\                        | ○         | 手動\        | 最大\           |
   .. |                 | ス\             | bleサーバのホスト名（または\ |           | 入力         | 長128バイト     |
   .. | インターフェース| ト              | IPアドレス）を入力します。   |           |              |                 |
   .. |                 |                 |                              |           |              | 実行エンジ\     |
   .. |                 |                 | HTTPS通信の\                 |           |              | ンがAnsible \   |
   .. |                 |                 | 場合はホスト名が推奨です。   |           |              | Core以外\       |
   .. |                 |                 |                              |           |              | でもansibl\     |
   .. |                 |                 |                              |           |              | e-vaultコマ\    |
   .. |                 |                 |                              |           |              | ンドを実行\     |
   .. |                 |                 |                              |           |              | するAnsible \   |
   .. |                 |                 |                              |           |              | Coreイン\       |
   .. |                 |                 |                              |           |              | ターフェー\     |
   .. |                 |                 |                              |           |              | スの設定が\     |
   .. |                 |                 |                              |           |              | 必要です。      |
   .. |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 | プ\             | An\                          | ○         | 手動\        | -               |
   .. |                 | ロ\             | sibleサーバとのプロトコルを \|           | 入力         | 実行エンジ\     |
   .. |                 | ト\             |                              |           |              | ンがAnsible \   |
   .. |                 | コ\             | http / \                     |           |              | Core以外\       |
   .. |                 | ル              | https \                      |           |              | でもansibl\     |
   .. |                 |                 | のどちらかを入力します。     |           |              | e-vaultコマ\    |
   .. |                 |                 |                              |           |              | ンドを実行\     |
   .. |                 |                 |                              |           |              | するAnsible \   |
   .. |                 |                 |                              |           |              | Coreイン\       |
   .. |                 |                 |                              |           |              | ターフェー\     |
   .. |                 |                 |                              |           |              | スの設定が\     |
   .. |                 |                 |                              |           |              | 必要です。      |
   .. |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 | ポ\             | Ansibleサーバの接\           | ○         | 手動\        | -               |
   .. |                 | ー\             | 続ポート(80/443)を入力しま\  |           | 入力         | 実行エンジ\     |
   .. |                 | ト              | す。通常はHTTPS(443)です。   |           |              | ンがAnsible \   |
   .. |                 |                 |                              |           |              | Core以外\       |
   .. |                 |                 |                              |           |              | でもansibl\     |
   .. |                 |                 |                              |           |              | e-vaultコマ\    |
   .. |                 |                 |                              |           |              | ンドを実行\     |
   .. |                 |                 |                              |           |              | するAnsible \   |
   .. |                 |                 |                              |           |              | Coreイン\       |
   .. |                 |                 |                              |           |              | ターフェー\     |
   .. |                 |                 |                              |           |              | スの設定が\     |
   .. |                 |                 |                              |           |              | 必要です。      |
   .. |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 | 実\             | sudoコ\                      | ○         | 手動\        | 最大\           |
   .. |                 | 行\             | マンドでansible-playbook/an\ |           | 入力         | 長64バイト      |
   .. |                 | ユ\             | sible-vaultコマンドを実行す\ |           |              |                 |
   .. |                 | ー\             | るとユーザーを入力します。   |           |              | 実行エンジ\     |
   .. |                 | ザ\             |                              |           |              | ンがAnsible \   |
   .. |                 | ー              |                              |           |              | Core以外\       |
   .. |                 |                 |                              |           |              | でもansibl\     |
   .. |                 |                 |                              |           |              | e-vaultコマ\    |
   .. |                 |                 |                              |           |              | ンドを実行\     |
   .. |                 |                 |                              |           |              | するAnsible \   |
   .. |                 |                 |                              |           |              | Coreイン\       |
   .. |                 |                 |                              |           |              | ターフェー\     |
   .. |                 |                 |                              |           |              | スの設定が\     |
   .. |                 |                 |                              |           |              | 必要です。      |
   .. |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 | A\              | Ansibleサー\                 | ○         | 手動\        | 最大\           |
   .. |                 | C\              | バと接続時の認証に使用する\  |           | 入力         | 長64バイト      |
   .. |                 | C\              | アクセスキーを入力します。   |           |              |                 |
   .. |                 | E\              |                              |           |              | 実行エンジ\     |
   .. |                 | S\              |                              |           |              | ンがAnsible \   |
   .. |                 | S\              |                              |           |              | Core以外\       |
   .. |                 | _\              |                              |           |              | でもansibl\     |
   .. |                 | K\              |                              |           |              | e-vaultコマ\    |
   .. |                 | E\              |                              |           |              | ンドを実行\     |
   .. |                 | Y\              |                              |           |              | するAnsible \   |
   .. |                 | _\              |                              |           |              | Coreイン\       |
   .. |                 | I\              |                              |           |              | ターフェー\     |
   .. |                 | D               |                              |           |              | スの設定が\     |
   .. |                 |                 |                              |           |              | 必要です。      |
   .. |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 | S\              | Ansibleサーバと接続時の\     | ○         | 手動\        | 最大\           |
   .. |                 | E\              | 認証に使用するシークレット\  |           | 入力         | 長64バイト      |
   .. |                 | C\              | アクセスキーを入力します。   |           |              |                 |
   .. |                 | R\              |                              |           |              | 実行エンジ\     |
   .. |                 | E\              |                              |           |              | ンがAnsible \   |
   .. |                 | T\              |                              |           |              | Core以外\       |
   .. |                 | _\              |                              |           |              | でもansibl\     |
   .. |                 | A\              |                              |           |              | e-vaultコマ\    |
   .. |                 | C\              |                              |           |              | ンドを実行\     |
   .. |                 | C\              |                              |           |              | するAnsible \   |
   .. |                 | E\              |                              |           |              | Coreイン\       |
   .. |                 | S\              |                              |           |              | ターフェー\     |
   .. |                 | S\              |                              |           |              | スの設定が\     |
   .. |                 | _\              |                              |           |              | 必要です。      |
   .. |                 | K\              |                              |           |              |                 |
   .. |                 | E\              |                              |           |              |                 |
   .. |                 | Y\              |                              |           |              |                 |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. | Ansible         | 代\             | Ansible Automation \         | ー        | リ\          | 実行エンジ\     |
   .. |                 | 表\             | Controllerホスト一覧に\      |           | スト\        | ンがAnsible \   |
   .. | Automation      | ホ\             | 登録されているホストの一覧\  |           | 選択         | Cor\            |
   .. |                 | ス\             | より、ITAと通信するAnsible \ |           |              | e以外の場合\    |
   .. | Controller      | ト              | Automation \                 |           |              | に入力必須      |
   .. |                 |                 | Controllerを選択します。     |           |              |                 |
   .. | インターフェース|                 |                              |           |              |                 |
   .. |                 |                 |                              |           |              |                 |
   .. |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 | プ\             | Ansible Automation \         | ー        | 手動\        | 実行エンジ\     |
   .. |                 | ロ\             | Contr\                       |           | 入力         | ンがAnsible \   |
   .. |                 | ト\             | ollerサーバとのプロトコルを \|           |              | Cor\            |
   .. |                 | コ\             | http / \                     |           |              | e以外の場合\    |
   .. |                 | ル              | https \                      |           |              | に入力必須      |
   .. |                 |                 | のどちらかを入力します。     |           |              |                 |
   .. |                 |                 |                              |           |              |                 |
   .. |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 | ポ\             | Ansible Automation \         | ー        | 手動\        | 実行エンジ\     |
   .. |                 | ー\             | Controllerサーバの接\        |           | 入力         | ンがAnsible \   |
   .. |                 | ト              | 続ポート(80/443)を入力しま\  |           |              | Cor\            |
   .. |                 |                 | す。通常はHTTPS(443)です。   |           |              | e以外の場合\    |
   .. |                 |                 |                              |           |              | に入力必須      |
   .. |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 | 組\             | Ansible Automation \         | ー        | リ\          | 実行エンジ\     |
   .. |                 | 織\             | Controllerサーバに登録され\  |           | スト\        | ンがAnsible \   |
   .. |                 | 名              | ている組織名を選択します。   |           | 選択         | Cor\            |
   .. |                 |                 |                              |           |              | e以外の場合\    |
   .. |                 |                 |                              |           |              | に入力必須      |
   .. |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 | 認\             | ITAからAnsible Automation \  | ー        | 手動\        | 最大\           |
   .. |                 | 証\             | Controlle\                   |           | 入力         | 長128バイト     |
   .. |                 | ト\             | rサーバに接続するユーザーの\ |           |              |                 |
   .. |                 | ー\             | 認証トークンを入力します。   |           |              | 実行エンジ\     |
   .. |                 | ク\             |                              |           |              | ンがAnsible \   |
   .. |                 | ン              |                              |           |              | Cor\            |
   .. |                 |                 |                              |           |              | e以外の場合\    |
   .. |                 |                 |                              |           |              | に入力必須      |
   .. |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 | 実\             | 作業実行時にITAとAnsible \   | ー        | リ\          | 実行エンジ\     |
   .. |                 | 行\             | Automation Controller \      |           | スト\        | ンがAnsible \   |
   .. |                 | 時\             | 内に一時的に生成した\        |           | 選択         | Cor\            |
   .. |                 | デ\             | データリソースを作業終了後\  |           |              | e以外の場合\    |
   .. |                 | ー\             | に削除するかを選択します。   |           |              | に入力必須      |
   .. |                 | タ\             | 「削\                        |           |              |                 |
   .. |                 | 削\             | 除する」を選択した場合に削\  |           |              |                 |
   .. |                 | 除              | 除されるデータリソースは「 \ |           |              |                 |
   .. |                 |                 | :ref:`general_operations\    |           |              |                 |
   .. |                 |                 | _data_resources_deleted\     |           |              |                 |
   .. |                 |                 | _when_executing` \           |           |              |                 |
   .. |                 |                 | 」を参照してください。         |           |              |                 |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 | A\              | プロキシサー\                | ー        | 手動\        | 最\             |
   .. |                 | d\              | バのアドレスを入力します。   |           | 入力         | 大128バイト     |
   .. |                 | r\              |                              |           |              |                 |
   .. | P\              | e\              | ITAがプロキシ\               |           |              |                 |
   .. | r\              | s\              | 環境下にある場合、Ansible/\  |           |              |                 |
   .. | o\              | s               | Ansible Automation \         |           |              |                 |
   .. | x\              |                 | Controlle\                   |           |              |                 |
   .. | y               |                 | rサーバまでの疎通のために設\ |           |              |                 |
   .. |                 |                 | 定が必要な場合があります。   |           |              |                 |
   .. |                 |                 |                              |           |              |                 |
   .. |                 |                 | プロキシサーバのURLが\       |           |              |                 |
   .. |                 |                 |                              |           |              |                 |
   .. |                 |                 | \http://\                    |           |              |                 |
   .. |                 |                 | procy.gate.co.jp:8080の場合\ |           |              |                 |
   .. |                 |                 |                              |           |              |                 |
   .. |                 |                 | Address\                     |           |              |                 |
   .. |                 |                 | にはhttp://procy.gate.co.jp\ |           |              |                 |
   .. |                 |                 | を入力します。               |           |              |                 |
   .. |                 |                 |                              |           |              |                 |
   .. |                 |                 | Portには 8080を入力します。  |           |              |                 |
   .. |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 | P\              | プロキシサ\                  | ー        | 手動\        |                 |
   .. |                 | o\              | ーバのポートを入力します。   |           | 入力         |                 |
   .. |                 | r\              |                              |           |              |                 |
   .. |                 | t\              | ITAがプロキシ\               |           |              |                 |
   .. |                 |                 | 環境下にある場合、Ansible/\  |           |              |                 |
   .. |                 |                 | Ansible Automation \         |           |              |                 |
   .. |                 |                 | Controlle\                   |           |              |                 |
   .. |                 |                 | rサーバまでの疎通のために設\ |           |              |                 |
   .. |                 |                 | 定が必要な場合があります。   |           |              |                 |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 | ホ\             | Ansible Automation \         | ー        | 手動\        | 最大\           |
   .. |                 | ス\             | Controllerから連携先のGitリ\ |           | 入力         | 長128バイト     |
   .. |                 | ト\             | ポジトリへsshプロトコルで接\ |           |              |                 |
   .. | S\              | 名              | 続する為のホスト名（または\  |           |              | 実行エンジ\     |
   .. | C\              |                 | IPアドレス）を入力します。   |           |              | ンがAnsible \   |
   .. | M\              |                 |                              |           |              | Automation \    |
   .. | 管\             |                 | Ansible \                    |           |              | C\              |
   .. | 理              |                 | driverのバ\                  |           |              | ontrollerの\    |
   .. |                 |                 | ックヤード機能がインストー\  |           |              | 場合に必須\     |
   .. |                 |                 | ルされているホストにAnsible \|           |              | 入力です。      |
   .. |                 |                 | Automation \                 |           |              |                 |
   .. | G\              |                 | Controllerと連携するGi\      |           |              |                 |
   .. | i\              |                 | tリポジトリが作成されます。  |           |              |                 |
   .. | t\              |                 |                              |           |              |                 |
   .. | 連\             |                 |                              |           |              |                 |
   .. | 携\             |                 |                              |           |              |                 |
   .. | 先\             |                 |                              |           |              |                 |
   .. | 情\             |                 |                              |           |              |                 |
   .. | 報              |                 |                              |           |              |                 |
   .. |                 +--------+--------+------------------------------+-----------+--------------+-----------------+
   .. |                 |        | ユー\  | Ansible Automation \         | ー        | 手動\        | 最大\           |
   .. |                 |        | ザー   | Contro\                      |           | 入力         | 長128バイト     |
   .. |                 |        |        | llerから連携先のGitリポジト\ |           |              |                 |
   .. |                 | L\     |        | リへsshプロトコルで接続する\ |           |              | 実行エンジ\     |
   .. |                 | i\     |        | 為のユーザーを入力します。   |           |              | ンがAnsible \   |
   .. |                 | n\     |        |                              |           |              | Automation \    |
   .. |                 | u\     |        |                              |           |              | C\              |
   .. |                 | x\     |        |                              |           |              | ontrollerの\    |
   .. |                 | ア\    |        |                              |           |              | 場合に必須\     |
   .. |                 | カ\    |        |                              |           |              | 入力です。      |
   .. |                 | ウ\    |        |                              |           |              |                 |
   .. |                 | ン\    |        |                              |           |              |                 |
   .. |                 | ト     |        |                              |           |              |                 |
   .. |                 |        +--------+------------------------------+-----------+--------------+-----------------+
   .. |                 |        | ssh秘\ | Ansible Automation \         | ー        | ファ\        | フ\             |
   .. |                 |        | 密鍵\  | Controllerから連携先の\      |           | イル         | ァイル選択      |
   .. |                 |        | ファ\  | Gitリポジトリへsshプロトコ\  |           |              |                 |
   .. |                 |        | イル   | ルの鍵認証で接続する為の秘\  |           |              | 最大サイ\       |
   .. |                 |        |        | 密鍵ファイルを入力します。   |           |              | ズ4Gバイト      |
   .. |                 |        |        |                              |           |              |                 |
   .. |                 |        |        |                              |           |              | 実行エンジ\     |
   .. |                 |        |        |                              |           |              | ンがAnsible \   |
   .. |                 |        |        |                              |           |              | Automation \    |
   .. |                 |        |        |                              |           |              | C\              |
   .. |                 |        |        |                              |           |              | ontrollerの\    |
   .. |                 |        |        |                              |           |              | 場合に必須\     |
   .. |                 |        |        |                              |           |              | 入力です。      |
   .. |                 |        +--------+------------------------------+-----------+--------------+-----------------+
   .. |                 |        | パス\  | ssh秘密\                     | ー        | 手動\        | 最大\           |
   .. |                 |        | フレ\  | 鍵ファイルに設定されている\  |           | 入力         | 長256バイト     |
   .. |                 |        | ーズ   | パスフレーズを入力します。   |           |              |                 |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. | データリレイストレージパス\       | ITAシステム・Ansible \       | ○         | 手動\        | 最大\           |
   .. | (ITA)※                            | driverサーバから見た\        |           | 入力         | 長128バイト     |
   .. |                                   | ディレクトリを入力します。   |           |              |                 |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. | データリレイストレージパス\       | Ansibleサーバーから見た\     | ○         | 手動\        | 最大\           |
   .. | (Ansible)                         | ディレクトリを入力します。   |           | 入力         | 長128バイト     |
   .. |                                   |                              |           |              |                 |
   .. |                                   |                              |           |              | 実行エンジ\     |
   .. |                                   |                              |           |              | ンがAnsible \   |
   .. |                                   |                              |           |              | C\              |
   .. |                                   |                              |           |              | ore以外では\    |
   .. |                                   |                              |           |              | 使用しない\     |
   .. |                                   |                              |           |              | 情報です。      |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. | S\                                | Symphony実行時、各Movem\     | ○         | 手動\        | 最大\           |
   .. | y\                                | entで共有するディレクトリで\ |           | 入力         | 長128バイト     |
   .. | m\                                | す。Ansibleサーバーから見た\ |           |              |                 |
   .. | p\                                | ディレクトリを入力します。   |           |              | 実行エンジ\     |
   .. | h\                                |                              |           |              | ンがAnsible \   |
   .. | o\                                | ITAシステムから見たパ\       |           |              | Core以外で\     |
   .. | n\                                | スはSymphonyインターフェー\  |           |              | は使用ない\     |
   .. | y\                                | ス情報より設定します。Symph\ |           |              | 情報です。      |
   .. | イ\                               | onyインターフェース情報につ\ |           |              |                 |
   .. | ン\                               | いては「利用手順マニュアル \ |           |              |                 |
   .. | ス\                               | S\                           |           |              |                 |
   .. | タ\                               | ymphony」を参照してください。  |           |              |                 |
   .. | ン\                               |                              |           |              |                 |
   .. | ス\                               |                              |           |              |                 |
   .. | デ\                               |                              |           |              |                 |
   .. | ー\                               |                              |           |              |                 |
   .. | タ\                               |                              |           |              |                 |
   .. | リ\                               |                              |           |              |                 |
   .. | レ\                               |                              |           |              |                 |
   .. | イ\                               |                              |           |              |                 |
   .. | ス\                               |                              |           |              |                 |
   .. | ト\                               |                              |           |              |                 |
   .. | レ\                               |                              |           |              |                 |
   .. | ー\                               |                              |           |              |                 |
   .. | ジ\                               |                              |           |              |                 |
   .. | パ\                               |                              |           |              |                 |
   .. | ス\                               |                              |           |              |                 |
   .. | (\                                |                              |           |              |                 |
   .. | A\                                |                              |           |              |                 |
   .. | n\                                |                              |           |              |                 |
   .. | s\                                |                              |           |              |                 |
   .. | i\                                |                              |           |              |                 |
   .. | b\                                |                              |           |              |                 |
   .. | l\                                |                              |           |              |                 |
   .. | e\                                |                              |           |              |                 |
   .. | )                                 |                              |           |              |                 |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. | C\                                | Conducto\                    | ○         | 手動\        | 最大\           |
   .. | o\                                | r実行時、各Movementで共有す\ |           | 入力         | 長128バイト     |
   .. | n\                                | るディレクトリです。Ansible\ |           |              |                 |
   .. | d\                                | サーバーから見た\            |           |              | 実行エンジ\     |
   .. | u\                                | ディレクトリを入力します。   |           |              | ンがAnsible \   |
   .. | c\                                |                              |           |              | Core以外で\     |
   .. | t\                                | ITAシステムから見たパス\     |           |              | は使用ない\     |
   .. | o\                                | はConductorインターフェース\ |           |              | 情報です。      |
   .. | r\                                | 情報より設定します。Conduc\  |           |              |                 |
   .. | イ\                               | torインターフェース情報につ\ |           |              |                 |
   .. | ン\                               | いては\                      |           |              |                 |
   .. | ス\                               | :doc:`\                      |           |              |                 |
   .. | タ\                               | ../it_automa\                |           |              |                 |
   .. | ン\                               | tion_base/conductor` \       |           |              |                 |
   .. | ス\                               | を参照してください。           |           |              |                 |
   .. | デ\                               |                              |           |              |                 |
   .. | ー\                               |                              |           |              |                 |
   .. | タ\                               |                              |           |              |                 |
   .. | リ\                               |                              |           |              |                 |
   .. | レ\                               |                              |           |              |                 |
   .. | イ\                               |                              |           |              |                 |
   .. | ス\                               |                              |           |              |                 |
   .. | ト\                               |                              |           |              |                 |
   .. | レ\                               |                              |           |              |                 |
   .. | ー\                               |                              |           |              |                 |
   .. | ジ\                               |                              |           |              |                 |
   .. | パ\                               |                              |           |              |                 |
   .. | ス\                               |                              |           |              |                 |
   .. | (\                                |                              |           |              |                 |
   .. | A\                                |                              |           |              |                 |
   .. | n\                                |                              |           |              |                 |
   .. | s\                                |                              |           |              |                 |
   .. | i\                                |                              |           |              |                 |
   .. | b\                                |                              |           |              |                 |
   .. | l\                                |                              |           |              |                 |
   .. | e\                                |                              |           |              |                 |
   .. | )                                 |                              |           |              |                 |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. | オ\                               | Movement共通のオプショ\      | ー        | 手動\        | 最大\           |
   .. | プ\                               | ンパラメータを入力します。   |           | 入力         | 長512バイト     |
   .. | シ\                               |                              |           |              |                 |
   .. | ョ\                               | 実行エンジンがAnsible \      |           |              |                 |
   .. | ン\                               | Coreの場合はansible-playboo\ |           |              |                 |
   .. | パ\                               | kコマンドのオプションパラメ\ |           |              |                 |
   .. | ラ\                               | ータ、実行エンジンが\        |           |              |                 |
   .. | メ\                               | Ansible Core以外\            |           |              |                 |
   .. | ー\                               | の場合はジョブテンプレート\  |           |              |                 |
   .. | タ                                | のパラメータを入力します。   |           |              |                 |
   .. |                                   |                              |           |              |                 |
   .. |                                   | Movement固\                  |           |              |                 |
   .. |                                   | 有のオプションパラメータは\  |           |              |                 |
   .. |                                   | Movement一覧で入力します。   |           |              |                 |
   .. |                                   |                              |           |              |                 |
   .. |                                   | オプションパ\                |           |              |                 |
   .. |                                   | ラメータの詳細については、\  |           |              |                 |
   .. |                                   | 「 :ref:`general_operations\ |           |              |                 |
   .. |                                   | _option_parameter_list` 」\  |           |              |                 |
   .. |                                   | を参照してください。         |           |              |                 |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. | 並\                               | 同時に実行でき\              | ○         | 手動\        |                 |
   .. | 列\                               | るMovement(Legacy/Pioneer/\  |           | 入力         |                 |
   .. | 実\                               | Legacy-\                     |           |              |                 |
   .. | 行\                               | Role)の最大数を入力します。  |           |              |                 |
   .. | 数                                |                              |           |              |                 |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. | 状\                               | 「:ref:`general_operations_c\| ○         | 手動\        | 最小値1000\     |
   .. | 態\                               | heck_operation_status`」で\  |           | 入力         | ミリ秒          |
   .. | 監\                               | 表示されるログのリフレッシ\  |           |              |                 |
   .. | 視\                               | ュ間隔を入力します。通常は3\ |           |              |                 |
   .. | 周\                               | 000ミリ秒程度が推奨値です。  |           |              |                 |
   .. | 期\                               |                              |           |              |                 |
   .. | （\                               |                              |           |              |                 |
   .. | 単\                               |                              |           |              |                 |
   .. | 位\                               |                              |           |              |                 |
   .. | ミ\                               |                              |           |              |                 |
   .. | リ\                               |                              |           |              |                 |
   .. | 秒\                               |                              |           |              |                 |
   .. | ）                                |                              |           |              |                 |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. | 進\                               | 「:ref:`general_operations_c\| ○         | 手動\        | ー              |
   .. | 行\                               | heck_operation_status`」\    |           | 入力         |                 |
   .. | 状\                               | での進行ログ・エラーログの\  |           |              |                 |
   .. | 態\                               | 最大表示行数を入力します。   |           |              |                 |
   .. | 表\                               |                              |           |              |                 |
   .. | 示\                               | ステータスが[未実\           |           |              |                 |
   .. | 行\                               | 行]、[準備中]、[実行中]、[\  |           |              |                 |
   .. | 数                                | 実行中(遅延)]の場合、指定し\ |           |              |                 |
   .. |                                   | た行数でログを出力します。   |           |              |                 |
   .. |                                   |                              |           |              |                 |
   .. |                                   | ステータス\                  |           |              |                 |
   .. |                                   | が[完了]、[完了(異常)]、[想\ |           |              |                 |
   .. |                                   | 定外エラー]、[緊急停止]、[\  |           |              |                 |
   .. |                                   | 未実行(予約)]、[予約取消]の\ |           |              |                 |
   .. |                                   | 場合、指定した行数ではなく\  |           |              |                 |
   .. |                                   | すべてのログを出力します。   |           |              |                 |
   .. |                                   |                              |           |              |                 |
   .. |                                   | 環境毎にチュ\                |           |              |                 |
   .. |                                   | ーニングを要しますが、通常\  |           |              |                 |
   .. |                                   | は1000行程度が推奨値です。   |           |              |                 |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. | N\                                | 代入値自動登録\              | ○         | リ\          | ー              |
   .. | U\                                | 設定でパラメータシートの具\  |           | スト\        |                 |
   .. | L\                                | 体値がNULL(空白)の場合に、\  |           | 選択         |                 |
   .. | L\                                | 代入値管理への登録をNULL(空\ |           |              |                 |
   .. | 連\                               | 白)の値で行うか設定します。  |           |              |                 |
   .. | 携                                |                              |           |              |                 |
   .. |                                   | 代入値自動登録設定メニ\      |           |              |                 |
   .. |                                   | ューの「NULL連携」が空白の\  |           |              |                 |
   .. |                                   | 場合この値が適用されます。   |           |              |                 |
   .. |                                   |                              |           |              |                 |
   .. |                                   | ・「有効」\                  |           |              |                 |
   .. |                                   | の場合、パラメータシートの\  |           |              |                 |
   .. |                                   | 値がどのような値でも代入値\  |           |              |                 |
   .. |                                   | 管理への登録が行われます。   |           |              |                 |
   .. |                                   |                              |           |              |                 |
   .. |                                   | ・「無効」の\                |           |              |                 |
   .. |                                   | 場合、パラメータシートに値\  |           |              |                 |
   .. |                                   | が入っている場合のみ代入値\  |           |              |                 |
   .. |                                   | 管理への登録が行われます。   |           |              |                 |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   .. | 備\                               | 自由記述欄です。             | ー        | 手動\        | 最大長\         |
   .. | 考                                |                              |           | 入力         | 4000バイト      |
   .. +-----------------+--------+--------+------------------------------+-----------+--------------+-----------------+
   
   .. | ※ データリレイストレージパスは、ITAとAnsibleが別サーバで運用する構成もサポートするので、ディレクトリパスを別々に管理します。詳細は :doc:`./architecture` を参照してください。

.. _general_operations_ansible_automation_controlller_hosts:

Ansible Automation Controller ホスト一覧
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#. | :menuselection:`Ansible共通-->Ansible Automation Controller ホスト一覧` では、Ansible Automation ControllerのRestAPI実行に必要な情報、および構築資材をAnsible Automation Controllerにファイル転送するために必要な情報のメンテナンス(閲覧/登録/更新/廃止)を行います。
   | クラスタ構成の場合は、構成している全てのサーバを登録してください。
   | ただし、Ansible Automation Controllerのhop nodeの登録は不要です。

   .. figure:: /images/ja/ansible_common/ansible_automation_controller/ansible_automation_controller_host_list.png
      :width: 800px
      :alt: サブメニュー画面（Ansible Automation Controller ホスト一覧）
   
      サブメニュー画面（Ansible Automation Controller ホスト一覧）

#. | :guilabel:`＋ 登録` ボタンより、Ansible Automation Controllerのホスト情報の登録を行います。

   .. figure:: /images/ja/ansible_common/ansible_automation_controller/ansible_automation_controller_host_list.gif
      :width: 800px
      :alt: 登録画面（Ansible Automation Controller ホスト一覧）

      登録画面（Ansible Automation Controller ホスト一覧）

#. | Ansible Automation Controller ホスト一覧画面の項目一覧は以下のとおりです。

   .. table:: 登録画面項目一覧（Ansible Automation Controller ホスト一覧）
      :align: left

      +-----+-------+-----------------------------+-------+-------+-------------+
      | **項目**    | **説明**                    | **入\ | **入\ | **制約\     |
      |             |                             | 力\   | 力方\ | 事項**      |
      |             |                             | 必\   | 法**  |             |
      |             |                             | 須**  |       |             |
      |             |                             |       |       |             |
      |             |                             |       |       |             |
      |             |                             |       |       |             |
      +=====+=======+=============================+=======+=======+=============+
      | ホ\         | Ansible Automation \        | ○     | 手動\ | 最大\       |
      | ス\         | Controllerサーバ\           |       | 入力  | 長255バイト |
      | ト          | のホスト名（または\         |       |       |             |
      |             | IPアドレス）を入力します。  |       |       |             |
      |             |                             |       |       |             |
      |             | HTTPS通信の\                |       |       |             |
      |             | 場合はホスト名が推奨です。  |       |       |             |
      +-----+-------+-----------------------------+-------+-------+-------------+
      | 認\         | Ansible Automation \        | ○     | 手動\ | 最大\       |
      | 証\         | Controllerサーバへ\         |       | 入力  | 長30バイト  |
      | 方\         | ファイル転送(scp)で接続する\|       |       |             |
      | 式          | 際の認証方式を選択します。  |       |       |             |
      |             |                             |       |       |             |
      |             | ●パスワード認証             |       |       |             |
      |             |                             |       |       |             |
      |             | ログインユーザとパ\         |       |       |             |
      |             | スワードの入力が必須です。  |       |       |             |
      |             |                             |       |       |             |
      |             | ●鍵認証（パスフレーズなし） |       |       |             |
      |             |                             |       |       |             |
      |             | ssh秘密鍵ファイル(id_ras\   |       |       |             |
      |             | )のアップロードが必須です。 |       |       |             |
      |             |                             |       |       |             |
      |             | ●鍵認証（パスフレーズあり） |       |       |             |
      |             |                             |       |       |             |
      |             | ssh秘密鍵ファイル(id\       |       |       |             |
      |             | _ras)のアップロードと、パス\|       |       |             |
      |             | フレーズの入力が必須です。  |       |       |             |
      |             |                             |       |       |             |
      |             | ●鍵認証（鍵交換済み）※      |       |       |             |
      |             |                             |       |       |             |
      |             | ssh秘\                      |       |       |             |
      |             | 密鍵ファイル(id_ras)のアッ\ |       |       |             |
      |             | プロードは必要ありません。  |       |       |             |
      +-----+-------+-----------------------------+-------+-------+-------------+
      | ユーザー    | Ansible Automation \        | ○     | 手動\ | 最大\       |
      |             | Controllerサーバへファイ\   |       | 入力  | 長255バイト |
      |             | ル転送(scp)で接続する際の\  |       |       |             |
      |             | ログインユーザを入力します。|       |       |             |
      |             |                             |       |       |             |
      |             | ログインユーザは、Ansible \ |       |       |             |
      |             | Automation \                |       |       |             |
      |             | Controllerインストール時に\ |       |       |             |
      |             | 生成されるawxユーザーに\    |       |       |             |
      |             | パスワードを設定し、使\     |       |       |             |
      |             | 用することを強く推奨します。|       |       |             |
      +-----+-------+-----------------------------+-------+-------+-------------+
      | パ\         | 認証方式\                   | ー    | 手動\ | 最大\       |
      | ス\         | でパスワード認証を選択した\ |       | 入力  | 長30バイト  |
      | ワ\         | 場合に必須入力となります。  |       |       |             |
      | ー\         | ログインユーザ\             |       |       |             |
      | ド          | のパスワードを指定します。  |       |       |             |
      +-----+-------+-----------------------------+-------+-------+-------------+
      | ssh\| ssh\  | ssh秘密鍵ファイルを\        | ー    | ファ\ | 最大サイ\   |
      | 鍵\ | 秘密\ | 指定して鍵認証する場合の秘\ |       | イル\ | ズ100Mバイト|
      | 認\ | 鍵\   | 密鍵ファイルを入力します。  |       | 選択  |             |
      | 証\ | ファ\ | アップロードしたファイル\   |       |       |             |
      | 情\ | イル  | は暗号化されて保存されま\   |       |       |             |
      | 報  |       | す。※登録後は\              |       |       |             |
      |     |       | ダウンロード不可となります。|       |       |             |
      |     +-------+-----------------------------+-------+-------+-------------+
      |     | パス\ | ssh秘密鍵ファイルにパスフレ\| ー    | 手動\ | 最大\       |
      |     | フレ\ | ーズが設定されている場合、\ |       | 入力  | 長255バイト |
      |     | ーズ  | パスフレーズを入力します。  |       |       |             |
      +-----+-------+-----------------------------+-------+-------+-------------+
      | iso\        | ク\                         | ー    | リス\ |             |
      | lat\        | ラスタ構成で構築されている\ |       | ト選\ |             |
      | ed\         | 場合で、対象ノードがAnsible\|       | 択    |             |
      | To\         | Towerのisolated\            |       |       |             |
      | wer\        | node/Ansible Automation \   |       |       |             |
      |             | Controllerのexecution \     |       |       |             |
      |             | node \                      |       |       |             |
      |             | の場合、「●」を選択します。 |       |       |             |
      +-----+-------+-----------------------------+-------+-------+-------------+
      | 備\         | 自由記述欄です。            | ー    | 手動\ | 最大長\     |
      | 考          |                             |       | 入力  | 4000バイト  |
      +-----+-------+-----------------------------+-------+-------+-------------+

   .. note:: | ※ 認証方式が鍵認証（鍵交換済み）に設定する為に必要な公開鍵ファイルの配布
      | ITAがインストールされているサーバーのrootからAnsible Automation Controllerのawxユーザーでssh接続します。
      | rootの公開鍵ファイルをAnsible Automation Controllerのawxユーザーのauthorized_keysにコピーして下さい。




.. _general_operations_global_variable_list:

グローバル変数管理
~~~~~~~~~~~~~~~~~~

#. | :menuselection:`Ansible共通-->グローバル変数管理` では、Playbookで利用するグローバル変数名のメンテナンス(閲覧/登録/更新/廃止)を行います。

   .. figure:: /images/ja/ansible_common/global_variable/global_variable_list.png
      :width: 800px
      :alt: サブメニュー画面（グローバル変数管理）

      サブメニュー画面（グローバル変数管理）

#. | :guilabel:`＋ 登録` ボタンより、グローバル変数管理情報の登録を行います。

   .. figure:: /images/ja/ansible_common/global_variable/global_variable_list.gif
      :width: 800px
      :alt: 登録画面（グローバル変数管理）

      登録画面（グローバル変数管理）

#. | グローバル変数管理画面の項目一覧は以下のとおりです。

   .. table:: 登録画面項目一覧（グローバル変数管理）
      :align: left

      +-----------+--------------------------------+-------+-------+-------------+
      | **項目**  | **説明**                       | **入\ | **入\ | **制約\     |
      |           |                                | 力\   | 力方\ | 事項**      |
      |           |                                | 必\   | 法**  |             |
      |           |                                | 須**  |       |             |
      |           |                                |       |       |             |
      |           |                                |       |       |             |
      +===========+================================+=======+=======+=============+
      | グローバ\ | 変数名を入力します。           | ○     | 手動\ | 説明欄記\   |
      | ル変数名  |                                |       | 入力  | 載のとおり  |
      |           | 変数名は、\                    |       |       |             |
      |           | 「GBL_****」形式で入力します。 |       |       |             |
      |           |                                |       |       |             |
      |           | \****                          |       |       |             |
      |           | ：半角英数字とアンダースコア（ |       |       |             |
      |           | \_                             |       |       |             |
      |           | ）が利用可能です。(最小\       |       |       |             |
      |           | 値:1バイト、最大値:255バイト)  |       |       |             |
      +-----------+--------------------------------+-------+-------+-------------+
      | 具体値    | 具体値を入力\                  | ー    | 手動\ | 最大長\     |
      |           | します。複数行の具体値も入力で\|       | 入力  | 4000バイト  |
      |           | きますが、Pioneerの対話ファイ\ |       |       |             |
      |           | ルで使用しているグローバル変数\|       |       |             |
      |           | で複数行の具体値を設定すると、\|       |       |             |
      |           | 作業実行時にエラーとなります。 |       |       |             |
      |           |                                |       |       |             |
      +-----------+--------------------------------+-------+-------+-------------+
      | 変\       | 変数に対する\                  | ー    | 手動\ | 最大長\     |
      | 数名説明  | 説明・コメントを入力します。   |       | 入力  | 4000バイト  |
      +-----------+--------------------------------+-------+-------+-------------+
      | 備考      | 自由記述欄です。               | ー    | 手動\ | 最大長\     |
      |           |                                |       | 入力  | 4000バイト  |
      +-----------+--------------------------------+-------+-------+-------------+



.. _general_operations_file_list:

ファイル管理
~~~~~~~~~~~~

#. | :menuselection:`Ansible共通-->ファイル管理` では、Playbook内で定義している各モジュールで使用するファイルとファイル埋込変数のメンテナンス(閲覧/登録/更新/廃止)を行います。
   | ファイル管理でファイル素材を登録しておくことで、Playbook内で定義している各モジュールで使用するファイルをファイル埋込変数名で指定することができます。

   .. figure:: /images/ja/ansible_common/file_management/contents_list.png
      :width: 800px
      :alt: サブメニュー画面（ファイル管理）

      サブメニュー画面（ファイル管理）

#. | :guilabel:`＋ 登録` ボタンより、ファイル管理情報の登録を行います。

   .. figure:: /images/ja/ansible_common/file_management/contents_list.gif
      :width: 800px
      :alt: 登録画面（ファイル管理）
   
      登録画面（ファイル管理）
   
   .. | 「登録」の前に、「ファイル素材」を「事前アップロード（①）」してください。「アップロード状況（②）」にPlaybookのファイル名が表示されたのを確認してから、「登録」ボタンを押してください。

   .. .. image:: ./general_operations/image_2a_2.png
   ..    :width: 2.60802in
   ..    :height: 1.55251in
   ..    :align: center

#. | 登録画面の項目は以下のとおりです。

   .. table:: 登録画面項目一覧（ファイル管理）
      :align: left

      +---------+---------------------------------+-------+-------+-------------+
      | **項\   | **説明**                        | **入\ | **入\ | **制約\     |
      | 目**    |                                 | 力\   | 力方\ | 事項**      |
      |         |                                 | 必\   | 法**  |             |
      |         |                                 | 須**  |       |             |
      |         |                                 |       |       |             |
      +=========+=================================+=======+=======+=============+
      | ファイ\ | 各モジュールのパラメータ\       | ○     | 手動\ | 説明欄記\   |
      | ル埋込  | に埋め込む変数名を入力します。  |       | 入力  | 載のとおり  |
      |         |                                 |       |       |             |
      | 変数名  | 変数名は、\                     |       |       |             |
      |         | 「CPF_****」形式で入力します。  |       |       |             |
      |         |                                 |       |       |             |
      |         | \****\：半角英数字と\           |       |       |             |
      |         | アンダースコア（ \              |       |       |             |
      |         | \_ \                            |       |       |             |
      |         | ）が利用可能です。(最\          |       |       |             |
      |         | 小値:1バイト、最大値:128バイト) |       |       |             |
      +---------+---------------------------------+-------+-------+-------------+
      | ファイ\ | 各モジュールで使用する\         | ○     | ファ\ | 最大サイ\   |
      | ル素材  | ファイルをアップロードします。  |       | イル\ | ズ100Mバイト|
      |         |                                 |       | 登録  |             |
      +---------+---------------------------------+-------+-------+-------------+
      | 備考    | 自由記述欄です。                | ー    | 手動\ | 最大長\     |
      |         |                                 |       | 入力  | 4000バイト  |
      +---------+---------------------------------+-------+-------+-------------+

.. note:: | **ファイル埋込変数の使用例**

   .. #. | Playbookの記述
   .. | プレイブックの各モジュールに記述する場合、ファイル埋め込み変数を記述します。
   .. | ※ファイル名にスペースなどが含まれている場合、適切にクォーテーションで囲まないと、作業実行時にエラーになる場合があります。



   | ファイル管理で登録したファイルをPlaybookに記述する場合、該当のパラメータにファイル埋込変数名を記述します。ファイル埋込変数名を使用しない場合、代入値自動登録設定で登録した変数や該当ファイルのパスを記述します。
   | ※ファイル名にスペースなどが含まれている場合、適切にクォーテーションで囲まないと、作業実行時にエラーになる場合があります。
   

   | Exp) 

   - | ファイル管理で登録したhostsファイルをファイル埋め込み変数を使用して作業対象サーバの/etc/配下にコピーする場合
   
     #. | ファイル管理メニューから下記のようにhostsファイルを登録します。
  


        .. table:: ファイル管理の登録内容
           :align: left                                                        
                                                                              
           +------------------------------------+----------------------------+   
           | **ファイル埋込変数名**             | **ファイル素材**           |   
           +====================================+============================+   
           | CPF_hosts                          | hosts                      |   
           +------------------------------------+----------------------------+                                                                   
  
     #. | 下記のようにPlaybookを記述します。
        | ※destはファイル名も記述してください。ファイル名の指定がない場合、登録したファイル素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。 
        | 　たとえば、dest=/etc/ とした場合、ファイル名は/etc/10桁の数値_hostsとなります。
  
        | **Playbookの記述**                                                    
                                                                              
        .. code-block:: yaml

           - copy: src='{{ CPF_hosts }}' dest=/etc/hosts  
  
   - | ファイル管理で登録したtool.tgzファイルをファイル埋込変数を使用して作業対象サーバの/usr/local/bin/配下に解凍する場合
   
     #. | ファイル管理メニューから下記のようにtool.tgzファイルを登録します。
  


        .. table:: ファイル管理の登録内容
           :align: left                                                        
                                                                              
           +------------------------------------+----------------------------+   
           | **ファイル埋込変数名**             | **ファイル素材**           |   
           +====================================+============================+   
           | CPF_tool_tgz                       | tool.tgz                   |   
           +------------------------------------+----------------------------+                                                                   
  
     #. | 下記のようにPlaybookを記述します。
  
        | **Playbookの記述**                                                    
                                                                              
        .. code-block:: yaml                                                  
                                                                              
           - unarchive: src={{ CPF_tool_tgz }} dest=/usr/local/bin

   .. #. | Playbookの記述
   ..    | プレイブックの各モジュールに記述する場合、ファイル埋め込み変数を記述します。
   ..    | ※ファイル名にスペースなどが含まれている場合、適切にクォーテーションで囲まないと、作業実行時にエラーになる場合があります。

   ..    | e.g)
   ..    - | ファイル管理でhostsファイルをPlaybook内の各モジュールで使用する場合
   ..      | ①ファイル管理メニューから下記のように対象ファイルを登録します。
   ..      | **ファイル管理の登録内容**
   
   ..      
      .. table::
   ..         :align: left
  
   ..         +-------------------------------------+---------------------------+   
   ..         | **ファイル埋込変数名**              | **ファイル素材**          |   
   ..         +=====================================+===========================+   
   ..         | CPF_hosts                           | hosts                     |   
   ..         +-------------------------------------+---------------------------+
        
   ..      | ②Playbookは下記の記述となります。
   ..      | **Playbookの記述**
  
   ..      .. code-block:: yaml
  
   ..         - copy: src='{{ CPF_hosts }}' dest=/etc/hosts
  
   ..    - | ファイル管理でtool.tgzファイルをPlaybook内の各モジュールで使用する場合
   ..      | ①ファイル管理メニューから下記のように対象ファイルを登録します。
   ..      | **ファイル管理の登録内容**

   ..     
       .. table::
   ..         :align: left        
           
   ..         +-------------------------------------+---------------------------+   
   ..         | **ファイル埋込変数名**              | **ファイル素材**          |   
   ..         +=====================================+===========================+   
   ..         | CPF_tool_tgz                        | tool.tgz                  |   
   ..         +-------------------------------------+---------------------------+             
         
   ..      | ②Playbookは下記の記述となります。
   ..      | **Playbookの記述**

   ..      .. code-block:: yaml                                                  
                                                                                  
   ..         - unarchive: src={{ CPF_tool_tgz }} dest=/usr/local/bin
         
   ..    .. note:: | destはファイル名も記述してください。ファイル名の指定がない場合、登録したファイル素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。 
   ..       | たとえば、dest=/etc/ とした場合、ファイル名は/etc/10桁の数字_hostsとなります。  

   .. #. | 対話ファイルの記述
   ..    | 対話ファイルに記述する場合、ファイル埋め込み変数を記述します。

   ..    | e.g) ファイル管理でhostsファイルをPlaybook内の各モジュールで使用する場合
   ..    | ①ファイル管理メニューから下記のように対象ファイルを登録します。
   ..    | **ファイル管理の登録内容**
   
   ..    
      .. table::
   ..       :align: left

   ..       +-------------------------------------+---------------------------+   
   ..       | **ファイル埋込変数名**              | **ファイル素材**          |   
   ..       +=====================================+===========================+   
   ..       | CPF_hosts                           | hosts                     |   
   ..       +-------------------------------------+---------------------------+
   
   ..    | ②対話ファイルは下記の記述となります。
   ..    | **対話ファイルの記述**
                                                                                                                                              
   ..    .. code-block:: yaml                                                  
                                                                            
   ..       - expect: '{{ __loginuser__ }}@{{ __loginhostname__ }}'            
   ..         exec: 'scp ITAユーザ@ITAホスト名:{{ CPF_hosts }} 転送先'         
                                                                            
   ..       - expect: 'password:'                                              
   ..         exec: ITAユーザのパスワード'                                     
                                                                                                                         
   ..    .. note:: | 転送先はファイル名も記述してください。ファイル名の指定がない場合、登録したファイル素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。 
   ..       | たとえば、転送先=/etc/ とした場合、ファイル名は/etc/10桁の数字_hostsとなります。             
   ..       | {{△CPF_hosts△}}は実行時に転送元の絶対パスに置換されます。  

.. _general_operations_template_list:

テンプレート管理
~~~~~~~~~~~~~~~~

#. | :menuselection:`Ansible共通-->テンプレート管理` では、Playbookで定義しているtemplateモジュールやios_configモジュールなどのパラメータで使用するJinja2テンプレートファイルとテンプレート埋込変数のメンテナンス(閲覧/登録/更新/廃止)を行います。
   | テンプレート管理でテンプレート素材を登録しておくことで、Playbook内で定義しているtemplateモジュールなどで使用するtemplateファイルをテンプレート埋込変数で指定することができます。

   .. figure:: /images/ja/ansible_common/template_management/template_list.png
      :width: 800px
      :alt: サブメニュー画面（テンプレート管理）

      サブメニュー画面（テンプレート管理）

#. | :guilabel:`＋ 登録` ボタンより、テンプレート管理情報の登録を行います。

   .. figure:: /images/ja/ansible_common/template_management/template_list.gif
      :width: 800px
      :alt: 登録画面（テンプレート管理）

      登録画面（テンプレート管理）
   
   .. | 「登録」の前に、「テンプレート素材」を「事前アップロード（①）」してください。「アップロード状況（②）」にPlaybookのファイル名が表示されたのを確認してから、「登録」ボタンを押してください。

   .. .. image:: ./general_operations/image_2a_2.png
   ..    :width: 2.60802in
   ..    :height: 1.55251in
   ..    :align: center

#. | 登録画面の項目は以下のとおりです。
 
   .. list-table:: 登録画面項目一覧（テンプレート管理）
      :widths: 15 50 5 10 20
      :header-rows: 1
      :align: left

      * - **項目**
        - **説明**
        - **入力必須**
        - **入力方法**
        - **制約事項**
      * - テンプレート埋込変数名
        - | templateモジュールやios_configモジュールなどのパラメータに埋め込む変数名を入力します。
          | 変数名は、「TPF_****」形式で入力します。
          | \****\：半角英数字とアンダースコア（ _ ）が利用可能です。(最小値:1バイト、最大値:255バイト)
        - ○ 
        - 手動入力
        - 説明欄記載のとおり
      * - テンプレート素材
        - モジュールのパラメータで使用するJinja2テンプレートファイルをアップロードします。
        - ○ 
        - ファイル登録
        - | テキスト形式
          | 最大サイズ100Mバイト
      * - 変数定義
        - | テンプレート素材で使用している変数を定義します。
          | 具体値は定義のみで使用することはありません。
          | Ansible-LegacyRoleのみで使用するテンプレートで、default変数定義ファイルなどに変数定義をしている場合、変数定義は省略できます。
          | 同名の変数を複数のテンプレートで使用する場合、変数定義を合わせる必要があります。変数定義が一致していない場合は登録でエラーとなります。
          | 変数定義はAnsibleの仕様に準拠していますが、ITA独自仕様があります。変数名の命名規則は「 :ref:`general_operations_variable_handling` 」と同様です。
        - ー 
        - 手動入力
        - 最大長4000バイト
      * - 備考
        - 自由記述欄です。
        - ー 
        - 手動入力
        - 最大長4000バイト

   
.. warning:: | **テンプレートの変数定義を読み取るタイミング**
   | 内部の処理でテンプレートの変数定義を読み取り、「 :ref:`general_operations_substitution_value_auto_registration_setting` 」で具体値が登録可能になります。
   | 読み取りのタイミングはリアルタイムではないので、「 :ref:`general_operations_substitution_value_auto_registration_setting` 」で変数が扱えるまでに **時間がかかる** 場合があります。


.. tip:: | **変数定義の留意事項**
   | 変数定義の留意事項は以下のとおりです。

   .. table:: 変数定義の留意事項
      :widths: 10 30
      :align: left

      +---------------+------------------------------------------------------+
      | **種類**      | **留意事項**                                         |
      +===============+======================================================+
      | 通常変数      | 具体値は省略可能です。                               |
      |               |                                                      |
      |               | e.g.)                                                |
      |               |                                                      |
      |               | .. code-block:: yaml                                 |
      |               |                                                      |
      |               |    VAR_sample_1: none                                |
      |               |    VAR_sample_2:                                     |
      |               |                                                      |
      +---------------+------------------------------------------------------+
      | 複\           | 具体値は省略可能です。                               |
      | 数具体値変数  |                                                      |
      |               | e.g.)                                                |
      |               |                                                      |
      |               | .. code-block:: yaml                                 |
      |               |                                                      |
      |               |    VAR_sample_1:                                     |
      |               |      - none                                          |
      |               |    VAR_sample_2: []                                  |
      |               |                                                      |
      +---------------+------------------------------------------------------+
      | 多段変数      | 階層化された変数構造が定義出来ます。                 |
      |               |                                                      |
      |               | e.g.)                                                |
      |               |                                                      |
      |               | .. code-block:: yaml                                 |
      |               |                                                      |
      |               |    VAR_sample_1:                                     |
      |               |      - item1: none                                   |
      |               |        item2:                                        |
      |               |    VAR_sample_2:                                     |
      |               |      - array:                                        |
      |               |          - item1: none                               |
      |               |            item2:                                    |
      |               |                                                      |
      |               | 同名の変数をdefault変数定義ファイルなどに定義\       |
      |               | している場合は、変数定義を合わせる必要があります。変\|
      |               | 数定義が一致していない場合は登録でエラーとなります。 |
      +---------------+------------------------------------------------------+
      | グ\           | 具体値は省略可能です。                               |
      | ローバル変数  |                                                      |
      |               | e.g.)                                                |
      |               |                                                      |
      |               | .. code-block:: yaml                                 |
      |               |                                                      |
      |               |    GBL_sample_1: none                                |
      |               |    GBL_sample_2:                                     |
      |               |                                                      |
      +---------------+------------------------------------------------------+
      | ITA独自変数   | 変数の定義は不要です。                               |
      +---------------+------------------------------------------------------+
             

   .. 詳しくは、別資料「利用手順マニュアル_Ansible-driver_別紙_Ansible利用ガイドライン_追加ルール」を参照してください。

.. note:: | **テンプレート埋込変数の使用例**

   | テンプレート管理で登録したテンプレートをPlaybookに記述する場合、該当のパラメータにテンプレート埋込変数名を記述します。テンプレート埋込変数名を使用しない場合、代入値自動登録設定で登録した変数や該当ファイルのパスを記述します。
 
   | ※ファイル名にスペースなどが含まれている場合、適切にクォーテーションで囲まないと、作業実行時にエラーになる場合があります。
   
   | Exp) テンプレート管理で登録したhostsファイルをテンプレート埋込変数を使用して作業対象サーバの/etc/配下に設置する場合
 
   #. | テンプレート管理メニューから下記のようにhostsファイルを登録します。

      .. table:: テンプレート管理の登録内容
         :align: left                                                        
                                                                            
         +------------------------------------+----------------------------+   
         | **テンプレート埋込変数名**         | **テンプレート素材**       |   
         +====================================+============================+   
         | TPF_hosts                          | hosts                      |   
         +------------------------------------+----------------------------+                                                                   

   #. | 下記のようにPlaybookを記述します。
      | ※destはファイル名も記述してください。ファイル名の指定がない場合、登録したテンプレート素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。
      | 　たとえば、dest=/etc/ とした場合、ファイル名は/etc/10桁の数値_hostsとなります。

      | **Playbookの記述**                                                    
                                                                            

      .. code-block:: yaml                                                  
                                                                            
         - template: src='{{ TPF_hosts }}' dest=/etc/hosts                                                                           


   .. 
      .. note:: | destはファイル名も記述してください。ファイル名の指定がない場合、登録したテンプレート素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。 

        
   .. #. | 対話ファイルの記述
   ..    | 対話ファイルに記述する場合、テンプレート埋込変数名を記述します。
   
   ..    | Exp) テンプレート管理でhostsファイルを/etc/配下に設置する場合
   ..    | ①テンプレート管理メニューから下記のように対象ファイルを登録します。
   ..    | **テンプレート管理の登録内容**

   ..    .. table::
   ..       :align: left

   ..       +------------------------------------+----------------------------+   
   ..       | **テンプレート埋込変数名**         | **テンプレート素材**       |   
   ..       +====================================+============================+   
   ..       | TPF_hosts                          | /etc/hosts                 |   
   ..       +------------------------------------+----------------------------+ 
      
   ..    | ②対話ファイルは下記の記述となります。
   ..    | **対話ファイルの記述** 
   
   ..    .. code-block:: yaml                                                  
                                                                            
   ..       - expect: '{{ __loginuser__ }}@{{ __loginhostname__ }}'            
   ..         exec: 'scp ITAユーザ@ITAホスト名:{{ TPF_hosts }} 転送先'         
                                                                            
   ..       - expect: 'password:'                                              
   ..         exec: ITAユーザのパスワード'                                     
                                                                                                                                                 
   ..    .. note:: | 転送先はファイル名も記述してください。ファイル名の指定がない場合、登録したファイル素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。                                                                
   ..       | 例えば、転送先=/etc/ とした場合、ファイル名は/etc/10桁の数字_hostsとなります。                                                                           
   ..       | {{△TPF_hosts△}}は実行時に転送元の絶対パスに置換されます。

.. _general_operations_unmanaged_var_list:

管理対象外変数リスト
~~~~~~~~~~~~~~~~~~~~        

#. | :menuselection:`Ansible共通-->管理対象外変数リスト` では、ロールパッケージ管理のデフォルト変数定義やテンプレート管理の変数定義で定義している変数で、代入値自動登録の変数一覧に表示したくない変数のメンテナンス(参照/更新/廃止/復活)を行います。

   .. figure:: /images/ja/ansible_common/unmanaged_variables/unmanaged_var_list.png
      :width: 800px
      :alt: サブメニュー画面（管理対象外変数リスト）

      サブメニュー画面（管理対象外変数リスト）

#. | :guilabel:`＋ 登録` ボタンより、オペレーション情報の登録を行います。

   .. figure:: /images/ja/ansible_common/unmanaged_variables/unmanaged_var_list.gif
      :width: 800px
      :alt: 登録画面（管理対象外変数リスト）

      登録画面（管理対象外変数リスト）

#. | 管理対象外変数リスト画面の項目一覧は以下のとおりです。
   
   .. list-table:: 登録画面項目一覧（管理対象外変数リスト）
      :widths: 30 120 30 30 30
      :header-rows: 1
      :align: left
   
      * - **コマンド**
        - **注意事項**
        - **入力必須**
        - **入力方法**
        - **制約事項**
      * - 変数名
        - ロールパッケージ管理のデフォルト変数定義やテンプレート管理の変数定義で定義している変数で、代入値自動登録の変数一覧に表示したくない変数名を入力します。 
        - 〇
        - 手動入力
        - 説明欄記載のとおり
      * - 備考
        - 自由記述欄です。
        - ー
        - 手動入力
        - 最大長4000バイト


.. 収集インターフェース情報
.. ~~~~~~~~~~~~~~~~~~~~~~~~

.. | [収集インターフェース情報]では、収集機能で利用するITAの標準RESTAPIを利用する為、RESTAPIアクセス用の接続インターフェース情報の更新を行います。
.. 詳細は、別紙「Exastro-ITA_利用手順マニュアル_収集機能」を参照。

.. 収集項目値管理
.. ~~~~~~~~~~~~~~

.. | [収集項目値管理]では、収集対象項目とパラメータシートの項目の紐付設定を行います。
.. 詳細は、別紙「Exastro-ITA_利用手順マニュアル_収集機能」を参照。

.. | 一覧/更新のメニューIDまたは、メニュー名称のリンクをクリックすると、対象メニューへ遷移します。

.. .. figure:: ./general_operations/image21.png
..    :width: 6.06889in
..    :height: 1.28747in
..    :alt: サブメニュー画面（収集項目値管理）

..    サブメニュー画面（収集項目値管理）

.. Ansibel-Legacy／Legacy Role／Pioneer　コンソール


Ansible-LegacyRoleコンソール
------------------------------

| Ansible-LegacyRoleコンソールの操作です。


.. | Ansibel-Legacy／Legacy Role／Pioneer　コンソールの操作です。

.. .. _general_operations_os_type_master:
.. OS種別マスタ
.. ~~~~~~~~~~~~

.. #. | [OS種別マスタ] 画面では、ITAのPioneerより操作対象となる機器のOS種別を管理します。
..    | ※本メニューはAnsible-Pioneer コンソールにのみ存在します。

..    .. figure:: ./general_operations/image22.png
..       :width: 6.08053in
..       :height: 2.91359in
..       :alt: サブメニュー画面（ＯＳ種別マスタ）

..       サブメニュー画面（ＯＳ種別マスタ）

.. #. | 「登録」-「登録開始」ボタンより、OS情報の登録を行います。

..    .. figure:: ./general_operations/image23.png
..       :width: 5.80331in
..       :height: 0.80347in
..       :alt: 登録画面（ＯＳ種別マスタ）

..       登録画面（ＯＳ種別マスタ）

.. #. | 一覧/更新の対話素材ファイル集ボタンをクリックすると、対象の :ref:`general_operations_dialog_files_ansible_pioneer_only` へ遷移します。

..    .. figure:: ./general_operations/image24.png
..       :width: 5.81353in
..       :height: 1.20265in
..       :alt: サブメニュー画面（ＯＳ種別マスタ）

..       サブメニュー画面（ＯＳ種別マスタ）

.. #. | 登録画面の項目一覧は以下のとおりです。

..    .. table:: 登録画面項目一覧（ＯＳ種別マスタ）
..       :align: left

..       +-----+-----+--------------------------------+-------+-------+-------------+
..       | **項目**  | **説明**                       | **入\ | **入\ | **制約\     |
..       |           |                                | 力**  | 力方\ | 事項**      |
..       |           |                                |       | 法**  |             |
..       |           |                                |       |       |             |
..       |           |                                |       |       |             |
..       |           |                                | **必\ |       |             |
..       |           |                                | 須**  |       |             |
..       |           |                                |       |       |             |
..       |           |                                |       |       |             |
..       +=====+=====+================================+=======+=======+=============+
..       | OS\       | 登録情報を識別する\            | ○     | 自\   | ー          |
..       | 種\       | 一意のＩＤが自動入力されます。 |       | 動入力|             |
..       | 別\       |                                |       |       |             |
..       | ID        |                                |       |       |             |
..       +-----+-----+--------------------------------+-------+-------+-------------+
..       | OS\       | 任意の機器名称を入力します。   | ○     | 手\   | 最大\       |
..       | 種\       |                                |       | 動入力| 長256バイト |
..       | 別\       |                                |       |       |             |
..       | 名        |                                |       |       |             |
..       +-----+-----+--------------------------------+-------+-------+-------------+
..       | 機\ | S\  | 機器種別がサーバの場合\        | ー    | リス\ | ー          |
..       | 種\ | V   | 「●」を選択します。            |       | ト選択|             |
..       | 別  |     |                                |       |       |             |
..       |     +-----+--------------------------------+-------+-------+-------------+
..       |     | N\  | 機器種別がネットワーク機器\    | ー    | リス\ | ー          |
..       |     | W   | の場合「●」を選択します。      |       | ト選択|             |
..       |     +-----+--------------------------------+-------+-------+-------------+
..       |     | S\  | 機器種別がストレージ機器\      | ー    | リス\ | ー          |
..       |     | T   | の場合「●」を選択します。      |       | ト選択|             |
..       +-----+-----+--------------------------------+-------+-------+-------------+
..       | 備\       | 自由記述欄です。               | ー    | 手\   | ー          |
..       | 考        |                                |       | 動入力|             |
..       +-----+-----+--------------------------------+-------+-------+-------------+

.. _general_operations_movement_list:

Movement一覧
~~~~~~~~~~~~

#. | :menuselection:`Ansible-LegacyRole-->Movement一覧` ではMovement名のメンテナンス(閲覧/登録/更新/廃止)を行います。

   .. figure:: /images/ja/ansible-legacyrole/movement_list/movement_list.png
      :width: 800px
      :alt: サブメニュー画面（Movement一覧）

      サブメニュー画面（Movement一覧）

#. | :guilabel:`＋ 登録` ボタンより、Movement情報の登録を行います。

   .. figure:: /images/ja/ansible-legacyrole/movement_list/registration_movement_list.gif
      :width: 800px
      :alt: 登録画面（Movement一覧）

      登録画面（Movement一覧）

   .. #. | Movement-Playbook紐付(Movement-対話種別紐付、Movement-ロール紐付)ボタンをクリックすると、対象の :ref:`general_operations_movement_details` へ遷移します。

   ..    .. figure:: ./general_operations/image27.png
   ..       :width: 5.97831in
   ..       :height: 1.1875in
   ..       :alt: サブメニュー画面（Movement一覧）

   ..       サブメニュー画面（Movement一覧）

#. | 登録画面の項目一覧は以下のとおりです。

   .. table:: 登録画面項目一覧（Movement一覧）
      :align: left

      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-------------------+
      | **項目**                          | **説明**                                        | **入力\   | **入力方法** | **制約事項**      |
      |                                   |                                                 | 必須**    |              |                   |
      |                                   |                                                 |           |              |                   |
      +========+========+========+========+=================================================+===========+==============+===================+
      | Movement名                        | Movementの名称を入力します。                    | ○         | 手動入力     | 最大長255バイト   |
      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-------------------+
      | 遅延タイマー                      | Movementが指定期間遅延した場合にステータスを\   | ー        | 手動入力     | ー                |
      |                                   | 遅延として警告表示したい場合に指定期間(1～)を\  |           |              |                   |
      |                                   | 入力します。(単位:分)                           |           |              |                   |
      |                                   |                                                 |           |              |                   |
      |                                   | 未入力の場合は警告表示しません。                |           |              |                   |
      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-------------------+
      | Ansible利用情報 | ホスト指定形式  | 特別にIPアドレスで表現しないホストを指定したい\ | ○         | リスト選択   | ー                |
      |                 |                 | 場合に「ホスト名」を選択します。                |           |              |                   |
      |                 |                 |                                                 |           |              |                   |
      |                 |                 | 通常はIPが推奨です。                            |           |              |                   |
      |                 +--------+--------+-------------------------------------------------+-----------+--------------+-------------------+
      |                 | WinRM接続       | 対象ホストがWindowsServerの場合に、\            | ー        | リスト選択   | ー                |
      |                 |                 | 「●」を選択します。                             |           |              |                   |
      |                 +--------+--------+-------------------------------------------------+-----------+--------------+-------------------+
      |                 | ヘッダー\       | ITAが自動生成する親Playbookの先頭からtasksまた\ | ー        | 手動入力     | 最大長4000バイト  |
      |                 | セクション      | はrolesセクションまでのセクションを編集します。 |           |              |                   |
      |                 |                 |                                                 |           |              |                   |
      |                 |                 | 未入力の場合は、以下を適用します。              |           |              |                   |
      |                 |                 |                                                 |           |              |                   |
      |                 |                 | .. code-block:: yaml                            |           |              |                   |
      |                 |                 |                                                 |           |              |                   |
      |                 |                 |    # Ansible                                    |           |              |                   |
      |                 |                 |    - hosts: all                                 |           |              |                   |
      |                 |                 |      remote_user: "{{ __loginuser__ }}"         |           |              |                   |
      |                 |                 |      gather_facts: no                           |           |              |                   |
      |                 |                 |      become: yes                                |           |              |                   |
      |                 |                 |                                                 |           |              |                   |
      |                 |                 |    # Ansible Automation Controller              |           |              |                   |
      |                 |                 |    - hosts: all                                 |           |              |                   |
      |                 |                 |      gather_facts: no                           |           |              |                   |
      |                 |                 |      become: yes                                |           |              |                   |
      |                 |                 |                                                 |           |              |                   |
      |                 |                 | ※winrm接続の場合は become: yesは適用しません。  |           |              |                   |
      |                 +--------+--------+-------------------------------------------------+-----------+--------------+-------------------+
      |                 | オプション\     | Movement固有のオプションパラメータを入力します。| ー        | 手動入力     | 最大長4000バイト  |
      |                 | パラメータ      |                                                 |           |              |                   |
      |                 |                 | 実行エンジンがAnsible Coreの場合はansible-play\ |           |              |                   |
      |                 |                 | bookコマンドのオプションパラメータ、実行エンジ  |           |              |                   |
      |                 |                 | ンがAnsible Core以外の場合はジョブテンプレート\ |           |              |                   |
      |                 |                 | のパラメータを入力します。                      |           |              |                   |
      |                 |                 |                                                 |           |              |                   |
      |                 |                 | オプションパラメータの詳細については、「 \      |           |              |                   |
      |                 |                 | :ref:`general_operations_option\                |           |              |                   |
      |                 |                 | _parameter_list` 」を参照してください。         |           |              |                   |
      |                 +--------+--------+-------------------------------------------------+-----------+--------------+-------------------+
      |                 | ansible.cfg     | 作業実行時に使用するansible.cfgを\              | ー        | ファイル選択 | 最大サイズ100M\   |
      |                 |                 | アップロードします。                            |           |              | バイト            |
      |                 |                 |                                                 |           |              |                   |
      |                 |                 | 未アップロードの場合は、デフォルトが使用され\   |           |              |                   |
      |                 |                 | ます。                                          |           |              |                   |
      |                 |                 |                                                 |           |              |                   |
      |                 |                 | また、ロールパッケージ管理でアップロードされて\ |           |              |                   |
      |                 |                 | いるzipファイルにansible.cfgが含まれている場合\ |           |              |                   |
      |                 |                 | は、この項目でアップロードしたansible.cfgで\    |           |              |                   |
      |                 |                 | 上書きされます。                                |           |              |                   |
      |                 +--------+--------+-------------------------------------------------+-----------+--------------+-------------------+
      |                 | Ansibl\| 実行\  | Ansible Automation Controllerサーバに構築され\  | ー        | リスト選択   |                   |
      |                 | e Auto\| 環境   | ている実行環境が表示されています。              |           |              |                   |
      |                 | matio\ |        |                                                 |           |              |                   |
      |                 | n Cont\|        | 実行する実行環境を選択します。                  |           |              |                   |
      |                 | roller\|        |                                                 |           |              |                   |
      |                 | 利用\  |        | 未選択の場合は、デフォルト「Default execution \ |           |              |                   |
      |                 | 情報   |        | environment」が使用されます。                   |           |              |                   |
      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-------------------+
      | 備考                              | 自由記述欄です。                                | ー        | 手動入力     | 最大長4000バイト  |
      +--------+--------+--------+--------+-------------------------------------------------+-----------+--------------+-------------------+
   
   .. +-----------+------------------------------------------+-------+-------+-------------+
   .. | **項目**  | **説明**                                 | **入\ | **入\ | **制約\     |
   .. |           |                                          | 力**  | 力形\ | 事項**      |
   .. |           |                                          |       | 式**  |             |
   .. |           |                                          |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           |                                          | **必\ |       |             |
   .. |           |                                          | 須**  |       |             |
   .. |           |                                          |       |       |             |
   .. |           |                                          |       |       |             |
   .. +===========+==========================================+=======+=======+=============+
   .. | M\        | Movementの名称を入力します。             | ○     | 手動\ | 最大\       |
   .. | ovement名 |                                          |       | 入力  | 長256バイト |
   .. +-----------+------------------------------------------+-------+-------+-------------+
   .. | 遅延\     | Movementが指定期間遅\                    | ー    | 手動\ | ー          |
   .. | タイマー  | 延した場合にステータスを遅延と\          |       | 入力  |             |
   .. |           | して警告表示したい場合に指定期\          |       |       |             |
   .. |           | 間(1～)を入力します。(単位:分)           |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           | 未\                                      |       |       |             |
   .. |           | 入力の場合は警告表示しません。           |       |       |             |
   .. +-----------+------------------------------------------+-------+-------+-------------+
   .. | ホスト\   | 特別にIP\                                | ○     | リ\   | ー          |
   .. | 指定形式  | アドレスで表現しないホストを指\          |       | スト\ |             |
   .. |           | 定したい場合に「ホスト名」を選\          |       | 選択  |             |
   .. |           | 択します。通常はIPが推奨です。           |       |       |             |
   .. +-----------+------------------------------------------+-------+-------+-------------+
   .. | v\        | Ansibleサーバー内にvirtu\                | ー    | 手動\ | 最大\       |
   .. | irtualenv | alenvで構築したansible実行環境\          |       | 入力  | 長512バイト |
   .. |           | で作業実行したい場合、virtuale\          |       |       |             |
   .. |           | nvのフルパスを入力してください。           |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           | virtualen\                               |       |       |             |
   .. |           | v環境が存在しなかったりvirtual\          |       |       |             |
   .. |           | env環境内にansibleがインストー\          |       |       |             |
   .. |           | ルされていない場合、作業実行時\          |       |       |             |
   .. |           | に「想定外エラー」となります。           |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           | 未入力の場合はansibleサーバ\             |       |       |             |
   .. |           | ーにインストールされているans\           |       |       |             |
   .. |           | ible環境で作業実行を行います。           |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           | Exp)                                     |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           | /virtualenv配下にans\                    |       |       |             |
   .. |           | ible11.1.0という名前でvirtuale\          |       |       |             |
   .. |           | nv環境を作成した場合のvirtuale\          |       |       |             |
   .. |           | nvのフルパスは下記となります。           |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           | virtualenv環境の作成                     |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           | .. code-block::                          |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           |    cd /virtualenv                        |       |       |             |
   .. |           |    virtualenv ansible11.1.0              |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           | virtualenvのフルパス                     |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           | /virtualenv/ansible11.1.0                |       |       |             |
   .. +-----------+------------------------------------------+-------+-------+-------------+
   .. | 並\       | Ansible-pl\                              | ー    | 手動\ | NUL\        |
   .. | 列実行数  | aybookコマンドのオプションパラ\          |       | 入力  | Lまたは整数 |
   .. |           | メータ「forks」を入力します。            |       |       |             |
   .. | ※\        |                                          |       |       |             |
   .. | Pioneer\  | ■未入力時の振る舞いについて              |       |       |             |
   .. | のMovemen\|                                          |       |       |             |
   .. | t一覧での\| サーバの設定\                            |       |       |             |
   .. | み表示さ\ | ファイル(/etc/ansible.conf)の\           |       |       |             |
   .. | れます。  | 内容がデフォルト値となります。           |       |       |             |
   .. +-----------+------------------------------------------+-------+-------+-------------+
   .. | WinRM接続 | 対象ホストがWindowsServe\                | ー    | リ\   | ー          |
   .. |           | rの場合に、「●」を選択します。           |       | スト\ |             |
   .. |           |                                          |       | 選択  |             |
   .. +-----------+------------------------------------------+-------+-------+-------------+
   .. | ヘ\       | ITA\                                     | ー    | 手動\ | 最大\       |
   .. | ッダーセ\ | が自動生成する親Playbookの先頭\          |       | 入力  | 長512バイト |
   .. | クション  | からtasksまたはrolesセクション\          |       |       |             |
   .. |           | までのセクションを編集します。           |       |       |             |
   .. | ※\        |                                          |       |       |             |
   .. | Pioneer\  | 未入\                                    |       |       |             |
   .. | のMovemen\| 力の場合は、以下を適用します。           |       |       |             |
   .. | t一覧では\|                                          |       |       |             |
   .. | 表示され\ | .. code-block:: yaml                     |       |       |             |
   .. | ません。  |                                          |       |       |             |
   .. |           |    # Ansible                             |       |       |             |
   .. |           |    - hosts: all                          |       |       |             |
   .. |           |      remote_user: "{{ __loginuser__ }}"  |       |       |             |
   .. |           |      gather_facts: no                    |       |       |             |
   .. |           |      become: yes                         |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           |    # Ansible Automation Controller       |       |       |             |
   .. |           |    - hosts: all                          |       |       |             |
   .. |           |      gather_facts: no                    |       |       |             |
   .. |           |      become: yes                         |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           | ※winrm接続の場合は become: \             |       |       |             |
   .. |           | yesは適用しません。                      |       |       |             |
   .. +-----------+------------------------------------------+-------+-------+-------------+
   .. | オプ\     | Movement固有のオプ\                      | ー    | 手動\ | 最大\       |
   .. | ションパ\ | ションパラメータを入力します。           |       | 入力  | 長512バイト |
   .. | ラメータ  |                                          |       |       |             |
   .. |           |                                          |       |       |             |
   .. | ※\        | 実行エンジンがAnsible\                   |       |       |             |
   .. | Pioneer\  | Coreの場合はan\                          |       |       |             |
   .. | のMovemen\| sible-playbookコマンドのオプシ\          |       |       |             |
   .. | t一覧では\| ョンパラメータ、実行エンジンが\          |       |       |             |
   .. | 表示され\ | Ansible Core \                           |       |       |             |
   .. | ません。  | 以外の場合はジョブテンプレ\              |       |       |             |
   .. |           | ートのパラメータを入力します。           |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           | オプショ\                                |       |       |             |
   .. |           | ンパラメータの詳細については、「 \       |       |       |             |
   .. |           | :ref:`general_operations_option\         |       |       |             |
   .. |           | _parameter_list` 」覧を参照してください。|       |       |             |
   .. +-----------+------------------------------------------+-------+-------+-------------+
   .. | V\        | virtualenvで構築した\                    | ー    | リ\   |             |
   .. | irtualenv | ansible実行環境を選択します。            |       | スト\ |             |
   .. |           |                                          |       | 選択  |             |
   .. | ※\        | 未選択の場合は Ansible \                 |       |       |             |
   .. | 実行エ\   | Automation Controller \                  |       |       |             |
   .. | ンジンが\ | インストール時にインストー\              |       |       |             |
   .. | AnsibleTo\| ルされた仮想環境を使用します。           |       |       |             |
   .. | werの場合\|                                          |       |       |             |
   .. | に表示さ\ |                                          |       |       |             |
   .. | れます。  |                                          |       |       |             |
   .. +-----------+------------------------------------------+-------+-------+-------------+
   .. | 実行\     | Ansible Automation \                     | ー    | リ\   |             |
   .. | 環境      | Controllerサーバに構築されてい\          |       | スト\ |             |
   .. |           | る実行環境が表示されています。           |       | 選択  |             |
   .. | ※\        |                                          |       |       |             |
   .. | 実行エ\   |                                          |       |       |             |
   .. | ンジンが\ | 作業\                                    |       |       |             |
   .. | Ansible \ | 実行する実行環境を選択します。           |       |       |             |
   .. | Automa\   |                                          |       |       |             |
   .. | tion \    | 未選択\                                  |       |       |             |
   .. | cont\     | の場合は、デフォルト「Default \          |       |       |             |
   .. | roller \  | execution \                              |       |       |             |
   .. | の場合\   | environment」が使用されます。            |       |       |             |
   .. | に表示さ\ |                                          |       |       |             |
   .. | れます。  |                                          |       |       |             |
   .. +-----------+------------------------------------------+-------+-------+-------------+
   .. | An\       | 作業実行時に使用するans\                 | ー    | ファ\ | 最大サイ\   |
   .. | sible.cfg | ible.cfgをアップロードします。           |       | イル\ | ズ4Gバイト  |
   .. |           |                                          |       | 選択  |             |
   .. |           | 未アップロードの場合\                    |       |       |             |
   .. |           | は、デフォルトが使用されます。           |       |       |             |
   .. |           |                                          |       |       |             |
   .. |           | また\                                    |       |       |             |
   .. |           | 、ロールパッケージ管理でアップ\          |       |       |             |
   .. |           | ロードされているzipファイルに\           |       |       |             |
   .. |           | ansible.cfgが含まれている場合\           |       |       |             |
   .. |           | は、この項目でアップロードした\          |       |       |             |
   .. |           | ansible.cfgで上書きされます。            |       |       |             |
   .. +-----------+------------------------------------------+-------+-------+-------------+
   .. | 備考      | 自由記述欄です。                         | ー    | 手動\ | 最大長\     |
   .. |           |                                          |       | 入力  | 4000バイト  |
   .. +-----------+------------------------------------------+-------+-------+-------------+
   
   .. warning:: 
      | WinRM接続で「●」を選択した場合は接続するホストをすべてWindowsServerとみなします。

.. .. _general_operations_playbook_file_list_ansible_legacy_only:
.. Playbook素材集（Ansible-Legacyのみ）
.. ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. #. | [Playbook素材集]ではユーザーが作成したPlaybookの登録／更新／廃止を行います。
..    | ※本メニューはAnsible-Legacy コンソールにのみ存在します。
..    | Playbookの記述など関しては、「 :ref:`general_operations_write_playbook_ansible_legacy` 」を参照してください。

..    .. figure:: ./general_operations/image28.png
..       :width: 6.22721in
..       :height: 2.78024in
..       :alt: サブメニュー画面（Playbook素材集）

..       サブメニュー画面（Playbook素材集）

.. #. | 「登録」-「登録開始」ボタンより、Playbookの登録を行います。

..    .. figure:: ./general_operations/image29.png
..       :width: 5.99563in
..       :height: 0.89595in
..       :alt: 登録画面（Playbook素材集）

..       登録画面（Playbook素材集）

.. #. | Movement-Playbook紐付ボタンをクリックすると、対象の :ref:`general_operations_movement_details` へ遷移します。

..    .. figure:: ./general_operations/image30.png
..       :width: 6.16965in
..       :height: 1.25024in
..       :alt: サブメニュー画面（Playbook素材集）

..       サブメニュー画面（Playbook素材集）

.. #. | 登録画面の項目一覧は以下のとおりです。

..    .. table:: 登録画面項目一覧（Playbook素材集）
..       :align: left

..       +---------------+----------------------+----------+---------+---------------+
..       | **項目**      | **説明**             | **入力\  | **入力\ | **制約事項**  |
..       |               |                      | 必須**   | 方法**  |               |
..       |               |                      |          |         |               |
..       |               |                      |          |         |               |
..       |               |                      |          |         |               |
..       |               |                      |          |         |               |
..       |               |                      |          |         |               |
..       |               |                      |          |         |               |
..       +===============+======================+==========+=========+===============+
..       | プレイ\       | ITAで\               | ○        | 手\     | 最\           |
..       | ブック素材名  | 管理するプレイブック\|          | 動入力  | 大長256バイト |
..       |               | 素材名を入力します。 |          |         |               |
..       +---------------+----------------------+----------+---------+---------------+
..       | プレ\         | 作成し\              | ○        | ファイ\ | 最大サ\       |
..       | イブック素材  | たPlaybookファイルを\|          | ル選択  | イズ4Gバイト  |
..       |               | アップロードします。 |          |         |               |
..       |               |                      |          |         |               |
..       |               | アップロードす\      |          |         |               |
..       |               | るPlaybookファイルは\|          |         |               |
..       |               | 文字コードがUTF-8のB\|          |         |               |
..       |               | OMで作成してください。 |          |         |               |
..       |               |                      |          |         |               |
..       |               | 文\                  |          |         |               |
..       |               | 字コードがUTF-8のBOM\|          |         |               |
..       |               | なし以外のPlaybookフ\|          |         |               |
..       |               | ァイルはアップロード\|          |         |               |
..       |               | でエラーになります。 |          |         |               |
..       +---------------+----------------------+----------+---------+---------------+
..       | 備考          | 自由記述欄です。     | ー       | 手\     | 最大\         |
..       |               |                      |          | 動入力  | 長4000バイト  |
..       +---------------+----------------------+----------+---------+---------------+

..    | 「登録」の前に、「プレイブック素材」を「事前アップロード（①）」してください。「アップロード状況（②）」にPlaybookのファイル名が表示されたのを確認してから、「登録」ボタンを押してください。

..    .. image:: ./general_operations/image_2a_3.png
..       :width: 1.81218in
..       :height: 0.98027in
..       :align: center

..    | 内部の処理でPlaybookファイル内に定義している変数を抜出します。抜出した変数は、「 :ref:`general_operations_substitution_value_list` 」や「:ref:`general_operations_substitution_value_auto_registration_setting` 」で具体値の登録が可能になります。
..    | 抜出するタイミングはリアルタイムではありませんので、「 :ref:`general_operations_substitution_value_list` 」や「:ref:`general_operations_substitution_value_auto_registration_setting` 」で変数が扱えるまでに **時間がかかる※** 場合があります。
..    | ※ 抜出のタイミングは「 :ref:`general_operations_about_the_maintenance_method` 」に記載していますので、そちらをご参照ください。

.. _general_operations_role_package_list_ansible_legacy_role_only:

ロールパッケージ管理
~~~~~~~~~~~~~~~~~~~~
.. ロールパッケージ管理（Ansible-Legacy Roleのみ）

#. | ユーザーが作成したロールパッケージファイルのメンテナンス(閲覧/登録/更新/廃止)を行います。
   | ロールパッケージファイルは、「roles」のある階層のディレクトリをzipにて圧縮したものを登録してください。ロールパッケージディレクトリ構成などは「 :ref:`general_operations_write_role_package_ansible_legacy_role` 」を参照してください。

   .. figure:: /images/ja/ansible-legacyrole/role_packeage_management/role_package_list.png
      :width: 800px
      :alt: サブメニュー画面（ロールパッケージ管理）
   
      サブメニュー画面（ロールパッケージ管理）

#. | :guilabel:`＋ 登録` ボタンより、ロールパッケージ情報の登録を行います。

   .. figure:: /images/ja/ansible-legacyrole/role_packeage_management/registration_role_package_list.gif
      :width: 800px
      :alt: 登録画面（ロールパッケージ管理）
   
      登録画面（ロールパッケージ管理）
   
   .. | 「登録」の前に、「ロールパッケージファイル」を「事前アップロード（①）」してください。「アップロード状況（②）」にロールパッケージファイル名が表示されたのを確認してから、「登録」ボタンを押してください。

   .. .. image:: ./general_operations/image_2a_4.png
   ..    :width: 2.60802in
   ..    :height: 1.55251in
   ..    :align: center

   .. #. | 一覧/更新のMovement-ロール紐付ボタンをクリックすると、 :ref:`general_operations_movement_details` へ遷移します。

   ..    .. figure:: ./general_operations/image34.png
   ..       :width: 6.55395in
   ..       :height: 1.29253in
   ..       :alt: サブメニュー画面（ロールパッケージ管理）
      
   ..       サブメニュー画面（ロールパッケージ管理）

#. | 登録画面の項目一覧は以下のとおりです。

   .. table:: 登録画面項目一覧（ロールパッケージ管理）
      :align: left

      +-----------+--------------------------------+-------+-------+-------------+
      | **項目**  | **説明**                       | **入\ | **入\ | **制約\     |
      |           |                                | 力\   | 力方\ | 事項**      |
      |           |                                | 必\   | 法**  |             |
      |           |                                | 須**  |       |             |
      |           |                                |       |       |             |
      |           |                                |       |       |             |
      +===========+================================+=======+=======+=============+
      | ロ\       | ITAで管理するロ\               | ○     | 手動\ | 最大\       |
      | ールパッ\ | ールパッケージ名を入力します。 |       | 入力  | 長255バイト |
      | ケージ名  |                                |       |       |             |
      +-----------+--------------------------------+-------+-------+-------------+
      | ロールパ\ | 作成\                          | ○     | ファ\ | 最大サイ\   |
      | ッケージ\ | したロールパッケージファイル(\ |       | イル\ | ズ100Mバイト|
      | ファイル  | zip形式)をアップロードします。 |       | 選択  |             |
      |           |                                |       |       |             |
      |           | アップロードするロール\        |       |       |             |
      |           | パッケージファイルに含まれるPl\|       |       |             |
      |           | aybookファイルは文字コードがUT\|       |       |             |
      |           | F-8でBOMなしで作成してください\|       |       |             |
      |           | 。                             |       |       |             |
      |           |                                |       |       |             |
      |           | UTF-8でBOMなし以外の\          |       |       |             |
      |           | Playbookファイルが含まれてい\  |       |       |             |
      |           | ると登録時にエラーとなります。 |       |       |             |
      |           |                                |       |       |             |
      |           | 詳しくは、「 \                 |       |       |             |
      |           | :ref:`general_operations\      |       |       |             |
      |           | _write_role_package\           |       |       |             |
      |           | _ansible_legacy_role` \        |       |       |             |
      |           | 」を参照してください。         |       |       |             |
      +-----------+--------------------------------+-------+-------+-------------+
      | 備考      | 自由記述欄です。               | ー    | 手動\ | 最大長\     |
      |           |                                |       | 入力  | 4000バイト  |
      +-----------+--------------------------------+-------+-------+-------------+

.. warning:: | **ロールパッケージ内に定義した変数を取り出すタイミング**
   | 内部の処理でロールパッケージ内に定義している変数を取り出します。取り出した変数は、「 :ref:`general_operations_substitution_value_auto_registration_setting` 」で具体値の登録が可能になります。
   | 抜出するタイミングはリアルタイムではありませんので、「 :ref:`general_operations_substitution_value_auto_registration_setting` 」で変数が扱えるまでに **時間がかかる** 場合があります。


.. .. _general_operations_dialog_type_list_ansible_pioneer_only:
.. 対話種別リスト（Ansible-Pioneerのみ）
.. ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. #. | [対話種別リスト]では、対話種別の登録／更新／廃止を行います。
..    | ※本メニューはAnsible-Pioneer コンソールにのみ存在します。
..    | Ansible-Pioneerでは、「OS種別」ごとの差異を対話ファイルごとに定義し、同一目的の対話ファイルを「対話種別」として纏めて機器差分を吸収(抽象化)します。

..    .. figure:: ./general_operations/image35.png
..       :width: 6.25388in
..       :height: 2.78024in
..       :alt: サブメニュー画面（対話種別リスト）

..       サブメニュー画面（対話種別リスト）

.. #. | 「登録」-「登録開始」ボタンより、オペレーション情報の登録を行います。

..    .. figure:: ./general_operations/image36.png
..       :width: 5.38086in
..       :height: 0.9422in
..       :alt: 登録画面（対話種別リスト）
   
..       登録画面（対話種別リスト）

.. #. | 一覧/更新のMovement-対話種別紐付ボタンをクリックすると、対象の :ref:`general_operations_movement_details` へ遷移します。対話素材ファイル集ボタンをクリックすると、対象の :ref:`general_operations_dialog_files_ansible_pioneer_only` へ遷移します。

..    .. figure:: ./general_operations/image37.png
..       :width: 6.06944in
..       :height: 1.17301in
..       :alt: サブメニュー画面（対話種別リスト）

..       サブメニュー画面（対話種別リスト）

.. #. | 登録画面の項目一覧は以下のとおりです。

..    .. table:: 登録画面項目一覧（対話種別リスト）
..       :align: left

..       +-----------+--------------------------------+-------+-------+-------------+
..       | **項目**  | **説明**                       | **入\ | **入\ | **制約\     |
..       |           |                                | 力**  | 力方\ | 事項**      |
..       |           |                                |       | 法**  |             |
..       |           |                                |       |       |             |
..       |           |                                |       |       |             |
..       |           |                                | **必\ |       |             |
..       |           |                                | 須**  |       |             |
..       |           |                                |       |       |             |
..       |           |                                |       |       |             |
..       +===========+================================+=======+=======+=============+
..       | 対\       | 対話種別名を入力します。       | ○     | リ\   | 最大\       |
..       | 話種別名  |                                |       | スト\ | 長256バイト |
..       |           |                                |       | 選択  |             |
..       +-----------+--------------------------------+-------+-------+-------------+
..       | 備考      | 自由記述欄です。               | ー    | 手動\ | 最大長\     |
..       |           |                                |       | 入力  | 4000バイト  |
..       +-----------+--------------------------------+-------+-------+-------------+

.. .. _general_operations_dialog_files_ansible_pioneer_only:
.. 対話ファイル素材集（Ansible-Pioneerのみ）
.. ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. #. | [対話ファイル素材集]では、ユーザーが作成した対話ファイルの登録／更新／廃止を行います。
..    | ※本メニューは、Ansible-Pioneer コンソールにのみ存在します。

.. #. | 対話ファイルの記述などに関しては、「 :ref:`general_operations_write_dialog_file_ansible_pioneer` 」を参照してください。
..    | 「対話種別」と「OS種別」の組み合わせごとに対話ファイルを登録します。
..    | １つの「対話種別」で複数のOSに対応させたい場合は、同じ「対話種別」で、「OS種別」それぞれについて対話ファイルを登録してください。

..    .. figure:: ./general_operations/image38.png
..       :width: 6.4939in
..       :height: 2.90025in
..       :alt: サブメニュー画面（対話ファイル素材集）

..       サブメニュー画面（対話ファイル素材集）

.. #. | 「登録」-「登録開始」ボタンより、対話ファイル素材の登録を行います。

..    .. figure:: ./general_operations/image36.png
..       :width: 5.19507in
..       :height: 0.90966in
..       :alt: 登録画面（対話ファイル素材集）

..       登録画面（対話ファイル素材集）

.. #. | 一覧/更新の対話種別のリンクをクリックすると、対象の :ref:`general_operations_dialog_type_list_ansible_pioneer_only` へ遷移します。
..    | また、os種別のリンクをクリックすると、対象の :ref:`general_operations_os_type_master` へ遷移します。

..    .. figure:: ./general_operations/image39.png
..       :width: 6.2281in
..       :height: 1.2785in
..       :alt: サブメニュー画面（対話ファイル素材集）

..       サブメニュー画面（対話ファイル素材集）

.. #. | 登録画面の項目一覧は以下のとおりです。

..    .. table:: 登録画面項目一覧（対話ファイル素材集）
..       :align: left

..       +-----------+--------------------------------+-------+-------+-------------+
..       | **項目**  | **説明**                       | **入\ | **入\ | **制約\     |
..       |           |                                | 力**  | 力方\ | 事項**      |
..       |           |                                |       | 法**  |             |
..       |           |                                |       |       |             |
..       |           |                                |       |       |             |
..       |           |                                | **必\ |       |             |
..       |           |                                | 須**  |       |             |
..       |           |                                |       |       |             |
..       |           |                                |       |       |             |
..       +===========+================================+=======+=======+=============+
..       | 対話種別  | 対話種別\                      | ○     | リ\   | ー          |
..       |           | リストに登録されている対話種別\|       | スト\ |             |
..       |           | が表示されます。登録する対話フ\|       | 選択  |             |
..       |           | ァイルの対話種別を選択します。 |       |       |             |
..       +-----------+--------------------------------+-------+-------+-------------+
..       | OS種別    | OS\                            | ○     | リ\   | ー          |
..       |           | 種別マスタに登録されているOS種\|       | スト\ |             |
..       |           | 別が表示されます。登録する対話\|       | 選択  |             |
..       |           | ファイルのOS種別を選択します。 |       |       |             |
..       +-----------+--------------------------------+-------+-------+-------------+
..       | 対話ファ\ |                                | ○     | ファ\ | 最大サイ\   |
..       | イル素材  | 対話種別とOS種別に対応する対話\|       | イル\ | ズ4Gバイト  |
..       |           | ファイルをアップロードします。 |       | 登録  |             |
..       |           |                                |       |       |             |
..       |           | アップロードす\                |       |       |             |
..       |           | る対話ファイルは文字コードがUT\|       |       |             |
..       |           | F-8のBOMなしで作成してください。 |       |       |             |
..       |           |                                |       |       |             |
..       |           | 文字コードがUTF-8の\           |       |       |             |
..       |           | BOMなし以外の対話ファイルはア\ |       |       |             |
..       |           | ップロードでエラーになります。 |       |       |             |
..       +-----------+--------------------------------+-------+-------+-------------+
..       | 備考      | 自由記述欄です。               | ー    | 手動\ | 最大長\     |
..       |           |                                |       | 入力  | 4000バイト  |
..       +-----------+--------------------------------+-------+-------+-------------+

..    | 「登録」の前に、「対話ファイル」を「事前アップロード（①）」してください。「アップロード状況（②）」に対話ファイルのファイル名が表示されたのを確認してから、「登録」ボタンを押してください。

..    .. image:: ./general_operations/image_2a_3.png
..       :width: 1.81218in
..       :height: 0.98027in
..       :align: center

..    | 対話ファイルはYAML形式のファイルとして扱います。YAML形式に準じていない記述があると、アップロード時にエラーとなります。詳しくは、「 :ref:`general_operations_things_to_keep_in_mind_when_writing_dialogue_files_in_yaml_format` 」を参照してください。
..    | 内部の処理で対話ファイル内に定義している変数を取り出します。取り出した変数は、「 :ref:`general_operations_substitution_value_auto_registration_setting` 」や「 :ref:`general_operations_substitution_value_list` 」で具体値の登録が可能になります。
..    | 抜出するタイミングはリアルタイムではありませんので、「 :ref:`general_operations_substitution_value_list` 」や「 :ref:`general_operations_substitution_value_auto_registration_setting` 」で変数が扱えるまでに **時間がかかる※** 場合があります。
..    | ※ 抜出のタイミングは「 :ref:`general_operations_about_the_maintenance_method` 」に記載していますので、そちらをご参照ください。

.. _general_operations_movement_details:

Movement-ロール紐付
~~~~~~~~~~~~~~~~~~~
.. Movement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）

.. | ※メニュー名はAnsible-LegacyはMovement-Playbook紐付、Ansible-Pioneer はMovement-対話種別紐付、Ansible-LegacyRoleはMovement-ロール紐付です。

#. | Movementで実行するロールパッケージのメンテナンス(閲覧/登録/更新/廃止)を行います。

   .. figure:: /images/ja/ansible-legacyrole/movement_role/movement_role.png
      :width: 800px
      :alt: サブメニュー画面（Movement-ロール紐付）

      サブメニュー画面（Movement-ロール紐付）
   .. :alt: サブメニュー画面（Movement-Playbook紐付）

      サブメニュー画面（Movement-Playbook紐付）

#. | :guilabel:`＋ 登録` ボタンより、Movement-ロール紐付の登録を行います。

   .. figure:: /images/ja/ansible-legacyrole/movement_role/registration_movement_role.gif
      :width: 800px
      :alt: 登録画面（Movement-ロール紐付）

      登録画面（Movement-ロール紐付）
   .. :alt: 登録画面（Movement-Playbook紐付）

      登録画面（Movement-Playbook紐付）

   .. #. | Movementのリンクをクリックすると、対象の :ref:`general_operations_movement_list` へ遷移します。
   ..    | また、Playbook素材のリンクをクリックすると、:ref:`general_operations_playbook_file_list_ansible_legacy_only` へ遷移します。
   ..    | ※Movement-対話種別紐付（Ansible-Pioneer）の場合は、Movementと対話種別、Movement-ロール紐付（Ansible-LegacyRole）の場合は、Movementとロールパッケージ名がそれぞれリンクになっています。

   ..    .. figure:: ./general_operations/image42.png
   ..       :width: 6.10208in
   ..       :height: 1.22666in
   ..       :alt: サブメニュー画面（Movement-Playbook紐付）

   ..       サブメニュー画面（Movement-Playbook紐付）

#. | 登録画面の項目一覧は以下のとおりです。

   .. - | **Ansible-Legacy の場合**

   ..   .. table:: 登録画面項目一覧（Movement-Playbook紐付の場合）
   ..      :align: left
   
   ..      +-----------+--------------------------------+-------+-------+-------------+
   ..      | **項目**  | **説明**                       | **入\ | **入\ | **制約\     |
   ..      |           |                                | 力**  | 力方\ | 事項**      |
   ..      |           |                                |       | 法**  |             |
   ..      |           |                                |       |       |             |
   ..      |           |                                |       |       |             |
   ..      |           |                                | **必\ |       |             |
   ..      |           |                                | 須**  |       |             |
   ..      |           |                                |       |       |             |
   ..      |           |                                |       |       |             |
   ..      +===========+================================+=======+=======+=============+
   ..      | Movement  | Movement一覧で登\              | ○     | リ\   | ー          |
   ..      |           | 録したMovementが表示されます。 |       | スト\ |             |
   ..      |           |                                |       | 選択  |             |
   ..      |           | Movementを選択します。         |       |       |             |
   ..      +-----------+--------------------------------+-------+-------+-------------+
   ..      | プレイブ\ | 「:ref:`general_operations_pl\ | ○     | リ\   | ー          |
   ..      | ック素材  | aybook_file_list_ansible\      |       | スト\ |             |
   ..      |           | _legacy_only`」で登録したプ\   |       | 選択  |             |
   ..      |           | レイブック素材が表示されます。\|       |       |             |
   ..      |           | プレイブック素材を選択します。 |       |       |             |
   ..      +-----------+--------------------------------+-------+-------+-------------+
   ..      | インクル\ | プレイブック素材の実行\        | ○     | 手動\ | 半角整数    |
   ..      | ード順序  | 順序(1～:一意値)を入力します。 |       | 入力  |             |
   ..      |           |                                |       |       |             |
   ..      |           | 入力さ\                        |       |       |             |
   ..      |           | れたインクルード順序(昇順)でプ\|       |       |             |
   ..      |           | レイブック素材が実行されます。 |       |       |             |
   ..      +-----------+--------------------------------+-------+-------+-------------+
   ..      | 備考      | 自由記述欄です。               | ー    | 手動\ | 最大長\     |
   ..      |           |                                |       | 入力  | 4000バイト  |
   ..      +-----------+--------------------------------+-------+-------+-------------+

   .. - | **Ansible-Legacy Role の場合**

   .. table:: 登録画面項目一覧（Movement-ロール紐付）
      :align: left

      +-----------+--------------------------------+-------+-------+-------------+
      | **項目**  | **説明**                       | **入\ | **入\ | **制約\     |
      |           |                                | 力\   | 力方\ | 事項**      |
      |           |                                | 必\   | 法**  |             |
      |           |                                | 須**  |       |             |
      |           |                                |       |       |             |
      |           |                                |       |       |             |
      +===========+================================+=======+=======+=============+
      | Movement  | Movement一覧で登録した\        | ○     | リ\   | ー          |
      |           | Movementが表示されます。       |       | スト\ |             |
      |           |                                |       | 選択  |             |
      +-----------+--------------------------------+-------+-------+-------------+
      | ロ\       | ロールパッケージ管理で\        | ○     | リ\   | ー          |
      | ールパッ\ | 登録したロールパッケージ\      |       | スト\ |             |
      | ケージ名  | が表示されます。実行する\      |       | 選択  |             |
      |           | ロールパッケージを選択します。 |       |       |             |
      |           |                                |       |       |             |
      |           | 同一Movementに\                |       |       |             |
      |           | 複数のロール\                  |       |       |             |
      |           | パッケージは登録出来ません。   |       |       |             |
      +-----------+--------------------------------+-------+-------+-------------+
      | ロール名  | ロールパッケージ名で\          | ○     |       | ー          |
      |           | 選択したロールパッケージ\      |       |       |             |
      |           | に含まれているロール名が表\    |       |       |             |
      |           | 示されます。実行するロールパッ\|       |       |             |
      |           | ケージ内のロールを選択します。 |       |       |             |
      +-----------+--------------------------------+-------+-------+-------------+
      | インクル\ | ロールの実行順序(1～:一意値)\  | ○     | 手動\ | 半角整数    |
      | ード順序  | を入力します。                 |       | 入力  |             |
      |           |                                |       |       |             |
      |           | 入力されたインクルード順序\    |       |       |             |
      |           | (昇順)でロールが実行されます。 |       |       |             |
      +-----------+--------------------------------+-------+-------+-------------+
      | 備考      | 自由記述欄です。               | ー    | 手動\ | 最大長\     |
      |           |                                |       | 入力  | 4000バイト  |
      +-----------+--------------------------------+-------+-------+-------------+

   .. - | **Ansible-Pioneer の場合**

   ..   .. table:: 登録画面項目一覧（Movement-対話種別紐付の場合）
   ..      :align: left
  
   ..      +-----------+--------------------------------+-------+-------+-------------+
   ..      | **項目**  | **説明**                       | **入\ | **入\ | **制約\     |
   ..      |           |                                | 力**  | 力方\ | 事項**      |
   ..      |           |                                |       | 法**  |             |
   ..      |           |                                |       |       |             |
   ..      |           |                                |       |       |             |
   ..      |           |                                | **必\ |       |             |
   ..      |           |                                | 須**  |       |             |
   ..      |           |                                |       |       |             |
   ..      |           |                                |       |       |             |
   ..      +===========+================================+=======+=======+=============+
   ..      | Movement  | Ansible-Legacyと同様です。     | ○     | リ\   | ー          |
   ..      |           |                                |       | スト\ |             |
   ..      |           |                                |       | 選択  |             |
   ..      +-----------+--------------------------------+-------+-------+-------------+
   ..      | 対話種別  | 「:ref:`general_operations\    | ○     | リ\   | ー          |
   ..      |           | _dialog_type_list_ansible\     |       | スト\ |             |
   ..      |           | _pioneer_only`」で登\          |       | 選択  |             |
   ..      |           | 録した対話種別が表示されます。\|       |       |             |
   ..      |           | 実行する対話種別を選択します。 |       |       |             |
   ..      |           |                                |       |       |             |
   ..      |           | ホスト毎に\                    |       |       |             |
   ..      |           | OS種別と対話種別に関連付く対話\|       |       |             |
   ..      |           | ファイルが実行対象となります。 |       |       |             |
   ..      +-----------+--------------------------------+-------+-------+-------------+
   ..      | インクル\ | Ansible-Legacyと同様です。     | ○     | 手動\ | 半角整数    |
   ..      | ード順序  |                                |       | 入力  |             |
   ..      +-----------+--------------------------------+-------+-------+-------------+
   ..      | 備考      | 自由記述欄です。               | ー    | 手動\ | 最大長\     |
   ..      |           |                                |       | 入力  | 4000バイト  |
   ..      +-----------+--------------------------------+-------+-------+-------------+

.. _general_operations_nested_variable_list_ansible_legacy_role_only:

変数ネスト管理
~~~~~~~~~~~~~~
.. 変数ネスト管理（Ansible-Legacy Roleのみ）

#. | :menuselection:`Ansible-LegacyRole-->変数ネスト管理` では、「 :ref:`general_operations_role_package_list_ansible_legacy_role_only` 」で登録したロールパッケージで定義されている多段変数内で繰返配列定義されているメンバー変数の配列の最大繰返数のメンテナンス(閲覧/更新)を行います。

   .. figure:: /images/ja/ansible-legacyrole/variable_nest_management/nested_variable_list.png
      :width: 800px
      :alt: サブメニュー画面（変数ネスト管理）
   
      サブメニュー画面（変数ネスト管理）

#. | :guilabel:`編集` ボタンより最大繰返数の更新を行います。

   .. figure:: /images/ja/ansible-legacyrole/variable_nest_management/registration_nested_variable_list.gif
      :width: 800px
      :alt: 登録画面（変数ネスト管理）
   
      登録画面（変数ネスト管理）

#. | 登録画面の項目一覧は以下のとおりです。

   .. table:: 登録画面項目一覧（変数ネスト管理）
      :align: left

      +--------+----------------------------------+-------+-------+--------------+
      | **項\  | **説明**                         | **入\ | **入\ | **制約事項** |
      | 目**   |                                  | 力\   | 力方\ |              |
      |        |                                  | 必\   | 法**  |              |
      |        |                                  | 須**  |       |              |
      |        |                                  |       |       |              |
      +========+==================================+=======+=======+==============+
      | 最大\  | 配列の最大繰返数を1\             | ○     | 手動\ | 入力値\      |
      | 繰返数 | ～99,999,999の範囲で入力します。 |       | 入力  | 1\           |
      |        |                                  |       |       | ～99,999,999 |
      +--------+----------------------------------+-------+-------+--------------+
      | 備考   | 自由記述欄です。                 | ー    | 手動\ | 最大\        |
      |        |                                  |       | 入力  | 長4000バイト |
      +--------+----------------------------------+-------+-------+--------------+


.. warning:: | **初期登録および繰返数の更新タイミング**
   | 内部の処理でロールパッケージ内に定義している多段変数繰返配列で定義されているメンバー変数の繰返数を初期登録します。初期登録後、変数ネスト管理で繰返数を更新することが出来ます。
   | なお、初期登録および繰返数の更新はリアルタイムではないので、「 :ref:`general_operations_substitution_value_auto_registration_setting` 」で変数が扱えるまでに **時間がかかる** 場合があります。


.. {{2系で廃止(変数名の一意管理)}
   .. tip:: | **変数名の一意管理**
      | 変数名の管理は、全ロールパッケージで一意管理しています。ロールパッケージを跨って同じ変数名を使用している場合、変数ネスト管理で設定した繰返し数は、全ロールパッケージの変数に適用されます。


.. .. note:: | **変数定義ファイルで定義した変数の変数ネスト管理への反映例**
..    | メンバー変数名の表示は各階層の変数を「.」でスコープします。
..    | また、1階層目が繰返配列の場合はメンバー変数名が「－」と表示されます。
..    | e.g.) ロールパッケージの変数定義ファイル(defaults/main.yml)で定義した変数の変数ネスト管理への反映例
..    #. | 下記のようにロールパッケージの変数定義ファイル(defaults/main.yml)に変数を定義します。
..       | **変数定義**

..       .. code-block:: yaml

..          VAR_aaaa:
..            - name: alice
..              object: obj1
..              directory: 
..                - craete_dir: /dir
..              password:
..                - craete_pass: 
..                  sample:
..                    - sample_pass: pass1
..                - craete_pass: 
..                  sample:
..                    - sample_pass: pass2
..              user:
..                root:
..                  - craete_users: 
..                    prod:
..                      - prod_user: user1
..                    dev:
..                      - dev_user: user2
   
..    #. | 1. のように変数を定義した場合、変数ネスト管理には下記のように登録されます。
..       | メンバー変数名の表示は各階層の変数を「.」でスコープします。
   
..       .. table:: 
..          :align: left

..          +----------------------------+------------------------+----------------------------+
..          | **変数名**                 | **メンバー変数名**     | **最大繰返数の初期値**     |
..          |                            |                        |                            |
..          +============================+========================+============================+
..          | VAR_aaaa                   | 0                      | 1                          |
..          +----------------------------+------------------------+----------------------------+
..          | VAR_aaaa                   | 0.directory            | 1                          |
..          +----------------------------+------------------------+----------------------------+
..          | VAR_aaaa                   | 0.password             | 1                          |
..          +----------------------------+------------------------+----------------------------+
..          | VAR_aaaa                   | 0.password.sample      | 1                          |
..          +----------------------------+------------------------+----------------------------+
..          | VAR_aaaa                   | 0.user.root            | 1                          |
..          +----------------------------+------------------------+----------------------------+
..          | VAR_aaaa                   | 0.user.root.dev        | 1                          |
..          +----------------------------+------------------------+----------------------------+
..          | VAR_aaaa                   | 0.user.root.prod       | 1                          |
..          +----------------------------+------------------------+----------------------------+

.. #. | アクセス許可ロール
..    | 変数ネスト管理に設定されるアクセス許可ロールは、該当の変数が定義されているロールパッケージ管理のアクセス許可ロールが設定されます。複数のロールパッケージ管理で変数が定義されている場合、各ロールパッケージ管理のアクセス許可ロールが全て設定されます。また、アクセス許可ロールが空の場合、全てのロールへのアクセスが可能として扱われます。各ロールパッケージ管理のアクセス許可ロールが空白の場合、変数ネスト管理のアクセス許可ロールも空白が設定されます。
..    | アクセス許可ロールの詳細については :doc:`../it_automation_base/rbac` を参照してください。

..    .. table:: 
..       :align: left

..       +-----------+-------+--------+-------------+----------+-------------+
..       | ロールパ\ |       |        |             | 多\      |             |
..       | ッケージ\ |       |        |             | 段変数最\|             |
..       | 管理      |       |        |             | 大繰返数 |             |
..       |           |       |        |             |          |             |
..       +===========+=======+========+=============+==========+=============+
..       | ロールパ\ | 変数  | アク\  |             | 変数     | アクセス許\ |
..       | ッケージ  |       | セス\  |             |          | 可ロール    |
..       |           |       | 許可\  |             |          |             |
..       |           |       | ロール |             |          |             |
..       |           |       |        |             |          |             |
..       |           |       |        |             |          |             |
..       +-----------+-------+--------+-------------+----------+-------------+
..       | P\        | \VAR_\| 空白   |             | VAR\     | 空白        |
..       | ackeage_A | nest1 |        |             | \_nest1\ |             |
..       +-----------+-------+--------+-------------+----------+-------------+
..       | P\        | \VAR_\| 空白   |             | VAR\     | 空白        |
..       | ackeage_A | nest2 |        |             | \_nest2\ |             |
..       +-----------+-------+--------+-------------+----------+-------------+
..       | P\        | \VAR_\| Role_A |             | VAR\     | Ro\         |
..       | ackeage_A | nest3 |        |             | \_nest3\ | le_A,Role_B |
..       +-----------+-------+--------+-------------+----------+-------------+
..       | P\        | \VAR_\| Role_A |             | VAR\     | Role_C      |
..       | ackeage_B | nest2 |        |             | \_nest4\ |             |
..       +-----------+-------+--------+-------------+----------+-------------+
..       | P\        | \VAR_\| Role_B |             |          |             |
..       | ackeage_B | nest3 |        |             |          |             |
..       +-----------+-------+--------+-------------+----------+-------------+
..       | P\        | \VAR_\| Role_C |             |          |             |
..       | ackeage_B | nest4 |        |             |          |             |
..       +-----------+-------+--------+-------------+----------+-------------+

.. _general_operations_substitution_value_auto_registration_setting:

代入値自動登録設定
~~~~~~~~~~~~~~~~~~

#. | メニュー作成機能で作成したパラメータシートの項目の設定値とMovementの変数を紐付けます。登録した情報は内部の処理により代入値管理と作業対象ホストに反映されます。

   .. figure:: /images/ja/ansible-legacyrole/substitution_value_automatic_setting/substitution_value_auto_registration_setting_role.png
      :width: 800px
      :alt: サブメニュー画面（代入値自動登録設定）

      サブメニュー画面（代入値自動登録設定）

#. | :guilabel:`＋ 登録` ボタンより代入値自動登録設定を行います。

   .. figure:: /images/ja/ansible-legacyrole/substitution_value_automatic_setting/registration_substitution_value_auto_registration_setting_role.gif
      :width: 800px
      :alt: 登録画面（代入値自動登録設定）

      登録画面（代入値自動登録設定）


#. | 登録画面の項目一覧は以下のとおりです。


   .. #. | 一覧/更新のメニューIDまたは、メニュー名称のリンクをクリックすると、対象メニューへ遷移します。

   ..    .. figure:: ./general_operations/image47.png
   ..       :width: 6.43176in
   ..       :height: 1.54306in
   ..       :alt: サブメニュー画面（代入値自動登録設定）

   ..       サブメニュー画面（代入値自動登録設定）

   .. .. table:: 対応カラム一覧（代入値自動登録設定）
   ..    :align: left

   ..    +------+------------------+--------------+--------------+--------------+
   ..    | **カ\                   | **Legacy**   | **Legacy \   | **Pioneer**  |
   ..    | ラム**                  |              | Role**       |              |
   ..    +======+==================+==============+==============+==============+
   ..    | メ\                     | ○            | ○            | ○            |
   ..    | ニュ\                   |              |              |              |
   ..    | ーグ\                   |              |              |              |
   ..    | ルー\                   |              |              |              |
   ..    | プ:\                    |              |              |              |
   ..    | メニ\                   |              |              |              |
   ..    | ュー                    |              |              |              |
   ..    +------+------------------+--------------+--------------+--------------+
   ..    | 項目                    | ○            | ○            | ○            |
   ..    +------+------------------+--------------+--------------+--------------+
   ..    | 登録\                   | ○            | ○            | ○            |
   ..    | 方式                    |              |              |              |
   ..    +------+------------------+--------------+--------------+--------------+
   ..    | Move\                   | ○            | ○            | ○            |
   ..    | ment                    |              |              |              |
   ..    +------+------------------+--------------+--------------+--------------+
   ..    | Key  | 変数名           | ○            | ○            | ○            |
   ..    |      |                  |              |              |              |
   ..    | 情報 |                  |              |              |              |
   ..    |      +------------------+--------------+--------------+--------------+
   ..    |      | メンバー変数名   | －           | ▲            | －           |
   ..    |      +------------------+--------------+--------------+--------------+
   ..    |      | 代入順序         | △            | △            | △            |
   ..    +------+------------------+--------------+--------------+--------------+
   ..    | V\   | 変数名           | ○            | ○            | ○            |
   ..    | alue |                  |              |              |              |
   ..    |      |                  |              |              |              |
   ..    | 情報 |                  |              |              |              |
   ..    |      +------------------+--------------+--------------+--------------+
   ..    |      | メンバー変数名   | －           | ▲            | －           |
   ..    |      +------------------+--------------+--------------+--------------+
   ..    |      | 代入順序         | △            | △            | △            |
   ..    +------+------------------+--------------+--------------+--------------+
   ..    | NULL\                   | ●            | ●            | ●            |
   ..    | 連携                    |              |              |              |
   ..    +------+------------------+--------------+--------------+--------------+

   .. | ○:必須
   .. | ●:任意
   .. | △:選択した変数が複数具体値設定可能な変数の場合のみ必須
   .. | ▲:選択した変数が多段変数の場合のみ必須
   .. | －:非表示

   .. | 代入値自動登録設定で登録した情報は、内部の処理で代入値管理と作業対象ホストへ反映されます。
   .. | 反映のタイミングは「 :ref:`general_operations_about_the_maintenance_method` 」に記載していますので、そちらをご参照ください。

   .. table:: 登録画面項目一覧（代入値自動登録設定）
      :align: left

      +-----------------------------------+-------------------------------------------------+----------------------------------------------+--------------+-------------------+
      | **項目**                          | **説明**                                        | **入力必須**                                 | **入力方法** | **制約事項**      |
      |                                   |                                                 |                                              |              |                   |
      |                                   |                                                 |                                              |              |                   |
      +=================+=================+=================================================+==============================================+==============+===================+
      | パラメータシー\ | メニューグルー\ | メニュー作成機能で作成したパラメータシートの項\ | ○                                            | リスト選択   | ー                |
      | ト(From)        | プ:メニュー:項目| 目が表示されます。                              |                                              |              |                   |
      |                 |                 |                                                 |                                              |              |                   |
      |                 |                 | 対象の項目を選択します。                        |                                              |              |                   |
      |                 |                 |                                                 |                                              |              |                   |
      |                 +-----------------+-------------------------------------------------+----------------------------------------------+--------------+-------------------+
      |                 | 代入順序        | メニュー作成機能で作成したパラメータシートが\   |  :ref:`※1 <parashi_substitution>`            | 手動入力     | 1～2147483647     |
      |                 |                 | 縦型メニューの場合、\                           |                                              |              |                   |            
      |                 |                 | パラメータシートで登録している代入順序を\       |                                              |              |                   |
      |                 |                 | 入力します。                                    |                                              |              |                   |
      +-----------------+-----------------+-------------------------------------------------+----------------------------------------------+--------------+-------------------+
      | 登録方式                          | Value型:項目の設定値を紐付けた変数の具体値\     | ○                                            | リスト選択   | ー                |
      |                                   | とする場合に選択します。                        |                                              |              |                   |
      |                                   |                                                 |                                              |              |                   |
      |                                   | Key型:項目の名称を紐付けた変数の具体値\         |                                              |              |                   |
      |                                   | とする場合に選択します。                        |                                              |              |                   |
      |                                   |                                                 |                                              |              |                   |
      |                                   | 項目の設定値が空白の場合\                       |                                              |              |                   |
      |                                   | は紐付け対象外となります。                      |                                              |              |                   |
      +-----------------------------------+-------------------------------------------------+----------------------------------------------+--------------+-------------------+
      | Movement名                        | Movement一覧で登録したMovementが表示されます。  | ○                                            | リスト選択   | ー                |
      |                                   |                                                 |                                              |              |                   |
      |                                   | Movementを選択します。                          |                                              |              |                   |
      +-----------------+-----------------+-------------------------------------------------+----------------------------------------------+--------------+-------------------+
      | IaC変数(To)     | Movement名\     | Movement-ロール紐付で登録した資材で使用している\| ○                                            | リスト選択   | ー                |
      |                 | :変数名         | 変数が表示されます。                            |                                              |              |                   |
      |                 |                 |                                                 |                                              |              |                   |
      |                 |                 | 具体値に紐付けたい変数を選択します。            |                                              |              |                   |
      |                 +-----------------+-------------------------------------------------+----------------------------------------------+--------------+-------------------+
      |                 | Movement名:変\  | 変数名で多段変数を選択した場合に多段変数の\     |  :ref:`※2 <member>`                          | リスト選択   |                   |
      |                 | 数名:メンバー\  | メンバー変数が表示されます。                    |                                              |              |                   |
      |                 | 変数            |                                                 |                                              |              |                   |
      |                 |                 | メンバー変数を選択します。                      |                                              |              |                   |
      |                 +-----------------+-------------------------------------------------+----------------------------------------------+--------------+-------------------+
      |                 | 代入順序        | 複数具体値が設定できる変数の場合のみ必須入力\   |  :ref:`※3 <substitution>`                    | 手動入力     | 1～2147483647     |
      |                 |                 | になります。                                    |                                              |              |                   |
      |                 |                 |                                                 |                                              |              |                   |
      |                 |                 | 具体値の代入順序（1～）を入力します。入力値に\  |                                              |              |                   |
      |                 |                 | 従い昇順で代入されます。具体値が複数ない場合で\ |                                              |              |                   |
      |                 |                 | も代入順序（1～）を入力します。                 |                                              |              |                   |
      +-----------------+-----------------+-------------------------------------------------+----------------------------------------------+--------------+-------------------+
      | NULL連携                          | パラメータシートの具体値がNULL(空白)の場合に、\ | ※4                                           | リスト選択   | ー                |
      |                                   | 代入値管理への登録をNULL(空白)の値で行うか設定\ |                                              |              |                   |
      |                                   | します。                                        |                                              |              |                   |
      |                                   |                                                 |                                              |              |                   |
      |                                   | ・「True」の場合、パラメータシートの値がどのよ\ |                                              |              |                   |
      |                                   | うな値でも代入値管理への登録が行われます。      |                                              |              |                   |
      |                                   |                                                 |                                              |              |                   |
      |                                   | ・「False」の場合、パラメータシートに値が入っ\  |                                              |              |                   |
      |                                   | ている場合のみ代入値管理への登録が行われます。  |                                              |              |                   |
      |                                   |                                                 |                                              |              |                   |
      |                                   | ・空白の場合、Ansibleインターフェース情報の\    |                                              |              |                   |
      |                                   | 「NULL連携」の値が適用されます。                |                                              |              |                   |
      +-----------------------------------+-------------------------------------------------+----------------------------------------------+--------------+-------------------+
      | 備考                              | 自由記述欄です。                                | ー                                           | 手動入力     | 最大長4000バイト  |
      +-----------------------------------+-------------------------------------------------+----------------------------------------------+--------------+-------------------+
   
   | ※1:パラメータシート(縦メニュー)を使用する場合のみ必須
   | ※2:選択した変数が多段変数の場合のみ必須
   | ※3:選択した変数が複数具体値設定可能な変数の場合のみ必須
   | ※4:任意

.. _parashi_substitution:

.. note:: | **パラメータシート(縦メニュー)の場合**
   | パラメータシート(縦メニュー)のリピート設定されている項目とMovementの変数を紐付ける場合、 :menuselection:`Ansible-LegacyRole-->代入値自動登録設定` でパラメータシート(From) の代入順序を入力する必要があります。
   | パラメータシート(縦メニュー)と代入値自動登録設定の関係を以下の図に示します。

   .. figure:: /images/ja/diagram/parameter.png
      :width: 600px
      :alt: パラメータシート(縦メニュー)使用時の代入値自動登録設定登録方法


.. _member:

.. note:: | **メンバー変数の選択**
   
   | 多段変数の場合にのみメンバー変数の選択が必要になります。メンバー変数に表示される変数は具体値を必要とする変数のみです。
   | メンバー変数名の表示は各階層の変数を「.」でスコープします。
   | 繰返配列の場合は「[ ]」で繰返位置(0～)をスコープします。繰返し配列の数は「 :ref:`general_operations_nested_variable_list_ansible_legacy_role_only` 」で設定を行います。
   |
   | e.g.) 代入値自動登録設定で選択できるメンバー変数と変数ネスト管理で最大繰返数を更新後に選択できるメンバー変数の確認
   
   #. | 下記のようにロールパッケージの変数定義ファイル(defaults/main.yml)に変数を定義して、 :menuselection:`Ansible-LegacyRole-->ロールパッケージ管理` でロールパッケージを登録します。
      | **変数定義ファイルの記述内容**                                                         
                                                                              
      .. code-block:: yaml

         VAR_aaaa:
           - name: alice
             object: obj1
             directory: 
               - craete_dir: /dir
             password:
               - craete_pass: 
                 sample:
                   - sample_pass: pass1
               - craete_pass: 
                 sample:
                   - sample_pass: pass2
             user:
               root:
                 - craete_users: 
                   prod:
                     - prod_user: user1
                   dev:
                     - dev_user: user2
  
   #. | 1. のように変数を定義してロールパッケージを登録した場合、 :menuselection:`Ansible-LegacyRole-->変数ネスト管理` には下記のように登録され、 :menuselection:`Ansible-LegacyRole-->代入値自動登録設定` ではデフォルトで下記のメンバー変数が選択できます。
   
      .. table:: 変数ネスト管理の登録内容
         :align: left

         +----------------------------+------------------------+----------------------------+
         | **変数名**                 | **メンバー変数名**     | **最大繰返数**             |
         |                            |                        |                            |
         +============================+========================+============================+
         | VAR_aaaa                   | 0                      | 1                          |
         +----------------------------+------------------------+----------------------------+
         | VAR_aaaa                   | 0.directory            | 1                          |
         +----------------------------+------------------------+----------------------------+
         | VAR_aaaa                   | 0.password             | 1                          |
         +----------------------------+------------------------+----------------------------+
         | VAR_aaaa                   | 0.password.sample      | 1                          |
         +----------------------------+------------------------+----------------------------+
         | VAR_aaaa                   | 0.user.root            | 1                          |
         +----------------------------+------------------------+----------------------------+
         | VAR_aaaa                   | 0.user.root.dev        | 1                          |
         +----------------------------+------------------------+----------------------------+
         | VAR_aaaa                   | 0.user.root.prod       | 1                          |
         +----------------------------+------------------------+----------------------------+
      
      .. table:: 代入値自動登録設定で選択可能なメンバー変数
         :align: left

         +----------------------------+-----------------------------------------+
         | **変数名**                 | **メンバー変数名**                      | 
         |                            |                                         |                            
         +============================+=========================================+
         | VAR_aaaa                   | [0].directory[0].create_dir             | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].name                                | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].object                              |
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].password[0].create_pass             | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].password[0].sample[0].sample_pass   | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].user.root[0].create_users           | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].user.root[0].dev[0].dev_user        | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].user.root[0].prod[0].prod_user      | 
         +----------------------------+-----------------------------------------+
   
   #. | :menuselection:`Ansible-LegacyRole-->変数ネスト管理` でメンバー変数「0.user.root.prod」の最大繰返数を初期値"1"から"3"に更新します。

      .. table:: 変数ネスト管理の更新内容
         :align: left

         +----------------------------+------------------------+----------------------------+
         | **変数名**                 | **メンバー変数名**     | **最大繰返数**             |
         |                            |                        |                            |
         +============================+========================+============================+
         | VAR_aaaa                   | 0.user.root.prod       | 3                          |
         +----------------------------+------------------------+----------------------------+
   
   #. | 3. のようにメンバー変数を更新した場合、 :menuselection:`Ansible-LegacyRole-->代入値自動登録設定` で選択できるメンバー変数も下記のように更新されます。
      | （メンバー変数 [0].user.root[0].prod[1].prod_user と [0].user.root[0].prod[2].prod_user がプルダウンに追加されました。）

      .. table:: 代入値自動登録設定で選択可能なメンバー変数
         :align: left

         +----------------------------+-----------------------------------------+
         | **変数名**                 | **メンバー変数名**                      | 
         |                            |                                         |                            
         +============================+=========================================+
         | VAR_aaaa                   | [0].directory[0].create_dir             | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].name                                | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].object                              |
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].password[0].create_pass             | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].password[0].sample[0].sample_pass   | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].user.root[0].create_users           | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].user.root[0].dev[0].dev_user        | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].user.root[0].prod[0].prod_user      | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].user.root[0].prod[1].prod_user      | 
         +----------------------------+-----------------------------------------+
         | VAR_aaaa                   | [0].user.root[0].prod[2].prod_user      | 
         +----------------------------+-----------------------------------------+


.. _substitution:

.. note:: | **代入順序の入力**
  
   | 変数名またはメンバー変数名を選択することで、複数具体値変数の場合のみ代入順序が入力可能となります。複数具体値変数の場合に入力してください。
   | 特定の複数具体値変数に対して代入順序が連続していなくても問題ありません。
   | 
   | e.g.)複数具体値変数に代入順序を入力して作業実行する場合
   
   #. | 下記のようにロールパッケージの変数定義ファイル(defaults/main.yml)に変数を定義して、 :menuselection:`Ansible-LegacyRole-->ロールパッケージ管理` でロールパッケージを登録します。                                                              
      | **変数定義ファイルの記述内容**

      .. code-block:: yaml

         VAR_substitutionA:
           - user-name
           - group-name
           - meta-name
         
         VAR_substitutionB:
           - login
           - authorized
           - space
           - cluster         
   
   #. | :menuselection:`Ansible-LegacyRole-->代入値自動登録設定` で紐付対象メニューに登録されている項目の設定値とRole内の変数を紐付けします。
   
      .. table:: 紐付対象メニュー(sample-menu)の登録内容
         :align: left
         
         +----------------+------------------------+----------+----------+----------+----------+
         | **ホスト名**   | **オペレーション名**   | **パラメータ**                            |
         |                |                        +----------+----------+----------+----------+
         |                |                        | **項目1**| **項目2**| **項目3**| **項目4**|
         +================+========================+==========+==========+==========+==========+
         | test-host      | test-ope               | value1   | value2   | value3   | value4   |
         +----------------+------------------------+----------+----------+----------+----------+
   
      .. table:: 代入値自動登録設定の登録内容
         :align: left
         
         +---------------+-----------+--------------------+----------------+
         | **メニュー名**| **項目**  | **変数名**         | **代入順序**   |
         +===============+===========+====================+================+
         | sample-menu   | 項目1     | VAR_substitutionA  | 3              |
         +---------------+-----------+--------------------+----------------+
         | sample-menu   | 項目2     | VAR_substitutionA  | 1              |
         +---------------+-----------+--------------------+----------------+
         | sample-menu   | 項目3     | VAR_substitutionA  | 2              |
         +---------------+-----------+--------------------+----------------+
         | sample-menu   | 項目1     | VAR_substitutionB  | 2              |
         +---------------+-----------+--------------------+----------------+
         | sample-menu   | 項目2     | VAR_substitutionB  | 4              |
         +---------------+-----------+--------------------+----------------+
         | sample-menu   | 項目3     | VAR_substitutionB  | 1              |
         +---------------+-----------+--------------------+----------------+
         | sample-menu   | 項目4     | VAR_substitutionB  | 3              |
         +---------------+-----------+--------------------+----------------+

   #. | 作業実行時、投入データ(InputData_xxxx.zip)内のホスト変数ファイル(host_vars/test-host)には、代入値自動登録設定で登録した変数が下記のように出力されます。
      | **ホスト変数ファイルへの出力内容**

      .. code-block:: yaml
   
         VAR_substitutionA: 
           - value2
           - value3
           - value1
         VAR_substitutionB: 
           - value3
           - value1
           - value4
           - value2

.. _host:

.. note:: | **ホスト変数ファイルへの出力**
   | 代入値自動登録設定で具体値を登録した変数のみが作業実行時にホスト変数ファイルへ出力されます。
   | 多段変数も同様で具体値を登録しているメンバー変数のみとなります。
   | 
   | e.g.) 代入値自動登録設定で具体値を登録した変数と作業実行時にホスト変数ファイルに出力される変数の確認
   
   #. | 下記のようにロールパッケージの変数定義ファイル(defaults/main.yml)に変数を定義して、 :menuselection:`Ansible-LegacyRole-->ロールパッケージ管理` でロールパッケージを登録します。                                                              
      | **変数定義ファイルの記述内容**

      .. code-block:: yaml

         VAR_output:
           - name: alice
             group: root
             user:
               root:
                 - craete_users: 
                   prod:
                     - prod_user: user1
                   dev:
                     - dev_user: user2         
   
   #. | :menuselection:`Ansible-LegacyRole-->代入値自動登録設定` で紐付対象メニューに登録されている項目の設定値とRole内の変数を紐付けします。
   
      .. table:: 紐付対象メニュー(sample-menu)の登録内容
         :align: left
         
         +----------------+------------------------+----------+----------+
         | **ホスト名**   | **オペレーション名**   | **パラメータ**      |
         |                |                        +----------+----------+
         |                |                        | **項目1**| **項目2**|
         +================+========================+==========+==========+
         | test-host      | test-ope               | value1   | value2   |
         +----------------+------------------------+----------+----------+
   
      .. table:: 代入値自動登録設定の登録内容
         :align: left
         
         +---------------+-----------+-------------+----------------------------------+
         | **メニュー名**| **項目**  | **変数名**  | **メンバー変数名**               |
         +===============+===========+=============+==================================+
         | sample-menu   | 項目1     | VAR_output  | [0].name                         |
         +---------------+-----------+-------------+----------------------------------+
         | sample-menu   | 項目2     | VAR_output  | [0].user.root[0].dev[0].dev_user |
         +---------------+-----------+-------------+----------------------------------+

   #. | 作業実行時、投入データ(InputData_xxxx.zip)内のホスト変数ファイル(host_vars/test-host)には、代入値自動登録設定で登録した変数が下記のように出力されます。
      | **ホスト変数ファイルへの出力内容**

      .. code-block:: yaml
   
         VAR_output:
           - name: value1
             user:
               root:
               - dev:
                 - dev_user: value2

.. _file_and_templete:

.. note:: | **ファイル埋込変数とテンプレート埋込変数をPlaybookの変数に紐付して使用する例**
   | 「Ansible共通:ファイル管理:ファイル埋込変数名」「Ansible共通:テンプレート管理:テンプレート埋込変数名」をパラメータシートの項目として代入値自動登録設定で使用した場合、項目の設定値は選択されている変数名となり、紐付している変数の具体値は '{{ 変数名 }}' として代入値管理に反映されます。
   | ファイルパスはITAが作業実行時に配置したファイルパスをホスト変数経由でansibleが解釈し処理します。
   | e.g.) ファイル埋込変数 CPF_test とテンプレート埋込変数 TPF_sample を代入値自動登録設定でPlaybookの変数に紐付して使用する場合

   #. | :menuselection:`Ansible共通-->ファイル管理／テンプレート管理` で下記のように登録します。
      
      .. table:: ファイル管理の登録内容
           :align: left                                                        
                                                                              
           +------------------------------------+----------------------------+   
           | **ファイル埋込変数名**             | **ファイル素材**           |   
           +====================================+============================+   
           | CPF_test                           | test_file.txt              |   
           +------------------------------------+----------------------------+

      .. table:: テンプレート管理の登録内容
           :align: left                                                        
                                                                              
           +------------------------------------+----------------------------+   
           | **テンプレート埋込変数名**         | **テンプレート素材**       |   
           +====================================+============================+   
           | TPF_sample                         | sample.tpl                 |   
           +------------------------------------+----------------------------+

   #. | :menuselection:`メニュー作成-->メニュー定義・作成` で「Ansible共通:ファイル管理:ファイル埋込変数名」「Ansible共通:テンプレート管理:テンプレート埋込変数名」をパラメータシートの項目としてメニュー作成後、 :menuselection:`入力用-->サンプルパラメータシート(メニュー名)` で項目の設定値としてファイル埋込変数とテンプレート埋込変数を登録します。
      
      .. figure:: /images/ja/menu_creation/menu_definition_and_create/legacyrole_menucreate.png
         :width: 800px
         :alt: メニュー定義・作成画面

         メニュー定義・作成画面

      .. table:: サンプルパラメータシート(メニュー名)の登録内容
         :align: left
         
         +----------------+------------------------+-----------------+---------------------+
         | **ホスト名**   | **オペレーション名**   | **パラメータ**                        |
         |                |                        +-----------------+---------------------+
         |                |                        | **ファイル管理**| **テンプレート管理**|
         +================+========================+=================+=====================+
         | test-host      | test-ope               | CPF_test        | TPF_sample          |
         +----------------+------------------------+-----------------+---------------------+

   #. | :menuselection:`Ansible-LegacyRole-->代入値自動登録設定` で2. のパラメータシートに登録した項目の設定値とPlaybookの変数を紐付して :menuselection:`Ansible-LegacyRole-->作業実行` で作業実行します。
      
      .. table:: 代入値自動登録設定の登録内容
         :align: left
         
         +----------------------------+-------------------+---------------+
         | **メニュー名**             | **項目**          | **変数名**    |
         +============================+===================+===============+
         | サンプルパラメータシート   | ファイル管理      | VAR_filetest  |
         +----------------------------+-------------------+---------------+
         | サンプルパラメータシート   | テンプレート管理  | VAR_temptest  |
         +----------------------------+-------------------+---------------+

   #. | :menuselection:`Ansible-LegacyRole-->作業状態確認` の :guilabel:`代入値確認` ボタンで具体値に '{{ CPF_test }}' '{{ TPF_sample }}' が反映されていることが確認できます。
      | また、作業実行後、作業対象サーバに1. で登録したファイル素材とテンプレート素材が設置されます。

      .. figure:: /images/ja/ansible-legacyrole/assigned_value_management/general_operations_note.png
         :width: 800px
         :alt: 作業状態確認の代入値確認画面

         作業状態確認の代入値確認画面
  
   .. #. | アクセス許可ロール
   ..    | 代入値自動登録の情報から生成される代入値管理と作業対象ホストに設定されるアクセス許可ロールは、代入値自動登録に設定されているMovementとパラメータシートに設定されているホスト(機器一覧)とオペレーションの各アクセス許可ロールで一致しているロールが設定されます。また、アクセス許可ロールが空の場合、全てのロールへのアクセスが可能として扱われます。各アクセス許可ロールで一致するロールの組み合わせが無いデータは、代入値管理と作業対象ホストにデータが生成されません。
   ..    | アクセス許可ロールの詳細については :doc:`../it_automation_base/rbac` を参照してください。

   ..    .. table:: 
   ..       :align: left

   ..       +----------+-----------+-------------+---------------+----------------+
   ..       | オペレ\  | Host      | Movement    |               | 代入値管理\    |
   ..       | ーシ\    |           |             |               | ・作業管理ホ\  |
   ..       | ョン     |           |             |               | ストに展開\    |
   ..       |          |           |             |               | されるアクセ\  |
   ..       |          |           |             |               | ス許可         |
   ..       |          |           |             |               |                |
   ..       +==========+===========+=============+===============+================+
   ..       | アクセ\  | アクセ\   | アクセ\     |               |                |
   ..       | ス許可\  | ス許可\   | ス許可\     |               |                |
   ..       | ロール   | ロール    | ロール      |               |                |
   ..       |          |           |             |               |                |
   ..       +----------+-----------+-------------+---------------+----------------+
   ..       | 空白     | 空白      | 空白        |               | 空白           |
   ..       +----------+-----------+-------------+---------------+----------------+
   ..       | Role_A   | 空白      | 空白        |               | Role_A         |
   ..       +----------+-----------+-------------+---------------+----------------+
   ..       | Role_A   | Role_A    | 空白        |               | Role_A         |
   ..       +----------+-----------+-------------+---------------+----------------+
   ..       | Role_A   | Role_A    | Role_A      |               | Role_A         |
   ..       +----------+-----------+-------------+---------------+----------------+
   ..       | Role\    | Rol\      | Role_A,Ro\  |               | Role_A,RoleB   |
   ..       | _A,RoleB | e_A,RoleB | le_B,Role_C |               |                |
   ..       +----------+-----------+-------------+---------------+----------------+
   ..       | Role_A   | Role_B    | Role_C      |               |                |
   ..       +----------+-----------+-------------+---------------+----------------+

.. #. | パラメータシート(縦メニュー)
..    | パラメータシート(縦メニュー)を使用する際に、リピート設定されている項目において、まとまり単位で値が空の場合、代入値自動登録設定でNULL連携を有効にしていても、代入値管理に登録はされません。

..    .. image:: ./general_operations/image_2a_6.png
..       :width: 5.44952in
..       :height: 1.80784in
..       :align: center
   
   .. メニュー作成

      .. image:: ./general_operations/image52.png
         :width: 5.44952in
         :height: 1.80784in
      
      パラメータシート
      
      .. image:: ./general_operations/image53.png
         :width: 5.45255in
         :height: 1.69342in
      
      代入値自動登録設定
      
      .. image:: ./general_operations/image54.png
         :width: 5.44943in
         :height: 1.19823in
      
      代入値管理
      
      .. image:: ./general_operations/image55.png
         :width: 5.49702in
         :height: 1.21611in

.. _general_operations_execution:

作業実行
~~~~~~~~

| 作業の実行を指示します。Movement一覧、オペレーション一覧からそれぞれラジオボタンで選択し、 :guilabel:`作業実行` ボタンを押すと、「 :ref:`general_operations_check_operation_status` 」に遷移し、実行されます。

.. figure:: /images/ja/ansible-legacyrole/execution/execution_screen.gif
   :width: 800px
   :alt: 作業実行画面

   作業実行画面

   .. :alt: サブメニュー画面（作業実行）

   .. サブメニュー画面（作業実行）

#. | **ドライラン**
   | 「ドライラン」ボタンをクリックすると、実際に対象機器に対して構築作業をせず、ドライランを行うことができます。
   | ドライランを行った場合の動作は、Ansible-Playbookコマンドの--checkパラメータを指定してroleを実行します。


    
   ..    :align: left

   ..    +----------------+-----------------------------------------------------+
   ..    | **Driver**     | **動作**                                            |
   ..    +================+=====================================================+
   ..    | Ansible\       | Ansible-Playbookコ\                                 |
   ..    | -Legacy Role   | マンドの--checkパラメータを指定しroleを実行します。 |
   ..    +----------------+-----------------------------------------------------+

   .. +----------------+-----------------------------------------------------+
   .. | **Driver**     | **動作**                                            |
   .. +================+=====================================================+
   .. | Ansible-Legacy | Ansible-Playbookコマン\                             |
   .. |                | ドの—checkパラメータを指定しPlaybookを実行します。  |
   .. +----------------+-----------------------------------------------------+
   .. | Ansible\       | Ansible-Playbookコ\                                 |
   .. | -Legacy Role   | マンドの—checkパラメータを指定しroleを実行します。  |
   .. +----------------+-----------------------------------------------------+
   .. | A\             | 対象機器への接続チェックのみを行います。            |
   .. | nsible-Pioneer |                                                     |
   .. +----------------+-----------------------------------------------------+

#. | **予約日時の指定**
   | 「予約日時」を入力することで、実行を予約することがきます。
   | 「予約日時」には、未来の日時のみ登録可能です。

   .. | 作業実行時にアクセス許可ロールの適合判定

   .. .. table:: 
   ..    :align: left

   ..    +----------------+--------------+---------------------+---------------+
   ..    | Movement       | オペレーシ\  |                     | 作業管理      |
   ..    |                | ョン         |                     |               |
   ..    +================+==============+=====================+===============+
   ..    | アクセス許可\  | アクセス許可\|                     | アクセス許可\ |
   ..    | ロール         | ロール       |                     | ロール        |
   ..    |                |              |                     |               |
   ..    +----------------+--------------+---------------------+---------------+
   ..    | 空白           | 空白         |                     | 空白          |
   ..    +----------------+--------------+---------------------+---------------+
   ..    | 空白           | Role_A       |                     | Role_A        |
   ..    +----------------+--------------+---------------------+---------------+
   ..    | Role_B         | Role_B       |                     | Role_B        |
   ..    +----------------+--------------+---------------------+---------------+
   ..    | Role_B,Role_C  | R\           |                     | Role_B        |
   ..    |                | ole_B,Role_C |                     |               |
   ..    +----------------+--------------+---------------------+---------------+
   ..    | Role_D         | Role_E       |                     |               |
   ..    +----------------+--------------+---------------------+---------------+

   .. | Movement一覧、オペレーション一覧で選択したMovementとオペレーションの各アクセス許可ロールで一致するロールがあるかを判定します。一致するロールが無い場合、その旨のエラーメッセージが表示され作業実行は出来ません。また、一致するロールが作業管理のアクセス許可ロールとして設定されます。また、アクセス許可ロールが空白の場合は、全てのロールへのアクセスが可能として扱われます。各アクセス許可ロールが空白の場合、作業管理のアクセス許可ロールも空白に設定されます。
   .. | アクセス許可ロールの詳細については :doc:`../it_automation_base/rbac` を参照してください。


.. _general_operations_check_operation_status:

作業状態確認
~~~~~~~~~~~~

| 作業の実行状態を監視します。

.. figure:: /images/ja/ansible-legacyrole/check_work_status/check_operation_status.png
   :width: 800px
   :alt: サブメニュー画面（作業状態確認）

   サブメニュー画面（作業状態確認）

#. | **実行状態表示**
   | 実行状況に即し、「ステータス」が表示されます。
   | また、実行ログ、エラーログに実行状況の詳細が表示されます。
   | 「実行種別」には、ドライランの場合は「ドライラン」、それ以外は「通常」が表示されます。
   | ステータスが想定外エラーで終了した場合、Webコンテンツの登録不備が原因であれば、エラーログにメッセージが表示されます。
   | また、「 :ref:`general_operations_interface_information` 」の登録不備等で、Ansible RestAPIとの通信に失敗した場合にはエラーログにメッセージが表示されません。この場合は、アプリケーションログにエラー情報が記録されます。必要に応じてアプリケーションログを確認ください。
   | Conductorから実行した場合に、「呼出元Conductor」には、どのConductorから実行されたかを表示します。
   | Ansible-LegacyRoleドライバから直接実行した場合は空欄になります。
   | 「実行ユーザ」には、作業実行メニューより「実行」ボタンまたは「ドライラン」ボタンを押下した際のログインユーザが表示されます。

#. | **作業対象ホスト確認**
   | :guilabel:`作業対象ホスト確認` ボタンで「 :ref:`general_operations_target_host` 」が表示され、作業対象のオペレーションとMovementに絞り込んだホストが表示されます。

#. | **代入値確認**
   | :guilabel:`代入値確認` ボタンで「 :ref:`general_operations_substitution_value_list` 」が表示され、作業対象のオペレーションとMovementに絞り込んだ代入値が表示されます。

#. | **緊急停止/予約取り消し**
   | :guilabel:`緊急停止` ボタンで構築作業を停止させることができます。
   | また、実行前の「予約実行」の作業の場合は、 :guilabel:`予約取消` ボタンが表示されます。 :guilabel:`予約取消` ボタンで予約実行が取り消せます。

#. | **実行ログ表示**
   | Ansible Automation Controllerで実行した場合、構築対象機器の機器一覧のユーザー・パスワード・インスタンスグルーブなのどの項目値でグループ化された構築対象機器の単位でPlaybookが実行され、ansibleの実行ログが分割されます。
   | さらに、Movement一覧のオプションパラメータでジョブスライス数を指定することによりグループ化された構築対象機器をさらにジョブスライス数で分割しplaybookが実行され、ansibleの実行ログも分割されます。
   | 実行ログが分割された場合、表示ログファイルのプルダウンが表示され、表示したいログファイルを選択する事ができます。

   | 表示ログファイルのプルダウンに表示されるログファイル名は以下の2種類があります。
   | exec.log:　全ての実行ログをまとめたログファイルです。
   | exec.log以外: 分割された実行ログファイルです。ファイル命名規則は以下になります。
   | Ita_<mode名>_executions_jobtpl_<作業番号>_<グループ番号>_<通番>


   .. table:: 分割された実行ログファイルの命名要素
      :align: left
   
      +-------------+--------------------------------------------------------+
      | 要素        | 内容                                                   |
      +=============+========================================================+
      | mode名      | 実行したモード名 legacy_role                           |
      +-------------+--------------------------------------------------------+
      | 作業番号    | 作業管理メニューの作業実行No                           |
      +-------------+--------------------------------------------------------+
      | グ\         | 構築対\                                                |
      | ループ番号  | 象機器の機器一覧のユーザー・パスワード・インスタンスグ\|
      |             | ルーブなのどの項目値でグルーブ化した1からの通番です。  |
      +-------------+--------------------------------------------------------+
      | 通番        | ジョブスライ\                                          |
      |             | ス数の設定によりグループ内を分割した1からの通番です。  |
      |             |                                                        |
      |             | 0の場合は\                                             |
      |             | ジョブスライス数による分割がなかったことのを表します。 |
      +-------------+--------------------------------------------------------+

#. | **ログ検索**
   | 実行ログ、エラーログは、フィルタリングができます。各ログのフィルタのテキストボックスに検索したい文字列を入力し、「該当行のみ表示」のチェックボックスをチェックすることで該当する行だけが表示されます。
   | 実行ログ、エラーログのリフレッシュ表示間隔と最大表示行数を、「 :ref:`general_operations_interface_information` 」の「状態監視周期（単位ミリ秒）」と「進行状態表示行数」で設定できます。

#. | **投入データ**
   | 実行したPlaybookなどをダウンロードすることができます。
   | 投入データの構成は「 :ref:`general_operations_the_linkage_between_the_input_data_used_during_ansible_execution_and_ita_menu` 」を参照してください。

#. | **結果データ**
   | 実行ログ、エラーログなどをダウンロードすることができます。

.. _general_operations_execution_list:

作業管理
~~~~~~~~

| 作業の履歴を閲覧できます。
| 条件を指定し :guilabel:`フィルタ` ボタンをクリックすると、作業一覧テーブルを表示します。
| :guilabel:`詳細` ボタンで :ref:`general_operations_check_operation_status` に遷移し、実行状態の詳細を見ることができます。

.. figure:: /images/ja/ansible-legacyrole/work_management/execution_list.png
   :width: 800px
   :alt: サブメニュー画面（作業管理）


   サブメニュー画面（作業管理）



.. _general_operations_target_host:

作業対象ホスト
~~~~~~~~~~~~~~

#. | :menuselection:`Ansible-LegacyRole-->作業対象ホスト` では、オペレーションに紐付くMovementおよびホストを閲覧できます。

   .. figure:: /images/ja/ansible-legacyrole/work_taget_host/target_host.png
      :width: 800px
      :alt: サブメニュー画面（作業対象ホスト）

      サブメニュー画面（作業対象ホスト）

   .. #. | 「登録」-「登録開始」ボタンより、作業対象ホスト登録を行います。

   ..    .. figure:: ./general_operations/image_2a_9.png
   ..       :width: 5.39203in
   ..       :height: 1.33953in
   ..       :alt: 登録画面（作業対象ホスト）

   ..       登録画面（作業対象ホスト）

   .. #. | 一覧/更新のMovementのリンクをクリックすると、対象の :ref:`general_operations_movement_details` へ遷移します。
   ..    | また、代入値管理ボタンをクリックすると、対象の :ref:`general_operations_substitution_value_list` へ遷移します。

   ..    .. figure:: ./general_operations/image58.png
   ..       :width: 6.20485in
   ..       :height: 1.25094in
   ..       :alt: サブメニュー画面（作業対象ホスト）

   ..       サブメニュー画面（作業対象ホスト）

#. | 閲覧画面の項目一覧は以下のとおりです。
   

   .. list-table:: 閲覧画面項目一覧（作業対象ホスト）
      :widths: 45 120 
      :header-rows: 1
      :align: left
   
      * - **項目**
        - **説明**
      * - 作業No
        - 作業実行時に自動採番した36桁の文字列が表示されます。
      * - オペレーション
        - オペレーション一覧に登録されているオペレーションが表示されます。
      * - Movement名
        - Movement一覧に登録されているMovementが表示されます。
      * - ホスト名
        - 機器一覧に登録されているホスト名が表示されます。 
      * - 備考  
        - 自由記述欄です。 


   .. +-----------+---------------------------------+-------+-------+-------------+
   .. | **項目**  | **説明**                        | **入\ | **入\ | **制約\     |
   .. |           |                                 | 力**  | 力形\ | 事項**      |
   .. |           |                                 |       | 式**  |             |
   .. |           |                                 | **必\ |       |             |
   .. |           |                                 | 須**  |       |             |
   .. |           |                                 |       |       |             |
   .. |           |                                 |       |       |             |
   .. +===========+=================================+=======+=======+=============+
   .. | オペレ\   | オ\                             | ○     | リ\   | ー          |
   .. | ーション  | ペレーション一覧に登録されてい\ |       | スト\ |             |
   .. |           | るオペレーションが表示されます\ |       | 選択  |             |
   .. |           | 。オペレーションを選択します。  |       |       |             |
   .. +-----------+---------------------------------+-------+-------+-------------+
   .. | Movement  | Movemen\                        | ○     | リ\   | ー          |
   .. |           | t一覧に登録されているMovementが\|       | スト\ |             |
   .. |           | 表示されます。オペレーションに\ |       | 選択  |             |
   .. |           | 紐付けるMovementを選択します。  |       |       |             |
   .. +-----------+---------------------------------+-------+-------+-------------+
   .. | ホスト    | 機器一覧に登録され\             | ○     | リ\   | ー          |
   .. |           | ているホスト名が表示されます。  |       | スト\ |             |
   .. |           |                                 |       | 選択  |             |
   .. |           | オペレーション\                 |       |       |             |
   .. |           | に紐付けるホストを選択します。  |       |       |             |
   .. +-----------+---------------------------------+-------+-------+-------------+
   .. | 備考      | 自由記述欄です。                | ー    | 手動\ | 最大長\     |
   .. |           |                                 |       | 入力  | 4000バイト  |
   .. +-----------+---------------------------------+-------+-------+-------------+


.. _general_operations_substitution_value_list:

代入値管理
~~~~~~~~~~~~~~

#. | オペレーションに紐付くMovementで利用されるRole内の変数に代入する具体値を閲覧できます。


   .. figure:: /images/ja/ansible-legacyrole/assigned_value_management/substitution_value_list.png
      :width: 800px
      :alt: サブメニュー画面（代入値管理）

      サブメニュー画面（代入値管理）


#. | 閲覧画面の項目一覧は以下のとおりです。

   .. table:: 閲覧画面項目一覧（代入値管理）
      :align: left

      +------------+-----------+------------------+-------------------------------------------------------------------------------------------------------------+
      | **項目**                                  | **説明**                                                                                                    | 
      +============+===========+==================+=============================================================================================================+
      | 作業No                                    | 作業実行時に自動採番した36桁の文字列が表示されます。                                                        |
      +------------+-----------+------------------+-------------------------------------------------------------------------------------------------------------+
      | オペレーション                            | 作業対象ホストに登録されているオペレーションが表示されます。                                                |
      +------------+-----------+------------------+-------------------------------------------------------------------------------------------------------------+
      | Movement名                                | 作業対象ホストに登録されているデータの中から、選択されたオペレーションに紐づくMovementが表示されます。      |
      +------------+-----------+------------------+-------------------------------------------------------------------------------------------------------------+
      | ホスト名                                  | 作業対象ホストに登録されているデータで選択されたオペレーションとMovementに紐づくホストが表示されます。      |
      +------------+-----------+------------------+-------------------------------------------------------------------------------------------------------------+
      | Movement名:変数名                         | Movement-ロール紐付に登録されている資材の中から、選択されたMovementにアタッチしている変数名が表示されます。 |
      +------------+-----------+------------------+-------------------------------------------------------------------------------------------------------------+
      | Movement名:変数名:メンバー変数            | 変数名で多段変数を選択した場合に多段変数のメンバー変数が表示されます。                                      | 
      +------------+-----------+------------------+-------------------------------------------------------------------------------------------------------------+
      | 具体値     | 文字列    | Sensitive設定    | 「OFF」または「ON」が表示されます。                                                                         |
      |            |           |                  |                                                                                                             |
      |            |           |                  | Ansibleに渡すホスト変数ファイルには、ansible-vaultで暗号化された内容が設定されます。                        |
      |            |           +------------------+-------------------------------------------------------------------------------------------------------------+
      |            |           | 値               | オペレーション/Movement/ホストで使用する変数の具体値が表示されます。                                        |
      |            |           |                  |                                                                                                             |
      |            |           |                  | 代入値自動登録設定でファイル埋込変数とテンプレート埋込変数をPlaybookの変数に紐付した場合、\                 |
      |            |           |                  | 具体値には '{{ CPF_xxxx }}' '{{ TPF_xxxx }}'が表示されます。                                                |
      |            +-----------+------------------+-------------------------------------------------------------------------------------------------------------+
      |            | ファイル                     | オペレーション/Movement/ホストで使用する変数にファイルを埋込む場合に、埋込むファイルがアップロードされます。|
      +------------+-----------+------------------+-------------------------------------------------------------------------------------------------------------+
      | 代入順序                                  | 複数具体値が設定できる変数の場合のみ表示されます。                                                          |
      +------------+-----------+------------------+-------------------------------------------------------------------------------------------------------------+
      | 備考                                      | 自由記述欄です。                                                                                            |
      +------------+-----------+------------------+-------------------------------------------------------------------------------------------------------------+

   .. +-------+-------+-------+---------------------------------+-------+-------+-------------+
   .. | **項目**              | **説明**                        | **入\ | **入\ | **制約\     |
   .. |                       |                                 | 力**  | 力形\ | 事項**      |
   .. |                       |                                 |       | 式**  |             |
   .. |                       |                                 | **必\ |       |             |
   .. |                       |                                 | 須**  |       |             |
   .. |                       |                                 |       |       |             |
   .. +=======+=======+=======+=================================+=======+=======+=============+
   .. | オペレーション        | 作業対象ホストに登録されてい\   | ○     | リ\   | ー          |
   .. |                       | るオペレーションが表示されます\ |       | スト\ |             |
   .. |                       | 。オペレーションを選択します。  |       | 選択  |             |
   .. |                       |                                 |       |       |             |
   .. +-------+-------+-------+---------------------------------+-------+-------+-------------+
   .. | M\                    | 作業対象ホストに登録\           | ○     | リ\   | ー          |
   .. | o\                    | されているデータの中から、選択\ |       | スト\ |             |
   .. | v\                    | されたオペレーションに\         |       | 選択  |             |
   .. | e\                    | 紐づくMovementが表示されます。  |       |       |             |
   .. | m\                    |                                 |       |       |             |
   .. | e\                    |                                 |       |       |             |
   .. | n\                    | Movementを選択します。          |       |       |             |
   .. | t                     |                                 |       |       |             |
   .. +-------+-------+-------+---------------------------------+-------+-------+-------------+
   .. | ホ\                   | 作業対象ホ\                     | ○     | リ\   | ー          |
   .. | ス\                   | ストに登録されているデータで選\ |       | スト\ |             |
   .. | ト                    | 択されたオペレーションとMovemen\|       | 選択  |             |
   .. |                       | tに紐づくホストが表示されます。 |       |       |             |
   .. |                       |                                 |       |       |             |
   .. |                       | ホストを選択します。            |       |       |             |
   .. +-------+-------+-------+---------------------------------+-------+-------+-------------+
   .. | 変\                   | Movemen\                        | ○     | リ\   | ー          |
   .. | 数\                   | t-Playbook紐付（Movement-対話種\|       | スト\ |             |
   .. | 名                    | 別紐付、Movement-ロール紐付）に\|       | 選択  |             |
   .. |                       | て登録されている資材の中から、\ |       |       |             |
   .. |                       | 選択されたMov\                  |       |       |             |
   .. |                       | ementにアタッチしている変数名が\|       |       |             |
   .. |                       | 表\                             |       |       |             |
   .. |                       | 示されます。変数を選択します。  |       |       |             |
   .. +-------+-------+-------+---------------------------------+-------+-------+-------------+
   .. | メ\                   | 変数名で多段\                   | ○     | リ\   | ー          |
   .. | ン\                   | 変数を選択した場合に多段変数の\ |       | スト\ |             |
   .. | バ\                   | メンバー変数が表示されます。    | ま    | 選択  |             |
   .. | ー\                   |                                 | た    |       |             |
   .. | 変\                   |                                 | は    |       |             |
   .. | 数\                   | メンバー変数を選択します。      |       |       |             |
   .. | 名                    |                                 | /     |       |             |
   .. +-------+-------+-------+---------------------------------+-------+-------+-------------+
   .. | 具\   | 文\   | Se\   | 「\                             | ー    | ボ\   |             |
   .. | 体\   | 字\   | nsi\  | OFF」または「ON」を選択します。 |       | タン\ |             |
   .. | 値    | 列    | tiv\  |                                 |       | 選択  |             |
   .. |       |       | e設\  | 「ON」を選\                     |       |       |             |
   .. |       |       | 定    | 択した場合、具体値を暗号化しIT\ |       |       |             |
   .. |       |       |       | A上で表示させないようにします。 |       |       |             |
   .. |       |       |       |                                 |       |       |             |
   .. |       |       |       | ・Legacy/Legacy-Roleの場合      |       |       |             |
   .. |       |       |       |                                 |       |       |             |
   .. |       |       |       | ansibleに渡すホスト変数\        |       |       |             |
   .. |       |       |       | ファイルには、ansible-vaultで暗\|       |       |             |
   .. |       |       |       | 号化された内容が設定されます。  |       |       |             |
   .. |       |       |       |                                 |       |       |             |
   .. |       |       |       | ・Pioneerの場合                 |       |       |             |
   .. |       |       |       |                                 |       |       |             |
   .. |       |       |       | ansibleに渡すホ\                |       |       |             |
   .. |       |       |       | スト変数ファイルには、ITA独自で\|       |       |             |
   .. |       |       |       | 暗号化した内容が設定されます。  |       |       |             |
   .. |       |       +-------+---------------------------------+-------+-------+-------------+
   .. |       |       | 値\   | オペレーション\                 | ー    | 手動\ | 最大長8\    |
   .. |       |       | ※１   | /Movement/ホストで使用する変数\ |       | 入力  | 192バイト   |
   .. |       |       |       | の具体値を入力します。複数行の\ |       |       |             |
   .. |       |       |       | 具体値も入力できますが、Pionee\ |       |       |             |
   .. |       |       |       | rで複数行の具体値を設定すると、\|       |       |             |
   .. |       |       |       | 作業実行時にエラーとなります。  |       |       |             |
   .. |       |       |       |                                 |       |       |             |
   .. |       |       |       | 具体値にファイル埋込変数\       |       |       |             |
   .. |       |       |       | 「\CPF_\」とテンプレート埋込\   |       |       |             |
   .. |       |       |       | 変数「\TPF_\」が入力出来ます。\ |       |       |             |
   .. |       |       |       | 変数を記述する場合、Playbook\   |       |       |             |
   .. |       |       |       | に変数を記述する場合と同様、\   |       |       |             |
   .. |       |       |       | 変数名を{{}}で囲みます。        |       |       |             |
   .. |       |       |       |                                 |       |       |             |
   .. |       |       |       | Exp)                            |       |       |             |
   .. |       |       |       |                                 |       |       |             |
   .. |       |       |       | 具\                             |       |       |             |
   .. |       |       |       | 体値にTPF_sampleを入力する場合  |       |       |             |
   .. |       |       |       |                                 |       |       |             |
   .. |       |       |       | '{{△TPF_sample△}}'              |       |       |             |
   .. |       |       |       |                                 |       |       |             |
   .. |       |       |       | △:半角スペース                  |       |       |             |
   .. |       |       |       |                                 |       |       |             |
   .. |       |       |       | ':シングル・ダブ\               |       |       |             |
   .. |       |       |       | ルコーテーションで囲む「必須」  |       |       |             |
   .. |       |       |       |                                 |       |       |             |
   .. |       |       |       | 尚、\                           |       |       |             |
   .. |       |       |       | 具体値\                         |       |       |             |
   .. |       |       |       | に値とファイルの両方を設定する\ |       |       |             |
   .. |       |       |       | ことは出来ません。Sensitive設定\|       |       |             |
   .. |       |       |       | ONで設定さ\                     |       |       |             |
   .. |       |       |       | れている値をクリアしたい場合、\ |       |       |             |
   .. |       |       |       | Sensitive\                      |       |       |             |
   .. |       |       |       | 設定をOFFにして更新してください。 |       |       |             |
   .. |       +-------+-------+---------------------------------+-------+-------+-------------+
   .. |       | フ\           | オペレーション/\                | ー    | 手動\ | 最\         |
   .. |       | ァ\           | Movement/ホストで使用する変数に\|       | 入力  | 大サイズ\   |
   .. |       | イ\           | ファイルを埋込む場合に、埋込む\ |       |       | 4Gバイト    |
   .. |       | ル            | ファイルをアップロードします。  |       |       |             |
   .. +-------+-------+-------+---------------------------------+-------+-------+-------------+
   .. | 代\                   | 複数具体値が設定できる変数\     | ○     | 手動\ | ブランク\   |
   .. | 入\                   | の場合のみ必須入力になります。  |       | 入力  |             |
   .. | 順\                   |                                 | ま    |       | または、\   |
   .. | 序                    | 具体値の代入順序（1～）を入力し\| た    |       |             |
   .. |                       | ます。入力値に従い昇順で代入さ\ | は    |       | 正の整数    |
   .. |                       | れます。具体値が複数ない場合で\ |       |       |             |
   .. |                       | も代入順序（1～）を入力します。 | /     |       |             |
   .. +-------+-------+-------+---------------------------------+-------+-------+-------------+
   .. | デ\                   | 変数名およ\                     | ー    | 表示\ | ー          |
   .. | フ\                   | びメンバー変数名で選択されてい\ |       | のみ  |             |
   .. | ォ\                   | る変数のデフォルト変数定義ファ\ |       |       |             |
   .. | ル\                   | イル(defaults->main.yml)に設定\ |       |       |             |
   .. | ト\                   | されている具体値を表示します。  |       |       |             |
   .. | 値                    |                                 |       |       |             |
   .. |                       | 詳しくは「 :ref:`general\       |       |       |             |
   .. |                       | _operations_write_ita_readme\   |       |       |             |
   .. |                       | _ansible_legacy_role_only` \    |       |       |             |
   .. |                       | 」を参照してください。          |       |       |             |
   .. |                       |                                 |       |       |             |
   .. |                       | 具体値が8進数文字列\            |       |       |             |
   .. |                       | (0755)や16進数文字列(0x1ED)の場\|       |       |             |
   .. |                       | 合、10進数(493)で表示されます。 |       |       |             |
   .. |                       |                                 |       |       |             |
   .. |                       | 具体値が「true」「Yes」「Y」「\ |       |       |             |
   .. |                       | y」の場合は空白が表示されます。 |       |       |             |
   .. |                       |                                 |       |       |             |
   .. |                       | 具体値が「false」「No」「N」「n\|       |       |             |
   .. |                       | 」の場合はFalseが表示されます。 |       |       |             |
   .. +-------+-------+-------+---------------------------------+-------+-------+-------------+
   .. | 備\                   | 自由記述欄です。                | ー    | 手動\ | 最大長4\    |
   .. | 考                    |                                 |       | 入力  | 000バイト   |
   .. +-------+-------+-------+---------------------------------+-------+-------+-------------+

   .. | ※１具体値にファイル埋込変数「\CPF_\」・テンプレート埋込変数「\TPF_\」を設定する場合、Sensitive設定は「OFF」に設定してください。Sensitive設定が「ON」の場合、各変数として扱われません。

.. | 【メンバー変数名の表示内容】
.. | 多段変数の場合にのみメンバー変数の選択が必要になります。メンバー変数に表示される変数は具体値を必要とする変数のみです。
.. | メンバー変数名の表示は各階層の変数を「.」でスコープします。繰返配列の場合は「[ ]」で繰返位置(0～)をスコープします。繰返し配列の数は「 :ref:`general_operations_nested_variable_list_ansible_legacy_role_only` 」で設定を行います。

.. | e.g.)     
.. | **変数定義**                                                                
                                                                              
.. .. code-block:: yaml                                                         

..    VAR_users:                                            
..      - name: alice                                                 
..        authorized:                                           
..          - /tmp/alice/onekey.pub                                             
..        mysql:                                                                
..            password: mysql-password                     
..            hosts:                                           
..              - "127.0.0.1"                                                   
..              - "localhost"                                                   
..      - name: bob                                                   
..        authorized:                                          
..          - /tmp/alice/onekey.pub                                             
..        mysql:                                                                
..            password: mysql-password                      
..            hosts:                                          
..              - "127.0.0.1"                                                   
..              - "localhost"                 

.. .. table:: 
..    :align: left

..    +------------------------+
..    | **メンバー変数の表示** |
..    |                        |         
..    +========================+
..    | [0].name               |       
..    +------------------------+
..    | [0].authorized         |
..    +------------------------+
..    | [0].mysql.password     |
..    +------------------------+
..    | [0].mysql.hosts        |
..    +------------------------+
..    | [1].name               |
..    +------------------------+
..    | [1].authorized         |
..    +------------------------+
..    | [1].mysql.password     |
..    +------------------------+
..    | [1].mysql.hosts        |     
..    +------------------------+                                  
                                                                              
.. | ※mysqlは階層を示す変数なのでメンバー変数には表示されません。 

.. | 代入値自動登録設定で登録した情報は、内部の処理で代入値管理と作業対象ホストへ反映されます。
.. | ※反映のタイミングは「 :ref:`general_operations_about_the_maintenance_method` 」に記載していますので、そちらをご参照ください。

.. #. | **代入順序の入力**
..    | Ansible-Legacyでは、代入順序が未入力の場合は、通常変数として扱います。
..    | 代入順序が入力されている場合は、複数具体値変数として扱います。複数具体値変数の場合は複数の具体値が必要ない場合(具体値が1個でよい)でも代入順序は入力してください。
..    | Ansible-Legacy Roleでは、変数名またはメンバー変数名を選択することで、複数具体値変数の場合のみ代入順序が入力可能となります。複数具体値変数の場合に入力してください。
..    | Ansible-Pioneerでは、代入順序が未入力の場合は、通常変数として扱います。
..    | 代入順序が入力されている場合は、複数具体値変数として扱います。複数具体値変数の場合は、複数の具体値が必要ない場合(具体値が1個でよい)でも代入順序を入力してください。
..    | 各モードとも、特定の複数具体値変数に対して代入順序が連続していなくても問題ありません。
..    | e.g.)

..    .. table:: 代入値管理の登録
..       :align: left

..       +--------+--------+------+------+
..       | ホスト | 変数   | 具\  | 代入 |
..       |        |        | 体値 |      |
..       |        |        |      | 順序 |
..       +========+========+======+======+
..       | HOST_A | V\     | va\  |      |
..       |        | AR_std | lue1 |      |
..       +--------+--------+------+------+
..       | HOST_A | \VAR_\ | va\  | 10   |
..       |        | list_a | lue2 |      |
..       +--------+--------+------+------+
..       | HOST_A | \VAR_\ | va\  | 100  |
..       |        | list_b | lue3 |      |
..       +--------+--------+------+------+
..       | HOST_A | \VAR_\ | va\  | 200  |
..       |        | list_b | lue4 |      |
..       +--------+--------+------+------+
   
..    | **HOST_Aのホスト変数ファイルへの出力内容**

..    .. code-block:: yaml

..       VAR_std: value1
..       VAR_list_a:
..         - value2
..       VAR_list_b:
..         - value3
..         - value4

.. #. | **ホスト変数ファイルへの出力**
..    | 代入値管理で登録した変数の具体値はホスト変数ファイルへ出力されます。
..    | Ansible-Legacyと Ansible-Pioneerでは、作業実行時にPlaybookまたは対話ファイルで使用している変数の具体値が代入値管理に登録されていないと作業実行が想定外エラーとなります。
..    | Ansible-Legacy Roleでは、代入値管理で具体値を登録した変数のみが作業実行時にホスト変数ファイルへ出力されます。多段変数も同様で具体値を登録しているメンバー変数のみとなります。
..    | e.g.)

..    | **変数定義**                                                                
                                                                              
..    .. code-block:: yaml                                                         
   
..       VAR_users:                                            
..         - name: alice                                                 
..           authorized:                                           
..             - /tmp/alice/onekey.pub                                             
..           mysql:                                                                
..               password: mysql-password                     
..               hosts:                                           
..                 - "127.0.0.1"                                                   
..                 - "localhost"                                                   
..         - name: bob                                                   
..           # 略
   
..    .. table:: 代入値管理の登録
..       :align: left
      
..       +-------+--------+----------+-------+--------+
..       | ホ\   | 変数   | メン\    | 具\   | 代\    |
..       | スト  |        | バー変数 | 体値  | 入順序 |
..       +=======+========+==========+=======+========+
..       | H\    | \VAR\  | [0].name | v\    |        |
..       | OST_A | _users |          | alue1 |        |
..       +-------+--------+----------+-------+--------+
..       | H\    | VAR\   | [1].au\  | v\    |        |
..       | OST_A | _users | thorized | alue2 |        |
..       +-------+--------+----------+-------+--------+
   
..    | **HOST_Aのホスト変数ファイルへの出力内容**

..    .. code-block:: yaml

..       VAR_users:
..         - name: value1
..         - .authorized: value2
   
.. #. | **デフォルト値チェックオプション**
..    | 複数ロール間でデフォルト値が一致していない変数に対して具体値の登録した場合に、警告メッセージを表示して登録させないパラメータを「ITA管理コンソール システム設定」で設定することが出来ます。このパラメータはデフォルトでは未登録です。必要に応じて登録してください。
..    | システム設定に登録する内容は以下の通りです。尚、システム設定については :doc:`../it_automation_base/management_console` を参照してください。

..    .. table:: システム設定登録内容
..       :align: left

..       +------------+-------------------------------------------------+-------+
..       | **項目**   | **入力値**                                      | **入\ |
..       |            |                                                 | 力**  |
..       |            |                                                 |       |
..       |            |                                                 | **必\ |
..       |            |                                                 | 須**  |
..       +============+=================================================+=======+
..       | 識別ID     | ANSIBLE_DEF_VAL_CHK                             | ○     |
..       +------------+-------------------------------------------------+-------+
..       | 項目名     | 任意の文字列                                    | ー    |
..       +------------+-------------------------------------------------+-------+
..       | 設定値     | 1： パラメータ有効                              | ○     |
..       |            |                                                 |       |
..       |            | 1以外またはレコード未登録 ： パラメータ無効     |       |
..       +------------+-------------------------------------------------+-------+
..       | 備考       | 任意の文字列                                    |       |
..       +------------+-------------------------------------------------+-------+


構築コード記述方法
==================
..
   .. _general_operations_write_playbook_ansible_legacy:
   Playbook（Ansible-Legacy）の記述
   --------------------------------
   | 「 :ref:`general_operations_playbook_file_list_ansible_legacy_only` 」でアップロードされたPlaybookは、ITAで生成するマスターPlaybookよりinclude形式で実行されます。
   | ITAで作成するマスターPlaybookはへッダーセクションとtasksセクションで構成されます。


   ヘッダーセクション
   ~~~~~~~~~~~~~~~~~~~~~

   | アップロードアップロードするPlaybookにはヘッダーセクションは含む必要はありません。
   | ヘッダーセクションは、デフォルト値が決まっていますが、「 :ref:`general_operations_movement_list` 」のヘッダーセクションで変更することが出来ます。
   |
   | ▼ヘッダーセクションのデフォルト値について 
   - | Ansible Coreの場合 

   .. code-block:: yaml

      # ヘッダーセクションのデフォルト値　
        - hosts: all
          remote_user: "{{ __loginuser__ }}"
          gather_facts: no
          become: no

   - | Ansible Automation Controllerの場合 

   .. code-block:: yaml  

      # ヘッダーセクションのデフォルト値　
        - hosts: all                                                
          gather_facts: no                                         
          become: yes                                              

   tasksセクション
   ~~~~~~~~~~~~~~~~ 
   | アップロードされたPlaybookは、ITAで生成するマスタPlaybookよりinclude形式で実行されます。
   | Playbook基本書式についてはAnsibleの公式マニュアルを参照してください。
   |
   | 例)

   .. code-block:: yaml
      
      - name: コメント                                                     
        template:                                                          
          src:   "{{ item.src }}"                                         
          dest:  "{{ item.dest }}"                                          
          owner: "{{ item.owner is none |ternary('root', item.owner) }}"    
          group: "{{ item.group is none |ternary('bacula', item.group) }}"   
          mode:  "{{ item.mode is none |ternary('0654', item.mode) }}"
      
   .. warning:: | Playbook内のインデントは2倍数で調整してください。
    | 文字コードは、UTF-8のBOMなしで作成してください。

   | アップロードさたPlaybookは、「 :ref:`general_operations_movement_details` 」のインクルード順序に従いincludeします。
      
   .. figure:: ./general_operations/image_2b_1.png
      :align: center
      :width: 6.85417in
      :height: 4.67187in


   .. _general_operations_write_dialog_file_ansible_pioneer:
   対話ファイル（Ansible-Pioneer）の記述
   ---------------------------------------
   | Ansible-Pioneerでは、ITA独自モジュールをAnsibleに組込んでいます。
   | 対話ファイルはITA独自書式となります。

   .. warning:: | 文字コードは、UTF-8のBOMなしで作成してください。
      | 対話ファイルはYAML形式のファイルとして扱います。YAML形式に準じていない記述があると、対話ファイルのアップロード時や作業実行時にエラーとなります。詳しくは、本章の「 :ref:`general_operations_things_to_keep_in_mind_when_writing_dialogue_files_in_yaml_format` 」を参照してください。

   対話ファイルの構成
   ~~~~~~~~~~~~~~~~~~
   | 対話ファイルは2種類のセクションにより構成されます。

   .. table:: 
     :align: Left
     
     +------------------+------------------------------------------------------+
     | **セクション名** | **用途**                                             |
     +==================+======================================================+
     | conf             | timeoutパラメータによりタイムアウト値を指定します。  |
     |                  |                                                      |
     |                  | タイムアウト値:1～3600(単位:秒)                      |
     +------------------+------------------------------------------------------+
     | exe_list         | 4種\                                                 |
     |                  | の対話コマンドにより作業対象ホストの構築を行います。 |
     +------------------+------------------------------------------------------+
    
   | 以降に対話コマンドを記述します。
   | 例1-1)
    
   .. code-block:: yaml
                                                                
      # コメント                                                         
      conf:                                                            
        timeout: 10                                                    
      exec_list:   


   .. tip:: | 対話ファイルの先頭にtimeoutパラメータを記述します。   
    | コメントはAnsibleの基本書式と同様の記述が出来ます。

   対話コマンド
   ~~~~~~~~~~~~
   | 対話コマンドは以下の5種類があります。

   .. table::
     :align: Left

     +---------------------+------------------------------------------------------+
     | **モジュール**      | **用途**                                             |
     +=====================+======================================================+
     | exec                | 作業対象ホストにコマンドを投入します。               |
     +---------------------+------------------------------------------------------+
     | expect              | 作業対象ホストが標準出力に出力する内容よ\            |
     |                     | り、期待する文字列(プロンプト)の出力を待ち合せます。 |
     +---------------------+------------------------------------------------------+
     | state               | 作業対象ホストにコ\                                  |
     |                     | マンドを投入し、標準出力にプロンプトを出力するまでの |
     |                     | 標準出力の内容を外部Shellで解析し結果判定をします。  |
     +---------------------+------------------------------------------------------+
     | command             | 作業対象ホストにコマンドを投入する前\                |
     |                     | 後において、繰り返しや条件分岐を行うことができます。 |
     +---------------------+------------------------------------------------------+
     | localaction         | Ansible/Ansible Automation\                          |
     |                     | Controllerサーバ上でコマンドを実行します。           |
     +---------------------+------------------------------------------------------+

   ①expectモジュール
   *******************
   | 作業対象ホストが標準出力に出力する内容より、期待する文字列(プロンプト)の出力を待ち合せます。期待する文字列を正規表記で記述できます。
   | 期待する文字列を受取ると次へ進みます。また、timeoutパラメータで指定された時間内に受取れない場合は対話ファイルを異常終了します。
   | 例2-1)

   .. code-block:: yaml

      # telnet接続でパスワード入力のプロンプトを待ち合せます。
        - expect: 'Password'   
                                                 
      
   .. note:: | 待ち合わせる文字列をコーテーションで囲むことを推奨します。   

   ②execモジュール
   *******************

   | 作業対象ホストにコマンドを投入します。
   | execモジュールとexpectモジュールは対で使用します。
   | 例2-2)

   .. code-block:: yaml

      # telnet接続でパスワード入力のプロンプトを待ち合せてパスワードを投入します。   
        - expect: 'Password'                                                              
          exec: itapassword                                                               
            
         
   .. note:: | 必要に応じコーテーションで囲むことを推奨します。   

   ③stateモジュール
   *******************

   | 作業対象ホストにコマンドを投入し、標準出力にプロンプトを出力するまでの標準出力の内容を外部Shellで解析し結果判定をします。

   .. table:: stateモジュールの書式
      :align: Left

      +----------------------+------------+----------------------------------------------------------------------------------+
      | パラメータ　         | 必須/任意  | 説明　                                                                           |
      +======================+============+==================================================================================+
      | state                | 必須       | 投入するコマンドを指定します。                                                   |
      |                      |            |                                                                                  |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | prompt               | 必須       | 待受けプロンプトを指定します。正規表記で記述できます。                           |
      |                      |            |                                                                                  |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | shell                | 任意       | 作成したshellで結果を確認する場合に、shellファイル名を指定します。               |
      |                      |            |                                                                                  |
      |                      |            | 作成したshellのexitコードが0の場合は正常、他は異常と判定します。                 |  
      |                      |            |                                                                                  |
      |                      |            | デフォルトのshellで結果を確認する場合、本パラメータは不要となります。            |
      |                      |            |                                                                                  |
      |                      |            | デフォルトのshellはparameter(-)で指定された文字列で標準出力の内容をgrepします。  |
      |                      |            |                                                                                  |
      |                      |            | マッチする行が1行でもあれば正常とし、マッチする行がなければ異常と判定します。    |
      |                      |            |                                                                                  |
      |                      |            | また、parameterを指定しなかった場合、異常と判定されます。                        |
      |                      |            |                                                                                  |
      |                      |            | コマンドの結果(標準出力)をstdout_fileで指定したファイルに退避したい目的で使用す\ |
      |                      |            | る場合、ignore_errorsで「yes」を指定してください。                                 |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | parameter            | 任意       | 投入するコマンドの結果(標準出力)を検索する文字列を指定します。                   |
      |                      |            |                                                                                  |
      |                      |            | shellを指定している場合、作成したshellの実行時パラメータとなります。複数ある場合\|
      |                      |            | は検索文字列を列挙します。                                                       |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | stdout_file          | 任意       | 投入するコマンドの結果(標準出力)を退避するファイルです。                         |
      |                      |            |                                                                                  |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | success_exit         | 任意       | 検索結果が正常の場合で対話ファイルを正常終了する場合に「yes」を指定します。      |
      |                      |            |                                                                                  |
      |                      |            | 「no」の場合は正常の場合は次に進みます。                                         |
      |                      |            |                                                                                  |
      |                      |            | デフォルトは「no」。                                                             |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | ignore_errors        | 任意       | 検索結果が異常でも次に進む場合に「yes」を指定します。                            |
      |                      |            |                                                                                  |
      |                      |            | 「no」の場合は、異常の場合に対話ファイルを異常終了とします。                     |
      |                      |            |                                                                                  |
      |                      |            | デフォルトは「no」。                                                             |
      +----------------------+------------+----------------------------------------------------------------------------------+
        
   | 例2-3)

   .. code-block:: yaml

      # hostsファイルをcatし、表示結果をparameter値でgrepしている。139.0.0.1、lalhostを含む行があれば正常と判定し次に進みます。
      # 行がなければ異常と判定し対話ファイルを異常終了します。
      exec_list:
        - state: 'cat /etc/hosts'
          prompt: 'root@{{ __loginhostname__ }}'
          parameter: 
            - '139.0.0.1'
            - 'lalhost'
        - expect: root@{{ __loginhostname__ }}
          exec: exit

   | 例2-4) 

   .. code-block:: yaml

      # hostsファイルをcatし、表示結果をparameter値でgrepしている。
      # 139.0.0.1、lalhostを含む行があれば正常と判定しますがsuccess_exit: yesの設定により対話ファイルを正常終了します。
      # 行がなければ異常と判定し対話ファイルを異常終了します。                                     
      
      exec_list:                                                                                
        - state: 'cat /etc/hosts'                                                                 
          prompt: 'root@{{ __loginhostname__ }}'                                                   
          parameter:                                                                               
            - '139.0.0.1'                                                                            
            - 'lalhost'                                                                              
          success_exit: yes                                                                        
        - expect: root@{{ __loginhostname__ }}                                                   
          exec: exit                                                                               


   | 例2-5) 

   .. code-block:: yaml

      # hostsファイルをcatし、表示結果をparameter値でgrepしている。139.0.0.1、lalhostを含む
      # 139.0.0.1、lalhostを含む行があれば正常と判定し次に進みます。
      # 行がなければ異常と判定しますがignore_errors: yesの設定により次に進みます。                                                      
      
      exec_list:                                                                           
        - state: 'cat /etc/hosts'                                                            
          prompt: 'root@{{ __loginhostname__ }}'                                              
          parameter:                                                                          
            - '139.0.0.1'                                                                       
            - 'lalhost'                                                                         
          ignore_errors: yes                                                                  
        - expect: root@{{ __loginhostname__ }}                                              
          exec: exit                                                                          
     

   | 例2-6) 

   .. code-block:: yaml

      # hostsファイルをcatし、ユーザー作成のshellで表示結果をparameter値でgrepしている。
      # 139.0.0.1、lalhostを含む行があれば正常と判定し次に進みます。 
      # 行がなければ異常と判定し対話ファイルを異常終了します。  

      exec_list:                                          
        - state: 'cat /etc/hosts'
          prompt: 'root@{{ __loginhostname__ }}'
          shell: '/tmp/grep.sh'
          stdout_file: '/tmp/stdout.txt'
          parameter: 
            - '139.0.0.1'
            - 'lalhost'  
        - expect: root@{{ __loginhostname__ }}
          exec: exit

      # ユーザー作成 shell(/tmp/grep.sh)
      #!/bin/bash
      STDOUT=/tmp/STDOUT.tmp
      STDERR=/tmp/STDERR.tmp
      cat /tmp/stdout.txt|grep $1|grep $2 | wc -l >${STDOUT} 2>${STDERR}
      RET=$?
      if [ $RET -ne 0 ]; then
          EXIT_CODE=$RET
      else
          if [ -s ${STDERR} ]; then
              EXIT_CODE=1
          else
              CNT=`cat ${STDOUT}`
              if [ ${CNT} -eq 0 ]; then
                  EXIT_CODE=1
              else
                  EXIT_CODE=0
              fi
          fi
      fi


   | 例2-7)

   .. code-block:: yaml

      # hostsファイルをcatし、表示結果をstdout_file で指定したファイルに保存し次に進みます。
      # デフォルトのshellはparameterの設定がないと異常と判定します。次に進める為にignore_errors: yesを設定します。
      exec_list:
        - state: 'cat /etc/hosts'
          prompt: 'root@{{ __loginhostname__ }}'
          stdout_file: '{{ __symphony_workflowdir__ }}/hosts'
          ignore_errors: yes
        - expect: root@{{ __loginhostname__ }}
          exec: exit

   ④commandモジュール
   ********************
   | 作業対象ホストにコマンドを投入する前後において、繰り返しや条件分岐を行うことができます。
   | commandモジュールの書式

   .. table::
      :align: Left

      +----------------------+------------+----------------------------------------------------------------------------------+
      | パラメータ　         | 必須/任意  | 説明　                                                                           |
      +======================+============+==================================================================================+
      | command              | 必須       | 投入するコマンドを指定します。                                                   |
      |                      |            |                                                                                  |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | prompt               | 必須       | 待受けプロンプトを指定します。正規表記で記述できます。                           |
      |                      |            |                                                                                  |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | timeout              | 任意       | コマンドを送ってからのプロンプト待ちタイマを指定します。                         |
      |                      |            |                                                                                  |
      |                      |            | 省略されている場合は、conf->timeoutを使用します。                                |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | register             | 任意       | コマンドを送信後に標準出力の情報を設定する変数「任意の文字列」を指定します。     |
      |                      |            |                                                                                  |
      |                      |            | with_itemsでループしている場合は、最後のコマンド送信後の標準出力の情報が設定され\|
      |                      |            | ます。                                                                           |
      |                      |            |                                                                                  |
      |                      |            | 設定した変数はcommandモジュールの条件判定(when・exec_when・failed_when)でのみ使\ |
      |                      |            | 用できます。                                                                     |
      |                      |            |                                                                                  |
      |                      |            | 設定した変数は、1つのみ保持できます。次にregisterで別の変数に値を設定した場合、\ |
      |                      |            | 前に設定した変数は削除されます。                                                 |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | with_items           | 任意       | with_itemsにコマンドをループして投入する場合にに複数具体値変数の変数名を設定し\  |
      |                      |            | ます。各変数のスコープはitem.X(Xは0から99)とします。                             |
      |                      |            |                                                                                  |
      |                      |            | prompt、timeoutでwith_itemsを利用する場合の変数名は下記の通りにしてください。    |
      |                      |            |                                                                                  |
      |                      |            | prompt: {{ VAR_prompt_XXX }}                                                     |
      |                      |            |                                                                                  |
      |                      |            | timeout: {{ VAR_timeout_XXX }}                                                   |
      |                      |            |                                                                                  |
      |                      |            | (XXXは任意の半角英数字とアンダースコア)                                          |
      |                      |            |                                                                                  |
      |                      |            | with_itemsに設定する各変数の具体値数が同じでない場合、各変数の具体値数の最大値数\|
      |                      |            | でループします。具体値が不足している変数の具体値は空として扱います。             |
      |                      |            |                                                                                  |
      |                      |            | また、promptやtimeoutでwith_itemsを利用する場合、具体値数に注意が必要です。      |
      |                      |            |                                                                                  |
      |                      |            | prompt→command→prompt→command→prompt・・・(以下ループ)となり、command数+1の\     |
      |                      |            | 具体値を設定する必要があります。(timeoutも同様)                                  |
      |                      |            |                                                                                  |
      |                      |            | prompt、timeout の変数の具体値数が不足していると、作業実行時にエラーになります。 |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | when                 | 任意       | command実行前の条件判定です。                                                    |
      |                      |            |                                                                                  |
      |                      |            | 条件にマッチしてcommand実行します。                                              |
      |                      |            |                                                                                  |
      |                      |            | 条件にマッチしていなければ次のcommand行に移ります。                              |
      |                      |            |                                                                                  |
      |                      |            | 条件式                                                                           |
      |                      |            |                                                                                  |
      |                      |            | 　変数定義判定                                                                   |
      |                      |            |                                                                                  |
      |                      |            | 　VAR_xx is define　　　変数が定義されている　　true                             |
      |                      |            |                                                                                  |
      |                      |            | 　VAR_xx is undefine　　変数が未定義　　　　　　true                             |
      |                      |            |                                                                                  |
      |                      |            | 　Exp）                                                                          |
      |                      |            |                                                                                  |
      |                      |            | 　　- 'VAR_status is define'                                                     |
      |                      |            |                                                                                  |
      |                      |            | 　　- 'VAR_status is undefine'                                                   |
      |                      |            |                                                                                  |
      |                      |            | ※define/undefineはITAの変数(VAR_xx)のみ指定可能                                  |
      |                      |            |                                                                                  |
      |                      |            | 変数具体値判定                                                                   |
      |                      |            |                                                                                  |
      |                      |            | VAR_xx/register変数　比較演算子　文字列                                          |
      |                      |            |                                                                                  |
      |                      |            | VAR_xx/register変数　比較演算子　VAR_xx                                          |
      |                      |            |                                                                                  |
      |                      |            | VAR_xx/register変数　match(正規表記文字列/VAR_xx)                                |
      |                      |            |                                                                                  |
      |                      |            | VAR_xx/register変数　no match(正規表記文字列/VAR_xx)                             |
      |                      |            |                                                                                  |
      |                      |            | ※比較演算子は「==」、「!=」、「>」、「>=」、「<」、「<=」                        |
      |                      |            |                                                                                  |
      |                      |            | ※比較演算子の「>」、「>=」、「<」、「<=」は数値を想定しています。                |
      |                      |            |                                                                                  |
      |                      |            | 　Exp）                                                                          |
      |                      |            |                                                                                  |
      |                      |            | 　　- '{{ VAR_status }} match(active)'                                           |
      |                      |            |                                                                                  |
      |                      |            | 　　- '{{ VAR_status }} == active'                                               |
      |                      |            |                                                                                  |
      |                      |            | 　　- 'register変数match(active)'                                                |
      |                      |            |                                                                                  |
      |                      |            | 　※activeなどの条件判定する文字列をクォーテーションで囲む必要はありません。      |
      |                      |            |                                                                                  |
      |                      |            | and/orによる複合条件                                                             |
      |                      |            |                                                                                  |
      |                      |            | 　or条件を行いたい場合、判定条件の間にORを記述します。                           |
      |                      |            |                                                                                  |
      |                      |            | 　Exp）                                                                          |
      |                      |            |                                                                                  |
      |                      |            | 　　- '{{ VAR_status }} == 1　OR {{ VAR_status }} == 2'                          |
      |                      |            |                                                                                  |
      |                      |            | 　and条件を行いたい場合、複数行に分けて記述するとand条件になります。             |
      |                      |            |                                                                                  |
      |                      |            | 　Exp）                                                                          |
      |                      |            |                                                                                  |
      |                      |            | 　　- '{{ VAR_status }} == 1　OR {{ VAR_status }} == 2'                          |
      |                      |            |                                                                                  |
      |                      |            | 　　- '{{ VAR_sub_status }} == 1'                                                |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | exec_when            | 任意       | ループ毎の条件判定です。(continue条件)                                           |
      |                      |            |                                                                                  |
      |                      |            | with_itemsが記述されている場合に条件判定を行います。                             |
      |                      |            |                                                                                  |
      |                      |            | 条件にマッチしていれば該当ループのcommandを実行します。                          |
      |                      |            |                                                                                  |
      |                      |            | マッチしていなければ次のループへ移ります。                                       |
      |                      |            |                                                                                  |
      |                      |            | 条件式                                                                           |
      |                      |            |                                                                                  |
      |                      |            | 　when:と同様の記述が行えます。                                                  |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | failed_when          | 任意       | command実行後(ループ毎)のstdoutの内容に対する条件判定です。                      |
      |                      |            |                                                                                  |
      |                      |            | with_itemsが記述されている場合に条件判定を行います。                             |
      |                      |            |                                                                                  |
      |                      |            | 条件にマッチしていれば正常とします。                                             |
      |                      |            |                                                                                  |
      |                      |            | マッチしていなければ異常とし、対話ファイルを異常終了させます。                   |
      |                      |            |                                                                                  |
      |                      |            | 条件式                                                                           |
      |                      |            |                                                                                  |
      |                      |            | 　変数具体値判定                                                                 |
      |                      |            |                                                                                  |
      |                      |            | 　stdout 比較演算子 文字列                                                       |
      +----------------------+------------+----------------------------------------------------------------------------------+


   | registerパラメータの有効範囲

   .. code-block:: yaml

      exec_list:
        - expect: 'assword:'
          exec: '{{ __loginpassword__ }}'
        - command: 'systemctl status httpd'
          prompt: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
          register: httpd_status_register
        - command: 'systemctl restart httpd'
          when:
            - httpd_status_register no match(running)
          prompt: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
        - command: 'systemctl status mysql'
          prompt: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
          register: mysql_status_register
        - command: 'systemctl restart mysql'
          when:
            - mysql_status_register no match(running)
          prompt: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
        - expect: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
          exec: exit

   .. tip:: | 6行目のhttpd_status_registerは、11行目のcommandモジュール内のregisterで別の変数(mysql_status_register)に値を設定している為、10行目までが有効範囲となります。


   例)　with_itemsで定義した変数はregister/when以外でitem.Xでスコープすることが出来ます。

   .. code-block:: yaml
         
      with_items:
         - '{{ VAR_item1 }}'   #item.0
         - '{{ VAR_item2 }}'   #item.1
      exec_when:
         - '{{ item.0 }} == active'
         - '{{ item.0 }} == {{ VAR_status }}'
         - 'register変数 match({{ item.0 }})'
      failed_when:
         - 'stdout match({{ item.1 }})'

   | 例）commandモジュールで、下記コマンドを実行したい場合
   |  ・systemctl start httpd
   |  ・systemctl start mysql

   | 対話ファイルの記述とwith_itemsで使用する変数の具体値は以下の様になります。

   | ▼対話ファイルの記述内容

   .. code-block:: yaml

      - command: "systemctl  {{ item.0 }}  {{ item.1 }}"
        prompt: '{{ item.2 }}'
        timeout: '{{ item.3 }}'
        with_items:
           - '{{ VAR_status_list }}'    # item.0
           - '{{ VAR_service_list }}'   # item.1
           - '{{ VAR_prompt_list }}'    # item.2
           - '{{ VAR_timeout_list }}'   # item.3

   | ▼with_itemsで使用する変数の具体値

   | 　VAR_status_list:　　　　　 VAR_service_list:
   | 　- start　　　　　　　　　　- httpd                   
   | 　- start　　　　　　　　　　- mysql
   | 　VAR_prompt_list:　　　　　 VAR_timeout_list:
   | 　 - コマンドプロンプト　　　 - 10
   | 　 - コマンドプロンプト　　　 - 10
   | 　 - コマンドプロンプト　　　 - 10


   | 例3-1)

   .. code-block:: yaml

     conf:
       timeout: 30

     exec_list:
     # プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。
     # パスワードが必要な場合
       - expect: 'password:'
         exec:   '{{ __loginpassword__ }}'

     # VAR_hosts_makeというITA変数がホスト変数ファイルに記載されている場合、
     # hostsファイルをcatします。記載されていない場合は、スキップします。
       - command: cat /etc/hosts
         prompt: root@{{ __loginhostname__ }}
         when: 
           - VAR_hosts_make is define
       - expect: root@{{ __loginhostname__ }}
         exec: exit


   | 例3-2)

   .. code-block:: yaml

      conf:
        timeout: 30

      exec_list:
      # プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。
      # パスワードが必要な場合
        - expect: 'password:'
          exec:   '{{ __loginpassword__ }}'

      # VAR_hosts_makeというITA変数がホスト変数ファイルに記載されている場合、
      # hostsファイルをcatします。記載されていない場合は、スキップします。
      # catにより、標準出力されたhostsファイルの内容をresult_stdoutに退避します。
        - command: cat /etc/hosts
          prompt: root@{{ __loginhostname__ }}
          register: result_stdout
          when: 
            - VAR_hosts_make is define

      # VAR_hosts_makeというITA変数がホスト変数ファイルに記載されている場合、
      # command実行します。記載されていない場合は、スキップします。
      # with_itemsの複数具体値変数に設定されている具体値数分command実行します。
      # ループ毎の条件判定として、hostsファイルに「ipアドレス ホスト名」が該当しない場合
      # command実行します。
      # hostsファイルの最終行にechoによる、「IPアドレス ホスト名」を追記します。

        - command: 'echo {{ item.0 }}  {{ item.1 }} >> /etc/hosts'
          prompt: 'root@{{ __loginhostname__ }}'
          when: 
            - VAR_hosts_make is define
          with_items:
            - '{{ VAR_hosts_ip }}'      # item.0
            - '{{ VAR_hosts_name }}'   # item.1
          exec_when:
            - result_stdout no match({{ item.0 }} *{{ item.1 }})

        - expect: root@{{ __loginhostname__ }}
          exec: exit


   | 例3-3)

   .. code-block:: yaml

      conf:
        timeout: 30

      exec_list:
      # プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。
      # パスワードが必要な場合
        - expect: 'password:'
          exec:   '{{ __loginpassword__ }}'

      # with_itemsの複数具体値変数に設定されている具体値数分command実行します。
      # 自動起動設定を実行します。
        - command: 'systemctl enable {{ item.0 }}'
          prompt: 'root@{{ __loginhostname__ }}'
          with_items:
            - '{{ VAR_service_name_list }}'  # item.0

      # with_itemsの複数具体値変数に設定されている具体値数分command実行します。
      # サービスの起動を実行します。
        - command: 'systemctl start {{ item.0 }}'
          prompt: 'root@{{ __loginhostname__ }}'
          with_items:
            - '{{ VAR_service_name_list }}'  # item.0

      # with_itemsの複数具体値変数に設定されている具体値数分command実行します。
      # サービスのステータスを標準出力します。
      # 標準出力された結果の内容に、item.1の正規表現がある場合、正となります。
      # 例えば、VAR_service_status_listの具体値をrunningと設定し、サービスが起動している場合、
      # 「Active: active (running)」のrunnigが一致するので正となります。(次のループに移ります)
      # そうでない場合は、異常と判断し、対話ファイルは異常終了となります。
        - command: 'systemctl status {{ item.0 }}'
          prompt: 'root@{{ __loginhostname__ }}'
          with_items:
            - '{{ VAR_service_name_list }}'  # item.0
            - '{{ VAR_service_status_list }}'  # item.1
          failed_when:
            - stdout match({{ item.1 }})

        - expect: root@{{ __loginhostname__ }}
          exec: exit


   | 例3-4)

   .. code-block:: yaml

      conf:
        timeout: 30
      exec_list:
      # プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。
      # パスワードが必要な場合
        - expect: 'password:'
          exec:   '{{ __loginpassword__ }}'

      # with_itemsの複数具体値変数に設定されている具体値数分command実行します。
      # commandに「{{ item.0 }}」のみの記述をする場合は、ダブルクォーテーションで囲みます。
      # promptやtimeoutでwith_itemsを利用する場合、具体値数に注意が必要です。
      # prompt→command→prompt→command→prompt ・・・(以下ループ)となり、command数+1
      # 設定する必要があります。(timeoutも同様)
        - command: "{{ item.0 }}"
          prompt: '{{ item.1 }}'
          timeout: '{{ item.2 }}'
          with_items:
            - '{{ VAR_command_list }}'  # item.0
            - '{{ VAR_prompt_list }}'    # item.1
            - '{{ VAR_timeout_list }}'    # item.2
        - expect: root@{{ __loginhostname__ }}
          exec: exit

   | 例3-5)

   .. code-block:: yaml

      conf:
        timeout: 30

      exec_list:
      # プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。
      # パスワードが必要な場合
        - expect: 'password:'
          exec:   '{{ __loginpassword__ }}'

      # with_itemsの複数具体値変数に設定されている具体値数分command実行します。
      # 代入値管理の具体値に{{ item.X }} を設定することができます。その際は対話ファイルに記載する
      # item.Xより具体値に記載するitem.Xの数値が大きくなるようにしてください。
      # 今回の例で実行するcommandは「systemctl status ky_pioneer_execute-workflow.service」
        - command: "{{ item.0 }}"
          prompt: 'root@{{ __loginhostname__ }}'
          with_items:
            - '{{ VAR_command_list }}'      # item.0
            - '{{ VAR_service_name_list }}'  # item.1

        - expect: root@{{ __loginhostname__ }}
          exec: exit
      
   | ※ VAR_command_list      ・・・ systemctl status {{ item.1 }}
   | ※ VAR_service_name_list ・・・ ky_pioneer_execute-workflow.service

   | 例3-6)

   .. code-block:: yaml

      conf:
        timeout: 30

      exec_list:
      # プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。
      # パスワードが必要な場合
        - expect: 'password:'
          exec:   '{{ __loginpassword__ }}'

      # and/orによる複合条件の記述例です。
      # or条件を行いたい場合、if文を横に記述することができます。
      # and条件を行いたい場合、複数行に分けて記述するとand条件になります。
      # 今回、whenを例にしていますが、exec_when、failed_whenも同様です。
        - command: echo aaa
          prompt: 'root@{{ __loginhostname__ }}'
          when:
            - 10 == 9 OR 10 != 9 OR 10 >= 9
            - 10 > 9 OR 10 <= 9 OR 10 < 9

        - expect: root@{{ __loginhostname__ }}
          exec: exit

              
   ⑤localactionモジュール
   ************************
   | Ansible/Ansible Automation Controllerサーバ上でコマンドを実行します。
   | localactionモジュールの書式

   .. table::
      :align: Left

      +----------------------+------------+----------------------------------------------------------------------------------+
      | パラメータ　         | 必須/任意  | 説明　                                                                           |
      +======================+============+==================================================================================+
      | localaction          | 必須       | 実行するコマンドを指定します。                                                   |
      |                      |            |                                                                                  |
      |                      |            | confセクションのtimeoutパラメータでのタイマ監視は適用外です。                    |
      |                      |            |                                                                                  |
      |                      |            | コマンドが完了するまで次のステップに進みません。                                 |
      +----------------------+------------+----------------------------------------------------------------------------------+
      | ignore_errors        | 任意       | コマンドの実行結果が異常でも次に進む場合に「yes」を指定します。                  |
      |                      |            |                                                                                  |
      |                      |            | 「no」の場合は、異常の場合に対話ファイルを異常終了します。                       |
      |                      |            |                                                                                  |
      |                      |            | デフォルトは「no」。                                                             |
      +----------------------+------------+----------------------------------------------------------------------------------+

   | 例4-1)

   .. code-block:: yaml
            
     # Symphony実行時の各Movementで共有するディレクトリ({{ __symphony_workflowdir__ }})にホスト毎のディレクトリを設けて、hostsファイルを退避します。
     
     exec_list:
       - localaction: mkdir -p 755 {{ __symphony_workflowdir__ }}/{{ __loginhostname__ }}
         ignore_errors: yes
       - state: cat /etc/hosts
         prompt: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
         stdout_file: '{{ __symphony_workflowdir__ }}/{{ __loginhostname__ }}/hosts'
         ignore_errors: yes
       - expect: root@{{ __loginhostname__ }}
         exec: exit

   正規表記
   ~~~~~~~~~
   | 下記のコマンド及びパラメータに記述された文字列は正規表記で評価されます。
   -  expectモジュール
   -  stateモジュールのpromptパラメータ
   -  commandモジュールのpromptパラメータ
   | 正規表記で記述した文字列にメタ文字「(){}.など」を含む場合、メタ文字の前にエスケープ文字「\\」を挿入する必要があります。
      
   | 正しい例)

   .. code-block:: yaml

      XAMPP Developer Files ¥[Y¥/n¥] exec_list:  

   | 誤った例)

   .. code-block:: yaml

      XAMPP Developer Files [Y/n] exec_list:

   | stateモジュールとcommandモジュールは、実行したコマンドの結果（標準出力）の取り出しを行っています。取り出す上での留意事項を以下に記述します。

   #. | 実行したコマンドの結果（標準出力）とプロンプトの区切り
      | 実行したコマンドの結果（標準出力）とプロンプトの区切りをpromptパラメータで指定された文字列で行います。実行したコマンドの結果（標準出力）の判定やファイルへの保存を行う場合は、正規表記で .*付の後方一致は記述しないでください。実行したコマンドの結果（標準出力）が取り出せません。
      |
      | .* 付の後方一致の正規表記の例
      | '\ **.\***\ [\\#\\$\\%] $''
      |
   #. | エスケープシーケンスの対応
      | 構築対象機器に依存しますが、構築対象機器から送られてくるプロンプトの直前にOperating
      | System Commandシーケンスが付加されている場合があります。promptパラメータで指定された文字列の直前にあるエスケープシーケンスを排除しています。

   複数具体値変数使用時の注意事項
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   | 対話ファイルで複数具体値変数が使用出来るパラメータは、commandモジュールのwith_itemsパラメータのみです。これ以外で使用した場合、作業実行時にエラーとなります。

   コマンドプロンプト以外のプロンプトを処理する場合の注意事項
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   | コマンドプロンプト以外のプロンプトを処理する場合、execモジュールとexpectモジュールの組合せで対話ファイルを作成してください。commandとstateモジュールでは処理できません。

   | 例) 

   .. code-block:: yaml

      # ssh-keygenを対話ファイルで処理する。

      conf:
        timeout: 10


      exec_list:
      # ssh接続　パスワード認証
        - expect: 'assword:'
          exec: '{{ __loginpassword__ }}'

      # ssh-keygenコマンド実行
        - expect: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
          exec: ssh-keygen
        
      # 以降がコマンドプロンプト以外のプロンプトに対する処理
      # 秘密鍵ファイルのパスを設定 
      # expectは正規表記で評価されるので、エスケープが必要なメタ文字にはエスケープ文字(\)を挿入する必要があります。
        - expect: 'id_rsa\):'
          exec: '{{ VAR_id_rsa_path }}'

      # パスフレーズを設定
        - expect: ' passphrase\):'
          exec: '{{ VAR_passphrase }}'

      # パスフレーズを確認
        - expect: ' passphrase again:'
          exec: '{{ VAR_passphrase }}'

      # 生成された 秘密鍵ファイルを確認
        - expect: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
          exec: 'ls -al {{ VAR_id_rsa_path }}'

      # ssh接続クローズ
        - expect: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
          exec: exit

   | ※ VAR_id_rsa_path　・・・　秘密鍵ファイルのパスを設定します。
   | ※ VAR_passphrase 　・・・　パスフレーズを設定します。
   |
   | ◎リターンしたい場合
   | 変数使用の場合は具体値を空白(未入力)にします。
   | 変数を使用していない場合は空文字列(コーテーションを2個並べます)を記載します。

   .. code-block:: yaml

      exec: ''

   対話ファイル終了時の注意事項
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   | 対話ファイルの最後に、セッションを終了するコマンドを投入するようにしてください。
   | 最終行のモジュールが終了するとセッションをクローズします。最終行にファイルコピーなど処理に時間がかかるコマンドが記載されている場合、コマンド終了前にセッションがクローズされコマンドが異常終了してしまう場合があります。

   | 例)

   .. code-block:: yaml

      conf:
        timeout: 10

      exec_list:
      # ssh接続　パスワード認証
        - expect: 'assword:'
          exec: '{{ __loginpassword__ }}'

      # ファイルコピー
        - expect: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
          exec: 'cp -rfp {{ VAR_src_path }} {{ VAR_dest_path }}'

      # 直前のコマンド終了をコマンドプロンプトで待ち合わせ、exitコマンドを投入する記載を対話ファイルの最後に挿入
        - expect: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
          exec: exit

   .. _general_operations_things_to_keep_in_mind_when_writing_dialogue_files_in_yaml_format:
   対話ファイルをyaml形式で記載する際の注意事項
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   | 対話ファイルはyaml形式のファイルとして扱います。以下のようなYAML形式に準じていない記載があると対話モジュールのアップロード時や作業実行時にエラーとなります。
   - 各モジュールのパラメータに変数を記載している場合でパラメータ全体をクォーテーションで囲んでいない場合。
   - 各パラメータを定数のみで記載している場合で、定数の終端が「\ **:**\ 」の場合など、パラメータ全体をクォーテーションで囲んでいない場合。
   | 各モジュールのパラメータは、パラメータ全体をクォーテーションで囲むことを推奨します。

   | 正しい例）

   .. code-block:: yaml

      - expect: 'assword:'
        exec:  '{{ __loginpassword__ }}'
      - expect: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
        exec: 'ls'
      - command: 'echo {{ item.0 }}'
        prompt: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
        exec_when:
          - '{{ item.1 }} == run'
        with_items:
          - '{{ VAR_echo }}' 
          - '{{ VAR_exec_when }}' 
          - '{{ VAR_failed_when }}' 
        failed_when:
          - stdout == match({{ item.2 }})
      - state: '{{ VAR_command }}'
        prompt: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
        parameter:
          - '{{ VAR_p1 }}' 
          - '{{ VAR_p2 }}' 
        success_exit: 'yes'

   | 誤った例）

   .. code-block:: yaml

      - expect: assword:
        exec:  {{ __loginpassword__ }}
      - expect: {{ __loginuser__ }}@{{ __loginhostname__ }}
        exec: ls
      - command: echo {{ item.0 }}
        prompt: {{ __loginuser__ }}@{{ __loginhostname__ }}
        exec_when:
          - {{ item.1 }} == run
        with_items:
          - {{ VAR_echo }}
          - {{ VAR_exec_when }}
          - {{ VAR_failed_when }}
        failed_when:
          - stdout == match({{ item.2 }})
      - state: {{ VAR_command }}
        prompt: {{ __loginuser__ }}@{{ __loginhostname__ }}
        parameter:
          - {{ VAR_p1 }}
          - {{ VAR_p2 }}
        success_exit: yes

      
   構築対象機器のログインユーザーのLANGについての注意事項
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   | ログインユーザーの「LANG」は、「UTF-8/euc/shift_jis」の3種類についてサポートしています。
   | ログインユーザーの「LANG」の設定は機器一覧より行ってください。
   | 「euc/shift_jis」を設定した場合、構築対象機器との通信制御で使用しているpexpectモジュールのUTF-8へのデコード処理の特性で対話ファイルを正しく処理出来ない場合があります。
   - 一部の全角文字( ①②等)をUTF-8にデコード出来ません。デコード出来ない文字は??で表示されます。
   - 一部の全角文字( － 等)をexpect等のプロンプト待ちで使用した場合、「LANG」がUTF-8では待ち受けが正しく出来ますが、LANGが「euc/shift_jis」では待ち受けがタイムアウトしてしまいます。

   構築対象機器へ投入するコマンドの終端コードについての注意事項
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   構築対象機器へ投入するコマンドの終端コードは「LF」を送信します。構築対象機器のコマンド終端コードが「CRLF」の場合、対話ファイルで構築対象機器に投入するコマンドの末尾に「\r」を追加してください。

   .. code-block:: yaml

      conf:
        timeout: 10
      exec_list:
        - expect: 'password:'
          exec: 'XXXXXXXX\r'
        - command: '{{ VAR_command }}\r'
          prompt: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
        - state: '{{ VAR_state }}\r'
          prompt: '{{ __loginuser__ }}@{{ __loginhostname__ }}'
          parameter:
           - '{{ VAR_parameter1 }}' 
           - '{{ VAR_parameter2 }}'

               
.. _general_operations_write_role_package_ansible_legacy_role:

ロールパッケージ（Ansible-Legacy Role）の記述
---------------------------------------------

| 基本書式については `Ansibleベストプラクティス <https://docs.ansible.com/ansible/2.9_ja/user_guide/playbooks_best_practices.html#directory-layout>`_ の公式マニュアルを参照してください。
| 「 :ref:`general_operations_role_package_list_ansible_legacy_role_only` 」でアップロードするロールパッケージファイルのZipに含めるべきディレクトリと、ITAでの扱いについて記述します。

.. code-block:: none

   (上位ディレクトリ)
   │
   ├─── site.yml                           ・・・・・・・・・・・・・・・・・・・・・・・・ (1)              
   │
   ├─── hosts                              ・・・・・・・・・・・・・・・・・・・・・・・・ (2)
   │
   ├─── group_vars                         ・・・・・・・・・・・・・・・・・・・・・・・・ (3)
   │
   ├─── host_vars                          ・・・・・・・・・・・・・・・・・・・・・・・・ (4)
   │
   ├─── ITA readme                         ・・・・・・・・・・・・・・・・・・・・・・・・ (5)
   │
   └─── roles                              ・・・・・・・・・・・・・・・・・・・・・・・・ (6)
           │ 
           ├─ [role名①]                              ・・・・・・・・・・・・・・・・・・・・・・・・ (7)
           │     │      
           │     ├── readme.md                               ・・・・・・・・・・・・・・・・・・・・・・・・ (8)
           │     │      
           │     ├── tasks                                   ・・・・・・・・・・・・・・・・・・・・・・・・ (9)
           │     │      ├── main.yml
           │     │      └── user_files
           │     │      └── user.yml
           │     │      
           │     ├── handlers                                ・・・・・・・・・・・・・・・・・・・・・・・・ (10)
           │     │      ├── main.yml
           │     │      └── user_files
           │     │      └── user.yml
           │     │      
           │     ├── templates                               ・・・・・・・・・・・・・・・・・・・・・・・・ (11)
           │     │      ├── hosts.j2
           │     │      └── user_files
           │     │      └── user.j2
           │     │      
           │     ├── files                                   ・・・・・・・・・・・・・・・・・・・・・・・・ (12) 
           │     │      └── sudoers
           │     │      
           │     ├── vars                                    ・・・・・・・・・・・・・・・・・・・・・・・・ (13)
           │     │      └─ main.yml
           │     │      
           │     ├── defaults                                ・・・・・・・・・・・・・・・・・・・・・・・・ (14)
           │     │      ├── main.yml
           │     │      └── user_files
           │     │              └── user.yml
           │     │      
           │     ├── meta                                    ・・・・・・・・・・・・・・・・・・・・・・・・ (15)
           │     │      └── main.yml
           │     │ 
           │     上記以外のディレクトリやファイルが存在する場合、 ITAは関知しません。
           │ 
           └─ [role名②] ロールの数に特に制限はありません。

.. list-table:: 
   :widths: 25 15 40
   :header-rows: 1
   :align: left

   * - 
     - | 含めるべきファイル
       | 〇　：必要
       | △　：任意 
     - ITAでの取り扱い
   * - \(1)\　site.yml　\(マスターPlaybook)\
     - △
     - ITAで作成されるため、存在する場合は上書きされます。
   * - \(2)\　hosts
     - △
     - ITAで作成されるため、存在する場合は上書きされます。
   * - \(3)\　group_vars
     - △
     - ITAで作成されるため、存在する場合は上書きされます。
   * - \(4)\　host_vars
     - △
     - ITAで作成されるため、存在する場合は上書きされます。
   * - \(5)\　ITA readme
     - △
     - | ITA readmeはロール毎に定義します。無くてもエラーにはなりません。
       | ITA readmeは、文字コードがUTF-8のBOMなしで作成してください。
       | 詳細については「 :ref:`general_operations_write_ita_readme_ansible_legacy_role_only` 」をご確認ください。
   * - \(6)\　roles
     - 〇
     - rolesディレクトリが存在しない場合はアップロードでエラーになります。
   * - \(7)\　roles/[role 名①]
     - 〇
     - | role名ディレクトリが存在しない場合はアップロードでエラーになります。
       | tasksディレクトリを含むディレクトリをroleとして扱います。
       | ディレクトリ階層が深くても問題ありません。
   * - \(8)\　roles/[role 名①]/readme.md
     - △
     - ITA は関知しません。
   * - \(9)\　roles/[role 名①]/tasks
     - 〇
     - | tasksディレクトリは必須です。
       | playbookファイルは、文字コードがUTF-8のBOMなで作成してください。
       | main.ymlがない場合はアップロードでエラーになります。
       | main.yml以外のファイルも配置できます。
       | サブディレクトリにmain.yml以外のファイルを配置できます。 
   * - \(10)\　roles/[role 名①]/handlers
     - △
     - | handlersディレクトリの有無は関知しません。
       | playbookファイルは、文字コードがUTF-8のBOMなしで作成してください。
       | main.ymlの有無は関知しません。
       | main.yml以外のファイルも配置できます。
       | サブディレクトリにファイルを配置できます。    
   * - \(11)\　roles/[role 名①]/templates
     - △
     - | templatesディレクトリの有無は関知しません。
       | サブディレクトリにファイルを配置できます。 
   * - \(12)\　roles/[role 名①]/files
     - △
     - | filesディレクトリの有無は関知しません。
       | ファイル及びサブディレクトリの有無は関知しません。
       | ファイル内容は関知しません。
   * - \(13)\　roles/[role 名①]/vars
     - △
     - | varsディレクトリの有無は関知しません。
       | playbookファイルは、文字コードがUTF-8のBOMなしで作成してください。
       | ファイル及びサブディレクトリの有無は関知しません。
       | ファイル内容は関知しません。
   * - \(14)\　roles/[role 名①]/defaults
     - △
     - | defaultsディレクトリの有無は関知しません。
       | playbookファイルは、文字コードがUTF-8のBOMなしで作成してください。
       | main.ymlの有無は関知しません。
       | main.yml以外のファイルも配置できます。
       | サブディレクトリにmain.yml以外のファイルを配置できます。    
   * - \(15)\　roles/[role 名①]/meta
     - △
     - | metaディレクトリの有無は関知しません。
       | playbookファイルは、文字コードがUTF-8のBOMなしで作成してください。
       | ファイル及びサブディレクトリの有無は関知しません。
       | ファイル内容は関知しません。

..
   * - \(6)\　読替表
     - △
     - | 読替表はロール毎に定義します。無くてもエラーにはなりません。
       | 詳細については「 :ref:`general_operations_write_translation_table_ansible_legacy_role_only` 」をご確認ください。



マスターPlaybook
~~~~~~~~~~~~~~~~~~
| ITAで作成するマスターPlaybookはへッダーセクションとrolesセクションで構成されます。

① へッダーセクション
*********************
| ヘッダーセクションは、デフォルト値が決まっていますが、「 :ref:`general_operations_movement_list` 」のヘッダーセクションで変更することが出来ます。

| ▼ヘッダーセクションのデフォルト値について 

-  | Ansible Coreの場合 

.. code-block:: yaml

   # ヘッダーセクションのデフォルト値　
     - hosts: all
       remote_user: "{{ __loginuser__ }}"
       gather_facts: no
       become: no

- | Ansible Automation Controllerの場合 

.. code-block:: yaml  

   # ヘッダーセクションのデフォルト値　
     - hosts: all                                                
       gather_facts: no                                         
       become: yes                                              

② rolesセクション
*******************
| アップロードさたロールパッケージ内のロールを、「 :ref:`general_operations_movement_details` 」のインクルード順序に従いroleで実行します。

.. figure:: /images/ja/diagram/role_session.png
   :align: center
   :width: 8.85417in
   :height: 6.67187in

.. #25 
.. 変数名の一意管理
   ~~~~~~~~~~~~~~~~~
   | ITAの代入値管理で登録された変数の情報はホスト変数として扱います。変数名はドライバー毎の全ロールパッケージで一意管理します。ロールを跨って同じ変数名を使用しているが変数構造が違う場合は、アップロード時にエラーとなります。
   | 例えば、通常変数と多段変数や多段変数同士で多段構造が違う場合など。


Ansible Role Directory Structureにおける所定ディクレトリのサブディレクトリについて注意事項
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
| Ansible Role Directory Structureにおける所定ディクレトリの下位に当該の所定ディクレトリ名と同名のサブディレクトリ（例えば、filesディレクトリの下位にそれと同名のfilesディレクトリなど）を作成されていると、作業実行時にエラーになります。

ロールパッケージ内のロール名をディレクトリ階層にした場合の留意点
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
| 下記のようなディレクトリ階層のロールパッケージを例に説明します。

.. code-block:: none

   └── roles
          ├── parent
          │     ├── sample_role1
          │     │ ├── defaults
          │     │ └── tasks
          │     └── sample_role2
          │            ├── defaults
          │            ├── sample_role3
          │            │     ├── defaults
          │            │     └── tasks
          │            ├── sample_role4
          │            │     ├── defaults
          │            │     └── tasks
          │            └── tasks
          ├── sample_role5
          │     └── defaults
          └── sample_role6
                 ├── defaults
                 └── tasks


#. | ロールとして認識するディレクトリは、tasksディレクトリがあるディレクトリになります。
   | この例だと、ロールして扱うディレクトリ階層(ロール名)は以下の3個になります。

   - parent/sample_role1
   - parent/sample_role2
   - sample_role6

#. | tasksディレクトリが複数あるディレクトリ階層の除外
   | parent/sample_role2/sample_role3とparent/sample_role2/sample_role4にもtasksディレクトリがありますが、parent/sample_role2にtasksディレクトリがありロールとして認識していますので、ロールとして扱いません。


.. _general_operations_write_ita_readme_ansible_legacy_role_only:

ITAreadme（Ansible-Legacy Role）の記述
------------------------------------------

| Playbook中に直接変数を定義したくない場合など、defaults変数定義ファイルに変数が定義されていない際に、ITA readmeファイルに変数の定義を設定することで、代入値管理機能で変数の値を指定することができます。

ITA readmeのファイル名の命名規則
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

| 　ita_readme_[ロール名].yml
| 　e.g.)

.. table::
   :align: Left

   +-------------------------------------------+--------------------------------------------------+
   | ロール名                                  | 作成するファイル名                               |
   +===========================================+==================================================+
   | mysql                                     | ita_readme_mysql.yml                             |
   +-------------------------------------------+--------------------------------------------------+
   | mysql/install                             | ita_readme_mysql%install.yml                     |
   +-------------------------------------------+--------------------------------------------------+

.. warning:: | roleのディレクトリ階層が深い場合、ロール名に含まれる / を % に置き換える必要があります。


ITA readmeのフォーマット
~~~~~~~~~~~~~~~~~~~~~~~~~~~

| フォーマットはYAML形式となります。
| 文字コードはUTF-8のBOMなしで作成してください。
|
| ITA readmeファイルと、代入値管理機能の関係を以下の図に示します。

.. figure:: /images/ja/diagram/readme_format.png
   :align: center
   :width: 8.85417in
   :height: 6.67187in

| Playbook中に無い変数をITA readmeファイルで定義した場合、定義した変数を代入値管理機能で値を設定することができます。
| また、Playbook中の変数と異なる型をITA readmファイルで定義した場合、代入値管理機能には、上書きした変数の型で値を登録することができます。
|
| 代入値管理機能で設定した値は、各ホスト用に変数定義ファイル(host_vars)に出力され、Ansibleで元のPlaybookと変数定義用ファイルを入力として各ホストに実行されます。
| ITA readme ファイルは代入値管理機能に変数情報を与えるためだけに使用され、ITA readme に定義した変数および、変数の値はAnsible実行には影響を与えません。

.. note:: | ITA readmeとdefaults変数定義ファイルで変数定義が重なった場合など、以下のルールで処理されます。


  .. table:: 変数採用ルール
     :align: Left

     +----------------+---------------+------------------------------------------+
     | **defaults変数\| **ITA readme**| **変数定義の採用先**                     |
     | 定義ファイル** |               |                                          |
     +================+===============+==========================================+
     | 定義あり       | 定義なし      | デフォルト変数定義ファイル               |
     +----------------+---------------+------------------------------------------+
     | 定義なし       | 定義あり      | ITA readme                               |
     +----------------+---------------+------------------------------------------+
     | 定義あり       | 定義あり      | ITA readme                               |
     +----------------+---------------+------------------------------------------+

  |
  | また、「 :ref:`general_operations_substitution_value_list` 」に表示するデフォルト値は以下のルールで処理されます。
 
  .. table:: デフォルト値表示ルール
     :align: Left

     +----------------+---------------+------------------------------------------+
     | **defaults変数\| **ITA readme**| **変数定義の採用先**                     |
     | 定義ファイル** |               |                                          |
     +================+===============+==========================================+
     | あり           | なし          | デフォルト変数定義ファイルを採用。       |
     +----------------+---------------+------------------------------------------+
     | なし           | あり          | デフォルト値なしの扱いとなる。           |
     +----------------+---------------+------------------------------------------+
     | あり           | あり          | デフォルト変数定義ファイルを採用。       |
     |                |               |                                          |
     |                |               | ただし、変数定義が一致し\                |
     |                |               | ている場合のみ。変数定義が一致していな\  |
     |                |               | い場合はデフォルト値なしの扱いとなる。   |
     +----------------+---------------+------------------------------------------+

  | ITA readmeは、作業実行時はロールパッケージから切り離されます。
  | ITA readmeに記載した変数と具体値は適用されません。

..
 .. _general_operations_write_translation_table_ansible_legacy_role_only:
 読替表（Ansible-Legacy Role）の記述
 ---------------------------------------
 | defaults変数定義ファイルまたはITA readmeに定義されている「VAR_xxx」以外の変数に対して、代入値自動登録設定で具体値を設定できるようにするための設定を行うファイルです。
 | defaults変数定義ファイルまたはITA readmeに定義されている「VAR_xxx」以外の変数「任意変数」に対して代入値自動登録設定で扱う変数「読替変数」の紐付を定義します。
 
 読替表のファイル名は以下の命名規則
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 
 | 　ita_translation-table_[ロール名].txt
 | 　e.g.)
 
 .. table:: **デフォルト値表示ルール**
    :align: Left
    :widths: 25 50 
 
    +-------------------------------+---------------------------------------------+
    |    ロール名                   |       作成するファイル名                    |
    +===============================+=============================================+
    |    mysql                      |       ita_translation-table_mysql.txt       |
    +-------------------------------+---------------------------------------------+
    |   mysql/install               |  ita_translation-table_mysql%install.txt    |
    +-------------------------------+---------------------------------------------+
    
 .. warning:: | roleのディレクトリ階層が深い場合、ロール名に含まれる / を % に置き換える必要があります。
 
 
 読替表のフォーマット
 ~~~~~~~~~~~~~~~~~~~~~
 | テキスト形式で下記フォーマットとなります。
 | 文字コードはUTF-8のBOMなしで作成してください。
 | ロール内で読替変数と任意変数の組合せは一意である必要があります。
 | 読替変数に関する詳細は「  :doc:`../basic_console` 」を参照してください。
 
 
 .. image:: ./general_operations/image65.png
    :width: 6.22054in
    :height: 1.90683in
    :align: center
 
 注意事項
 ~~~~~~~~~~
 | 読替表を作成する際の注意事項を列挙します。
 
 .. table:: 
    :align: Left
 
    +-----------------------+---------------------------+-----------------+
    | **ケース**            | ITA\ **の動作**           | **備考**        |
    +=======================+===========================+=================+
    | 読替表はあるが、defau\| 読替表を読込まない。      |                 |
    | lts変数定義ファイルと\|                           |                 |
    | ITA\                  |                           |                 |
    | rea\                  |                           |                 |
    | dmeがない。(ロール毎) |                           |                 |
    +-----------------------+---------------------------+-----------------+
    | 任意\                 | ロールパッケージアップロ\ |                 |
    | 変数にVAR_で始まる変\ | ード時にエラーなります。  |                 |
    | 数が定義されている。  |                           |                 |
    +-----------------------+---------------------------+-----------------+
    | defau\                | ロールパッケージアップロ\ |                 |
    | lts変数定義ファイルと\| ード時にエラーなります。  |                 |
    | ITA\                  |                           |                 |
    | readmeに\             |                           |                 |
    | 定義されていない任意\ |                           |                 |
    | 変数を使用している。  |                           |                 |
    +-----------------------+---------------------------+-----------------+
    | ロール内で読替変数\   | ロールパッケージアップロ\ | パッケー\       |
    | が重複定義されている  | ード時にエラーなります。  | ジA->ロールA    |
    |                       |                           |                 |
    |                       |                           | LCA_A:\         |
    |                       |                           | user_A/LCA_A:\  |
    |                       |                           | user_B          |
    +-----------------------+---------------------------+-----------------+
    | ロール内で任意変数\   | ロールパッケージアップロ\ | パッケー\       |
    | が重複定義されている  | ード時にエラーなります。  | ジA->ロールB    |
    |                       |                           |                 |
    |                       |                           | LCA_A:\         |
    |                       |                           | user_A/LCA_B:\  |
    |                       |                           | user_A          |
    +-----------------------+---------------------------+-----------------+
    | ロール間で任意変数\   | ロールパッケージアップロ\ | パ\             |
    | の構造に差異がある。  | ード時にエラーなります。  | ッケージA->ロー |
    |                       |                           | ルA/B           |
    |                       |                           |                 |
    |                       |                           | LCA_C:\         |
    |                       |                           | user_C          |
    +-----------------------+---------------------------+-----------------+
    | ロールパッケージ内で\ | ロールパッケージアップロ\ | パッケージA     |
    | 置換変数と任意変数の\ | ード時にエラーなります。  |                 |
    | 組合せが一意でない。  |                           | ロールA  \      |
    |                       |                           | LCA_D: user_D   |
    |                       |                           |                 |
    |                       |                           | ロールB  \      |
    |                       |                           | LCA_D: user_E   |
    +-----------------------+---------------------------+-----------------+
    | ロールパ\             | ロールパッケージア\       | パッケージ\     |
    | ッケージ間で任意変数\ | ップロード時にエラーなり\ | A->ロールA      |
    | の構造に差異がある。  | ませんが、読替変数が代入\ |                 |
    |                       | 値管理に表示されません。  | LCA_F: user_F   |
    |                       |                           |                 |  
    |                       |                           | パッケージ\     |
    |                       |                           | B->ロールA      |
    |                       |                           |                 |
    |                       |                           | LCA_F: user_F   |
    +-----------------------+---------------------------+-----------------+
    | ロールパ\             | 多段の構造が\             | パッケージ\     |
    | ッケージ間で多段の任\ | 一致しているのでエラーに\ | A->ロールB      |
    | 意変数を定義している  | はなりませんが、多段繰返\ |                 |
    |                       | 回数の設定は各パッケージ\ | LCA_H: user_H   |
    |                       | で共通の設定となります。  |                 |
    |                       |                           | パッケージ\     |
    |                       |                           | B->ロールA      |
    |                       |                           |                 |
    |                       |                           | LCA_H: user_H   |
    +-----------------------+---------------------------+-----------------+
 
 .. figure:: ./general_operations/image66.png
    :align: center
    :width: 4.85417in
    :height: 3.67187in
    
 
「ita_readme」の活用例（Ansible-Legacy Role）
-------------------------------------------------------------

| Ansible-Legacy Roleにおける「ita_readme」の活用例について、観点1～7を列挙します。
|
| 前提として、Ansible-Legacy Role（「roles」ディレクトリ）は外部から取得したものとします。
| 以下は、「ita_readme」を用いてアップロードから結果確認までを表した全体イメージ図です。

.. figure:: /images/ja/diagram/ansible-legacyrole_usage_example1.png
   :width: 1000px
   :alt: 全体イメージ図

   全体イメージ図

| 以降、上記の図をベースに観点1～7について掘り下げていきます。

.. list-table:: 
   :widths: 35 80 
   :header-rows: 1
   :align: left

   * - No.
     - 観点
   * - 1
     - 外部から取得したAnsible-Legacy Roleを編集せず利用する
   * - 2
     - 「ita_readme」の役割
   * - 3
     - 「defaults/main.yml」に記載の変数定義およびデフォルト値について
   * - 4
     - 「host_varsファイル」と「ITAのCMDB」について 
   * - 5
     - 「defaults/main.yml」に追記したい場合の救済処置
   * - 6
     - playbookにおけるlength評価への応用
   * - 7
     - playbookにおけるdefined評価への応用 

..
   .. table:: 
      :align: Left
   
      +---------+------------------------------------------------------------------+
      | **NO.** | **観点**                                                         |
      |         |                                                                  |
      |         |                                                                  |
      |         |                                                                  |
      |         |                                                                  |
      |         |                                                                  |
      |         |                                                                  |
      +=========+==================================================================+
      | 1.      | 外部から取得したAnsible-Legacy Roleを編集せず利用する            |
      +---------+------------------------------------------------------------------+
      | 2.      | 「ita_readme」と「読替表」の役割                                 |
      +---------+------------------------------------------------------------------+
      | 3.      | 「defaults/main.yml」に記載の変数定義およびデフォルト値について  |
      +---------+------------------------------------------------------------------+
      | 4.      | 「host_varsファイル」と「ITAのCMDB」について                     |
      +---------+------------------------------------------------------------------+
      | 5.      | 「defaults/main.yml」に追記したい場合の救済処置                  |
      +---------+------------------------------------------------------------------+
      | 6.      | 変数名の先頭“\VAR_\”の有無について                               |
      +---------+------------------------------------------------------------------+
      | 7.      | 「ita_readme」と「読替表」の連携活用                             |
      +---------+------------------------------------------------------------------+
      | 8.      | playbookにおけるlength評価への応用                               |
      +---------+------------------------------------------------------------------+
      | 9.      | playbookにおけるdefined評価への応用                              |
      +---------+------------------------------------------------------------------+
   
- | **観点１：外部から取得したAnsible-Legacy Roleを編集せず利用する**
  | 外部(Galaxy等)から取得したAnsible-Legacy Role（「roles」ディレクトリ）は編集を加えずに利用いただくことが可能です。
  | そのため「ita_readme」を「roles」ディレクトリの外に置いて、Ansible-Legacy Role（「roles」ディレクトリ）内で使われている変数にパラメータを与えることが可能となっております。

.. figure:: /images/ja/diagram/ansible-legacyrole_usage_example2.png
   :width: 1000px
   :alt: 観点１のイメージ図

   観点１のイメージ図


- | **観点２：「ita_readme」の役割について**
  | 「ita_readme」は変数名および変数の型をITAに伝えるための機能です。
  | 言い換えれば、「ita_readme」は変数の具体値（パラメータ）を定義するための機能ではありません（具体値を記載してもITAで認識しません）。
  |
  | 具体値を与える方法を以降の観点で説明します。

.. figure:: /images/ja/diagram/ansible-legacyrole_usage_example3.png
   :width: 1000px
   :alt: 観点２のイメージ図

   観点２のイメージ図

- | **観点３：「defaults/main.yml」に記載の変数定義およびデフォルト値について**
  | 「roles」配下の「defaults/main.yml」はそのまま変更なくansibleに渡されます。
  | 変数定義およびデフォルト値はhost_varsで定義されない限り有効となります。(例：『VAR_A：aaa』)

.. figure:: /images/ja/diagram/ansible-legacyrole_usage_example4.png
   :width: 1000px
   :alt: 観点３のイメージ図

   観点３のイメージ図

- | **観点４：「host_varsファイル」と「ITAのCMDB」について**
  | host_varsファイルはITAのCMDB（パラメータシート）から実行ごとに自動作成されます。

.. figure:: /images/ja/diagram/ansible-legacyrole_usage_example5.png
   :width: 1000px
   :alt: 観点４のイメージ図

   観点４のイメージ図

- | **観点５：「defaults/main.yml」に追記したい場合の救済処置**
  | Ansible-Legacy Role（「roles」ディレクトリ）に変更を加えたい場合、救済処置として「ita_readme」に変数名および型を記述することが可能です。
  |
  | 既に「defaults/main.yml」に記載がある変数を、改めて「ita_readme」に定義する必要はありません。
  | もし二つのファイルで同じ変数が定義されている場合は、「ita_readme」側が優位になります。
  |
  | ※下図のとおり、変数「VAR_H」を「ita_readme」に記述することで変数の追加が可能

.. figure:: /images/ja/diagram/ansible-legacyrole_usage_example6.png
   :width: 1000px
   :alt: 観点５のイメージ図

   観点５のイメージ図

- | **観点６：playbookにおけるlength評価への応用**
  | 変数に対し具体値があるか否かによって、length評価における条件分岐に活用することが可能です。
  | 例えば、「defaults/main.yml」に『VAR_C:[]』がある状態で、変数「VAR_C」に具体値を与えずに実行した場合length＝0となります。
  | 反対に、何らかの具体値を与えて実行した場合length＞0となります。（例：『VAR_X:sss』）

.. figure:: /images/ja/diagram/ansible-legacyrole_usage_example7.png
   :width: 1000px
   :alt: 観点６のイメージ図

   観点６のイメージ図

- | **観点７：playbookにおけるdefined評価への応用**
  | 変数に対し具体値を定義しているか否かによって、defined評価による条件分岐に活用することが可能です。
  | 例えば、「defaults/main.yml」で定義のない変数「VAR_G」と「VAR_H」を、「ita_readme」で定義を記述します。「ita_readme」に記述することで、ITAのCMDB（パラメータシート）で取り扱うことが可能となります。
  |
  | 変数「VAR_G」に具体値を付与せず実行すると、「defaults/main.yml」および「host_vars」に定義されずに動作するためdefined→falseとなります。
  | 反対に、変数「VAR_H」に具体値「kkk」を付与し実行すると、「host_vars」に定義されて動作するためdefined→trueとなります。

.. figure:: /images/ja/diagram/ansible-legacyrole_usage_example8.png
   :width: 1000px
   :alt: 観点７のイメージ図

   観点７のイメージ図

..
   - | **観点６：変数名の先頭“VAR_”の有無について**
     | 「defaults/main.yml」の変数のうち、ITAは“\VAR_\”という接頭文字から始まるものを変数マスタに管理します。
     | 「defaults/main.yml」の変数のうち、“\VAR_\”という接頭文字から始まっていないものをITAにて変数管理させる場合は「読替表」を活用します。
     | 「読替表」では“\VAR_\”という接頭文字から始まっていない変数を“\LCA_\”という接頭文字から始まる変数名と紐づけることでITAにて変数管理させることが可能となります。
     |
     | なお、本機能の応用例として、「defaults/main.yml」の変数（“\VAR_\”という接頭文字から始まっていない）にITAからパラメータを与えずに実行したい場合は、あえて「読替表」での変数紐づけを避けることも可能です。
     |
     | ※以下、図の変数名「hoge3」のパターン
     | ※「読替表」には“\LCA_\”から始まる変数定義のみ有効
   
   .. figure:: ./general_operations/image73.png
     :width: 6.49606in
     :height: 4.84121in
     :align: center
     :alt: 観点６のイメージ図
  
     観点６のイメージ図
  
   - | **観点７：「ita_readme」と「読替表」の連携活用**
     | 「tasks/main.yml」（playbook本体）において“\VAR_\”から始まっていない変数が使われており、また、その変数が「default/main.yml」に定義されていない場合、「ita_readme」と「読替表」を連携活用することで、ITAからパラメータを与えることが可能です。
     | 例えば、下図の様に「roles」配下の「tasks/main.yml」に変数「hoge」が使われている場合、以下の手順によってITAに変数を伝えることが可能です。
   
     #. | 「ita_readme」に、変数名「hoge」を追記する
     #. | 「読替表」に、変数名「hoge」をITAのCMDB（パラメータシート）で「LCA_xxx」という変数名で扱うことを追記する
   
   .. figure:: ./general_operations/image74.png
      :width: 6.49606in
      :height: 4.23387in
      :align: center
      :alt: 観点７のイメージ図
   
      観点７のイメージ図
   
BackYardコンテンツ
------------------

変数自動登録
~~~~~~~~~~~~~
| 変数解析対象の資材をアップロードした場合、アップロードされた資材から変数を取出します。

.. table:: モード別アップロードした資材の変数の扱い
  :align: Left

  +-------------------------+--------------+
  | メニュー                | Legacy Role  |
  +=========================+==============+
  | Playbook素材集          | ×            | 
  +-------------------------+--------------+
  | ロールパッケージ管理    | ○            | 
  +-------------------------+--------------+
  | 対話ファイル素材集      | ×            |
  +-------------------------+--------------+

..
   ※修正前
  .. table:: モード別アップロードした資材の変数の扱い
    :align: Left

    +-------------------------+--------------+--------------+--------------+
    | メニュー                | Legacy　　   | Legacy Role  | Pioneer　　  |
    +=========================+==============+==============+==============+
    | Playbook素材集          | ○            | ×            | ×            |
    +-------------------------+--------------+--------------+--------------+
    | ロールパッケージ管理    | ×            | ○            | ×            |
    +-------------------------+--------------+--------------+--------------+
    | 対話ファイル素材集      | ×            | ×            | ○            |
    +-------------------------+--------------+--------------+--------------+



| なお、取出すタイミングは 自動プロセスの起動周期 に依存します。


|

.. warning:: | ● 変数名の一意管理
   | 取出した変数名は、モード毎に全資材で一意管理されます。
   | 同一ロールパッケージ内でロールを跨って同じ変数名を使用しており、変数構造が異なる場合は :menuselection:`Ansible-LegacyRole-->ロールパッケージ管理` のアップロードでエラーとなります。
   | 具体的には通常変数と多段変数や多段変数同士で多段構造が異なる場合、同じ変数名を使用しているとアップロードでエラーとなります。
   | なお、ロールパッケージが異なる場合は上記の場合でもアップロードすることが可能です。
   |
   | 具体例は下記の通りです。
   |


   | Exp)

   .. table:: 

      +--------------+------------------------+--------------+--------------------------------------------------------------------------+-----------+------------------------------------------------------------------+
      | No.          | ロールパッケージ       | ロール       | defaults/main.yml                                                        | 動作 (※)  | パターン                                                         |
      |              |                        |              |                                                                          |           |                                                                  |
      +==============+========================+==============+==========================================================================+===========+==================================================================+
      | 1            | package_A              | role1        | | VAR_SAMPLE:                                                            | 〇        | | ・変数名が同じ                                                 |
      |              |                        |              |                                                                          |           | | ・配列変数のメンバー変数の定義が同じ                           |
      |              |                        |              | |  - { VAR_001: "aaaa" , \VAR_002:\ "bbbb" }                             |           | | ・メンバー変数の記載順序が異なる                               |
      |              |                        |              |                                                                          |           |                                                                  |
      |              |                        +--------------+--------------------------------------------------------------------------+           |                                                                  |
      |              |                        | role2        | | VAR_SAMPLE:                                                            |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      |              |                        |              | |  - { VAR_002: "bbbb" , \VAR_001:\ "aaaa" }                             |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      +--------------+------------------------+--------------+--------------------------------------------------------------------------+-----------+------------------------------------------------------------------+
      | 2            | package_A              | role1        | | VAR_SAMPLE:                                                            | ×         | | ・変数名が同じ                                                 |
      |              |                        |              |                                                                          |           | | ・配列変数のメンバー変数の定義が異なる                         |
      |              |                        |              | |  - { VAR_001: "aaaa" , \VAR_002:\ "bbbb" }                             |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      |              |                        +--------------+--------------------------------------------------------------------------+           |                                                                  |
      |              |                        | role2        | | VAR_SAMPLE:                                                            |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      |              |                        |              | |  - { VAR_003: "aaaa" , \VAR_004:\ "bbbb" }                             |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      +--------------+------------------------+--------------+--------------------------------------------------------------------------+-----------+------------------------------------------------------------------+
      | 3            | package_A              | role1        | | VAR_SAMPLE:                                                            | ×         | | ・変数名が同じ                                                 |
      |              |                        |              |                                                                          |           | | ・一般の変数と配列変数が混在している                           |
      |              |                        |              | |  - { VAR_001: "aaaa" , \VAR_002:\ "bbbb" }                             |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      |              |                        +--------------+--------------------------------------------------------------------------+           |                                                                  |
      |              |                        | role2        | | VAR_SAMPLE: aaaa                                                       |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      +--------------+------------------------+--------------+--------------------------------------------------------------------------+-----------+------------------------------------------------------------------+
      | 4            | package_A              | role1        | | VAR_SAMPLE:                                                            | 〇        | | ・変数名が同じ                                                 |
      |              |                        |              |                                                                          |           | | ・配列変数のメンバー変数の定義が同じ                           |
      |              |                        |              | |  - { VAR_001: "aaaa" , \VAR_002:\ "bbbb" }                             |           | | ・メンバー変数の記載順序が異なる                               |
      |              |                        |              |                                                                          |           |                                                                  |
      |              +------------------------+--------------+--------------------------------------------------------------------------+           |                                                                  |
      |              | package_B              | role1        | | VAR_SAMPLE:                                                            |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      |              |                        |              | |  - { VAR_002: "bbbb" , \VAR_001:\ "aaaa" }                             |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      +--------------+------------------------+--------------+--------------------------------------------------------------------------+-----------+------------------------------------------------------------------+
      | 5            | package_A              | role1        | | VAR_SAMPLE:                                                            | 〇        | | ・変数名が同じ                                                 |
      |              |                        |              |                                                                          |           | | ・配列変数のメンバー変数の定義が異なる                         |
      |              |                        |              | |  - { VAR_001: "aaaa" , \VAR_002:\ "bbbb" }                             |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      |              +------------------------+--------------+--------------------------------------------------------------------------+           |                                                                  |
      |              | package_B              | role1        | | VAR_SAMPLE:                                                            |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      |              |                        |              | |  - { VAR_003: "aaaa" , \VAR_004:\ "bbbb" }                             |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      +--------------+------------------------+--------------+--------------------------------------------------------------------------+-----------+------------------------------------------------------------------+
      | 6            | package_A              | role1        | | VAR_SAMPLE:                                                            | 〇        | | ・変数名が同じ                                                 |
      |              |                        |              |                                                                          |           | | ・一般の変数と配列変数が混在している                           |
      |              |                        |              | |  - { VAR_001: "aaaa" , \VAR_002:\ "bbbb" }                             |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      |              +------------------------+--------------+--------------------------------------------------------------------------+           |                                                                  |
      |              | package_B              | role1        | | VAR_SAMPLE: aaaa                                                       |           |                                                                  |
      |              |                        |              |                                                                          |           |                                                                  |
      +--------------+------------------------+--------------+--------------------------------------------------------------------------+-----------+------------------------------------------------------------------+
   


   | ※ 動作　： ロールパッケージ管理のアップロード結果
   |
.. {{開発者確認で下記不要と判断}} 
.. {{開発者確認で下記不要と判断}}
   |
   | ●全ロールパッケージ
   | ロールパッケージを跨って同じ変数名を使用しているが変数構造が違う場合。
   | ⇒ アップロード時にエラーとなります。

..
    代入値自動値登録設定
    ~~~~~~~~~~~~~~~~~~
..
    | 連携対象としたパラメータシートのオペレーションとホスト毎の項目の設定値と紐付けたMovementと変数の情報を代入値管理と作業対象ホストに反映されます。
    | なお、反映のタイミングは前述と同様に 自動プロセスの起動周期に依存します。
    | 作業対象ホストと代入値管理は複数の操作者が更新を行います。最終更新者が他操作者の場合は反映処理をしません。
    | 代入値自動登録設定のデータを反映したい場合は、代入値管理で該当レコードを廃止にする。他
    | BackYard処理で該当レコードの更新を無効にする。などの操作を行ってください。

    | 作業対象ホストと代入値管理への反映ルールを以下に明記します。

    ① 代入値自動登録に登録されている情報を代入値管理へ反映時
    **********************************************************
      
    .. table:: 
       :align: Left
        
       +-------------------------------+-------------------------------+---------------------------------------------------------------------+-------------------------------+
       |     **代入値管理の状態**      |     **該当レコードなし**      | **該当レコードあり**                                                |     **該当レコード廃止中**    |
       |                               |                               +---------------------------+-----------------------------------------+                               |
       |                               |                               | **=具体値**               | **≠具体値**                             |                               |
       |                               |                               |                           +-----------------------------------------+                               |
       |                               |                               |                           | **最終更新者**                          |                               |
       |                               |                               |                           +--------------------+--------------------+                               |
       |                               |                               |                           | **BackYard処理**   | **他操作者**       |                               |
       +===============================+===============================+===========================+====================+====================+===============================+
       | **代入値管理への反映**        | **新規レコード追加**          | ー                        | 該当レコードの\    | ー                 | 廃止レコード復活              |
       |                               |                               |                           | 具体値更新         |                    |                               |
       +-------------------------------+-------------------------------+---------------------------+--------------------+--------------------+-------------------------------+

    | ※該当レコード：オペレーション＋ホスト＋Movement+変数名+(メンバー変数)+(代入順序)が同一のレコードの意

    ② 代入値自動登録に登録されていない情報（代入値管理のみに登録）を代入値管理へ反映時
    *************************************************************************************

    .. table:: 
       :align: Left
        
       +-------------------------------+---------------------------------------------------------------------+
       |     **代入値管理の状態**      | **該当レコードあり**                                                |
       |                               +---------------------------------------------------------------------+
       |                               | **最終更新者**                                                      |
       |                               +----------------------------------+----------------------------------+
       |                               | **BackYard処理**                 | **他操作者**                     |
       +===============================+==================================+==================================+
       | **代入値管理への反映**        | 該当レコード廃止　               | ー                               |
       +-------------------------------+----------------------------------+----------------------------------+

    ③ 代入値自動登録に登録されている情報を作業対象ホストへの反映時
    ***************************************************************

    .. table:: 
       :align: Left

       +--------------------+-------------+-------------+--------------------+
       | **作業\            | **該当レコ\ | **該当レコ\ | **該\              |
       | 対象ホストの状態** | ードなし**  | ードあり**  | 当レコード廃止中** |
       +====================+=============+=============+====================+
       | **作業対\          | 新規レ\     | －          | 廃止レコード復活   |
       | 象ホストへの反映** | コード追加  |             |                    |
       +--------------------+-------------+-------------+--------------------+
    | ※ 該当レコード：オペレーション＋ホスト＋Movementが同一のレコードの意

    ④ 代入値自動登録に登録されていない情報（作業対象ホストのみに登録）を作業対象ホストへ反映時
    ********************************************************************************************

    .. table:: 
       :align: Left
        
       +-------------------------------+---------------------------------------------------------------------+
       |     **代入値管理の状態**      | **該当レコードあり**                                                |
       |                               +---------------------------------------------------------------------+
       |                               | **最終更新者**                                                      |
       |                               +----------------------------------+----------------------------------+
       |                               | **BackYard処理**                 | **他操作者**                     |
       +===============================+==================================+==================================+
       | **代入値管理への反映**        | 該当レコード廃止　               | ー                               |
       +-------------------------------+----------------------------------+----------------------------------+

    ⑤ 同一Movementと変数と代入順序に、複数項目の紐付が登録されている場合
    ************************************************************************
    複数のパラメータシートで同一のオペレーションとホストが紐付されている場合は、ランダムに1項目を選択し代入値管理へ反映を行います。
       
    .. figure:: ./general_operations/image_2b_5.png
       :width: 6.49606in
       :height: 4.23387in
       :align: center


..
   {{開発メンバー確認時に不要のためコメントアウト}}
  Ansible利用ガイドラインITA追加ルール
  ------------------------------------
  | ITAを使用して、Ansibleで実行する為のPlaybook作成ガイドラインを記述します。
  | 詳しくは、別資料「利用手順マニュアル_Ansible-driver_別紙_Ansible利用ガイドライン_追加ルール」を参照してください。

  運用操作
  ========
  | 本機能を活用する操作は、クライアントPCのブラウザ画面からのユーザー利用による入力だけでなく、システム運用・保守による操作もあります。用意している運用・保守の操作は次のとおりです。

  メンテナンス
  ------------
  | Ansible-driverのプロセスの開始/停止/再起動に必要なファイルは以下となります。
  | {{#9: こちらの下記対象ファイルとコマンド実行の変更ありますでしょうか。}}

  .. table::
     :align: Left

     +--------------------------------------+-------------------------------+
     | **説明**                             | **対象ファイル名**            |
     +======================================+===============================+
     | LegacyRole実行監視                   | ky_ans\                       |
     |                                      | ible_execute-workflow.service |
     | 未実行作業の実行を行う。             |                               |
     +--------------------------------------+-------------------------------+
     | legacyRole変数自動登録               | ky_legacy_role_va\            |
     |                                      | rsautolistup-workflow.service |
     | アップロ\                            |                               |
     | ードした資材から変数の取出しを行う。 |                               |
     +--------------------------------------+-------------------------------+
     | legacyRole自動登録設定               | ky_legacy_role\               |
     |                                      | _valautostup-workflow.service |
     | 自動登録設定に設定された情報を代入値 |                               |
     | 管理と作業対象メニューに反映を行う。 |                               |
     +--------------------------------------+-------------------------------+
     | Ansible Automation\                  | ky_ansible_tow\               |
     | Controllerデータ同期                 | ermasterSync-workflow.service |
     |                                      |                               |
     | Ansible Automation\                  |                               |
     | Cont\                                |                               |
     | rollerから各種設定情報の取得を行う。 |                               |
     +--------------------------------------+-------------------------------+
   
   | 対象ファイルは「/usr/lib/systemd/system」に格納されています。
   | プロセス起動/停止/再起動の方法は次の通りです。
   | root権限でコマンドを実行してください。
   
   #. | プロセス起動
   
      .. code-block:: none
   
         # systemctl start ky_ansible_execute-workflow.service 
   
   
   #. | プロセス停止
   
      .. code-block:: none
   
         # systemctl stop ky_ansible_execute-workflow.service 
            
   #. | プロセス再起動
   
      .. code-block:: none
   
         # systemctl restart ky_ansible_execute-workflow.service 
   
   | 各対象ファイル名に置き換えて起動/停止/再起動を行ってください。

..
   {{開発メンバー確認時に不要のためコメントアウト}}

   .. _general_operations_about_the_maintenance_method:
   メンテナンス方法について　 {{#10: こちらの下記ログレベル設定ファイル・コード変更ありますでしょうか。}}
   -------------------------------------------------------------------------------------------------------
   
   #. | NORMALレベルへの変更
      | 以下のファイルの8行目「DEBUG」を「NORMAL」に書き換えます。
      | ログレベル設定ファイル： <インストールディレクトリ>/ita-root/confs/backyardconfs/ita_env
   
   #. | DEBUGレベルへの変更
      | 以下のファイルの8行目「NORMAL」を「DEBUG」に書き換えます。
      | ログレベル設定ファイル： <インストールディレクトリ>/ita-root/confs/backyardconfs/ita_env
   
   #. | 起動周期の変更
      | 各対象ファイルのExecStartの5番目のパラメータを変更します。（単位:秒）
      | 例外を除き起動周期はデフォルト値の使用をしてください。
   
      .. code-block:: none
   
         ExecStart=/exastro/ita-root/backyards/common/ky_loopcall-php-procedure.sh /usr/local/bin/php /usr/local/bin/php /exastro/ita-root/backyards/ansible_driver/ky_pioneer_varsautolistup-workflow.php /exastro/ita-root/logs/backyardlogs 10 NORMAL > /dev/null 2>&1
   
      | 書き換え後、\ **プロセス再起動(restart)後に有効になります。**
      | ログファイルの出力先： *<インストールディレクトリ>/ita-root/logs/backyardlogs*
   
付録
====

.. _general_operations_the_linkage_between_the_input_data_used_during_ansible_execution_and_ita_menu:

Ansible実行時に使用される投入データとITAメニューの紐づけ
--------------------------------------------------------
| 各ITAメニューより情報を抜出してAnsible実行に必要な投入データを作ります。この際、機器一覧のパスワードや代入値管理でSensitive設定をONした変数の具体値がansible-vaultで暗号化されています。
| 投入データはZIP形式で「 :ref:`general_operations_check_operation_status` 」よりダウンロードが可能です。
| ダウンロードした投入データを所定のディレクトリに解凍することで、Ansibleを直接実行することも可能です。
| 
| 各種データとITAメニューの関係性は以下の通りです。



..
   ※修正前(v2.0用に)

  Ansible-Legacy投入データ
  ~~~~~~~~~~~~~~~~~~~~~~~~

  .. table:: Ansible-Legacy投入データ
     :align: Left

     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | メニューグループ              | メニュー                      | 項目                                                   | ディレクトリ解凍時のパス                   |
     +===============================+===============================+========================================================+============================================+
     | Ansible-Legacy                | Playbook素材集                | プレイブック素材                                       | /child_playbooks                           |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible 共通                  | テンプレート管理              | テンプレート素材                                       | /template_files                            |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible 共通                  | ファイル管理                  | ファイル素材                                           | /copy_files                                |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Legacy                | 代入値管理                    | ファイル素材                                           | /upload_files                              |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible 共通                  | グローバル変数管理            | 変数名/具体値                                          | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Legacy                | 代入値管理                    | 変数名/具体値(文字列)                                  | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Legacy                | 代入値管理                    | 変数名/具体値(ファイル)                                | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Legacy                | template 管理                 | テンプレート素材                                       | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Legacy                | ファイル管理                  | ファイル変数名                                         | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Legacy                | インターフェース情報          | データリレイストレージパス(ITA)                        | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Legacy                | インターフェース情報          | Symphony インスタンスデータリレイストレージパス(ANS)   | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Legacy                | インターフェース情報          | Conductor インスタンスデータリレイストレージパス(ANS)  | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | プロトコル                                             | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ログインユーザ ID                                      | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ログインパスワード                                     | /host_vars                                 |
     |                               |                               |                                                        |                                            |
     |                               |                               | ※ansible-vault で暗号化                                |                                            |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ホスト名                                               | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ssh 認証鍵ファイル                                     | /ssh_key_files                             |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | サーバ証明書                                           | /winrm_ca_files                            |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible 共通                  | インターフェース情報          | オプションパラメータ                                   | /AnsibleExecOption.txt                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Legacy                | Movement 一覧                 | オプションパラメータ                                   | /AnsibleExecOption.txt                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ログインユーザ ID                                      | /hosts                                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ログインパスワード                                     | /hosts                                     |
     |                               |                               |                                                        |                                            |
     |                               |                               | ※ansible-vault で暗号化                                |                                            |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ホスト名                                               | /hosts                                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | IP アドレス                                            | /hosts                                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | インベントリファイル追加オプション                     | /hosts                                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | WinRM 接続情報                                         | /hosts                                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | 接続オプション                                         | /hosts                                     |
     |                               |                               |                                                        |                                            |
     |                               |                               | ※ansible_ssh_extra_args の値                           |                                            |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Legacy                | Playbook 素材集               | プレイブック素材                                       | /playbook.yml                              |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Legacy                | Movement-Playbook紐付         | インクルード順序                                       | /playbook.yml                              |
     |                               |                               |                                                        |                                            |
     |                               | （Movement-対話種別紐付、\    |                                                        |                                            |
     |                               | Movement-ロール紐付）         |                                                        |                                            |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+




  Ansible-Pioneer投入データ
  ~~~~~~~~~~~~~~~~~~~~~~~~~

  .. table:: Ansible-Pioneer投入データ
     :align: Left

     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | メニューグループ              | メニュー                      | 項目                                                   | ディレクトリ解凍時のパス                   |
     +===============================+===============================+========================================================+============================================+
     | Ansible-Legacy                | Playbook素材集                | プレイブック素材                                       | /child_playbooks                           |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible 共通                  | テンプレート管理              | テンプレート素材                                       | /template_files                            |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible 共通                  | ファイル管理                  | ファイル素材                                           | /copy_files                                |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible- Pioneer              | 代入値管理                    | ファイル素材                                           | /upload_files                              |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible 共通                  | グローバル変数管理            | 変数名/具体値                                          | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Pioneer               | 代入値管理                    | 変数名/具体値(文字列)                                  | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Pioneer               | 代入値管理                    | 変数名/具体値(ファイル)                                | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Pioneer               | template 管理                 | テンプレート素材                                       | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Pioneer               | ファイル管理                  | ファイル変数名                                         | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Pioneer               | インターフェース情報          | データリレイストレージパス(ITA)                        | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Pioneer               | インターフェース情報          | Symphony インスタンスデータリレイストレージパス(ANS)   | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Pioneer               | インターフェース情報          | Conductor インスタンスデータリレイストレージパス(ANS)  | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | プロトコル                                             | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ログインユーザ ID                                      | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ログインパスワード                                     | /host_vars                                 |
     |                               |                               |                                                        |                                            |
     |                               |                               | ※base64、rot13の順でエンコードした値                   |                                            |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ホスト名                                               | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | Pioneer 利用情報                                       | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Pioneer               | Movement 一覧                 | 並列実行数                                             | /host_vars                                 |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ssh 認証鍵ファイル                                     | /ssh_key_files                             |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible 共通                  | インターフェース情報          | オプションパラメータ                                   | /AnsibleExecOption.txt                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Pioneer               | Movement 一覧                 | オプションパラメータ                                   | /AnsibleExecOption.txt                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ログインユーザ ID                                      | /hosts                                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ログインパスワード                                     | /hosts                                     |
     |                               |                               |                                                        |                                            |
     |                               |                               | ※base64、rot13の順でエンコードした値                   |                                            |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | ホスト名                                               | /hosts                                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | IP アドレス                                            | /hosts                                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | インベントリファイル追加オプション                     | /hosts                                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | Pioneer 利用情報                                       | /hosts                                     |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | 基本コンソール                | 機器一覧                      | 接続オプション                                         | /hosts                                     |
     |                               |                               |                                                        |                                            |
     |                               |                               | ※ansible_ssh_extra_args の値                           |                                            |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Pioneer               | 対話ファイル素材集            | 対話ファイル素材                                       | /playbook.yml                              |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
     | Ansible-Pioneer               | Movement-Playbook紐付         | インクルード順序                                       | /playbook.yml                              |
     |                               |                               |                                                        |                                            |
     |                               | （Movement-対話種別紐付、\    |                                                        |                                            |
     |                               | Movement-ロール紐付）         |                                                        |                                            |
     +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+

Ansible-LegacyRole投入データ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. table:: Ansible-LegacyRole投入データ
   :align: Left

   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | メニューグループ              | メニュー                      | 項目                                                   | ディレクトリ解凍時のパス                   |
   +===============================+===============================+========================================================+============================================+
   | Ansible-LegacyRole            | Playbook素材集                | プレイブック素材                                       | /child_playbooks                           |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible 共通                  | テンプレート管理              | テンプレート素材                                       | /template_files                            |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible 共通                  | ファイル管理                  | ファイル素材                                           | /copy_files                                |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible-LegacyRole            | 代入値管理                    | ファイル素材                                           | /upload_files                              |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible 共通                  | グローバル変数管理            | 変数名/具体値                                          | /host_vars                                 |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible-LegacyRole            | 代入値管理                    | 変数名/具体値(文字列)                                  | /host_vars                                 |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible-LegacyRole            | 代入値管理                    | 変数名/具体値(ファイル)                                | /host_vars                                 |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible-LegacyRole            | template 管理                 | テンプレート素材                                       | /host_vars                                 |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible-LegacyRole            | ファイル管理                  | ファイル変数名                                         | /host_vars                                 |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible共通                   | 機器一覧                      | プロトコル                                             | /host_vars                                 |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible共通                   | 機器一覧                      | ログインユーザ ID                                      | /host_vars                                 |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible共通                   | 機器一覧                      | ログインパスワード                                     | /host_vars                                 |
   |                               |                               |                                                        |                                            |
   |                               |                               | ※ansible-vault で暗号化                                |                                            |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible共通                   | 機器一覧                      | ホスト名                                               | /host_vars                                 |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible共通                   | 機器一覧                      | ssh 認証鍵ファイル                                     | /ssh_key_files                             |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible共通                   | 機器一覧                      | サーバ証明書                                           | /winrm_ca_files                            |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible 共通                  | インターフェース情報          | オプションパラメータ                                   | /AnsibleExecOption.txt                     |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible-LegacyRole            | Movement 一覧                 | オプションパラメータ                                   | /AnsibleExecOption.txt                     |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible共通                   | 機器一覧                      | ログインユーザ ID                                      | /hosts                                     |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible共通                   | 機器一覧                      | ログインパスワード                                     | /hosts                                     |
   |                               |                               |                                                        |                                            |
   |                               |                               | ※ansible-vault で暗号化                                |                                            |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible共通                   | 機器一覧                      | ホスト名                                               | /hosts                                     |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible共通                   | 機器一覧                      | IP アドレス                                            | /hosts                                     |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible共通                   | 機器一覧                      | インベントリファイル追加オプション                     | /hosts                                     |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible共通                   | 機器一覧                      | WinRM 接続情報                                         | /hosts                                     |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible共通                   | 機器一覧                      | 接続オプション                                         | /hosts                                     |
   |                               |                               |                                                        |                                            |
   |                               |                               | ※ansible_ssh_extra_args の値                           |                                            |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible-LegacyRole            | Playbook 素材集               | プレイブック素材                                       | /playbook.yml                              |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+
   | Ansible-LegacyRole            | Movement-Playbook紐付         | インクルード順序                                       | /playbook.yml                              |
   |                               |                               |                                                        |                                            |
   |                               | （Movement-対話種別紐付、\    |                                                        |                                            |
   |                               | Movement-ロール紐付）         |                                                        |                                            |
   +-------------------------------+-------------------------------+--------------------------------------------------------+--------------------------------------------+

..
   .. note:: | host_vars配下に格納されるデータリレイストレージパス(ITA)とConductor インスタンスデータリレイストレージパス(ANS)は、環境変数HOST_STORAGEPATHより情報を抜出します。
   
..
   {{開発メンバー確認時に不要のためコメントアウト}}

   投入データを直接実行する方法
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   ① 投入データの解凍先ディレクトリの作成　
   ***********************************************************************************************************************************
   | 以下の2つのディレクトリを作成し、1.のディレクトリに投入データを解凍します。
   #. | /ベースディレクトリ/ドライバパス/作業番号/in
   #. | /ベースディレクトリ/ドライバパス/作業番号/out
      | ベースディレクトリ　: インターフェース情報=>データリレイストレージパス(Ansible)
      | ドライバパス　:  Legacy-role: legacy/rl　 
      | 作業番号:　作業実行時に自動採番した36桁の文字列
   
   
   | 尚、投入データには、機器一覧にアップロードした秘密鍵ファイルが含まれていません。秘密鍵ファイルを必要といる認証方式の場合、投入データに含まれているインベントリファイル「hosts」を開き、ansible_ssh_private_key_fileに設定されているパスに秘密鍵ファイルをコピーしてください。
   
   | インベントリファイル「hosts」
   
   .. code-block:: none
   
      all:
        children:
          hostgroups:
            hosts:
              target_host_1:
                ansible_ssh_user: keyauth_user
                ansible_ssh_private_key_file: /exastro/data_relay_storage/ansible_driver/legacy/ns/0000000060/in/ssh_key_files/0000000006-keyauth_user_id_rsa
   
       
   ② 投入データを直接実行するコマンド
   ***********************************
   | Ansible-LegacyRole
   
   .. code-block:: none
      
      ansible-playbook (オプション) –i hosts --vault-password-file　パスワードファイル site.yml
   
   .. 
     ② 投入データを直接実行するコマンド
     ***********************************
     | Ansible-Legacy
     | 　　   ansible-playbook (オプション) –i hosts --vault-password-file　パスワードファイル playbook.yml
     | Ansible-Pioneer
     | 　　   ansible-playbook (オプション) –i hosts --vault-password-file　パスワードファイル playbook.yml
     | Ansible-LegacyRole
     | 　　   ansible-playbook (オプション) –i hosts --vault-password-file　パスワードファイル site.yml
     |
   
   .. note:: | パスワードファイル名は任意です。パスワードファイルに設定するパスワードは、ＩＴＡインストール先/ita-root/confs/commonconfs/ansible_vault_accesskey.txtの内容を、rot13、base64の順でデコードした値を使用してください。
   
Ansible実行時に作成される結果データ
-----------------------------------
| [投入データ]をansibleで実行した結果を[結果データ]としてZIP形式で保存します。
| [結果データ]はZIP形式で「 :ref:`general_operations_check_operation_status` 」よりダウンロードが可能です。

..
   ※修正前(v2.0用に)


  Legacy結果データに保存されるファイル一覧
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  .. table:: Legacy結果データの保存されるファイル一覧
     :align: Left

     +---------------+-----------------------------------------+----+------+
     | **ファ\       | **記録内容**                            | A\ | Ans\ |
     | イル名**      |                                         | ns\| ible\|
     |               |                                         | ib\| Au\  |
     |               |                                         | le\| toma\|
     |               |                                         | Co\| tion\|
     |               |                                         | re\| Co\  |
     |               |                                         | の\| ntro\|
     |               |                                         | 場\| ller\|
     |               |                                         | 合 | の\  |
     |               |                                         |    | 場合 |
     +===============+=========================================+====+======+
     | result.txt    | Ansibleの実行結果を記録                 | 〇 |      |
     +---------------+-----------------------------------------+----+------+
     | xxx.pid       | Ansible-playbbokコ\                     | 〇 |      |
     |               | マンドのプロセスIDを記録するファイル。  |    |      |
     |               |                                         |    |      |
     |               | x\                                      |    |      |
     |               | xx:Ansible-playbbokコマンドのプロセスID |    |      |
     +---------------+-----------------------------------------+----+------+
     | error.log     | 作業実行時にITAがなにかしらのエラ\      | 〇 | 〇   |
     |               | ーによりエラーメッセージを出力した場合\ |    |      |
     |               | 、または、Ansible-playbbokコマンドがな\ |    |      |
     |               | にかとらのエラーによりエラーメッセージ\ |    |      |
     |               | を出力した場合のエラー出力先ファイル。  |    |      |
     |               |                                         |    |      |
     |               | 作業実行確\                             |    |      |
     |               | 認のエラーログに表示に表示される内容。  |    |      |
     +---------------+-----------------------------------------+----+------+
     | exec.log      | Ansible-playbbokが出力した\             | 〇 | 〇   |
     |               | 実行ログを一部加工したログファイル。作\ |    |      |
     |               | 業実行確認の実行ログに表示される内容。  |    |      |
     +---------------+-----------------------------------------+----+------+
     | exec.log.org  | Ansible-playbbokが出力した実行ログ      | 〇 | 〇   |
     +---------------+-----------------------------------------+----+------+
     | I             | 分割された実行ログファイルです。        |    | 〇   |
     | ta_<mode名>\_ |                                         |    |      |
     |               | ファイル名の命名規則は :ref:`gen\       |    |      |
     | execut        | eral_operations_check_operation_stat\   |    |      |
     | ions_jobtpl\_ | us` の⑥実行ログ表示を参照してください。|    |      |
     |               |                                         |    |      |
     | <作業番号>_<  |                                         |    |      |
     | グループ番号> |                                         |    |      |
     +---------------+-----------------------------------------+----+------+
     | forced.txt    | 緊急停止をした場合の記録ファイル        | 〇 |      |
     +---------------+-----------------------------------------+----+------+
     | user_files    | 実行したplaybook\                       | 〇 | 〇   |
     |               | でITA独自変数「__workflowdir__」\       |    |      |
     |               | になにかしらのファイル出力をした場\     |    |      |
     |               | 合のファイルが記録されるディレクトリ。  |    |      |
     +---------------+-----------------------------------------+----+------+

  Pioneer結果データに保存されるファイル一覧
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  .. table:: Pioneer結果データの保存されるファイル一覧
     :align: Left
     
     +---------------+-----------------------------------------+----+------+
     | **ファ\       | **記録内容**                            | A\ | Ans\ |
     | イル名**      |                                         | ns\| ible\|
     |               |                                         | ib\| Au\  |
     |               |                                         | le\| toma\|
     |               |                                         | Co\| tion\|
     |               |                                         | re\| Cont\|
     |               |                                         | の\| roll\|
     |               |                                         | 場\| erの\|
     |               |                                         | 合 | 場合 |
     +===============+=========================================+====+======+
     | result.txt    | Ansibleの実行結果を記録                 | 〇 |      |
     +---------------+-----------------------------------------+----+------+
     | xxx.pid       | Ansible-playbbokコ\                     | 〇 |      |
     |               | マンドのプロセスIDを記録するファイル。  |    |      |
     |               |                                         |    |      |
     |               | x\                                      |    |      |
     |               | xx:Ansible-playbbokコマンドのプロセスID |    |      |
     +---------------+-----------------------------------------+----+------+
     | pioneer.xxx   | Pioneerモジ\                            | 〇 | 〇   |
     |               | ュールのプロセスIDを記録するファイル。  |    |      |
     |               |                                         |    |      |
     |               | xxx: PioneerモジュールのプロセスID      |    |      |
     +---------------+-----------------------------------------+----+------+
     | error.log     | 作業実行時にITAがなにかしらのエラ\      | 〇 | 〇   |
     |               | ーによりエラーメッセージを出力した場合\ |    |      |
     |               | 、または、Ansible-playbbokコマンドがな\ |    |      |
     |               | にかとらのエラーによりエラーメッセージ\ |    |      |
     |               | を出力した場合のエラー出力先ファイル。  |    |      |
     |               |                                         |    |      |
     |               | 作業実行確\                             |    |      |
     |               | 認のエラーログに表示に表示される内容。  |    |      |
     +---------------+-----------------------------------------+----+------+
     | exec.log      | Ansible-playbbokが出力した\             | 〇 | 〇   |
     |               | 実行ログを一部加工したログファイル。作\ |    |      |
     |               | 業実行確認の実行ログに表示される内容。  |    |      |
     +---------------+-----------------------------------------+----+------+
     | exec.log.org  | Ansible-playbbokが出力した実行ログ      | 〇 | 〇   |
     +---------------+-----------------------------------------+----+------+
     | I             | 分割された実行ログファイルです。        |    | 〇   |
     | ta_<mode名>\_ |                                         |    |      |
     |               | ファイル名の命名規則は :ref:`gene\      |    |      |
     | execut        | ral_operations_check_operation_sta\     |    |      |
     | ions_jobtpl\_ | tus` の⑥実行ログ表示を参照してください。|    |      |
     |               |                                         |    |      |
     | <作業番号>_<  |                                         |    |      |
     | グループ番号> |                                         |    |      |
     +---------------+-----------------------------------------+----+------+
     | forced.txt    | 緊急停止をした場合の記録ファイル        | 〇 |      |
     +---------------+-----------------------------------------+----+------+
     | user_files    | 実行したplaybook\                       | 〇 | 〇   |
     |               | でITA独自変数「__workflowdir__」\       |    |      |
     |               | になにかしらのファイル出力をした場\     |    |      |
     |               | 合のファイルが記録されるディレクトリ。  |    |      |
     +---------------+-----------------------------------------+----+------+

Legacy-Role 結果データに保存されるファイル一覧
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. table:: Legacy-Role結果データの保存されるファイル一覧
   :align: Left

   +---------------+-----------------------------------------+----+------+
   | **ファ\       | **記録内容**                            | A\ | Ans\ |
   | イル名**      |                                         | ns\| ible\|
   |               |                                         | ib\| Au\  |
   |               |                                         | le\| toma\|
   |               |                                         | Co\| tion\|
   |               |                                         | re\| Cont\|
   |               |                                         | の\| roll\|
   |               |                                         | 場\| erの\|
   |               |                                         | 合 | 場合 |
   +===============+=========================================+====+======+
   | result.txt    | Ansibleの実行結果を記録                 | 〇 |      |
   +---------------+-----------------------------------------+----+------+
   | xxx.pid       | Ansible-playbbokコ\                     | 〇 |      |
   |               | マンドのプロセスIDを記録するファイル。  |    |      |
   |               |                                         |    |      |
   |               | x\                                      |    |      |
   |               | xx:Ansible-playbbokコマンドのプロセスID |    |      |
   +---------------+-----------------------------------------+----+------+
   | error.log     | 作業実行時にITAがなにかしらのエラ\      | 〇 | 〇   |
   |               | ーによりエラーメッセージを出力した場合\ |    |      |
   |               | 、または、Ansible-playbbokコマンドがな\ |    |      |
   |               | にかとらのエラーによりエラーメッセージ\ |    |      |
   |               | を出力した場合のエラー出力先ファイル。  |    |      |
   |               |                                         |    |      |
   |               | 作業実行確\                             |    |      |
   |               | 認のエラーログに表示に表示される内容。  |    |      |
   +---------------+-----------------------------------------+----+------+
   | exec.log      | Ansible-playbbokが出力した\             | 〇 | 〇   |
   |               | 実行ログを一部加工したログファイル。作\ |    |      |
   |               | 業実行確認の実行ログに表示される内容。  |    |      |
   +---------------+-----------------------------------------+----+------+
   | exec.log.org  | Ansible-playbbokが出力した実行ログ      | 〇 | 〇   |
   +---------------+-----------------------------------------+----+------+
   | I\            | 分割された実行ログファイルです。        |    | 〇   |
   | ta_<mode名>\_ |                                         |    |      |
   | e\            | ファイル名の命名規則は :ref:`gen\       |    |      |
   | xecut\        | eral_operations_check_operation_sta\    |    |      |
   | ions_jobtpl\_\| tus` の⑥実行ログ表示を参照してくださ\   |    |      |
   | <\            | い。                                    |    |      |
   | 作業番号>_<\  |                                         |    |      |
   | グループ番号> |                                         |    |      |
   +---------------+-----------------------------------------+----+------+
   | forced.txt    | 緊急停止をした場合の記録ファイル        | 〇 |      |
   +---------------+-----------------------------------------+----+------+
   | user_files    | 実行したplaybook\                       | 〇 | 〇   |
   |               | でITA独自変数「__workflowdir__」\       |    |      |
   |               | になにかしらのファイル出力をした場\     |    |      |
   |               | 合のファイルが記録されるディレクトリ。  |    |      |
   +---------------+-----------------------------------------+----+------+


.. _general_operations_option_parameter_list:

オプションパラメータ一覧
------------------------

| インターフェース情報とMovement一覧のオプションパラメータについて説明します。
| ITAでは、以下の順番でansible-playbookのオプションパラメータを設定するので、単一の値しか許容していないパラメータを複数定義した場合、Movement一覧=>オプションパラメータのパラメータが有効になります。

- | Ansible共通=>インターフェース情報=>オプションパラメータ
- | Movement一覧=>オプションパラメータ

| ▼実行エンジンがAnsible Coreの場合
| 　　実行エンジンがAnsible Coreの場合、ansible-playbookコマンドのオプションパラメータを入力します。
| 　　ansible-playbookコマンドのオプションパラメータの仕様については、以下のコマンドを実行して表示されたヘルプを参照してください。

.. code-block:: none

   ansible-playbook -h

|
| ▼実行エンジンがAnsible Core以外の場合
| 　　以下の表は実行エンジンがAnsible Core以外の場合に、指定可能なオプションパラメータです。
|

.. table:: 実行エンジンがAnsible Core以外の場合に指定可能なオプションパラメータ一覧
   :align: Left

   +-------------+-------------------+-------------+---------------------+
   | **オ\       | **指定方法**      | **Ansible\  | **備考**            |
   | プションパ\ |                   | Automation\ |                     |
   | ラメータ**  |                   | C\          |                     |
   |             |                   | ontrollerの\|                     |
   |             |                   | 設定箇所**  |                     |
   +=============+===================+=============+=====================+
   | -v          | -v                | テ\         | ・vの合計値を適用   |
   |             |                   | ンプレート  |                     |
   | --verbose   | -vv               | 画面の[詳細 | ・--\               |
   |             |                   | ]に指定した | verboseは、-vと同様 |
   |             | -vvv              | vの数を設定 |                     |
   |             |                   |             | 例：--verbose \     |
   |             | -vvvv             |             | -vvv                |
   |             |                   |             | の場合、-vvvvと同様 |
   |             | -vvvvv            |             |                     |
   |             |                   |             | ・v\                |
   |             | --verbose         |             | を6以上指定した場合 |
   |             |                   |             | 、vは5の指定となる  |
   +-------------+-------------------+-------------+---------------------+
   | -f          | -f FORKS          | テンプレ\   | ・\                 |
   |             |                   | ートの[フォ\| FORKSには数値を指定 |
   | --forks     | --forks=FORKS     | ーク]に指定\|                     |
   |             |                   | したFORKSが\| ・複数定義した\     |
   |             |                   | 設定される  | 場合、最後に定義し\ |
   |             |                   |             | たパラメータが有効  |
   |             |                   |             |                     |
   |             |                   |             | 例：-f 1\           |
   |             |                   |             | -\                  |
   |             |                   |             | forks=10の場合、--f\|
   |             |                   |             | orks=10が有効となる |
   |             |                   |             |                     |
   |             |                   |             | ・数\               |
   |             |                   |             | 値以外が指定された\ |
   |             |                   |             | 場合、エラーとなる  |
   +-------------+-------------------+-------------+---------------------+
   | -l          | -l SUBSET         | テンプ\     | ・SUBSET:機器\      |
   |             |                   | レートの[制\| 一覧にあるホスト名  |
   | --limit     | --limit=SUBSET    | 限]に指定し\|                     |
   |             |                   | たSUBMITが\ | ・複数定義した\     |
   |             |                   | 設定される  | 場合、最後に定義し\ |
   |             |                   |             | たパラメータが有効  |
   +-------------+-------------------+-------------+---------------------+
   | -e          | -e EXTRA_VARS     | テン\       | ・EXTRA_VARS:\      |
   |             |                   | プレートの[\| 変数名、具体値をjso\|
   | -\          | --extr\           | 追加変数]に\| n形式またはyaml形式 |
   | -extra-vars | a-vars=EXTRA_VARS | 変数名:具体\|                     |
   |             |                   | 値の形式で\ | 例：\               |
   |             |                   | 設定される  | json形式\           |
   |             |                   |             | の場合              |
   |             |                   |             | -extra-var\         |
   |             |                   |             | s={"VAR_1":"directo\|
   |             |                   |             | ry","VAR_2":"0755"} |
   |             |                   |             |                     |
   |             |                   |             | yaml形式の場合      |
   |             |                   |             | -extra-vars=VAR_1:\ |
   |             |                   |             | directory\\nVAR_2:\ |
   |             |                   |             | 0755                |
   |             |                   |             |                     |
   |             |                   |             | ・複数定義した\     |
   |             |                   |             | 場合、最後に定義し\ |
   |             |                   |             | たパラメータが有効  |
   +-------------+-------------------+-------------+---------------------+
   | -t          | -t TAGS           | テンプレー\ | ・TAGS:タグ名       |
   |             |                   | トの[ジョブ\|                     |
   | --tags      | --tags=TAGS       | タグ]に設定\| ・複数個\           |
   |             |                   | したTAGSが\ | のパラメータを許容  |
   |             |                   | 設定される  |                     |
   +-------------+-------------------+-------------+---------------------+
   | -b          | -b                | テンプ\     | ・少\               |
   |             |                   | レートのオ\ | なくとも1つ指定すれ\|
   | --become    | --become          | プション[権\| ばパラメータが有効  |
   |             |                   | 限昇格の有\ |                     |
   |             |                   | 効化]がチェ\|                     |
   |             |                   | ックされる  |                     |
   +-------------+-------------------+-------------+---------------------+
   | -D          | -D                | テンプレ\   | ・少\               |
   |             |                   | ートの[変更\| なくとも1つ指定すれ\|
   | --diff      | --diff            | ]の表示が有\| ばパラメータが有効  |
   |             |                   | 効化される  |                     |
   +-------------+-------------------+-------------+---------------------+
   | --skip-tags | --sk\             | テンプ\     | ・SKIP_T\           |
   |             | ip-tags=SKIP_TAGS | レートの[ス\| AGS:スキップタグ名  |
   |             |                   | キップタグ\ |                     |
   |             |                   | ]に設定した\| ・複数個\           |
   |             |                   | SKIP_TAGSが\| のパラメータを許容  |
   |             |                   | 設定される  |                     |
   +-------------+-------------------+-------------+---------------------+
   | --st        | --start-at-t\     | ※Ansible \  | ・複数定義した\     |
   | art-at-task | ask=START_AT_TASK | Automation \| 場合、最後に定義し\ |
   |             |                   | Cont\       | たパラメータが有効  |
   |             |                   | rollerのWeb\|                     |
   |             |                   | UI には\    |                     |
   |             |                   | --st\       |                     |
   |             |                   | art-at-task\|                     |
   |             |                   | の表\       |                     |
   |             |                   | 示はない。  |                     |
   +-------------+-------------------+-------------+---------------------+
   | -ufc        | -ufc              | テンプ\     | ・少\               |
   |             |                   | レートのオ\ | なくとも1つ指定すれ\|
   | --use       | --use_fact_cache  | プション[フ\| ばパラメータが有効  |
   | _fact_cache |                   | ァクトキャ\ |                     |
   |             |                   | ッシュの有\ |                     |
   |             |                   | 効化]がチェ\|                     |
   |             |                   | ックされる  |                     |
   +-------------+-------------------+-------------+---------------------+
   | -as         | -as               | テ\         | ・少\               |
   |             |                   | ンプレート\ | なくとも1つ指定すれ\|
   | --allow_s\  | --a\              | のオプショ\ | ばパラメータが有効  |
   | imultaneous | llow_simultaneous | ン[同時実行\|                     |
   |             |                   | ジョブの有\ |                     |
   |             |                   | 効化]がチェ\|                     |
   |             |                   | ックされる  |                     |
   +-------------+-------------------+-------------+---------------------+
   | -jsc        | -jsc\             | テンプレ\   | ・ジョブスライ\     |
   |             | ジョブスライス数  | ートの[ジョ\| ス数には数値を指定  |
   | --job\      |                   | ブスライス\ |                     |
   | slice_count | --job_slice_count\| 数]に指定し\| ・複数定義した\     |
   |             | =ジョブスライス数 | たジョブス\ | 場合、最後に定義し\ |
   |             |                   | ライス数が\ | たパラメータが有効  |
   |             |                   | 設定される  |                     |
   +-------------+-------------------+-------------+---------------------+


| ※Ansible Automation Controllerのオプションパラメータの仕様については、Ansible Automation Controllerユーザーガイドのジョブテンプレートの説明を参照してください。


Ansible Automation ControllerでITA独自変数を利用する場合の留意事項
--------------------------------------------------------------------------------------------------------------------

| 下記ITA独自変数を利用してファイル出力をするPlyabookを含むMovementをクラスタ構成のAnsible Automation Controllerで作業実行した場合の留意事項について記載します。
|
| 　対象のITA独自変数
| 　・ __workflowdir_\_
| 　・ __conductor_workflowdir_\_
| 　・ __movement_status_filepath_\_
| 　・ __parameters_dir_for_epc_\_
| 　・ __parameters_file_dir_for_epc_\_
| 　・ __parameter_dir_\_
| 　・ __parameters_file_dir_\_
|

ITA独自変数を利用して作成したファイルの取り扱い 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

| ITA独自変数を利用して作成したファイルの出力先ディレクトリパスはAnsible Automation ControllerのITA作業用ディレクトリ配下「/var/lib/exastro」に設定されます。Movement実行前に結果データをAnsible Automation Controller（各実行ノード）のITA作業用ディレクトリ配下「/var/lib/exastro」にファイル転送します。Movement実行でここに作成されたファイルは、Movement実行後に各Ansible Automation Controller（各実行ノード）より結果データに上書きモードでファイル転送します。同一ファイル名でファイルを作成している場合、更新したファイルが結果データに正しく反映されない場合があります。

.. figure:: /images/ja/ansible_common/template_management/original_hensu.png
   :width: 7.49606in
   :height: 5.84593in
   :align: center

#. | Movementをconductorから実行している場合、Movement実行前に該当conductorインスタンス配下のファイルをAnsible Automation Controller（各実行ノード）のITA作業用ディレクトリ配下にファイル転送
#. | Movement実行前に該当Movement配下のファイルをAnsible Automation Controller（各実行ノード）のITA作業用ディレクトリにファイル転送
#. | Movementをconductorから実行している場合、Movement実行後にAnsible Automation Controller（各実行ノード）のITA作業用ディレクトリの該当Movementで作成したファイルを結果データにファイル転送
#. | Movement実行後にAnsible Automation Controller（各実行ノード）のITA作業用ディレクトリの該当conductorインスタンス配下に作成したファイルを結果データにファイル転送

..
    #. | Movementをsymphony/conductorから実行している場合、Movement実行前に該当symphony/conductorインスタンス配下のファイルをAnsible Automation ControllerのITA作業用ディレクトリ配下にファイル転送
    #. | Movement実行前に該当Movement配下のファイルをAnsible Automation ControllerのITA作業用ディレクトリにファイル転送
    #. | Movementをsymphony/conductorから実行している場合、Movement実行後にAnsible Automation ControllerのITA作業用ディレクトリの該当Movementで作成したファイルを結果データにファイル転送
    #. | Movement実行後にAnsible Automation ControllerのITA作業用ディレクトリの該当symphony/conductorインスタンス配下に作成したファイルを結果データにファイル転送



留意事項
~~~~~~~~~~

#. | ファイル名はansible「__loginhostname__」を含めるなどして、Movementに紐づいているターゲットホスト毎に同一ファイル名に出力しないように工夫してください。
#. | conductorから実行する場合、複数のMovementで同一ファイル名への出力しないよう工夫してください。


..
   #. | symphony/conductorから実行する場合、複数のMovementで同一ファイル名への出力しないよう工夫してください。


.. _general_operations_data_resources_deleted_when_executing:

実行時データ削除で削除されるデータリソース 
-------------------------------------------
| インターフェース情報の実行時データ削除で「削除する」を選択した場合に、削除されるデータリソースを以下に列挙します。

.. table:: 実行時データ削除で削除されるデータリソース一覧(Ansible Automation Controller側)
   :align: Left

   +----------------------------------------------------------------+-----------------------+-------------------------------+-----------------------------------------------+
   | データリソース                                                 | リソースタイプ        | 実行エンジン                  | 備考                                          |
   |                                                                |                       +-------------------------------+                                               |
   |                                                                |                       | Ansible Automation Controller |                                               |
   |                                                                |                       |                               |                                               |
   +================================================================+=======================+===============================+===============================================+
   | ITA作業用ディレクトリ                                          | ディレクトリ          | 〇                            |                                               |
   |                                                                |                       |                               |                                               |
   | /var/lib/exastro/ita_<区分>_executions_10桁の作業番号          |                       |                               |                                               |
   |                                                                |                       |                               |                                               |
   +----------------------------------------------------------------+-----------------------+-------------------------------+-----------------------------------------------+
   | SCM管理ディレクトリ                                            | ディレクトリ          | ※                             | ※プロジェクトリソースの削除により削除される   |
   |                                                                |                       |                               |                                               |
   | /var/lib/awx/projects/ita_<区分>_executions_作業番号           |                       |                               |                                               |
   |                                                                |                       |                               |                                               |
   +----------------------------------------------------------------+-----------------------+-------------------------------+-----------------------------------------------+
   | インベントリ　                                                 | リソース              | 〇                            |                                               |
   |                                                                |                       |                               |                                               |
   | リソース名: ita_<区分>_executions_inventory_作業番号_通番      |                       |                               |                                               |
   |                                                                |                       |                               |                                               |
   +----------------------------------------------------------------+-----------------------+-------------------------------+-----------------------------------------------+
   | 認証情報                                                       | リソース              | 〇                            |                                               |
   |                                                                |                       |                               |                                               |
   | リソース名: ita_<区分>_executions_credential_作業番号_通番     |                       |                               |                                               |
   |                                                                |                       |                               |                                               |
   | 　　　　　　ita_<区分>_executions_vault_credential_作業番号    |                       |                               |                                               |
   |                                                                |                       |                               |                                               |
   | 　　　　　　ita_<区分>_executions_git_credential_作業番号      |                       |                               |                                               |
   |                                                                |                       |                               |                                               |
   +----------------------------------------------------------------+-----------------------+-------------------------------+-----------------------------------------------+
   | プロジェクト                                                   | リソース              | 〇                            |                                               |
   |                                                                |                       |                               |                                               |
   | リソース名: ita_<区分>_executions_project_作業番号             |                       |                               |                                               |
   |                                                                |                       |                               |                                               |
   +----------------------------------------------------------------+-----------------------+-------------------------------+-----------------------------------------------+
   | ジョブテンプレート                                             | リソース              | 〇                            |                                               |
   |                                                                |                       |                               |                                               |
   | リソース名: ita_<区分>_executions_jobtpl_作業番号_通番         |                       |                               |                                               |
   |                                                                |                       |                               |                                               |
   +----------------------------------------------------------------+-----------------------+-------------------------------+-----------------------------------------------+
   | ワークフロージョブテンプレート                                 | リソース              | 〇                            |                                               |
   |                                                                |                       |                               |                                               |
   | リソース名: ita_<区分>_executions_workflowtpl_作業番号         |                       |                               |                                               |
   |                                                                |                       |                               |                                               |
   +----------------------------------------------------------------+-----------------------+-------------------------------+-----------------------------------------------+
   | ジョブ                                                         | リソース              | 〇                            |                                               |
   |                                                                |                       |                               |                                               |
   | リソース名: Job番号—ita_<区分>_executions_workflowtpl_作業番号 |                       |                               |                                               |
   |                                                                |                       |                               |                                               |
   | 　　　　　　Job番号—ita_<区分>_executions_jobtpl_作業番号      |                       |                               |                                               |
   +----------------------------------------------------------------+-----------------------+-------------------------------+-----------------------------------------------+
   

.. table:: 実行時データ削除で削除されるデータリソース一覧(ITA側)  
   :align: Left
   
   +-----------------------------------------------------------------------+-----------------------+-------------------------------+-----------------------------------------------+
   | データリソース                                                        | リソースタイプ        | 実行エンジン                  | 備考                                          |
   |                                                                       |                       +-------------------------------+                                               |
   |                                                                       |                       | Ansible Automation Controller |                                               |
   |                                                                       |                       |                               |                                               |
   +=======================================================================+=======================+===============================+===============================================+
   | Git リポジトリ                                                        | Gitリポジトリ         | 〇                            | ディレクトリごと削除                          |
   |                                                                       |                       |                               |                                               |
   | ワークスペース共有パス/driver/ansible/git_repositories/<区分>_作業番号|                       |                               |                                               |
   |                                                                       |                       |                               |                                               |
   +-----------------------------------------------------------------------+-----------------------+-------------------------------+-----------------------------------------------+






