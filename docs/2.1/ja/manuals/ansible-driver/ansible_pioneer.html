
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <title>Ansible-Pioneer &#8212; Documentation  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/option.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/exastro_documents.css?v=3" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/swagger/swagger-ui.css" />
    
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/translations.js"></script>
    <script src="../../../../_static/jquery-3.6.3.min.js"></script>
    <script src="../../../../_static/exastro_documents.js?v=1"></script>
    <script src="../../../../_static/swagger/swagger-ui-bundle.js"></script>
    <script src="../../../../_static/swagger/swagger-ui-standalone-preset.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../../../../genindex.html" />
    <link rel="search" title="検索" href="../../../../search.html" /> 
  </head>
<body id="page" class="ja">


<div id="container">

<div id="header">
  <header class="divInner">
    <!-- Exastro logo -->
    <div id="logo"><a href="https://ita.exastro.org/"><img src="../../../../_static/img/exastro.svg" alt="Exastro"></a></div>
    <!-- Project name -->
    <div id="projectName"><a href="../../../../index.html">Documentation</a></div>
    <!-- Heaedr navigation -->
    <div id="headerSearch">
      <form class="search" action="../../../../search.html" method="get">
        <input type="text" name="q" aria-labelledby="searchlabel">
        <button type="submit" value="検索"><img src="../../../../_static/img/search.png" alt="検索"></button>
      </form>
    </div>
  </header>
</div><!-- End #header -->


<div id="toolbar">
  <div class="divInner">
    
    <div id="documentVersion">
      <dl>
        <dt>Document version</dt>
        <dd>
          <div>
            <select name="version" onchange="location.href=value;">
                file_path: 2.0/ja/manuals/ansible-driver/ansible_pioneer
                file_path: 2.0/ja/manuals/ansible-driver/ansible_pioneer
                file_path: 2.1/ja/manuals/ansible-driver/ansible_pioneer
                  <option value="#"
                  selected
                  >2.1 (beta)</option>
            </select>
          </div>
        </dd>
      </dl>
    </div>

    <div id="documentLanguage">
      <dl>
        <dt>Language</dt>
        <dd>
          <div>
            <select name="lang" onchange="location.href=value;">
                file_path: 2.1/ja/manuals/ansible-driver/ansible_pioneer
                hasdoc: True
                  <option value="#"
                  selected
                  >日本語</option>
                file_path: 2.1/en/manuals/ansible-driver/ansible_pioneer
                hasdoc: False
            </select>
          </div>
        </dd>
      </dl>
    </div>
    <div id="toolbarNavigation">
      <ul>
      </ul>
    </div>
  </div>
</div><!-- End #toolbar -->

<div id="sideMenu">

  <div id="menuButton"></div>
  
  <aside class="divInner">
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../2.0/index.html">Exastro IT Automation Documentation 2.0</a></li>
</ul>

    <!-- <ul>
      <li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">索引</a></li>
    </ul> -->
    
  </aside>
</div><!-- End #sideMenu -->


<div id="tableOfContents">
  <div id="tocButton"></div>
  <ul>
<li><a class="reference internal" href="#">Ansible-Pioneer</a><ul>
<li><a class="reference internal" href="#id1">はじめに</a></li>
<li><a class="reference internal" href="#ansible-driver">Ansible driver概要</a><ul>
<li><a class="reference internal" href="#ansible-core">Ansible Coreについて</a></li>
<li><a class="reference internal" href="#ansible-automation-controller">Ansible Automation Controllerについて</a></li>
<li><a class="reference internal" href="#id2">Ansible driverについて</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ansible-pioneer-variable-handling-in-ansible-driver">Ansible driverでの変数取り扱い</a><ul>
<li><a class="reference internal" href="#id4">変数の種類</a></li>
<li><a class="reference internal" href="#id5">通常変数</a><ul>
<li><a class="reference internal" href="#id6">概要</a></li>
<li><a class="reference internal" href="#playbook">playbookにおける表記</a><ul>
<li><a class="reference internal" href="#id7">書式</a></li>
<li><a class="reference internal" href="#id8">正しい記述例</a></li>
<li><a class="reference internal" href="#wrong-description-example">誤った記述例</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id10">複数具体値変数</a><ul>
<li><a class="reference internal" href="#id11">概要</a></li>
<li><a class="reference internal" href="#id12">playbookにおける表記</a><ul>
<li><a class="reference internal" href="#id13">書式</a></li>
<li><a class="reference internal" href="#id14">正しい記述例</a></li>
<li><a class="reference internal" href="#id15">誤った記述例</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id16">グローバル変数</a><ul>
<li><a class="reference internal" href="#id17">概要</a></li>
<li><a class="reference internal" href="#id18">playbookにおける表記</a><ul>
<li><a class="reference internal" href="#id19">書式</a></li>
<li><a class="reference internal" href="#id20">正しい記述例</a></li>
<li><a class="reference internal" href="#id21">誤った記述例</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id22">テンプレート埋込変数</a><ul>
<li><a class="reference internal" href="#id23">概要</a></li>
<li><a class="reference internal" href="#id24">playbookにおける表記</a><ul>
<li><a class="reference internal" href="#id25">書式</a></li>
<li><a class="reference internal" href="#id26">正しい記述例</a></li>
<li><a class="reference internal" href="#id27">誤った記述例</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id28">ファイル埋込変数</a><ul>
<li><a class="reference internal" href="#id29">概要</a></li>
<li><a class="reference internal" href="#id30">playbookにおける表記</a><ul>
<li><a class="reference internal" href="#id31">書式</a></li>
<li><a class="reference internal" href="#id32">正しい記述例</a></li>
<li><a class="reference internal" href="#id33">誤った記述例</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#ita">ITA独自変数</a><ul>
<li><a class="reference internal" href="#id34">概要</a></li>
<li><a class="reference internal" href="#id35">機器一覧</a></li>
<li><a class="reference internal" href="#id36">オペレーション</a></li>
<li><a class="reference internal" href="#id37">データ連携</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id38">変数の抜出および具体値登録</a></li>
<li><a class="reference internal" href="#id39">代入値登録による変数の扱い</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id40">Ansible driver コンソールメニュー構成</a><ul>
<li><a class="reference internal" href="#id41">メニュー/画面一覧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id42">Ansible driver利用手順</a></li>
<li><a class="reference internal" href="#id43">Ansible driver機能・操作方法説明</a><ul>
<li><a class="reference internal" href="#id44">基本コンソール</a><ul>
<li><a class="reference internal" href="#id45">オペレーション一覧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ansible">Ansible共通コンソール</a><ul>
<li><a class="reference internal" href="#ansible-pioneer-device-list">機器一覧</a></li>
<li><a class="reference internal" href="#ansible-pioneer-interface-information">インターフェース情報</a></li>
<li><a class="reference internal" href="#ansible-pioneer-ansible-automation-controlller-hosts">Ansible Automation Controller ホスト一覧</a></li>
<li><a class="reference internal" href="#ansible-pioneer-global-variable-list">グローバル変数管理</a></li>
<li><a class="reference internal" href="#ansible-pioneer-file-list">ファイル管理</a></li>
<li><a class="reference internal" href="#ansible-pioneer-template-list">テンプレート管理</a></li>
<li><a class="reference internal" href="#ansible-pioneer-unmanaged-var-list">管理対象外変数リスト</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id53">Ansible-Pioneerコンソール</a><ul>
<li><a class="reference internal" href="#os">OS種別マスタ</a></li>
<li><a class="reference internal" href="#movement">Movement一覧</a></li>
<li><a class="reference internal" href="#ansible-pioneer-dialog-type-list-ansible-pioneer-only">対話種別リスト</a></li>
<li><a class="reference internal" href="#ansible-pioneer-dialog-files-ansible-pioneer-only">対話ファイル素材集</a></li>
<li><a class="reference internal" href="#ansible-pioneer-movement-details">Movement-対話種別紐付</a></li>
<li><a class="reference internal" href="#ansible-pioneer-substitution-value-auto-registration-setting">代入値自動登録設定</a></li>
<li><a class="reference internal" href="#ansible-pioneer-execution">作業実行</a></li>
<li><a class="reference internal" href="#ansible-pioneer-check-operation-status">作業状態確認</a></li>
<li><a class="reference internal" href="#ansible-pioneer-execution-list">作業管理</a></li>
<li><a class="reference internal" href="#ansible-pioneer-target-host">作業対象ホスト</a></li>
<li><a class="reference internal" href="#ansible-pioneer-substitution-value-list">代入値管理</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id63">構築コード記述方法</a><ul>
<li><a class="reference internal" href="#ansible-pioneer-write-dialog-file-ansible-pioneer">対話ファイル（Ansible-Pioneer）の記述</a><ul>
<li><a class="reference internal" href="#id65">対話ファイルの構成</a></li>
<li><a class="reference internal" href="#id66">対話コマンド</a><ul>
<li><a class="reference internal" href="#expect">①expectモジュール</a></li>
<li><a class="reference internal" href="#exec">②execモジュール</a></li>
<li><a class="reference internal" href="#state">③stateモジュール</a></li>
<li><a class="reference internal" href="#command">④commandモジュール</a></li>
<li><a class="reference internal" href="#localaction">⑤localactionモジュール</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id67">正規表記</a></li>
<li><a class="reference internal" href="#id68">複数具体値変数使用時の注意事項</a></li>
<li><a class="reference internal" href="#id69">コマンドプロンプト以外のプロンプトを処理する場合の注意事項</a></li>
<li><a class="reference internal" href="#id70">対話ファイル終了時の注意事項</a></li>
<li><a class="reference internal" href="#yaml">対話ファイルをyaml形式で記載する際の注意事項</a></li>
<li><a class="reference internal" href="#lang">構築対象機器のログインユーザーのLANGについての注意事項</a></li>
<li><a class="reference internal" href="#id71">構築対象機器へ投入するコマンドの終端コードについての注意事項</a></li>
</ul>
</li>
<li><a class="reference internal" href="#backyard">BackYardコンテンツ</a><ul>
<li><a class="reference internal" href="#id72">変数自動登録</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id73">付録</a><ul>
<li><a class="reference internal" href="#ansibleita">Ansible実行時に使用される投入データとITAメニューの紐づけ</a><ul>
<li><a class="reference internal" href="#id74">Ansible-Pioneer投入データ</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id75">Ansible実行時に作成される結果データ</a><ul>
<li><a class="reference internal" href="#id76">Ansible-Pioneer結果データに保存されるファイル一覧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ansible-pioneer-option-parameter-list">オプションパラメータ一覧</a></li>
<li><a class="reference internal" href="#ansible-automation-controllerita">Ansible Automation ControllerでITA独自変数を利用する場合の留意事項</a><ul>
<li><a class="reference internal" href="#id78">ITA独自変数を利用して作成したファイルの取り扱い</a></li>
<li><a class="reference internal" href="#id79">留意事項</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ansible-pioneer-data-resources-deleted-when-executing">実行時データ削除で削除されるデータリソース</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>


<div id="contents">
<main class="divInner">

 <div id="breadcrumbs">
  <ul>
    <li><a href="../../../../index.html">HOME</a></li>
    
    <li>Ansible-Pioneer</li>
  </ul>
</div>

<div id="article">
<article class="divInner">
<div class="body" role="main">

  <section id="ansible-pioneer">
<h1>Ansible-Pioneer<a class="headerlink" href="#ansible-pioneer" title="この見出しへのパーマリンク">¶</a></h1>
<section id="id1">
<h2>はじめに<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本書では、ITAの機能および操作方法について説明します。</div>
</div>
</section>
<section id="ansible-driver">
<h2>Ansible driver概要<a class="headerlink" href="#ansible-driver" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本章ではAnsible、Ansible Automation ControllerおよびAnsible driverについて説明します。</div>
</div>
<section id="ansible-core">
<h3>Ansible Coreについて<a class="headerlink" href="#ansible-core" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible Coreとは、多数の構築管理対象に対して、アプリーケーション/システムのデプロイ作業を容易にするPF構築自動化ツールです。</div>
<div class="line">Ansible Coreは、PlaybookというYAML形式のテキストファイルに定型処理をタスクとして記述し、それをAnsible Coreに実行させることにより、さまざまな処理を実現できます。</div>
<div class="line">タスクはモジュールと呼ばれる処理プログラムと紐付いており、さまざまな機器に対する制御を行うことができます。</div>
<div class="line">Ansible Coreの詳細情報については、Ansible Coreのマニュアルを参照してください。</div>
</div>
</section>
<section id="ansible-automation-controller">
<h3>Ansible Automation Controllerについて<a class="headerlink" href="#ansible-automation-controller" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible Automation Controllerとは、PF構築自動化ツールであるAnsibleにアクセスコントロール、ジョブスケジューリング、タスクの可視化などの機能を拡張した管理プラットフォームです。</div>
<div class="line">“プロジェクト”、”インベントリ”、”認証情報”の組合せで”ジョブテンプレート”を作成しAnsibleを実行できます。</div>
<div class="line">複数の“ジョブテンプレート”を組み合せて”ワークフロージョブテンプレート”を作成することによって、より多彩な作業フローを表現することができます。</div>
<div class="line">Ansible Automation Controllerの詳細情報については、Ansible Automation Controllerのマニュアルを参照してください。</div>
<div class="line">ITAで対応可能なAnsible Automation Controllerのバージョンは、 <span class="xref std std-doc">../../configuration/ansible/ansible_automation_platform</span> を参照してください。</div>
<div class="line">最新のバージョンに対応した記法は使えないことがありますので、ご注意ください。</div>
</div>
</section>
<section id="id2">
<h3>Ansible driverについて<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible driverは、ITAシステムのオプションとして機能し、ITAシステムで登録した構築対象のサーバ・ストレージ・ネットワーク各機器に対し、Ansible Core、Ansible Automation Controllerのどちらを経由するかを選択し、実際の運用設定を自動的に行います。</div>
</div>
<a class="reference internal image-reference" href="../../../../_images/overview.png"><img alt="Exastro概要" src="../../../../_images/overview.png" style="width: 6.68819in; height: 3.35972in;" /></a>
<div class="line-block">
<div class="line">Ansible driverには用途に応じて以下3つのモードを用意しています。本書ではそのうちPioneer モードについて説明します。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>Legacy モード</strong></div>
<div class="line">Ansible標準の機能を用いて各種ホストへ設定を投入します。</div>
<div class="line">構築コードを単体YAMLファイルとして登録し、作業パターンをその組み合わせで構成します。</div>
<div class="line">OS,NWの環境設定などの作業用に使われることを想定します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>Legacy Role モード</strong></div>
<div class="line">Legacyモードと同じく、Ansible標準の機能を用いて各種ホストへ設定を投入します。</div>
<div class="line">構築コードをパッケージとして登録し、作業パターンをRoleの組み合わせで構成します。</div>
<div class="line">製品部門などが提供するRoleパッケージを用いて、製品のインストール、環境構築などを行う際に使われることを想定します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>Pioneer モード</strong></div>
<div class="line">Ansibleに独自モジュールを追加し、対話形式による設定投入を可能とします。</div>
<div class="line">サーバ、ストレージ、ネットワークを問わず、Telnet, SSH でログイン可能なあらゆる機器に対応しています。対象機器と直接やり取りが必要となるため、相応のＩＴスキルが必要となります。</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">また、Ansible driverは、Playbook中の変数を画面から設定することができます。詳細は本書「 <a class="reference internal" href="ansible_legacyrole.html#ansible-legacyrole-variable-handling-in-ansible-driver"><span class="std std-ref">Ansible driverでの変数取り扱い</span></a> 」を参照してください。</div>
</div>
</section>
</section>
<section id="ansible-pioneer-variable-handling-in-ansible-driver">
<span id="id3"></span><h2>Ansible driverでの変数取り扱い<a class="headerlink" href="#ansible-pioneer-variable-handling-in-ansible-driver" title="この見出しへのパーマリンク">¶</a></h2>
<section id="id4">
<h3>変数の種類<a class="headerlink" href="#id4" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible driverでは、Playbook中の変数の具体値をITAの設定画面から設定することができます。</div>
<div class="line"><strong>※設定方法の詳細は、本書「</strong> <a class="reference internal" href="#ansible-pioneer-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> <strong>」を参照してください。</strong></div>
<div class="line">Playbook中の変数で、ITAの変数として扱える変数は以下の6種類があります。</div>
</div>
</section>
<section id="id5">
<h3>通常変数<a class="headerlink" href="#id5" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id6">
<h4>概要<a class="headerlink" href="#id6" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">変数名に対して具体値を1つ定義できる変数です。</div>
</div>
</section>
<section id="playbook">
<h4>playbookにおける表記<a class="headerlink" href="#playbook" title="この見出しへのパーマリンク">¶</a></h4>
<section id="id7">
<h5>書式<a class="headerlink" href="#id7" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">変数を使用する際、playbook内の変数を以下とする。</div>
<div class="line">※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">VAR_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
<span class="c1">#xxx: 半角英数字とアンダースコア（ _ ）</span>
</pre></div>
</div>
</section>
<section id="id8">
<h5>正しい記述例<a class="headerlink" href="#id8" title="この見出しへのパーマリンク">¶</a></h5>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_users</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ファイル内容確認</span>
<span class="w">  </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ VAR_SAMPLE }}</span>
</pre></div>
</div>
</section>
<section id="wrong-description-example">
<span id="id9"></span><h5>誤った記述例<a class="headerlink" href="#wrong-description-example" title="この見出しへのパーマリンク">¶</a></h5>
<ul>
<li><div class="line-block">
<div class="line">&quot;{{&quot;または&quot;}}&quot; と変数名の間に「半角スペース」がない</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{VAR_SAMPLE }}</span>
<span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ VAR_SAMPLE}}</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">&quot;{{&quot;または&quot;}}&quot; と変数名の間の「半角スペース」が2個以上ある</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{  VAR_SAMPLE }}</span>
<span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ VAR_SAMPLE  }}</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">変数名が129文字以上ある</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">ルールに準拠しない記述をした場合、<span class="menuselection">代入値自動登録</span> 機能に下記の影響を及ぼします。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">登録の場合</div>
<div class="line">Movementを選択しても変数名に候補として表示しません。</div>
<div class="line">作業実行時に変数未定義のエラーとなります。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">更新の場合 (代入値管理登録後にITA追加ルール外の記載のplaybookに更新した場合)</div>
<div class="line">変数名に「ID変換失敗(n)」(※nは登録時の管理番号)と表示します。</div>
<div class="line">作業実行時に変数未定義のエラーとなります。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">エラーの例(実行ログ)</div>
<div class="line"><strong class="command">&quot;msg&quot;: &quot;The task includes an option with an undefined variable. The error was: 'VAR_PAUSE_time' is undefined</strong></div>
</div>
</li>
</ul>
</section>
</section>
</section>
<section id="id10">
<h3>複数具体値変数<a class="headerlink" href="#id10" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id11">
<h4>概要<a class="headerlink" href="#id11" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">変数名に対して具体値を複数定義できる変数です。</div>
</div>
</section>
<section id="id12">
<h4>playbookにおける表記<a class="headerlink" href="#id12" title="この見出しへのパーマリンク">¶</a></h4>
<section id="id13">
<h5>書式<a class="headerlink" href="#id13" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">変数を使用する際、playbook内の変数を以下とする。</div>
<div class="line">※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">VAR_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
<span class="c1">#xxx: 半角英数字とアンダースコア（ _ ）</span>
</pre></div>
</div>
</section>
<section id="id14">
<h5>正しい記述例<a class="headerlink" href="#id14" title="この見出しへのパーマリンク">¶</a></h5>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_users</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
</pre></div>
</div>
</section>
<section id="id15">
<h5>誤った記述例<a class="headerlink" href="#id15" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">通常変数の <a class="reference internal" href="#wrong-description-example"><span class="std std-ref">誤った記述例</span></a> を参照してください。</div>
</div>
</section>
</section>
</section>
<section id="id16">
<h3>グローバル変数<a class="headerlink" href="#id16" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id17">
<h4>概要<a class="headerlink" href="#id17" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line"><span class="menuselection">グローバル変数</span> メニューから登録された変数です。</div>
<div class="line">ITAWebUI上のグローバル変数管理メニューでグローバル変数を登録する際、</div>
<div class="line">グローバル変数名の接頭文字をGBL_とし、GBL_を含め255Byte以内とする。</div>
</div>
</section>
<section id="id18">
<h4>playbookにおける表記<a class="headerlink" href="#id18" title="この見出しへのパーマリンク">¶</a></h4>
<section id="id19">
<h5>書式<a class="headerlink" href="#id19" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">変数を使用する際、playbook内の変数を以下とする。</div>
<div class="line">※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">GBL_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
<span class="c1">#xxx: 半角英数字とアンダースコア（ _ ）</span>
</pre></div>
</div>
</section>
<section id="id20">
<h5>正しい記述例<a class="headerlink" href="#id20" title="この見出しへのパーマリンク">¶</a></h5>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ファイル内容確認</span>
<span class="w">  </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ GBL_SAMPLE }}</span>
</pre></div>
</div>
</section>
<section id="id21">
<h5>誤った記述例<a class="headerlink" href="#id21" title="この見出しへのパーマリンク">¶</a></h5>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(GBL_)が小文字になっている</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ gbl_SAMPLE }}</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(GBL_)の「_」がない</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /tmp/{{ GBLSAMPLE }}</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">変数名が129文字以上ある</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">ルールに準拠しない記述をした場合、<span class="menuselection">グローバル変数管理</span> 機能に下記の影響を及ぼします。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">作業実行時にグローバル変数の置換が行われないためエラーとなります。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">エラーの例(実行ログ)</div>
<div class="line"><strong class="command">&quot;msg&quot;: &quot;'gbl_wait_for_delay' is undefined&quot;</strong></div>
</div>
</li>
</ul>
</section>
</section>
</section>
<section id="id22">
<h3>テンプレート埋込変数<a class="headerlink" href="#id22" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id23">
<h4>概要<a class="headerlink" href="#id23" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line"><span class="menuselection">テンプレート管理</span> メニューから登録された変数です。</div>
<div class="line">ITAWebUI上のテンプレート管理メニューでテンプレート素材を登録をする際、</div>
<div class="line">テンプレート埋込変数名の接頭文字をTPF_とし、TPF_を含め255Byte以内とする。</div>
</div>
</section>
<section id="id24">
<h4>playbookにおける表記<a class="headerlink" href="#id24" title="この見出しへのパーマリンク">¶</a></h4>
<section id="id25">
<h5>書式<a class="headerlink" href="#id25" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">変数を使用する際、playbook内の変数を以下とする。</div>
<div class="line">※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">TPF_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
<span class="c1">#xxx: 半角英数字とアンダースコア（ _ ）</span>
</pre></div>
</div>
</section>
<section id="id26">
<h5>正しい記述例<a class="headerlink" href="#id26" title="この見出しへのパーマリンク">¶</a></h5>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ファイル内容確認</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ TPF_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
</section>
<section id="id27">
<h5>誤った記述例<a class="headerlink" href="#id27" title="この見出しへのパーマリンク">¶</a></h5>
<ul>
<li><div class="line-block">
<div class="line">&quot;{{&quot;または&quot;}}&quot; と変数名の間に「半角スペース」がない</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{TPF_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
<span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ TPF_SAMPLE}} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">&quot;{{&quot;または&quot;}}&quot; と変数名の間の「半角スペース」が2個以上ある</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{   TPF_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(TPF_)が小文字になっている</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ tpf_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(TPF_)の「_」がない</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ TPFSAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">変数名が129文字以上ある</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">ルールに準拠しない記述をした場合、<span class="menuselection">テンプレート管理</span> 機能に下記の影響を及ぼします。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">登録したテンプレート素材への置換が行われません。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">エラーの例(実行ログ)</div>
<div class="line"><strong class="command">&quot;msg&quot;: &quot;'TPFSAMPLE' is undefined&quot;</strong></div>
</div>
</li>
</ul>
</section>
</section>
</section>
<section id="id28">
<h3>ファイル埋込変数<a class="headerlink" href="#id28" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id29">
<h4>概要<a class="headerlink" href="#id29" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line"><span class="menuselection">ファイル管理</span> メニューから登録された変数です。</div>
<div class="line">ITAWebUI上のファイル管理メニューでファイル埋込変数を登録する際、ファイル埋込変数名の接頭文字をCPF_とし、CPF_を含め255Byte以内とする。</div>
</div>
</section>
<section id="id30">
<h4>playbookにおける表記<a class="headerlink" href="#id30" title="この見出しへのパーマリンク">¶</a></h4>
<section id="id31">
<h5>書式<a class="headerlink" href="#id31" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">変数を使用する際、playbook内の変数を以下とする。</div>
<div class="line">※ユーザ定義範囲の記載ルールはAnsibleルールに準ずる</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">CPF_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
<span class="c1">#xxx: 半角英数字とアンダースコア（ _ ）</span>
</pre></div>
</div>
</section>
<section id="id32">
<h5>正しい記述例<a class="headerlink" href="#id32" title="この見出しへのパーマリンク">¶</a></h5>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ファイル内容確認</span>
<span class="w">  </span><span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ CPF_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
</section>
<section id="id33">
<h5>誤った記述例<a class="headerlink" href="#id33" title="この見出しへのパーマリンク">¶</a></h5>
<ul>
<li><div class="line-block">
<div class="line">&quot;{{&quot;または&quot;}}&quot; と変数名の間に「半角スペース」がない</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{CPF_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
<span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ CPF_SAMPLE}} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">&quot;{{&quot;または&quot;}}&quot; と変数名の間の「半角スペース」が2個以上ある</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{   CPF_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(CPF_)が小文字になっている</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ cpf_SAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">接頭文字(CPF_)の「_」がない</div>
</div>
</li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ CPFSAMPLE }} dest=/tmp/SAMPLE.txt</span>
</pre></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">変数名が129文字以上ある</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">ルールに準拠しない記述をした場合、<span class="menuselection">ファイル管理</span> 機能に下記の影響を及ぼします。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">作業実行時にファイル埋込変数の置換が行われないためエラーとなります。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">エラーの例(実行ログ)</div>
<div class="line"><strong class="command">Template embedded variable is not registered in the template list. (Role:roles/echo PlayBook:roles/echo/tasks/main.yml line:3 Template embedded variable:TPF_aa)</strong></div>
</div>
</li>
</ul>
</section>
</section>
</section>
<section id="ita">
<h3>ITA独自変数<a class="headerlink" href="#ita" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id34">
<h4>概要<a class="headerlink" href="#id34" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">ITA 独自で定義された変数です。</div>
</div>
</section>
<section id="id35">
<h4>機器一覧<a class="headerlink" href="#id35" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">基本コンソールの機器一覧の下記項目を変数として扱えます。</div>
</div>
<table class="docutils align-left">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ホスト名</p></td>
<td><p>__loginhostname__</p></td>
</tr>
<tr class="row-odd"><td><p>プロトコル</p></td>
<td><p>__loginprotocol__</p></td>
</tr>
<tr class="row-even"><td><p>ログインユーザID</p></td>
<td><p>__loginuser__</p></td>
</tr>
<tr class="row-odd"><td><p>ログインパスワード</p></td>
<td><p>__loginpassword__</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><strong>変数名の前後の「__」は半角アンダーバー2文字です。</strong></div>
<div class="line">機器一覧については、<span class="xref std std-doc">../it_automation_base/basic_console</span> を参照してください。</div>
</div>
</section>
<section id="id36">
<h4>オペレーション<a class="headerlink" href="#id36" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">作業実行時のオペレーションを変数として扱えます。</div>
</div>
<table class="docutils align-left">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>オペレーション</p></td>
<td><p>__operation__</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">設定値 : 実施予定日時「YYYY/MM/DD HH:MM」_オペレーションID:オペレーション名称</div>
</div>
</section>
<section id="id37">
<h4>データ連携<a class="headerlink" href="#id37" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">作業実行時のディレクトリパスを下記の変数として扱えます。</div>
</div>
<table class="docutils align-left">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>作業ディレクトリパス</p></td>
<td><p>__workflowdir__</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Playbook内で作業ディレクトリパス配下にファイルを作成することで、「<em>作業実行</em>」の結果データでファイルをダウンロードすることができます。</div>
<div class="line">Conductor実行時の各Movementで共有するディレクトリパスを下記の変数として扱えます。</div>
</div>
<table class="docutils align-left">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Conductor作業ディレクトリパス</p></td>
<td><p>__conductor_workflowdir__</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">Playbook内でConductor作業ディレクトリパス配下にファイルを作成することで、各Movement間でファイルを共有することが出来ます。また、ansible driverの作業実行から実行した場合は__workflowdir__と同じパスが設定されます。</div>
</div>
<div class="line-block">
<div class="line">Conductorの「Status file branch」ノードで参照するステータスファイルのファイルパスを下記の変数として扱えます。</div>
</div>
<table class="docutils align-left">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ステータスファイルパス</p></td>
<td><p>__movement_status_filepath__</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="id38">
<h3>変数の抜出および具体値登録<a class="headerlink" href="#id38" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">各モードとも、ITAにアップロードしたPlaybook等の資材から変数を抜出し、各メニューから具体値を登録できます。各メニューから登録した変数の具体値は、作業実行時にホスト変数ファイルに出力されます。</div>
<div class="line">変数の抜出方法は以下のとおりです。</div>
</div>
<div class="line-block">
<div class="line"><strong>Ansible-Pioneer</strong></div>
<div class="line">「対話ファイル素材 (本書： <a class="reference internal" href="#ansible-pioneer-dialog-files-ansible-pioneer-only"><span class="std std-ref">対話ファイル素材集</span></a> )」でアップロードした対話ファイルより、以下の書式の変数定義を抜出します。</div>
</div>
<table class="docutils align-left" id="id81">
<caption><span class="caption-text">変数の抜出および具体値登録</span><a class="headerlink" href="#id81" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 14%" />
<col style="width: 29%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>変数名</p></th>
<th class="head"><p>書式</p></th>
<th class="head"><p>具体値の設定</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>通常変数</p>
<p>複数具体値変数</p>
</td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">VAR_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
</pre></div>
</div>
</td>
<td><p>具体値の登録は「 <a class="reference internal" href="#ansible-pioneer-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」や「 <a class="reference internal" href="#ansible-pioneer-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」メニューより行います。</p>
<p>具体値の登録の仕方で通常変数か複数具体値変数かを決定します。</p>
</td>
</tr>
<tr class="row-odd"><td><p>グローバル変数</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">GBL_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
</pre></div>
</div>
</td>
<td><p>具体値の登録は「 <a class="reference internal" href="#ansible-pioneer-global-variable-list"><span class="std std-ref">グローバル変数管理</span></a> 」メニューより行います。</p></td>
</tr>
<tr class="row-even"><td><p>テンプレート埋込変数</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">TPF_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
</pre></div>
</div>
</td>
<td><p>具体値の登録は「 <a class="reference internal" href="#ansible-pioneer-template-list"><span class="std std-ref">テンプレート管理</span></a> 」メニューより行います。</p></td>
</tr>
<tr class="row-odd"><td><p>ファイル埋込変数</p></td>
<td><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{{</span><span class="w"> </span><span class="nv">CPF_xxx</span><span class="w"> </span><span class="p p-Indicator">}}</span>
</pre></div>
</div>
</td>
<td><p>具体値の登録は「 <a class="reference internal" href="#ansible-pioneer-file-list"><span class="std std-ref">ファイル管理</span></a> 」メニューより行います。</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id39">
<h3>代入値登録による変数の扱い<a class="headerlink" href="#id39" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Playbookで定義した変数の値は代入値登録機能により上書きすることができます。</div>
<div class="line">Playbook中の変数と、代入値管理機能で登録した変数の値の関係を、以下の図に示します。</div>
</div>
<a class="reference internal image-reference" href="../../../../_images/hensu.png"><img alt="../../../../_images/hensu.png" src="../../../../_images/hensu.png" style="width: 6.68819in; height: 3.35972in;" /></a>
<div class="line-block">
<div class="line">代入値管理機能で登録した変数の値は、各ホスト用に変数定義ファイル(host_vars)に出力され、Ansibleで元のPlaybookと変数定義用ファイルを入力として各ホストに実行されます。</div>
<div class="line">この結果、変数の値の優先順位は以下のようになります。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">代入値管理機能で登録した値</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Playbook中の変数に指定した値</div>
<div class="line">詳細は 「 <a class="reference internal" href="#ansible-pioneer-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」を参照してください。</div>
</div>
</li>
</ol>
</section>
</section>
<section id="id40">
<h2>Ansible driver コンソールメニュー構成<a class="headerlink" href="#id40" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本章では、ITAコンソールのメニュー構成について説明します。</div>
</div>
<section id="id41">
<h3>メニュー/画面一覧<a class="headerlink" href="#id41" title="この見出しへのパーマリンク">¶</a></h3>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>基本コンソールのメニュー</strong></div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">Ansible driverで利用する 基本コンソールのメニュー一覧を以下に記述します。</div>
</div>
<table class="docutils align-left" id="id82">
<caption><span class="caption-text">基本コンソール メニュー/画面一覧</span><a class="headerlink" href="#id82" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 7%" />
<col style="width: 29%" />
<col style="width: 64%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>No</p></th>
<th class="head"><p>メニュー画面</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>オペレーション一覧</p></td>
<td><p>オペレーション一覧をメンテナンス(閲覧/登録/更新/廃止)できます</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic" start="2">
<li><div class="line-block">
<div class="line"><strong>Ansible共通コンソールのメニュー</strong></div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">Ansible共通コンソールのメニュー一覧を以下に記述します。</div>
</div>
<table class="docutils align-left" id="id83">
<caption><span class="caption-text">Ansible共通コンソール メニュー/画面一覧</span><a class="headerlink" href="#id83" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 7%" />
<col style="width: 21%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>No</p></th>
<th class="head"><p>メニュー・画面</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>機器一覧</p></td>
<td><p>作業対象ホストの情報をメンテナンス(閲覧/登録/更新/廃止)できます。</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>インターフェース情報</p></td>
<td><div class="line-block">
<div class="line">Ansible Core、Ansible Automation Controllerサーバのどちらを実行エンジンとし構築作業をするか選択をします。</div>
<div class="line">ITAシステム・Ansible driverサーバと実行エンジンのサーバが共有するディレクトリのパスおよび、実行エンジンのサーバへの接続インターフェース情報を管理します。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Ansible Automation Controllerホスト一覧</p></td>
<td><p>Ansible Automation ControllerのRestAPI実行に必要な情報、および構築資材をAnsible Automation Controllerにファイル転送するために必要な情報を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>グローバル変数管理</p></td>
<td><p>Playbookや対話ファイルなどで共通利用する変数（以降、グローバル変数と称す）と具体値を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>ファイル管理</p></td>
<td><p>Playbook内の各モジュールで使用する素材ファイルと埋め込み変数を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>テンプレート管理</p></td>
<td><p>Playbook内のtemplateモジュールでなどで使用するテンプレートファイルと埋め込み変数を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>共通変数利用リスト (※1)</p></td>
<td><p>テンプレート管理、ファイル管理、グローバル管理に登録されている変数をどの素材(ロール)で使用しているかを閲覧できます。</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>管理対象外変数リスト (※1)</p></td>
<td><div class="line-block">
<div class="line">ロールパッケージ管理のデフォルト変数定義やテンプレート管理の変数定義で定義している変数で、代入値自動登録の変数一覧に表示したくない変数をメンテナンス(参照/更新/廃止/復活)できます。</div>
<div class="line">変数名は正規表記で記載できます。</div>
<div class="line">(例) ansible_* *:ワイルドカード</div>
<div class="line">ansible_[0-9a-zA-Z_]*</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※1 非表示メニューは、バックヤード機能でデータの登録・更新を行うメニューです。</div>
<div class="line">Ansible Driver機能をインストールした状態では表示されないメニューに設定されています。</div>
<div class="line">非表示メニューを表示するには、<span class="menuselection">管理コンソール‣ロール・メニュー紐付管理</span> で各メニューの復活処理を行います。詳細は <span class="xref std std-doc">../it_automation_base/management_console</span> を参照してください。</div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ol class="arabic" start="3">
<li><div class="line-block">
<div class="line"><strong>Ansible-Pioneerコンソールのメニュー</strong></div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">Ansible-Pioneerコンソールに対応するメニュー一覧を以下に記述します。</div>
</div>
<table class="docutils align-left" id="id84">
<caption><span class="caption-text">Ansible-Pioneerコンソール メニュー/画面一覧</span><a class="headerlink" href="#id84" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 15%" />
<col style="width: 23%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>No</p></th>
<th class="head"><p>メニュー・画面</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Movement一覧</p></td>
<td><p>Movementの一覧を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>対話種別リスト</p></td>
<td><p>同一目的の対話ファイルを対話種別としてまとめる種別を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>OS種別マスタ</p></td>
<td><p>Pioneerより捜査対象となる機器のOS種別を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>対話ファイル素材集</p></td>
<td><p>対話種別に紐づけるOS種別とITAシステム独自フォーマットの作業手順ファイル(移行、対話ファイルと称す。)を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>Movement-対話種別紐付</p></td>
<td><p>{{#4</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>Movement-変数紐付 (※1)</p></td>
<td><p>Movementで使用している変数を管理します。</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>代入値自動登録設定</p></td>
<td><p>CMDBのメニューに登録されているオぺレーションとホスト毎の項目値を紐付けるMovementと変数を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>作業実行</p></td>
<td><p>作業実行するMovementとオペレーションを選択し実行を指示します。</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>作業管理</p></td>
<td><p>作業実行履歴を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>作業状態確認</p></td>
<td><p>作業実行状態を表示します。</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>作業対象ホスト</p></td>
<td><p>Movementで使用するホストを管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>代入値管理</p></td>
<td><p>変数の代入値を管理します。</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※1 非表示メニューは、バックヤード機能でデータの登録・更新を行うメニューです。</div>
<div class="line">Ansible Driver機能をインストールした状態では表示されないメニューに設定されています。</div>
<div class="line">非表示メニューを表示するには、<span class="menuselection">管理コンソール‣ロール・メニュー紐付管理</span> で各メニューの復活処理を行います。詳細は <span class="xref std std-doc">../it_automation_base/management_console</span> を参照してください。</div>
</div>
</div>
</section>
</section>
<section id="id42">
<h2>Ansible driver利用手順<a class="headerlink" href="#id42" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">Ansibleコンソールの利用手順について説明します。</div>
</div>
<div class="line-block">
<div class="line">以下は、Ansible-Pioneerで作業を実行するまでの流れです。</div>
</div>
<ul>
<li><p><strong>作業フロー詳細と参照先</strong></p>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>OS種別の登録</strong></div>
<div class="line">Pioneerより操作対象となる機器のOS種別を設定します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>機器情報にAnsible利用情報を設定</strong></div>
<div class="line">ITA基本コンソールの機器一覧の画面から、各機器に対してAnsible利用情報を設定します。</div>
<div class="line">詳細は <a class="reference internal" href="#ansible-pioneer-device-list"><span class="std std-ref">機器一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>投入オペレーション名の登録</strong></div>
<div class="line">ITA基本コンソールのオペレーション一覧の画面から、作業用の投入オペレーション名を登録します。</div>
<div class="line">詳細は <span class="xref std std-ref">ansible_pioneer_input_operation_list</span> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>インターフェース情報の登録</strong></div>
<div class="line">Ansible共通コンソールのインターフェース情報の画面から、Ansible Core、Ansible Automation Controllerサーバのどちらを実行エンジンにするかを選択し、実行エンジンのサーバへの接続情報の登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#ansible-pioneer-interface-information"><span class="std std-ref">インターフェース情報</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業パターン(Movement)の登録</strong></div>
<div class="line">Ansible-PioneerコンソールのMovement一覧の画面から、作業用のMovementを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#ansible-pioneer-movement-list"><span class="std std-ref">Movement一覧</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>対話種別の登録</strong></div>
<div class="line">Ansible-Pioneerコンソールの対話種別リストの画面から、対話種別を登録します。</div>
<div class="line">OS種別ごとの差異を対話ファイルごとに定義し、同一目的の対話ファイルを対話種別として纏めて機器差分を吸収(抽象化)します。</div>
<div class="line">詳細は <a class="reference internal" href="#ansible-pioneer-dialog-type-list-ansible-pioneer-only"><span class="std std-ref">対話種別リスト</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>対話ファイルの登録</strong></div>
<div class="line">Ansible-Pioneerコンソールの対話ファイル素材集の画面から、対話種別とOS種別の組み合わせに対して対話ファイルを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#ansible-pioneer-dialog-files-ansible-pioneer-only"><span class="std std-ref">対話ファイル素材集</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>テンプレートファイルの登録(必要に応じて実施)</strong></div>
<div class="line">Ansible共通コンソールのテンプレート管理の画面から、対話ファイルで使用しているtemplateファイルとtemplate埋め込み変数の登録／更新／廃止を行います。</div>
<div class="line">詳細は <a class="reference internal" href="#ansible-pioneer-template-list"><span class="std std-ref">テンプレート管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>素材ファイルの登録(必要に応じて実施)</strong></div>
<div class="line">Ansible共通コンソールのファイル管理の画面から、作業対象サーバに配置するファイルを登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#ansible-pioneer-file-list"><span class="std std-ref">ファイル管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>Movementに対話ファイルを指定</strong></div>
<div class="line">Ansible-PioneerコンソールのMovement-Playbook紐付（Movement-対話種別紐付、Movement-ロール紐付）の画面から、登録したMovementに対話ファイルに対応した対話種別リストを指定します。</div>
<div class="line">詳細は <a class="reference internal" href="#ansible-pioneer-movement-details"><span class="std std-ref">Movement-対話種別紐付</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業対象ホストの指定</strong></div>
<div class="line">Ansible-Pioneerコンソールの作業対象ホストの画面から、作業対象ホストを指定します。</div>
<div class="line">詳細は <a class="reference internal" href="#ansible-pioneer-target-host"><span class="std std-ref">作業対象ホスト</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>変数値の設定</strong></div>
<div class="line">Ansible-Pioneerコンソールの代入値管理の画面から、Movementに登録したPlaybook内で定義した変数の値を設定します。変数を利用していない場合、設定は不要です。</div>
<div class="line">詳細は <a class="reference internal" href="#ansible-pioneer-substitution-value-list"><span class="std std-ref">代入値管理</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業実行</strong></div>
<div class="line">Ansible-Pioneerコンソールの作業実行の画面から、実行日時、投入オペレーションを選択して設定して処理の実行を指示します。</div>
<div class="line">詳細は <a class="reference internal" href="#ansible-pioneer-execution"><span class="std std-ref">作業実行</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業状態確認</strong></div>
<div class="line">Ansible-Pioneerコンソールの作業状態確認の画面では、実行した作業の状態がリアルタイムで表示されます。また、作業の緊急停止や、実行ログ、エラーログを監視することができます。</div>
<div class="line">詳細は <a class="reference internal" href="#ansible-pioneer-check-operation-status"><span class="std std-ref">作業状態確認</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業履歴確認</strong></div>
<div class="line">Ansible-Pioneerコンソールの作業管理の画面では、実行した作業の一覧が表示され履歴が確認できます。</div>
<div class="line">詳細は <a class="reference internal" href="#ansible-pioneer-execution-list"><span class="std std-ref">作業管理</span></a> を参照してください。</div>
</div>
</li>
</ol>
</li>
</ul>
</section>
<section id="id43">
<h2>Ansible driver機能・操作方法説明<a class="headerlink" href="#id43" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本章では、Ansible driverで利用する各コンソールの機能について説明します。</div>
<div class="line">本章に記載の登録画面項目一覧表の内容について説明します。</div>
</div>
<table class="docutils align-left" id="id85">
<caption><span class="caption-text">登録画面項目一覧凡例</span><a class="headerlink" href="#id85" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目…①</p></th>
<th class="head"><p>説明…②</p></th>
<th class="head"><p>入力必須…③</p></th>
<th class="head"><p>入力方法…④</p></th>
<th class="head"><p>制約事項…⑤</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>項目</strong></div>
<div class="line">サブメニュー内の項目名です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>説明</strong></div>
<div class="line">項目に対する説明です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>入力必須</strong></div>
<div class="line">○：項目に対する内容の入力が必須の項目です。</div>
<div class="line">ー：項目に対する内容の入力が任意の項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>入力方法</strong></div>
</div>
<ul>
<li><div class="line-block">
<div class="line">手動入力：手動での入力が必要な項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">自動入力：自動で内容が入力される項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">チェックボックス：チェックボックス形式の項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">ボタン：ラジオボタン形式の項目です。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">リスト選択：リストボックス形式の項目です。</div>
</div>
</li>
</ul>
</li>
<li><div class="line-block">
<div class="line"><strong>制約事項</strong></div>
<div class="line">項目に対する制約事項(文字数制限など)です。</div>
</div>
</li>
</ol>
<section id="id44">
<h3>基本コンソール<a class="headerlink" href="#id44" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">本節では、ITA基本コンソールでの操作について記載します。</div>
<div class="line">本作業は <span class="xref std std-doc">../it_automation_base/basic_console</span> を参照して、ITA基本コンソール画面内で作業を実施してください。</div>
</div>
<section id="id45">
<h4>オペレーション一覧<a class="headerlink" href="#id45" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line"><span class="menuselection">基本コンソール‣オペレーション一覧</span> では、オーケストレータで実行する作業対象ホストに対するオペレーションを管理します。作業はITA基本コンソール内メニューより選択します。</div>
<div class="line">登録方法の詳細は、関連マニュアルの <span class="xref std std-doc">../it_automation_base/basic_console</span> を参照してください。</div>
</div>
<figure class="align-default" id="id86">
<a class="reference internal image-reference" href="../../../../_images/register.png"><img alt="サブメニュー画面（オペレーション一覧）" src="../../../../_images/register.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（オペレーション一覧）</span><a class="headerlink" href="#id86" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="ansible">
<h3>Ansible共通コンソール<a class="headerlink" href="#ansible" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">本節では、Ansible共通コンソールでの操作について記載します。</div>
</div>
<section id="ansible-pioneer-device-list">
<span id="id46"></span><h4>機器一覧<a class="headerlink" href="#ansible-pioneer-device-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣機器一覧</span> では、作業対象ホストの情報のメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
</div>
<figure class="align-default" id="id87">
<a class="reference internal image-reference" href="../../../../_images/device_list.png"><img alt="サブメニュー画面（機器一覧）" src="../../../../_images/device_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（機器一覧）</span><a class="headerlink" href="#id87" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">＋ 登録</span> ボタンより、機器情報の登録を行います。</div>
</div>
<figure class="align-default" id="id88">
<a class="reference internal image-reference" href="../../../../_images/registration_device_list.gif"><img alt="登録画面（機器一覧）" src="../../../../_images/registration_device_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（機器一覧）</span><a class="headerlink" href="#id88" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の共通項目一覧は以下のとおりです。</div>
</div>
<div class="line-block">
<div class="line">Ansible driverを利用する場合には、Ansible利用情報を入力してください。</div>
<div class="line">未入力で作業実行した場合、想定外エラーとなる場合があります。</div>
</div>
<table class="docutils align-left" id="id89">
<caption><span class="caption-text">登録画面項目一覧（機器一覧）</span><a class="headerlink" href="#id89" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 21%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="4"><p>項目</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力方法</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="4"><p>管理システム項番</p></td>
<td><p>登録情報を識別する一意のIDが自動入力されます。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td colspan="4"><p>HW機器種別</p></td>
<td><p>HW機器の種別を選択します。</p>
<p>・NW(ネットワーク)</p>
<p>・ST(ストレージ)</p>
<p>・SV(サーバー)</p>
</td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-even"><td colspan="4"><p>ホスト名</p></td>
<td><p>ホスト名を記入します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="4"><p>DNSホスト名</p></td>
<td><p>ＤＮＳサーバーを使用してホスト名が解決できる名称を入力します。</p></td>
<td></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-even"><td colspan="4"><p>IPアドレス</p></td>
<td><p>IPアドレス(xxx.xxx.xxx.xxx形式)を記入します。</p></td>
<td></td>
<td><p>手動入力</p></td>
<td><p>最大長15バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2" rowspan="2"><p>ログインパスワード</p></td>
<td colspan="2"><p>ユーザ</p></td>
<td><p>ログインユーザを記入します。</p></td>
<td></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>パスワード</p></td>
<td><p>パスワードを指定します。</p></td>
<td></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2" rowspan="2"><p>ssh鍵認証情報</p></td>
<td colspan="2"><p>ssh秘密鍵ファイル</p></td>
<td><p>ssh秘密鍵ファイルを指定して鍵認証する場合の秘密鍵ファイルを入力します。アップロードしたファイルは暗号化されて保存されます。</p>
<p>※登録後はダウンロード不可となります。</p>
</td>
<td><p>ー</p></td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ100Mバイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>パスフレーズ</p></td>
<td><p>ssh秘密鍵ファイルにパスフレーズが設定されている場合、パスフレーズを入力します。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-odd"><td rowspan="7"><p>Ansible利用情報</p></td>
<td rowspan="3"><p>Legacy/Role利用情報</p></td>
<td colspan="2"><p>認証方式</p></td>
<td><p>Ansible・Ansible Automation Controller から機器へ接続する際の認証方式を選択します。</p>
<p>●パスワード認証</p>
<p>ログインパスワードの管理で●の選択と、ログインパスワードの入力が必須です。</p>
<p>●鍵認証（パスフレーズなし）</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードが必須です。</p>
<p>●鍵認証（パスフレーズあり）</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードと、パスフレーズの入力が必須です。</p>
<p>●鍵認証（鍵交換済み）※1</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードは必要ありません。</p>
<p>●パスワード認証（winrm)</p>
<p>必要に応じてWinRM接続情報を入力します。</p>
<p>尚、パスワード認証（winrm)以外の認証方式の場合、機器側に以下の設定が必要です。</p>
<p>ログインユーザの sudo権限を NOPASSWD付で <code class="file docutils literal notranslate"><span class="pre">/etc/sudoers</span></code> に設定します。</p>
<p>Exp)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Demo_user</span> <span class="n">ALL</span><span class="o">=</span><span class="p">(</span><span class="n">ALL</span><span class="p">)</span> <span class="n">NOPASSWD</span><span class="p">:</span><span class="n">ALL</span>
</pre></div>
</div>
</td>
<td></td>
<td><p>リスト選択</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>WinRM接続情報</p></td>
<td><p>ポート番号</p></td>
<td><p>WindowsServerにWinRM接続する際のポート番号を入力します。</p>
<p>未入力の場合はデフォルト(5985)でのWinRM接続となります。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td><p>サーバ証明書</p></td>
<td><p>WinRM接続ポートでhttpsのポート番号を指定した場合にサーバﾞ証明書を入力します。</p>
<p>アップロードしたファイルは暗号化されて保存されます。</p>
<p>※登録後はダウンロード不可となります。</p>
<p>サーバ証明書の認証を省く場合、インベントリファイル追加オプションに下記を追記してください。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_winrm_server_cert_validation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ignore</span>
</pre></div>
</div>
</td>
<td><p>ー</p></td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ100Mバイト</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>接続オプション</p></td>
<td><p>（ssh接続の場合）</p>
<p><code class="file docutils literal notranslate"><span class="pre">/etc/ansible.cfg/ssh_args</span></code> に設定しているsshオプション以外のオプションを設定したい場合、設定したいオプションを入力します。</p>
<p>（telnet接続の場合）</p>
<p>telnet接続時のオプションを設定したい場合、設定したいオプションを入力します。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>インベントリファイル追加オプション</p></td>
<td><p>ITAが設定していないインベントリファイルのオプションパラメータをyaml形式で入力します。</p>
<p>Exp)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_connection</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">network_cli</span>
<span class="nt">ansible_network_os</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ios</span>
<span class="nt">ansible_become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="nt">ansible_become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable</span>
</pre></div>
</div>
<p>各パラメータ値を変数で記述することも出来ます。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_become_password</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_passwd</span><span class="nv"> </span><span class="s">}}&#39;</span>
</pre></div>
</div>
<p>具体値に変数を記述する場合</p>
<p>'{{ VAR_passwd }}'</p>
<p>':シングル・ダブルコーテーションで囲む「必須」</p>
<p>変数の具体値は「 <a class="reference internal" href="#ansible-pioneer-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」や「 <a class="reference internal" href="#ansible-pioneer-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」メニューから登録します。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>Ansible Automation Controller 利用情報</p></td>
<td colspan="2"><p>インスタンスグループ名※2</p></td>
<td><p>Ansible Automation Controller がクラスタ構成の場合、どのインスタンスグループで実行するかを選択します。ここで設定した、インスタンスグループはインベントリオブジェクトに設定されます。</p>
<p>未選択の場合はAnsible Automation Controller のデフォルトのインスタンスグループになります。</p>
<p>Ansible Automation Controller がクラスタ構成でない場合は、未選択で構いません。</p>
</td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>接続タイプ</p></td>
<td><p>Ansible Automation Controller認証情報の接続タイプを設定します。通常はmachineを選択します。</p>
<p>ansible_connectionをlocalに設定する必要があるNetwork OSの場合にNetworkを選択します。</p>
<p>Networkを選択した場合、インベントリファイル追加オプションにPlatform Options(ansible_connection以外)を設定する必要があります。</p>
<p>Exp)</p>
<p>インベントリファイル追加オプションの設定例</p>
<p>Network OSがiosの場合の設定値</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ansible_network_os</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ios</span>
<span class="nt">ansible_become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="nt">ansible_become_method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable</span>
</pre></div>
</div>
<p>Ansible Automation Controllerの認証情報の接続タイプについては、ドキュメント <a class="reference external" href="https://docs.ansible.com/ansible-tower/3.6.4/html_ja/userguide/credentials.html">認証情報タイ
プ</a> を参照してください。</p>
<p>Network OSとansible_connectionの関連やPlatform Optionsについては、Ansibleドキュメント <a class="reference external" href="https://docs.ansible.com/ansible/devel/network/user_guide/platform_index.html">Platform Options</a> を参照してください。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-even"><td colspan="4"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※1 認証方式が鍵認証（鍵交換済み）に設定する為に必要な公開鍵ファイルの配布</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">Ansible Coreの場合</div>
<div class="line">ansibleがインストールされているサーバーの実行ユーザー「Ansible共通コンソール=&gt;インターフェース情報に設定されている実行ユーザー」から作業対象ホストにssh接続します。</div>
<div class="line">実行ユーザーの公開鍵ファイルをログイン先ユーザーのauthorized_keysにコピーしてください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Ansible Automation Controllerの場合</div>
<div class="line">Ansible Automation Controllerのawxユーザーから作業対象ホストにssh接続しています。</div>
<div class="line">awxユーザーの公開鍵ファイルをログイン先ユーザーのauthorized_keysにコピーしてください。ブラウザよりAnsible Automation Controllerにログインし、「設定」→「ジョブ」→「分離されたジョブに公開するパス」に <code class="file docutils literal notranslate"><span class="pre">/var/lib/awx/.ssh/</span></code> を設定します。</div>
</div>
<a class="reference internal image-reference" href="../../../../_images/ansible_automationcontroller.png"><img alt="../../../../_images/ansible_automationcontroller.png" class="align-center" src="../../../../_images/ansible_automationcontroller.png" style="width: 4.97986in; height: 1.51304in;" /></a>
<div class="line-block">
<div class="line">尚、AnsibleTower4.x以降、awxユーザーの.sshディレクトリが扱えない為、作業対象ホストと鍵認証（鍵交換済み）での接続は出来ません。</div>
</div>
</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※2 Ansible driverのバックヤード機能 「Ansible Automation Controllerデータ同期」により取得したデータから選択します。</div>
</div>
</div>
</li>
</ol>
</section>
<section id="ansible-pioneer-interface-information">
<span id="id47"></span><h4>インターフェース情報<a class="headerlink" href="#ansible-pioneer-interface-information" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣インターフェース情報</span> では、Ansible Core、AnsibleTower、Ansible Automation Controllerのいずれかを実行エンジンに選択し、ITAシステム・Ansible driverサーバと実行エンジンのサーバが共有するディレクトリのパスのおよび実行エンジンのサーバへの接続インターフェース情報のメンテナンス(閲覧/更新)を行います。</div>
</div>
<figure class="align-default" id="id90">
<a class="reference internal image-reference" href="../../../../_images/interface_information.png"><img alt="サブメニュー画面（インタフェース情報）" src="../../../../_images/interface_information.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（インタフェース情報）</span><a class="headerlink" href="#id90" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">編集</span> ボタンより、インターフェース情報の登録を行います。</div>
</div>
<figure class="align-default" id="id91">
<a class="reference internal image-reference" href="../../../../_images/registration_interface_information.gif"><img alt="登録画面（インタフェース情報）" src="../../../../_images/registration_interface_information.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（インタフェース情報）</span><a class="headerlink" href="#id91" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">インタフェース情報画面の項目一覧は以下のとおりです。</div>
<div class="line">インタフェース情報が未登録または、複数レコード登録されている状態で作業実行した場合、作業実行は想定外エラーとなります。</div>
</div>
<table class="docutils align-left" id="id92">
<caption><span class="caption-text">登録画面項目一覧（インタフェース情報）</span><a class="headerlink" href="#id92" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 32%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>項目</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力方法</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p>実行エンジン</p></td>
<td><p>実行するエンジンを下記の2種類から選択します。</p>
<p>・Ansible Core</p>
<p>・Ansible Automation Controller</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-odd"><td rowspan="6"><p>Ansible Automation Controller インターフェース</p></td>
<td colspan="2"><p>代表ホスト</p></td>
<td><p>Ansible Automation Controllerホスト一覧に登録されているホストの一覧より、ITAと通信するAnsible Automation Controllerを選択します。</p></td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>プロトコル</p></td>
<td><p>Ansible Automation Controllerサーバとのプロトコルを http / https のどちらかを入力します。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>ポート</p></td>
<td><p>Ansible Automation Controllerサーバの接続ポート(80/443)を入力します。通常はHTTPS(443)です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>組織名</p></td>
<td><p>Ansible Automation Controllerサーバに登録されている組織名を選択します。</p></td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>認証トークン</p></td>
<td><p>ITAからAnsible Automation Controllerサーバに接続するユーザーの認証トークンを入力します。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p>
<p>実行エンジンがAnsible Core以外の場合に入力必須</p>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p>実行時データ削除</p></td>
<td><p>作業実行時にITAとAnsible Automation Controller 内に一時的に生成したデータリソースを作業終了後に削除するかを選択します。
「削除する」を選択した場合に削除されるデータリソースは「 <a class="reference internal" href="#ansible-pioneer-data-resources-deleted-when-executing"><span class="std std-ref">実行時データ削除で削除されるデータリソース</span></a> 」を参照してください。</p></td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td><p>実行エンジンがAnsible Core以外の場合に入力必須</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>Proxy</p></td>
<td colspan="2"><p>Address</p></td>
<td><p>プロキシサーバのアドレスを入力します。</p>
<p>ITAがプロキシ環境下にある場合、Ansible/Ansible Automation Controllerサーバまでの疎通のために設定が必要な場合があります。</p>
<p>プロキシサーバのURLが</p>
<p>http://procy.gate.co.jp:8080の場合</p>
<p>Addressにはhttp://procy.gate.co.jpを入力します。</p>
<p>Portには 8080を入力します。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大255バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>Port</p></td>
<td><p>プロキシサーバのポートを入力します。</p>
<p>ITAがプロキシ環境下にある場合、Ansible/Ansible Automation Controllerサーバまでの疎通のために設定が必要な場合があります。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>Ansible-vaultパスワード</p></td>
<td><p>ansible-vaultコマンドで変数の具体値を暗号化する場合のパスワードを入力します。</p>
<p>空白の場合は、デフォルト値が使用します。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長64バイト</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>オプションパラメータ</p></td>
<td><p>Movement共通のオプションパラメータを入力します。</p>
<p>実行エンジンがAnsible Coreの場合はansible-playbookコマンドのオプションパラメータ、実行エンジンがAnsible Core以外の場合はジョブテンプレートのパラメータを入力します。</p>
<p>Movement固有のオプションパラメータはMovement一覧で入力します。</p>
<p>オプションパラメータの詳細については、「 <a class="reference internal" href="#ansible-pioneer-option-parameter-list"><span class="std std-ref">オプションパラメータ一覧</span></a> 」を参照してください。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>NULL連携</p></td>
<td><p>代入値自動登録設定でパラメータシートの具体値がNULL(空白)の場合に、代入値管理への登録をNULL(空白)の値で行うか設定します。</p>
<p>代入値自動登録設定メニューの「NULL連携」が空白の場合この値が適用されます。</p>
<p>・「有効」の場合、パラメータシートの値がどのような値でも代入値管理への登録が行われます。</p>
<p>・「無効」の場合、パラメータシートに値が入っている場合のみ代入値管理への登録が行われます。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>状態監視周期(単位ミリ秒)</p></td>
<td><p>「<a class="reference internal" href="#ansible-pioneer-check-operation-status"><span class="std std-ref">作業状態確認</span></a>」で表示されるログのリフレッシュ間隔を入力します。通常は3000ミリ秒程度が推奨値です。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最小値1000ミリ秒</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>進行状態表示行数</p></td>
<td><p>「<a class="reference internal" href="#ansible-pioneer-check-operation-status"><span class="std std-ref">作業状態確認</span></a>」での進行ログ・エラーログの最大表示行数を入力します。</p>
<p>ステータスが[未実行]、[準備中]、[実行中]、[実行中(遅延)]の場合、指定した行数でログを出力します。</p>
<p>ステータスが[完了]、[完了(異常)]、[想定外エラー]、[緊急停止]、[未実行(予約)]、[予約取消]の場合、指定した行数ではなくすべてのログを出力します。</p>
<p>環境毎にチューニングを要しますが、通常は1000行程度が推奨値です。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="ansible-pioneer-ansible-automation-controlller-hosts">
<span id="id48"></span><h4>Ansible Automation Controller ホスト一覧<a class="headerlink" href="#ansible-pioneer-ansible-automation-controlller-hosts" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣Ansible Automation Controller ホスト一覧</span> では、Ansible Automation ControllerのRestAPI実行に必要な情報、および構築資材をAnsible Automation Controllerにファイル転送するために必要な情報のメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
<div class="line">クラスタ構成の場合は、構成している全てのサーバを登録してください。</div>
<div class="line">ただし、Ansible Automation Controllerのhop nodeの登録は不要です。</div>
</div>
<figure class="align-default" id="id93">
<a class="reference internal image-reference" href="../../../../_images/ansible_automation_controller_host_list.png"><img alt="サブメニュー画面（Ansible Automation Controller ホスト一覧）" src="../../../../_images/ansible_automation_controller_host_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（Ansible Automation Controller ホスト一覧）</span><a class="headerlink" href="#id93" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">＋ 登録</span> ボタンより、Ansible Automation Controllerのホスト情報の登録を行います。</div>
</div>
<figure class="align-default" id="id94">
<a class="reference internal image-reference" href="../../../../_images/ansible_automation_controller_host_list.gif"><img alt="登録画面（Ansible Automation Controller ホスト一覧）" src="../../../../_images/ansible_automation_controller_host_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（Ansible Automation Controller ホスト一覧）</span><a class="headerlink" href="#id94" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">Ansible Automation Controller ホスト一覧画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id95">
<caption><span class="caption-text">登録画面項目一覧（Ansible Automation Controller ホスト一覧）</span><a class="headerlink" href="#id95" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>項目</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力方法</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><p>ホスト</p></td>
<td><p>Ansible Automation Controllerサーバのホスト名（またはIPアドレス）を入力します。</p>
<p>HTTPS通信の場合はホスト名が推奨です。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>認証方式</p></td>
<td><p>Ansible Automation Controllerサーバへファイル転送(scp)で接続する際の認証方式を選択します。</p>
<p>●パスワード認証</p>
<p>ログインユーザとパスワードの入力が必須です。</p>
<p>●鍵認証（パスフレーズなし）</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードが必須です。</p>
<p>●鍵認証（パスフレーズあり）</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードと、パスフレーズの入力が必須です。</p>
<p>●鍵認証（鍵交換済み）※</p>
<p>ssh秘密鍵ファイル(id_ras)のアップロードは必要ありません。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長30バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>ユーザー</p></td>
<td><p>Ansible Automation Controllerサーバへファイル転送(scp)で接続する際のログインユーザを入力します。</p>
<p>ログインユーザは、Ansible Automation Controllerインストール時に生成されるawxユーザーにパスワードを設定し、使用することを強く推奨します。</p>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>パスワード</p></td>
<td><p>認証方式でパスワード認証を選択した場合に必須入力となります。
ログインユーザのパスワードを指定します。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長30バイト</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>ssh鍵認証情報</p></td>
<td><p>ssh秘密鍵ファイル</p></td>
<td><p>ssh秘密鍵ファイルを指定して鍵認証する場合の秘密鍵ファイルを入力します。
アップロードしたファイルは暗号化されて保存されます。※登録後はダウンロード不可となります。</p></td>
<td><p>ー</p></td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ100Mバイト</p></td>
</tr>
<tr class="row-odd"><td><p>パスフレーズ</p></td>
<td><p>ssh秘密鍵ファイルにパスフレーズが設定されている場合、パスフレーズを入力します。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>isolatedTower</p></td>
<td><p>クラスタ構成で構築されている場合で、対象ノードがAnsibleTowerのisolatednode/Ansible Automation Controllerのexecution node の場合、「●」を選択します。</p></td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">※ 認証方式が鍵認証（鍵交換済み）に設定する為に必要な公開鍵ファイルの配布</div>
<div class="line">ITAがインストールされているサーバーのrootからAnsible Automation Controllerのawxユーザーでssh接続します。</div>
<div class="line">rootの公開鍵ファイルをAnsible Automation Controllerのawxユーザーのauthorized_keysにコピーして下さい。</div>
</div>
</div>
</li>
</ol>
</section>
<section id="ansible-pioneer-global-variable-list">
<span id="id49"></span><h4>グローバル変数管理<a class="headerlink" href="#ansible-pioneer-global-variable-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣グローバル変数管理</span> では、Playbookで利用するグローバル変数名のメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
</div>
<figure class="align-default" id="id96">
<a class="reference internal image-reference" href="../../../../_images/global_variable_list.png"><img alt="サブメニュー画面（グローバル変数管理）" src="../../../../_images/global_variable_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（グローバル変数管理）</span><a class="headerlink" href="#id96" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">＋ 登録</span> ボタンより、グローバル変数管理情報の登録を行います。</div>
</div>
<figure class="align-default" id="id97">
<a class="reference internal image-reference" href="../../../../_images/global_variable_list.gif"><img alt="登録画面（グローバル変数管理）" src="../../../../_images/global_variable_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（グローバル変数管理）</span><a class="headerlink" href="#id97" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">グローバル変数管理画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id98">
<caption><span class="caption-text">登録画面項目一覧（グローバル変数管理）</span><a class="headerlink" href="#id98" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 15%" />
<col style="width: 62%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力方法</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>グローバル変数名</p></td>
<td><div class="line-block">
<div class="line">変数名を入力します。</div>
<div class="line">変数名は、「GBL_****」形式で入力します。</div>
<div class="line">****：半角英数字とアンダースコア（ _ ）が利用可能です。(最小値:1バイト、最大値:255バイト)</div>
</div>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td><p>具体値</p></td>
<td><p>具体値を入力します。複数行の具体値も入力できますが、Pioneerの対話ファイルで使用しているグローバル変数で複数行の具体値を設定すると、作業実行時にエラーとなります。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-even"><td><p>変数名説明</p></td>
<td><p>変数に対する説明・コメントを入力します。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="ansible-pioneer-file-list">
<span id="id50"></span><h4>ファイル管理<a class="headerlink" href="#ansible-pioneer-file-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣ファイル管理</span> では、Playbook内で定義している各モジュールで使用するファイルとファイル埋込変数のメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
<div class="line">ファイル管理でファイル素材を登録しておくことで、Playbook内で定義している各モジュールで使用するファイルをファイル埋込変数名で指定することができます。</div>
</div>
<figure class="align-default" id="id99">
<a class="reference internal image-reference" href="../../../../_images/contents_list.png"><img alt="サブメニュー画面（ファイル管理）" src="../../../../_images/contents_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（ファイル管理）</span><a class="headerlink" href="#id99" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">＋ 登録</span> ボタンより、ファイル管理情報の登録を行います。</div>
</div>
<figure class="align-default" id="id100">
<a class="reference internal image-reference" href="../../../../_images/contents_list.gif"><img alt="登録画面（ファイル管理）" src="../../../../_images/contents_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（ファイル管理）</span><a class="headerlink" href="#id100" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id101">
<caption><span class="caption-text">登録画面項目一覧（ファイル管理）</span><a class="headerlink" href="#id101" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 15%" />
<col style="width: 50%" />
<col style="width: 5%" />
<col style="width: 10%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力方法</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ファイル埋込変数名</p></td>
<td><div class="line-block">
<div class="line">各モジュールのパラメータに埋め込む変数名を入力します。</div>
<div class="line">変数名は、「CPF_****」形式で入力します。</div>
<div class="line">****：半角英数字とアンダースコア（ _ ）が利用可能です。(最小値:1バイト、最大値:128バイト)</div>
</div>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td><p>ファイル素材</p></td>
<td><p>各モジュールで使用するファイルをアップロードします。</p></td>
<td><p>○</p></td>
<td><p>ファイル登録</p></td>
<td><p>最大サイズ100Mバイト</p></td>
</tr>
<tr class="row-even"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><strong>ファイル埋込変数の使用例</strong></div>
<div class="line">ファイル管理で登録したファイルをPlaybookに記述する場合、該当のパラメータにファイル埋込変数名を記述します。ファイル埋込変数名を使用しない場合、代入値自動登録設定で登録した変数や該当ファイルのパスを記述します。</div>
<div class="line">※ファイル名にスペースなどが含まれている場合、適切にクォーテーションで囲まないと、作業実行時にエラーになる場合があります。</div>
</div>
<div class="line-block">
<div class="line">Exp)</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">ファイル管理で登録したhostsファイルをファイル埋め込み変数を使用して作業対象サーバの/etc/配下にコピーする場合</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">ファイル管理メニューから下記のようにhostsファイルを登録します。</div>
</div>
<table class="docutils align-left" id="id102">
<caption><span class="caption-text">ファイル管理の登録内容</span><a class="headerlink" href="#id102" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ファイル埋込変数名</p></th>
<th class="head"><p>ファイル素材</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPF_hosts</p></td>
<td><p>hosts</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line">下記のようにPlaybookを記述します。</div>
<div class="line">※destはファイル名も記述してください。ファイル名の指定がない場合、登録したファイル素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。</div>
<div class="line">　たとえば、dest=/etc/ とした場合、ファイル名は/etc/10桁の数値_hostsとなります。</div>
</div>
<div class="line-block">
<div class="line"><strong>Playbookの記述</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">copy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src=&#39;{{ CPF_hosts }}&#39; dest=/etc/hosts</span>
</pre></div>
</div>
</li>
</ol>
</li>
<li><div class="line-block">
<div class="line">ファイル管理で登録したtool.tgzファイルをファイル埋込変数を使用して作業対象サーバの/usr/local/bin/配下に解凍する場合</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">ファイル管理メニューから下記のようにtool.tgzファイルを登録します。</div>
</div>
<table class="docutils align-left" id="id103">
<caption><span class="caption-text">ファイル管理の登録内容</span><a class="headerlink" href="#id103" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ファイル埋込変数名</p></th>
<th class="head"><p>ファイル素材</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPF_tool_tgz</p></td>
<td><p>tool.tgz</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line">下記のようにPlaybookを記述します。</div>
</div>
<div class="line-block">
<div class="line"><strong>Playbookの記述</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">unarchive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src={{ CPF_tool_tgz }} dest=/usr/local/bin</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ul>
</div>
</section>
<section id="ansible-pioneer-template-list">
<span id="id51"></span><h4>テンプレート管理<a class="headerlink" href="#ansible-pioneer-template-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣テンプレート管理</span> では、Playbookで定義しているtemplateモジュールやios_configモジュールなどのパラメータで使用するJinja2テンプレートファイルとテンプレート埋込変数のメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
<div class="line">テンプレート管理でテンプレート素材を登録しておくことで、Playbook内で定義しているtemplateモジュールなどで使用するtemplateファイルをテンプレート埋込変数で指定することができます。</div>
</div>
<figure class="align-default" id="id104">
<a class="reference internal image-reference" href="../../../../_images/template_list.png"><img alt="サブメニュー画面（テンプレート管理）" src="../../../../_images/template_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（テンプレート管理）</span><a class="headerlink" href="#id104" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">＋ 登録</span> ボタンより、テンプレート管理情報の登録を行います。</div>
</div>
<figure class="align-default" id="id105">
<a class="reference internal image-reference" href="../../../../_images/template_list.gif"><img alt="登録画面（テンプレート管理）" src="../../../../_images/template_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（テンプレート管理）</span><a class="headerlink" href="#id105" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id106">
<caption><span class="caption-text">登録画面項目一覧（テンプレート管理）</span><a class="headerlink" href="#id106" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 15%" />
<col style="width: 50%" />
<col style="width: 5%" />
<col style="width: 10%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力方法</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>テンプレート埋込変数名</p></td>
<td><div class="line-block">
<div class="line">templateモジュールやios_configモジュールなどのパラメータに埋め込む変数名を入力します。</div>
<div class="line">変数名は、「TPF_****」形式で入力します。</div>
<div class="line">****：半角英数字とアンダースコア（ _ ）が利用可能です。(最小値:1バイト、最大値:255バイト)</div>
</div>
</td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td><p>テンプレート素材</p></td>
<td><p>モジュールのパラメータで使用するJinja2テンプレートファイルをアップロードします。</p></td>
<td><p>○</p></td>
<td><p>ファイル登録</p></td>
<td><div class="line-block">
<div class="line">テキスト形式</div>
<div class="line">最大サイズ100Mバイト</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>変数定義</p></td>
<td><div class="line-block">
<div class="line">テンプレート素材で使用している変数を定義します。</div>
<div class="line">具体値は定義のみで使用することはありません。</div>
<div class="line">Ansible-Pioneerのみで使用するテンプレートで、default変数定義ファイルなどに変数定義をしている場合、変数定義は省略できます。</div>
<div class="line">同名の変数を複数のテンプレートで使用する場合、変数定義を合わせる必要があります。変数定義が一致していない場合は登録でエラーとなります。</div>
<div class="line">変数定義はAnsibleの仕様に準拠していますが、ITA独自仕様があります。変数名の命名規則は「 <span class="xref std std-ref">ansible_pioneer_variable_handling</span> 」と同様です。</div>
</div>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line"><strong>テンプレートの変数定義を読み取るタイミング</strong></div>
<div class="line">内部の処理でテンプレートの変数定義を読み取り、「 <a class="reference internal" href="#ansible-pioneer-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」で具体値が登録可能になります。</div>
<div class="line">読み取りのタイミングはリアルタイムではないので、「 <a class="reference internal" href="#ansible-pioneer-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」で変数が扱えるまでに <strong>時間がかかる</strong> 場合があります。</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line"><strong>変数定義の留意事項</strong></div>
<div class="line">変数定義の留意事項は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id107">
<caption><span class="caption-text">変数定義の留意事項</span><a class="headerlink" href="#id107" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>種類</p></th>
<th class="head"><p>留意事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>通常変数</p></td>
<td><p>具体値は省略可能です。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_sample_1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="nt">VAR_sample_2</span><span class="p">:</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>複数具体値変数</p></td>
<td><p>具体値は省略可能です。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_sample_1</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="nt">VAR_sample_2</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>多段変数</p></td>
<td><p>階層化された変数構造が定義出来ます。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_sample_1</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">item1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="w">    </span><span class="nt">item2</span><span class="p">:</span>
<span class="nt">VAR_sample_2</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">array</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">item1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="w">        </span><span class="nt">item2</span><span class="p">:</span>
</pre></div>
</div>
<p>同名の変数をdefault変数定義ファイルなどに定義している場合は、変数定義を合わせる必要があります。変数定義が一致していない場合は登録でエラーとなります。</p>
</td>
</tr>
<tr class="row-odd"><td><p>グローバル変数</p></td>
<td><p>具体値は省略可能です。</p>
<p>e.g.)</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">GBL_sample_1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
<span class="nt">GBL_sample_2</span><span class="p">:</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>ITA独自変数</p></td>
<td><p>変数の定義は不要です。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><strong>テンプレート埋込変数の使用例</strong></div>
</div>
<div class="line-block">
<div class="line">テンプレート管理で登録したテンプレートをPlaybookに記述する場合、該当のパラメータにテンプレート埋込変数名を記述します。テンプレート埋込変数名を使用しない場合、代入値自動登録設定で登録した変数や該当ファイルのパスを記述します。</div>
</div>
<div class="line-block">
<div class="line">※ファイル名にスペースなどが含まれている場合、適切にクォーテーションで囲まないと、作業実行時にエラーになる場合があります。</div>
</div>
<div class="line-block">
<div class="line">Exp) テンプレート管理で登録したhostsファイルをテンプレート埋込変数を使用して作業対象サーバの/etc/配下に設置する場合</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">テンプレート管理メニューから下記のようにhostsファイルを登録します。</div>
</div>
<table class="docutils align-left" id="id108">
<caption><span class="caption-text">テンプレート管理の登録内容</span><a class="headerlink" href="#id108" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 43%" />
<col style="width: 57%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>テンプレート埋込変数名</p></th>
<th class="head"><p>テンプレート素材</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TPF_hosts</p></td>
<td><p>hosts</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line">下記のようにPlaybookを記述します。</div>
<div class="line">※destはファイル名も記述してください。ファイル名の指定がない場合、登録したテンプレート素材のファイル名の前にITAの管理番号が付与された名前のファイル名で処理されます。</div>
<div class="line">　たとえば、dest=/etc/ とした場合、ファイル名は/etc/10桁の数値_hostsとなります。</div>
</div>
<div class="line-block">
<div class="line"><strong>Playbookの記述</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src=&#39;{{ TPF_hosts }}&#39; dest=/etc/hosts</span>
</pre></div>
</div>
</li>
</ol>
</div>
</section>
<section id="ansible-pioneer-unmanaged-var-list">
<span id="id52"></span><h4>管理対象外変数リスト<a class="headerlink" href="#ansible-pioneer-unmanaged-var-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣管理対象外変数リスト</span> では、ロールパッケージ管理のデフォルト変数定義やテンプレート管理の変数定義で定義している変数で、代入値自動登録の変数一覧に表示したくない変数のメンテナンス(参照/更新/廃止/復活)を行います。</div>
</div>
<figure class="align-default" id="id109">
<a class="reference internal image-reference" href="../../../../_images/unmanaged_var_list.png"><img alt="サブメニュー画面（管理対象外変数リスト）" src="../../../../_images/unmanaged_var_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（管理対象外変数リスト）</span><a class="headerlink" href="#id109" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">＋ 登録</span> ボタンより、オペレーション情報の登録を行います。</div>
</div>
<figure class="align-default" id="id110">
<a class="reference internal image-reference" href="../../../../_images/unmanaged_var_list.gif"><img alt="登録画面（管理対象外変数リスト）" src="../../../../_images/unmanaged_var_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（管理対象外変数リスト）</span><a class="headerlink" href="#id110" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">管理対象外変数リスト画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id111">
<caption><span class="caption-text">登録画面項目一覧（管理対象外変数リスト）</span><a class="headerlink" href="#id111" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 13%" />
<col style="width: 50%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 13%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>注意事項</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力方法</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>変数名</p></td>
<td><p>ロールパッケージ管理のデフォルト変数定義やテンプレート管理の変数定義で定義している変数で、代入値自動登録の変数一覧に表示したくない変数名を入力します。</p></td>
<td><p>〇</p></td>
<td><p>手動入力</p></td>
<td><p>説明欄記載のとおり</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
</section>
<section id="id53">
<h3>Ansible-Pioneerコンソール<a class="headerlink" href="#id53" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible-Pioneerコンソールの操作です。</div>
</div>
<section id="os">
<span id="ansible-pioneer-os-types"></span><h4>OS種別マスタ<a class="headerlink" href="#os" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-Pioneer‣OS種別マスタ</span> では、ITA の Pioneer より操作対象となる機器の OS種別を管理します。</div>
<div class="line">※本メニューは Ansible-Pioneer コンソールにのみ存在します。</div>
</div>
<figure class="align-default" id="id112">
<a class="reference internal image-reference" href="../../../../_images/movement_list.png"><img alt="サブメニュー画面（OS種別マスタ）" src="../../../../_images/movement_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（OS種別マスタ）</span><a class="headerlink" href="#id112" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">＋ 登録</span> ボタンより、OS情報の登録を行います。</div>
</div>
<figure class="align-default" id="id113">
<a class="reference internal image-reference" href="../../../../_images/movement_list.png"><img alt="登録画面（OS種別マスタ）" src="../../../../_images/movement_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（OS種別マスタ）</span><a class="headerlink" href="#id113" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">一覧/更新の <span class="guilabel">対話素材ファイル集</span> ボタンをクリックすると、対象の <a class="reference internal" href="#ansible-pioneer-dialog-files-ansible-pioneer-only"><span class="std std-ref">対話ファイル素材集</span></a> へ遷移します。</div>
</div>
<figure class="align-default" id="id114">
<a class="reference internal image-reference" href="../../../../_images/movement_list.png"><img alt="サブメニュー画面（OS種別マスタ）" src="../../../../_images/movement_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（OS種別マスタ）</span><a class="headerlink" href="#id114" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id115">
<caption><span class="caption-text">登録画面項目一覧（OS種別マスタ）</span><a class="headerlink" href="#id115" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>項目</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力形式</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><p>OS種別ID</p></td>
<td><p>登録情報を識別する一意のIDが自動入力されます。</p></td>
<td><p>〇</p></td>
<td><p>自動入力</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>OS種別名</p></td>
<td><p>任意の機器名称を入力します。</p></td>
<td><p>〇</p></td>
<td><p>手動入力</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-even"><td rowspan="3"><p>機種別</p></td>
<td><p>SV</p></td>
<td><p>機器種別がサーバの場合「●」を選択します。</p></td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td><p>NW</p></td>
<td><p>機器種別がネットワーク機器の場合「●」を選択します。</p></td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-even"><td><p>ST</p></td>
<td><p>機器種別がストレージ機器の場合「●」を選択します。</p></td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>ー</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="movement">
<span id="ansible-pioneer-movement-list"></span><h4>Movement一覧<a class="headerlink" href="#movement" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-Pioneer‣Movement一覧</span> ではMovement名のメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
</div>
<figure class="align-default" id="id116">
<a class="reference internal image-reference" href="../../../../_images/movement_list.png"><img alt="サブメニュー画面（Movement一覧）" src="../../../../_images/movement_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（Movement一覧）</span><a class="headerlink" href="#id116" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">＋ 登録</span> ボタンより、Movement情報の登録を行います。</div>
</div>
<figure class="align-default" id="id117">
<a class="reference internal image-reference" href="../../../../_images/registration_movement_list.gif"><img alt="登録画面（Movement一覧）" src="../../../../_images/registration_movement_list.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（Movement一覧）</span><a class="headerlink" href="#id117" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id118">
<caption><span class="caption-text">登録画面項目一覧（Movement一覧）</span><a class="headerlink" href="#id118" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>項目</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力方法</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p>Movement名</p></td>
<td><p>Movementの名称を入力します。</p></td>
<td><p>○</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>遅延タイマー</p></td>
<td><p>Movementが指定期間遅延した場合にステータスを遅延として警告表示したい場合に指定期間(1～)を入力します。(単位:分)</p>
<p>未入力の場合は警告表示しません。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-even"><td rowspan="6"><p>Ansible利用情報</p></td>
<td colspan="2"><p>ホスト指定形式</p></td>
<td><p>特別にIPアドレスで表現しないホストを指定したい場合に「ホスト名」を選択します。</p>
<p>通常はIPが推奨です。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>WinRM接続</p></td>
<td><p>対象ホストがWindowsServerの場合に、「●」を選択します。</p></td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>ヘッダーセクション</p></td>
<td><p>ITAが自動生成する親Playbookの先頭からtasksまたはrolesセクションまでのセクションを編集します。</p>
<p>未入力の場合は、以下を適用します。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ansible</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">remote_user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="c1"># Ansible Automation Controller</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>
</div>
<p>※winrm接続の場合は become: yesは適用しません。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>オプションパラメータ</p></td>
<td><p>Movement固有のオプションパラメータを入力します。</p>
<p>実行エンジンがAnsible Coreの場合はansible-playbookコマンドのオプションパラメータ、実行エンジ
ンがAnsible Core以外の場合はジョブテンプレートのパラメータを入力します。</p>
<p>オプションパラメータの詳細については、「 <a class="reference internal" href="ansible_legacyrole.html#ansible-legacyrole-option-parameter-list"><span class="std std-ref">オプションパラメータ一覧</span></a> 」を参照してください。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>ansible.cfg</p></td>
<td><p>作業実行時に使用するansible.cfgをアップロードします。</p>
<p>未アップロードの場合は、デフォルトが使用されます。</p>
<p>また、ロールパッケージ管理でアップロードされているzipファイルにansible.cfgが含まれている場合は、この項目でアップロードしたansible.cfgで上書きされます。</p>
</td>
<td><p>ー</p></td>
<td><p>ファイル選択</p></td>
<td><p>最大サイズ100Mバイト</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible Automation Controller利用情報</p></td>
<td><p>実行環境</p></td>
<td><p>Ansible Automation Controllerサーバに構築されている実行環境が表示されています。</p>
<p>実行する実行環境を選択します。</p>
<p>未選択の場合は、デフォルト「Default execution environment」が使用されます。</p>
</td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td></td>
</tr>
<tr class="row-even"><td colspan="3"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">WinRM接続で「〇」を選択した場合は接続するホストをすべてWindowsServerとみなします。</div>
</div>
</div>
</li>
</ol>
</section>
<section id="ansible-pioneer-dialog-type-list-ansible-pioneer-only">
<span id="id54"></span><h4>対話種別リスト<a class="headerlink" href="#ansible-pioneer-dialog-type-list-ansible-pioneer-only" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-Pioneer‣対話種別リスト</span> では、対話種別の登録／更新／廃止を行います。</div>
<div class="line">※本メニューはAnsible-Pioneer コンソールにのみ存在します。</div>
<div class="line">Ansible-Pioneerでは、「OS種別」ごとの差異を対話ファイルごとに定義し、同一目的の対話ファイルを「対話種別」として纏めて機器差分を吸収(抽象化)します。</div>
</div>
<figure class="align-default" id="id119">
<a class="reference internal image-reference" href="2.1/ja/manuals/ansible-driver/general_operations/image35.png"><img alt="サブメニュー画面（対話種別リスト）" src="2.1/ja/manuals/ansible-driver/general_operations/image35.png" style="width: 6.25388in; height: 2.78024in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（対話種別リスト）</span><a class="headerlink" href="#id119" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">＋ 登録</span> ボタンより、オペレーション情報の登録を行います。</div>
</div>
<figure class="align-default" id="id120">
<a class="reference internal image-reference" href="2.1/ja/manuals/ansible-driver/general_operations/image36.png"><img alt="登録画面（対話種別リスト）" src="2.1/ja/manuals/ansible-driver/general_operations/image36.png" style="width: 5.38086in; height: 0.9422in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（対話種別リスト）</span><a class="headerlink" href="#id120" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">一覧/更新の <span class="guilabel">Movement-対話種別紐付</span> ボタンをクリックすると、対象の <a class="reference internal" href="#ansible-pioneer-movement-details"><span class="std std-ref">Movement-対話種別紐付</span></a> へ遷移します。対話素材ファイル集ボタンをクリックすると、対象の <a class="reference internal" href="#ansible-pioneer-dialog-files-ansible-pioneer-only"><span class="std std-ref">対話ファイル素材集</span></a> へ遷移します。</div>
</div>
<figure class="align-default" id="id121">
<a class="reference internal image-reference" href="2.1/ja/manuals/ansible-driver/general_operations/image37.png"><img alt="サブメニュー画面（対話種別リスト）" src="2.1/ja/manuals/ansible-driver/general_operations/image37.png" style="width: 6.06944in; height: 1.17301in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（対話種別リスト）</span><a class="headerlink" href="#id121" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id122">
<caption><span class="caption-text">登録画面項目一覧（対話種別リスト）</span><a class="headerlink" href="#id122" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 15%" />
<col style="width: 50%" />
<col style="width: 5%" />
<col style="width: 10%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力方法</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>対話種別名</p></td>
<td><p>対話種別名を入力します</p></td>
<td><p>〇</p></td>
<td><p>リスト選択</p></td>
<td><p>最大長256バイト</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="ansible-pioneer-dialog-files-ansible-pioneer-only">
<span id="id55"></span><h4>対話ファイル素材集<a class="headerlink" href="#ansible-pioneer-dialog-files-ansible-pioneer-only" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-Pioneer‣対話ファイル素材集</span> では、ユーザーが作成した対話ファイルの登録／更新／廃止を行います。</div>
<div class="line">※本メニューは、Ansible-Pioneer コンソールにのみ存在します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">対話ファイルの記述などに関しては、「 <a class="reference internal" href="#ansible-pioneer-write-dialog-file-ansible-pioneer"><span class="std std-ref">対話ファイル（Ansible-Pioneer）の記述</span></a> 」を参照してください。</div>
<div class="line">「対話種別」と「OS種別」の組み合わせごとに対話ファイルを登録します。</div>
<div class="line">１つの「対話種別」で複数のOSに対応させたい場合は、同じ「対話種別」で、「OS種別」それぞれについて対話ファイルを登録してください。</div>
</div>
<figure class="align-default" id="id123">
<a class="reference internal image-reference" href="2.1/ja/manuals/ansible-driver/general_operations/image38.png"><img alt="サブメニュー画面（対話ファイル素材集）" src="2.1/ja/manuals/ansible-driver/general_operations/image38.png" style="width: 6.4939in; height: 2.90025in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（対話ファイル素材集）</span><a class="headerlink" href="#id123" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">＋ 登録</span> ボタンより、対話ファイル素材の登録を行います。</div>
</div>
<figure class="align-default" id="id124">
<a class="reference internal image-reference" href="2.1/ja/manuals/ansible-driver/general_operations/image36.png"><img alt="登録画面（対話ファイル素材集）" src="2.1/ja/manuals/ansible-driver/general_operations/image36.png" style="width: 5.19507in; height: 0.90966in;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（対話ファイル素材集）</span><a class="headerlink" href="#id124" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">一覧/更新の対話種別のリンクをクリックすると、対象の <a class="reference internal" href="#ansible-pioneer-dialog-type-list-ansible-pioneer-only"><span class="std std-ref">対話種別リスト</span></a> へ遷移します。</div>
<div class="line">また、OS種別のリンクをクリックすると、対象の <a class="reference internal" href="#ansible-pioneer-os-types"><span class="std std-ref">OS種別マスタ</span></a> へ遷移します。</div>
</div>
<figure class="align-default" id="id125">
<a class="reference internal image-reference" href="2.1/ja/manuals/ansible-driver/general_operations/image39.png"><img alt="サブメニュー画面（対話ファイル素材集）" src="2.1/ja/manuals/ansible-driver/general_operations/image39.png" style="width: 6.2281in; height: 1.2785in;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（対話ファイル素材集）</span><a class="headerlink" href="#id125" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id126">
<caption><span class="caption-text">登録画面項目一覧（対話ファイル素材集）</span><a class="headerlink" href="#id126" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 15%" />
<col style="width: 50%" />
<col style="width: 5%" />
<col style="width: 10%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>対話種別</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力方法</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>対話種別名</p></td>
<td><div class="line-block">
<div class="line">対話種別リストに登録されている対話種別が表示されます。</div>
<div class="line">登録する対話ファイルの対話種別を選択します。</div>
</div>
</td>
<td><p>〇</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td><p>OS種別</p></td>
<td><div class="line-block">
<div class="line">OS種別マスタに登録されているOS種別が表示されます。</div>
<div class="line">登録する対話ファイルのOS種別を選択します。</div>
</div>
</td>
<td><p>〇</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-even"><td><p>対話ファイル素材</p></td>
<td><div class="line-block">
<div class="line">対話種別とOS種別に対応する対話ファイルをアップロードします。</div>
<div class="line">アップロードする対話ファイルは文字コードが UTF-8 のBOMなしで作成して下さい。</div>
<div class="line">文字コードが UTF-8 のBOMなし以外の対話ファイルはアップロードでエラーになります。</div>
</div>
</td>
<td><p>〇</p></td>
<td><p>ファイル登録</p></td>
<td><p>最大サイズ4Gバイト</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">「登録」の前に、「対話ファイル」を「事前アップロード（①）」してください。「アップロード状況（②）」に対話ファイルのファイル名が表示されたのを確認してから、「登録」ボタンを押してください。</div>
</div>
<a class="reference internal image-reference" href="2.1/ja/manuals/ansible-driver/general_operations/image_2a_3.png"><img alt="2.1/ja/manuals/ansible-driver/general_operations/image_2a_3.png" class="align-center" src="2.1/ja/manuals/ansible-driver/general_operations/image_2a_3.png" style="width: 1.81218in; height: 0.98027in;" /></a>
<div class="line-block">
<div class="line">対話ファイルはYAML形式のファイルとして扱います。YAML形式に準じていない記述があると、アップロード時にエラーとなります。詳しくは、「 <a class="reference internal" href="#ansible-pioneer-things-to-keep-in-mind-when-writing-dialogue-files-in-yaml-format"><span class="std std-ref">対話ファイルをyaml形式で記載する際の注意事項</span></a> 」を参照してください。</div>
<div class="line">内部の処理で対話ファイル内に定義している変数を取り出します。取り出した変数は、「 <a class="reference internal" href="#ansible-pioneer-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」で具体値の登録が可能になります。</div>
<div class="line">抜出するタイミングはリアルタイムではありませんので、「 <a class="reference internal" href="#ansible-pioneer-substitution-value-auto-registration-setting"><span class="std std-ref">代入値自動登録設定</span></a> 」で変数が扱えるまでに <strong>時間がかかる※</strong> 場合があります。</div>
</div>
</li>
</ol>
</section>
<section id="ansible-pioneer-movement-details">
<span id="id56"></span><h4>Movement-対話種別紐付<a class="headerlink" href="#ansible-pioneer-movement-details" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">Movementで実行するロールパッケージのメンテナンス(閲覧/登録/更新/廃止)を行います。</div>
</div>
<figure class="align-default" id="id127">
<a class="reference internal image-reference" href="../../../../_images/movement_role.png"><img alt="サブメニュー画面（Movement-対話種別紐付）" src="../../../../_images/movement_role.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（Movement-対話種別紐付）</span><a class="headerlink" href="#id127" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">＋ 登録</span> ボタンより、Movement-対話種別紐付の登録を行います。</div>
</div>
<figure class="align-default" id="id128">
<a class="reference internal image-reference" href="../../../../_images/registration_movement_role.gif"><img alt="登録画面（Movement-対話種別紐付）" src="../../../../_images/registration_movement_role.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（Movement-対話種別紐付）</span><a class="headerlink" href="#id128" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id129">
<caption><span class="caption-text">登録画面項目一覧（Movement-対話種別紐付の場合）</span><a class="headerlink" href="#id129" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 15%" />
<col style="width: 50%" />
<col style="width: 5%" />
<col style="width: 10%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>対話種別</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力方法</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Movement</p></td>
<td><div class="line-block">
<div class="line">Movement一覧で登録したMovementが表示されます。</div>
<div class="line">Movement を選択します。</div>
</div>
</td>
<td><p>〇</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td><p>対話種別</p></td>
<td><div class="line-block">
<div class="line">「 <a class="reference internal" href="#ansible-pioneer-dialog-type-list-ansible-pioneer-only"><span class="std std-ref">対話種別リスト</span></a> 」で登録した対話種別が表示されます。</div>
<div class="line">実行する対話種別を選択します。</div>
<div class="line">ホスト毎にOS種別と対話種別に関連付く対話ファイルが実行対象となります。</div>
</div>
</td>
<td><p>〇</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-even"><td><p>インクルード順序</p></td>
<td><div class="line-block">
<div class="line">プレイブック素材の実行順序(1～:一意値)を入力します。</div>
<div class="line">入力されたインクルード順序(昇順)でプレイブック素材が実行されます。</div>
</div>
</td>
<td><p>〇</p></td>
<td><p>手動入力</p></td>
<td><p>半角整数</p></td>
</tr>
<tr class="row-odd"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>〇</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="ansible-pioneer-substitution-value-auto-registration-setting">
<span id="id57"></span><h4>代入値自動登録設定<a class="headerlink" href="#ansible-pioneer-substitution-value-auto-registration-setting" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">メニュー作成機能で作成したパラメータシートの項目の設定値とMovementの変数を紐付けます。登録した情報は内部の処理により代入値管理と作業対象ホストに反映されます。</div>
</div>
<figure class="align-default" id="id130">
<a class="reference internal image-reference" href="../../../../_images/substitution_value_auto_registration_setting_role.png"><img alt="サブメニュー画面（代入値自動登録設定）" src="../../../../_images/substitution_value_auto_registration_setting_role.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（代入値自動登録設定）</span><a class="headerlink" href="#id130" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">＋ 登録</span> ボタンより代入値自動登録設定を行います。</div>
</div>
<figure class="align-default" id="id131">
<a class="reference internal image-reference" href="../../../../_images/registration_substitution_value_auto_registration_setting_role.gif"><img alt="登録画面（代入値自動登録設定）" src="../../../../_images/registration_substitution_value_auto_registration_setting_role.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">登録画面（代入値自動登録設定）</span><a class="headerlink" href="#id131" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">登録画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id132">
<caption><span class="caption-text">登録画面項目一覧（代入値自動登録設定）</span><a class="headerlink" href="#id132" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>項目</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力方法</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="2"><p>パラメータシート(From)</p></td>
<td><p>メニューグループ:メニュー:項目</p></td>
<td><p>メニュー作成機能で作成したパラメータシートの項目が表示されます。</p>
<p>対象の項目を選択します。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td><p>代入順序</p></td>
<td><p>メニュー作成機能で作成したパラメータシートが縦型メニューの場合、パラメータシートで登録している代入順序を入力します。</p></td>
<td><p><a class="reference internal" href="#parashi-substitution"><span class="std std-ref">※1</span></a></p></td>
<td><p>手動入力</p></td>
<td><p>1～2147483647</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>登録方式</p></td>
<td><p>Value型:項目の設定値を紐付けた変数の具体値とする場合に選択します。</p>
<p>Key型:項目の名称を紐付けた変数の具体値とする場合に選択します。</p>
<p>項目の設定値が空白の場合は紐付け対象外となります。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>Movement名</p></td>
<td><p>Movement一覧で登録したMovementが表示されます。</p>
<p>Movementを選択します。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>IaC変数(To)</p></td>
<td><p>Movement名:変数名</p></td>
<td><p>Movement-ロール紐付で登録した資材で使用している変数が表示されます。</p>
<p>具体値に紐付けたい変数を選択します。</p>
</td>
<td><p>○</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td><p>代入順序</p></td>
<td><p>複数具体値が設定できる変数の場合のみ必須入力になります。</p>
<p>具体値の代入順序（1～）を入力します。入力値に従い昇順で代入されます。具体値が複数ない場合でも代入順序（1～）を入力します。</p>
</td>
<td><p><a class="reference internal" href="#substitution"><span class="std std-ref">※2</span></a></p></td>
<td><p>手動入力</p></td>
<td><p>1～2147483647</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>NULL連携</p></td>
<td><p>パラメータシートの具体値がNULL(空白)の場合に、代入値管理への登録をNULL(空白)の値で行うか設定します。</p>
<p>・「True」の場合、パラメータシートの値がどのような値でも代入値管理への登録が行われます。</p>
<p>・「False」の場合、パラメータシートに値が入っている場合のみ代入値管理への登録が行われます。</p>
<p>・空白の場合、Ansibleインターフェース情報の「NULL連携」の値が適用されます。</p>
</td>
<td><p>※3</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※1:パラメータシート(縦メニュー)を使用する場合のみ必須</div>
<div class="line">※2:選択した変数が複数具体値設定可能な変数の場合のみ必須</div>
<div class="line">※3:任意</div>
</div>
</li>
</ol>
<div class="admonition note" id="parashi-substitution">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><strong>パラメータシート(縦メニュー)の場合</strong></div>
<div class="line">パラメータシート(縦メニュー)のリピート設定されている項目とMovementの変数を紐付ける場合、 <span class="menuselection">Ansible-Pioneer‣代入値自動登録設定</span> でパラメータシート(From) の代入順序を入力する必要があります。</div>
<div class="line">パラメータシート(縦メニュー)と代入値自動登録設定の関係を以下の図に示します。</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../../_images/parameter.png"><img alt="パラメータシート(縦メニュー)使用時の代入値自動登録設定登録方法" src="../../../../_images/parameter.png" style="width: 600px;" /></a>
</figure>
</div>
<div class="admonition note" id="substitution">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><strong>代入順序の入力</strong></div>
</div>
<div class="line-block">
<div class="line">代入順序が未入力の場合は、通常変数として扱います。</div>
<div class="line">代入順序が入力されている場合は、複数具体値変数として扱います。複数具体値変数の場合は、</div>
<div class="line">複数の具体値が必要ない場合(具体値が 1 個でよい)でも代入順序を入力してください。</div>
<div class="line">特定の複数具体値変数に対して代入順序が連続していなくても問題ありません。</div>
<div class="line"><br /></div>
<div class="line">e.g.)複数具体値変数に代入順序を入力して作業実行する場合</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">下記のようにロールパッケージの変数定義ファイル(defaults/main.yml)に変数を定義して、 <span class="menuselection">Ansible-Pioneer‣ロールパッケージ管理</span> でロールパッケージを登録します。</div>
<div class="line"><strong>変数定義ファイルの記述内容</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_substitutionA</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user-name</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">group-name</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">meta-name</span>

<span class="nt">VAR_substitutionB</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">login</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">authorized</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">space</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster</span>
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-Pioneer‣代入値自動登録設定</span> で紐付対象メニューに登録されている項目の設定値とRole内の変数を紐付けします。</div>
</div>
<table class="docutils align-left" id="id133">
<caption><span class="caption-text">紐付対象メニュー(sample-menu)の登録内容</span><a class="headerlink" href="#id133" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p><strong>ホスト名</strong></p></th>
<th class="head" rowspan="2"><p><strong>オペレーション名</strong></p></th>
<th class="head" colspan="4"><p><strong>パラメータ</strong></p></th>
</tr>
<tr class="row-even"><th class="head"><p><strong>項目1</strong></p></th>
<th class="head"><p><strong>項目2</strong></p></th>
<th class="head"><p><strong>項目3</strong></p></th>
<th class="head"><p><strong>項目4</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>test-host</p></td>
<td><p>test-ope</p></td>
<td><p>value1</p></td>
<td><p>value2</p></td>
<td><p>value3</p></td>
<td><p>value4</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id134">
<caption><span class="caption-text">代入値自動登録設定の登録内容</span><a class="headerlink" href="#id134" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>メニュー名</strong></p></th>
<th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>変数名</strong></p></th>
<th class="head"><p><strong>代入順序</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sample-menu</p></td>
<td><p>項目1</p></td>
<td><p>VAR_substitutionA</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>sample-menu</p></td>
<td><p>項目2</p></td>
<td><p>VAR_substitutionA</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>sample-menu</p></td>
<td><p>項目3</p></td>
<td><p>VAR_substitutionA</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>sample-menu</p></td>
<td><p>項目1</p></td>
<td><p>VAR_substitutionB</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>sample-menu</p></td>
<td><p>項目2</p></td>
<td><p>VAR_substitutionB</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>sample-menu</p></td>
<td><p>項目3</p></td>
<td><p>VAR_substitutionB</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>sample-menu</p></td>
<td><p>項目4</p></td>
<td><p>VAR_substitutionB</p></td>
<td><p>3</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line">作業実行時、投入データ(InputData_xxxx.zip)内のホスト変数ファイル(host_vars/test-host)には、代入値自動登録設定で登録した変数が下記のように出力されます。</div>
<div class="line"><strong>ホスト変数ファイルへの出力内容</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_substitutionA</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value3</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value1</span>
<span class="nt">VAR_substitutionB</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value3</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value1</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value4</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value2</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="admonition note" id="host">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><strong>ホスト変数ファイルへの出力</strong></div>
<div class="line">代入値自動登録設定で具体値を登録した変数のみが作業実行時にホスト変数ファイルへ出力されます。</div>
<div class="line">作業実行時に Playbook または対話ファイルで使用している変数の具体値が代入値管理に登録されていないと作業実行が想定外エラーとなります。</div>
<div class="line"><br /></div>
<div class="line">e.g.) 代入値自動登録設定で具体値を登録した変数と作業実行時にホスト変数ファイルに出力される変数の確認</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">下記のようにロールパッケージの変数定義ファイル(defaults/main.yml)に変数を定義して、 <span class="menuselection">Ansible-Pioneer‣ロールパッケージ管理</span> でロールパッケージを登録します。</div>
<div class="line"><strong>変数定義ファイルの記述内容</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_output</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alice</span>
<span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="nt">user</span><span class="p">:</span>
<span class="w">      </span><span class="nt">root</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">craete_users</span><span class="p">:</span>
<span class="w">          </span><span class="nt">prod</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">prod_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user1</span>
<span class="w">          </span><span class="nt">dev</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dev_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user2</span>
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-Pioneer‣代入値自動登録設定</span> で紐付対象メニューに登録されている項目の設定値とRole内の変数を紐付けします。</div>
</div>
<table class="docutils align-left" id="id135">
<caption><span class="caption-text">紐付対象メニュー(sample-menu)の登録内容</span><a class="headerlink" href="#id135" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p><strong>ホスト名</strong></p></th>
<th class="head" rowspan="2"><p><strong>オペレーション名</strong></p></th>
<th class="head" colspan="2"><p><strong>パラメータ</strong></p></th>
</tr>
<tr class="row-even"><th class="head"><p><strong>項目1</strong></p></th>
<th class="head"><p><strong>項目2</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>test-host</p></td>
<td><p>test-ope</p></td>
<td><p>value1</p></td>
<td><p>value2</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id136">
<caption><span class="caption-text">代入値自動登録設定の登録内容</span><a class="headerlink" href="#id136" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><strong>メニュー名</strong></p></th>
<th class="head"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>変数名</strong></p></th>
<th class="head"><p><strong>メンバー変数名</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>sample-menu</p></td>
<td><p>項目1</p></td>
<td><p>VAR_output</p></td>
<td><p>[0].name</p></td>
</tr>
<tr class="row-odd"><td><p>sample-menu</p></td>
<td><p>項目2</p></td>
<td><p>VAR_output</p></td>
<td><p>[0].user.root[0].dev[0].dev_user</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line">作業実行時、投入データ(InputData_xxxx.zip)内のホスト変数ファイル(host_vars/test-host)には、代入値自動登録設定で登録した変数が下記のように出力されます。</div>
<div class="line"><strong>ホスト変数ファイルへの出力内容</strong></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">VAR_output</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value1</span>
<span class="w">    </span><span class="nt">user</span><span class="p">:</span>
<span class="w">      </span><span class="nt">root</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dev</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">dev_user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value2</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="admonition note" id="file-and-templete">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><strong>ファイル埋込変数とテンプレート埋込変数をPlaybookの変数に紐付して使用する例</strong></div>
<div class="line">「Ansible共通:ファイル管理:ファイル埋込変数名」「Ansible共通:テンプレート管理:テンプレート埋込変数名」をパラメータシートの項目として代入値自動登録設定で使用した場合、項目の設定値は選択されている変数名となり、紐付している変数の具体値は '{{ 変数名 }}' として代入値管理に反映されます。</div>
<div class="line">ファイルパスはITAが作業実行時に配置したファイルパスをホスト変数経由でansibleが解釈し処理します。</div>
<div class="line">e.g.) ファイル埋込変数 CPF_test とテンプレート埋込変数 TPF_sample を代入値自動登録設定でPlaybookの変数に紐付して使用する場合</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible共通‣ファイル管理／テンプレート管理</span> で下記のように登録します。</div>
</div>
<table class="docutils align-left" id="id137">
<caption><span class="caption-text">ファイル管理の登録内容</span><a class="headerlink" href="#id137" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 56%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ファイル埋込変数名</p></th>
<th class="head"><p>ファイル素材</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPF_test</p></td>
<td><p>test_file.txt</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id138">
<caption><span class="caption-text">テンプレート管理の登録内容</span><a class="headerlink" href="#id138" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 56%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>テンプレート埋込変数名</p></th>
<th class="head"><p>テンプレート素材</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>TPF_sample</p></td>
<td><p>sample.tpl</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><span class="menuselection">メニュー作成‣メニュー定義・作成</span> で「Ansible共通:ファイル管理:ファイル埋込変数名」「Ansible共通:テンプレート管理:テンプレート埋込変数名」をパラメータシートの項目としてメニュー作成後、 <span class="menuselection">入力用‣サンプルパラメータシート(メニュー名)</span> で項目の設定値としてファイル埋込変数とテンプレート埋込変数を登録します。</div>
</div>
<figure class="align-default" id="id139">
<a class="reference internal image-reference" href="images/ja/menu_create/menu_definition_and_create/legacyrole_menucreate.png"><img alt="メニュー定義・作成画面" src="images/ja/menu_create/menu_definition_and_create/legacyrole_menucreate.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">メニュー定義・作成画面</span><a class="headerlink" href="#id139" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<table class="docutils align-left" id="id140">
<caption><span class="caption-text">サンプルパラメータシート(メニュー名)の登録内容</span><a class="headerlink" href="#id140" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p><strong>ホスト名</strong></p></th>
<th class="head" rowspan="2"><p><strong>オペレーション名</strong></p></th>
<th class="head" colspan="2"><p><strong>パラメータ</strong></p></th>
</tr>
<tr class="row-even"><th class="head"><p><strong>ファイル管理</strong></p></th>
<th class="head"><p><strong>テンプレート管理</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>test-host</p></td>
<td><p>test-ope</p></td>
<td><p>CPF_test</p></td>
<td><p>TPF_sample</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-Pioneer-&gt;代入値自動登録設定</span> でのパラメータシートに登録した項目の設定値とPlaybookの変数を紐付して <span class="menuselection">Ansible-Pioneer‣作業実行</span> で作業実行します。</div>
</div>
<table class="docutils align-left" id="id141">
<caption><span class="caption-text">代入値自動登録設定の登録内容</span><a class="headerlink" href="#id141" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 45%" />
<col style="width: 27%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>メニュー名</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>変数名</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>サンプルパラメータシート</p></td>
<td><p>ファイル管理</p></td>
<td><p>VAR_filetest</p></td>
</tr>
<tr class="row-odd"><td><p>サンプルパラメータシート</p></td>
<td><p>テンプレート管理</p></td>
<td><p>VAR_temptest</p></td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-Pioneer‣作業状態確認</span> の <span class="guilabel">代入値確認</span> ボタンで具体値に '{{ CPF_test }}' '{{ TPF_sample }}' が反映されていることが確認できます。</div>
<div class="line">また、作業実行後、作業対象サーバに1. で登録したファイル素材とテンプレート素材が設置されます。</div>
</div>
<figure class="align-default" id="id142">
<a class="reference internal image-reference" href="../../../../_images/general_operations_note.png"><img alt="作業状態確認の代入値確認画面" src="../../../../_images/general_operations_note.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">作業状態確認の代入値確認画面</span><a class="headerlink" href="#id142" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
</ol>
</div>
</section>
<section id="ansible-pioneer-execution">
<span id="id58"></span><h4>作業実行<a class="headerlink" href="#ansible-pioneer-execution" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">作業の実行を指示します。Movement一覧、オペレーション一覧からそれぞれラジオボタンで選択し、 <span class="guilabel">作業実行</span> ボタンを押すと、「 <a class="reference internal" href="#ansible-pioneer-check-operation-status"><span class="std std-ref">作業状態確認</span></a> 」に遷移し、実行されます。</div>
</div>
<figure class="align-default" id="id143">
<a class="reference internal image-reference" href="../../../../_images/execution_screen.gif"><img alt="作業実行画面" src="../../../../_images/execution_screen.gif" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">作業実行画面</span><a class="headerlink" href="#id143" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>ドライラン</strong></div>
<div class="line">「ドライラン」ボタンをクリックすると、実際に対象機器に対して構築作業をせず、ドライランを行うことができます。</div>
<div class="line">ドライランを行った場合の動作は、Ansible-Playbookコマンドの--checkパラメータを指定してroleを実行します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>予約日時の指定</strong></div>
<div class="line">「予約日時」を入力することで、実行を予約することがきます。</div>
<div class="line">「予約日時」には、未来の日時のみ登録可能です。</div>
</div>
</li>
</ol>
</section>
<section id="ansible-pioneer-check-operation-status">
<span id="id59"></span><h4>作業状態確認<a class="headerlink" href="#ansible-pioneer-check-operation-status" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">作業の実行状態を監視します。</div>
</div>
<figure class="align-default" id="id144">
<a class="reference internal image-reference" href="../../../../_images/check_operation_status.png"><img alt="サブメニュー画面（作業状態確認）" src="../../../../_images/check_operation_status.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（作業状態確認）</span><a class="headerlink" href="#id144" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>実行状態表示</strong></div>
<div class="line">実行状況に即し、「ステータス」が表示されます。</div>
<div class="line">また、実行ログ、エラーログに実行状況の詳細が表示されます。</div>
<div class="line">「実行種別」には、ドライランの場合は「ドライラン」、それ以外は「通常」が表示されます。</div>
<div class="line">ステータスが想定外エラーで終了した場合、Webコンテンツの登録不備が原因であれば、エラーログにメッセージが表示されます。</div>
<div class="line">また、「 <a class="reference internal" href="#ansible-pioneer-interface-information"><span class="std std-ref">インターフェース情報</span></a> 」の登録不備等で、Ansible RestAPIとの通信に失敗した場合にはエラーログにメッセージが表示されません。この場合は、アプリケーションログにエラー情報が記録されます。必要に応じてアプリケーションログを確認ください。</div>
<div class="line">Conductorから実行した場合に、「呼出元Conductor」には、どのConductorから実行されたかを表示します。</div>
<div class="line">Ansible-Pioneerドライバから直接実行した場合は空欄になります。</div>
<div class="line">「実行ユーザ」には、作業実行メニューより「実行」ボタンまたは「ドライラン」ボタンを押下した際のログインユーザが表示されます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>作業対象ホスト確認</strong></div>
<div class="line"><span class="guilabel">作業対象ホスト確認</span> ボタンで「 <a class="reference internal" href="#ansible-pioneer-target-host"><span class="std std-ref">作業対象ホスト</span></a> 」が表示され、作業対象のオペレーションとMovementに絞り込んだホストが表示されます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>代入値確認</strong></div>
<div class="line"><span class="guilabel">代入値確認</span> ボタンで「 <a class="reference internal" href="#ansible-pioneer-substitution-value-list"><span class="std std-ref">代入値管理</span></a> 」が表示され、作業対象のオペレーションとMovementに絞り込んだ代入値が表示されます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>緊急停止/予約取り消し</strong></div>
<div class="line"><span class="guilabel">緊急停止</span> ボタンで構築作業を停止させることができます。</div>
<div class="line">また、実行前の「予約実行」の作業の場合は、 <span class="guilabel">予約取消</span> ボタンが表示されます。 <span class="guilabel">予約取消</span> ボタンで予約実行が取り消せます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>実行ログ表示</strong></div>
<div class="line">Ansible Automation Controllerで実行した場合、構築対象機器の機器一覧のユーザー・パスワード・インスタンスグルーブなのどの項目値でグループ化された構築対象機器の単位でPlaybookが実行され、ansibleの実行ログが分割されます。</div>
<div class="line">さらに、Movement一覧のオプションパラメータでジョブスライス数を指定することによりグループ化された構築対象機器をさらにジョブスライス数で分割しplaybookが実行され、ansibleの実行ログも分割されます。</div>
<div class="line">実行ログが分割された場合、表示ログファイルのプルダウンが表示され、表示したいログファイルを選択する事ができます。</div>
</div>
<div class="line-block">
<div class="line">表示ログファイルのプルダウンに表示されるログファイル名は以下の2種類があります。</div>
<div class="line">exec.log:　全ての実行ログをまとめたログファイルです。</div>
<div class="line">exec.log以外: 分割された実行ログファイルです。ファイル命名規則は以下になります。</div>
<div class="line">Ita_&lt;mode名&gt;_executions_jobtpl_&lt;作業番号&gt;_&lt;グループ番号&gt;_&lt;通番&gt;</div>
</div>
<table class="docutils align-left" id="id145">
<caption><span class="caption-text">分割された実行ログファイルの命名要素</span><a class="headerlink" href="#id145" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 29%" />
<col style="width: 71%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>要素</p></th>
<th class="head"><p>内容</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>mode名</p></td>
<td><p>実行したモード名 legacy_role</p></td>
</tr>
<tr class="row-odd"><td><p>作業番号</p></td>
<td><p>作業管理メニューの作業実行No</p></td>
</tr>
<tr class="row-even"><td><p>グループ番号</p></td>
<td><p>構築対象機器の機器一覧のユーザー・パスワード・インスタンスグルーブなのどの項目値でグルーブ化した1からの通番です。</p></td>
</tr>
<tr class="row-odd"><td><p>通番</p></td>
<td><div class="line-block">
<div class="line">ジョブスライス数の設定によりグループ内を分割した1からの通番です。</div>
<div class="line">0の場合はジョブスライス数による分割がなかったことのを表します。</div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
<li><div class="line-block">
<div class="line"><strong>ログ検索</strong></div>
<div class="line">実行ログ、エラーログは、フィルタリングができます。各ログのフィルタのテキストボックスに検索したい文字列を入力し、「該当行のみ表示」のチェックボックスをチェックすることで該当する行だけが表示されます。</div>
<div class="line">実行ログ、エラーログのリフレッシュ表示間隔と最大表示行数を、「 <a class="reference internal" href="#ansible-pioneer-interface-information"><span class="std std-ref">インターフェース情報</span></a> 」の「状態監視周期（単位ミリ秒）」と「進行状態表示行数」で設定できます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>投入データ</strong></div>
<div class="line">実行したPlaybookなどをダウンロードすることができます。</div>
<div class="line">投入データの構成は「 <a class="reference internal" href="#ansible-pioneer-the-linkage-between-the-input-data-used-during-ansible-execution-and-ita-menu"><span class="std std-ref">Ansible実行時に使用される投入データとITAメニューの紐づけ</span></a> 」を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>結果データ</strong></div>
<div class="line">実行ログ、エラーログなどをダウンロードすることができます。</div>
</div>
</li>
</ol>
</section>
<section id="ansible-pioneer-execution-list">
<span id="id60"></span><h4>作業管理<a class="headerlink" href="#ansible-pioneer-execution-list" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">作業の履歴を閲覧できます。</div>
<div class="line">条件を指定し <span class="guilabel">フィルタ</span> ボタンをクリックすると、作業一覧テーブルを表示します。</div>
<div class="line"><span class="guilabel">詳細</span> ボタンで <a class="reference internal" href="#ansible-pioneer-check-operation-status"><span class="std std-ref">作業状態確認</span></a> に遷移し、実行状態の詳細を見ることができます。</div>
</div>
<figure class="align-default" id="id146">
<a class="reference internal image-reference" href="../../../../_images/execution_list.png"><img alt="サブメニュー画面（作業管理）" src="../../../../_images/execution_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（作業管理）</span><a class="headerlink" href="#id146" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</section>
<section id="ansible-pioneer-target-host">
<span id="id61"></span><h4>作業対象ホスト<a class="headerlink" href="#ansible-pioneer-target-host" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">Ansible-Pioneer‣作業対象ホスト</span> では、オペレーションに紐付くMovementおよびホストを閲覧できます。</div>
</div>
<figure class="align-default" id="id147">
<a class="reference internal image-reference" href="../../../../_images/target_host.png"><img alt="サブメニュー画面（作業対象ホスト）" src="../../../../_images/target_host.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（作業対象ホスト）</span><a class="headerlink" href="#id147" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">閲覧画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id148">
<caption><span class="caption-text">閲覧画面項目一覧（作業対象ホスト）</span><a class="headerlink" href="#id148" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>作業No</p></td>
<td><p>作業実行時に自動採番した36桁の文字列が表示されます。</p></td>
</tr>
<tr class="row-odd"><td><p>オペレーション</p></td>
<td><p>オペレーション一覧に登録されているオペレーションが表示されます。</p></td>
</tr>
<tr class="row-even"><td><p>Movement名</p></td>
<td><p>Movement一覧に登録されているMovementが表示されます。</p></td>
</tr>
<tr class="row-odd"><td><p>ホスト名</p></td>
<td><p>機器一覧に登録されているホスト名が表示されます。</p></td>
</tr>
<tr class="row-even"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
<section id="ansible-pioneer-substitution-value-list">
<span id="id62"></span><h4>代入値管理<a class="headerlink" href="#ansible-pioneer-substitution-value-list" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">オペレーションに紐付くMovementで利用されるRole内の変数に代入する具体値を閲覧できます。</div>
</div>
<figure class="align-default" id="id149">
<a class="reference internal image-reference" href="../../../../_images/substitution_value_list.png"><img alt="サブメニュー画面（代入値管理）" src="../../../../_images/substitution_value_list.png" style="width: 800px;" /></a>
<figcaption>
<p><span class="caption-text">サブメニュー画面（代入値管理）</span><a class="headerlink" href="#id149" title="この画像へのパーマリンク">¶</a></p>
</figcaption>
</figure>
</li>
<li><div class="line-block">
<div class="line">閲覧画面の項目一覧は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id150">
<caption><span class="caption-text">閲覧画面項目一覧（代入値管理）</span><a class="headerlink" href="#id150" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="3"><p>項目</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="3"><p>作業No</p></td>
<td><p>作業実行時に自動採番した36桁の文字列が表示されます。</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>オペレーション</p></td>
<td><p>作業対象ホストに登録されているオペレーションが表示されます。</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>Movement名</p></td>
<td><p>作業対象ホストに登録されているデータの中から、選択されたオペレーションに紐づくMovementが表示されます。</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>ホスト名</p></td>
<td><p>作業対象ホストに登録されているデータで選択されたオペレーションとMovementに紐づくホストが表示されます。</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>Movement名:変数名</p></td>
<td><p>Movement-ロール紐付に登録されている資材の中から、選択されたMovementにアタッチしている変数名が表示されます。</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>Movement名:変数名:メンバー変数</p></td>
<td><p>変数名で多段変数を選択した場合に多段変数のメンバー変数が表示されます。</p></td>
</tr>
<tr class="row-even"><td rowspan="3"><p>具体値</p></td>
<td rowspan="2"><p>文字列</p></td>
<td><p>Sensitive設定</p></td>
<td><p>「OFF」または「ON」が表示されます。</p>
<p>Ansibleに渡すホスト変数ファイルには、ansible-vaultで暗号化された内容が設定されます。</p>
</td>
</tr>
<tr class="row-odd"><td><p>値</p></td>
<td><p>オペレーション/Movement/ホストで使用する変数の具体値が表示されます。</p>
<p>代入値自動登録設定でファイル埋込変数とテンプレート埋込変数をPlaybookの変数に紐付した場合、具体値には '{{ CPF_xxxx }}' '{{ TPF_xxxx }}'が表示されます。</p>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p>ファイル</p></td>
<td><p>オペレーション/Movement/ホストで使用する変数にファイルを埋込む場合に、埋込むファイルがアップロードされます。</p></td>
</tr>
<tr class="row-odd"><td colspan="3"><p>代入順序</p></td>
<td><p>複数具体値が設定できる変数の場合のみ表示されます。</p></td>
</tr>
<tr class="row-even"><td colspan="3"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</section>
</section>
</section>
<section id="id63">
<h2>構築コード記述方法<a class="headerlink" href="#id63" title="この見出しへのパーマリンク">¶</a></h2>
<section id="ansible-pioneer-write-dialog-file-ansible-pioneer">
<span id="id64"></span><h3>対話ファイル（Ansible-Pioneer）の記述<a class="headerlink" href="#ansible-pioneer-write-dialog-file-ansible-pioneer" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Ansible-Pioneerでは、ITA独自モジュールをAnsibleに組込んでいます。</div>
<div class="line">対話ファイルはITA独自書式となります。</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">文字コードは、UTF-8のBOMなしで作成してください。</div>
<div class="line">対話ファイルはYAML形式のファイルとして扱います。YAML形式に準じていない記述があると、対話ファイルのアップロード時や作業実行時にエラーとなります。詳しくは、本章の「 <a class="reference internal" href="#ansible-pioneer-things-to-keep-in-mind-when-writing-dialogue-files-in-yaml-format"><span class="std std-ref">対話ファイルをyaml形式で記載する際の注意事項</span></a> 」を参照してください。</div>
</div>
</div>
<section id="id65">
<h4>対話ファイルの構成<a class="headerlink" href="#id65" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">対話ファイルは2種類のセクションにより構成されます。</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>セクション名</p></th>
<th class="head"><p>用途</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>conf</p></td>
<td><p>timeoutパラメータによりタイムアウト値を指定します。</p>
<p>タイムアウト値:1～3600(単位:秒)</p>
</td>
</tr>
<tr class="row-odd"><td><p>exe_list</p></td>
<td><p>4種の対話コマンドにより作業対象ホストの構築を行います。</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">以降に対話コマンドを記述します。</div>
<div class="line">例1-1)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># コメント</span>
<span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nt">exec_list</span><span class="p">:</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">対話ファイルの先頭にtimeoutパラメータを記述します。</div>
<div class="line">コメントはAnsibleの基本書式と同様の記述が出来ます。</div>
</div>
</div>
</section>
<section id="id66">
<h4>対話コマンド<a class="headerlink" href="#id66" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">対話コマンドは以下の5種類があります。</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>モジュール</p></th>
<th class="head"><p>用途</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>exec</p></td>
<td><p>作業対象ホストにコマンドを投入します。</p></td>
</tr>
<tr class="row-odd"><td><p>expect</p></td>
<td><p>作業対象ホストが標準出力に出力する内容より、期待する文字列(プロンプト)の出力を待ち合せます。</p></td>
</tr>
<tr class="row-even"><td><p>state</p></td>
<td><p>作業対象ホストにコマンドを投入し、標準出力にプロンプトを出力するまでの
標準出力の内容を外部Shellで解析し結果判定をします。</p></td>
</tr>
<tr class="row-odd"><td><p>command</p></td>
<td><p>作業対象ホストにコマンドを投入する前後において、繰り返しや条件分岐を行うことができます。</p></td>
</tr>
<tr class="row-even"><td><p>localaction</p></td>
<td><p>Ansible/Ansible AutomationControllerサーバ上でコマンドを実行します。</p></td>
</tr>
</tbody>
</table>
<section id="expect">
<h5>①expectモジュール<a class="headerlink" href="#expect" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">作業対象ホストが標準出力に出力する内容より、期待する文字列(プロンプト)の出力を待ち合せます。期待する文字列を正規表記で記述できます。</div>
<div class="line">期待する文字列を受取ると次へ進みます。また、timeoutパラメータで指定された時間内に受取れない場合は対話ファイルを異常終了します。</div>
<div class="line">例2-1)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># telnet接続でパスワード入力のプロンプトを待ち合せます。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Password&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">待ち合わせる文字列をコーテーションで囲むことを推奨します。</div>
</div>
</div>
</section>
<section id="exec">
<h5>②execモジュール<a class="headerlink" href="#exec" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">作業対象ホストにコマンドを投入します。</div>
<div class="line">execモジュールとexpectモジュールは対で使用します。</div>
<div class="line">例2-2)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># telnet接続でパスワード入力のプロンプトを待ち合せてパスワードを投入します。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Password&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">itapassword</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">必要に応じコーテーションで囲むことを推奨します。</div>
</div>
</div>
</section>
<section id="state">
<h5>③stateモジュール<a class="headerlink" href="#state" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">作業対象ホストにコマンドを投入し、標準出力にプロンプトを出力するまでの標準出力の内容を外部Shellで解析し結果判定をします。</div>
</div>
<div class="line-block">
<div class="line">例2-3)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># hostsファイルをcatし、表示結果をparameter値でgrepしている。139.0.0.1、lalhostを含む行があれば正常と判定し次に進みます。</span>
<span class="c1"># 行がなければ異常と判定し対話ファイルを異常終了します。</span>
<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;cat</span><span class="nv"> </span><span class="s">/etc/hosts&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">parameter</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;139.0.0.1&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;lalhost&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例2-4)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># hostsファイルをcatし、表示結果をparameter値でgrepしている。</span>
<span class="c1"># 139.0.0.1、lalhostを含む行があれば正常と判定しますがsuccess_exit: yesの設定により対話ファイルを正常終了します。</span>
<span class="c1"># 行がなければ異常と判定し対話ファイルを異常終了します。</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;cat</span><span class="nv"> </span><span class="s">/etc/hosts&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">parameter</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;139.0.0.1&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;lalhost&#39;</span>
<span class="w">    </span><span class="nt">success_exit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例2-5)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># hostsファイルをcatし、表示結果をparameter値でgrepしている。139.0.0.1、lalhostを含む</span>
<span class="c1"># 139.0.0.1、lalhostを含む行があれば正常と判定し次に進みます。</span>
<span class="c1"># 行がなければ異常と判定しますがignore_errors: yesの設定により次に進みます。</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;cat</span><span class="nv"> </span><span class="s">/etc/hosts&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">parameter</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;139.0.0.1&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;lalhost&#39;</span>
<span class="w">    </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例2-6)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># hostsファイルをcatし、ユーザー作成のshellで表示結果をparameter値でgrepしている。</span>
<span class="c1"># 139.0.0.1、lalhostを含む行があれば正常と判定し次に進みます。</span>
<span class="c1"># 行がなければ異常と判定し対話ファイルを異常終了します。</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;cat</span><span class="nv"> </span><span class="s">/etc/hosts&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">shell</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/tmp/grep.sh&#39;</span>
<span class="w">    </span><span class="nt">stdout_file</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/tmp/stdout.txt&#39;</span>
<span class="w">    </span><span class="nt">parameter</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;139.0.0.1&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;lalhost&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>

<span class="c1"># ユーザー作成 shell(/tmp/grep.sh)</span>
<span class="c1">#!/bin/bash</span>

<span class="l l-Scalar l-Scalar-Plain">STDOUT=/tmp/STDOUT.tmp</span>
<span class="l l-Scalar l-Scalar-Plain">STDERR=/tmp/STDERR.tmp</span>
<span class="l l-Scalar l-Scalar-Plain">cat /tmp/stdout.txt|grep $1|grep $2 | wc -l &gt;${STDOUT} 2&gt;${STDERR}</span>
<span class="l l-Scalar l-Scalar-Plain">RET=$?</span>
<span class="l l-Scalar l-Scalar-Plain">if [ $RET -ne 0 ]; then</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">EXIT_CODE=$RET</span>
<span class="l l-Scalar l-Scalar-Plain">else</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">if [ -s ${STDERR} ]; then</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">EXIT_CODE=1</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">else</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">CNT=`cat ${STDOUT}`</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">if [ ${CNT} -eq 0 ]; then</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">EXIT_CODE=1</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">else</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">EXIT_CODE=0</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">fi</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">fi</span>
<span class="l l-Scalar l-Scalar-Plain">fi</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例2-7)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># hostsファイルをcatし、表示結果をstdout_file で指定したファイルに保存し次に進みます。</span>
<span class="c1"># デフォルトのshellはparameterの設定がないと異常と判定します。次に進める為にignore_errors: yesを設定します。</span>
<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;cat</span><span class="nv"> </span><span class="s">/etc/hosts&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">stdout_file</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__symphony_workflowdir__</span><span class="nv"> </span><span class="s">}}/hosts&#39;</span>
<span class="w">    </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
</section>
<section id="command">
<h5>④commandモジュール<a class="headerlink" href="#command" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">作業対象ホストにコマンドを投入する前後において、繰り返しや条件分岐を行うことができます。</div>
<div class="line">commandモジュールの書式</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>必須/任意</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>command</p></td>
<td><p>必須</p></td>
<td><p>投入するコマンドを指定します。</p></td>
</tr>
<tr class="row-odd"><td><p>prompt</p></td>
<td><p>必須</p></td>
<td><p>待受けプロンプトを指定します。正規表記で記述できます。</p></td>
</tr>
<tr class="row-even"><td><p>timeout</p></td>
<td><p>任意</p></td>
<td><p>コマンドを送ってからのプロンプト待ちタイマを指定します。</p>
<p>省略されている場合は、conf-&gt;timeoutを使用します。</p>
</td>
</tr>
<tr class="row-odd"><td><p>register</p></td>
<td><p>任意</p></td>
<td><p>コマンドを送信後に標準出力の情報を設定する変数「任意の文字列」を指定します。</p>
<p>with_itemsでループしている場合は、最後のコマンド送信後の標準出力の情報が設定されます。</p>
<p>設定した変数はcommandモジュールの条件判定(when・exec_when・failed_when)でのみ使用できます。</p>
<p>設定した変数は、1つのみ保持できます。次にregisterで別の変数に値を設定した場合、前に設定した変数は削除されます。</p>
</td>
</tr>
<tr class="row-even"><td><p>with_items</p></td>
<td><p>任意</p></td>
<td><p>with_itemsにコマンドをループして投入する場合にに複数具体値変数の変数名を設定します。各変数のスコープはitem.X(Xは0から99)とします。</p>
<p>prompt、timeoutでwith_itemsを利用する場合の変数名は下記の通りにしてください。</p>
<p>prompt: {{ VAR_prompt_XXX }}</p>
<p>timeout: {{ VAR_timeout_XXX }}</p>
<p>(XXXは任意の半角英数字とアンダースコア)</p>
<p>with_itemsに設定する各変数の具体値数が同じでない場合、各変数の具体値数の最大値数でループします。具体値が不足している変数の具体値は空として扱います。</p>
<p>また、promptやtimeoutでwith_itemsを利用する場合、具体値数に注意が必要です。</p>
<p>prompt→command→prompt→command→prompt・・・(以下ループ)となり、command数+1の具体値を設定する必要があります。(timeoutも同様)</p>
<p>prompt、timeout の変数の具体値数が不足していると、作業実行時にエラーになります。</p>
</td>
</tr>
<tr class="row-odd"><td><p>when</p></td>
<td><p>任意</p></td>
<td><p>command実行前の条件判定です。</p>
<p>条件にマッチしてcommand実行します。</p>
<p>条件にマッチしていなければ次のcommand行に移ります。</p>
<p>条件式</p>
<p>　変数定義判定</p>
<p>　VAR_xx is define　　　変数が定義されている　　true</p>
<p>　VAR_xx is undefine　　変数が未定義　　　　　　true</p>
<p>　Exp）</p>
<p>　　- 'VAR_status is define'</p>
<p>　　- 'VAR_status is undefine'</p>
<p>※define/undefineはITAの変数(VAR_xx)のみ指定可能</p>
<p>変数具体値判定</p>
<p>VAR_xx/register変数　比較演算子　文字列</p>
<p>VAR_xx/register変数　比較演算子　VAR_xx</p>
<p>VAR_xx/register変数　match(正規表記文字列/VAR_xx)</p>
<p>VAR_xx/register変数　no match(正規表記文字列/VAR_xx)</p>
<p>※比較演算子は「==」、「!=」、「&gt;」、「&gt;=」、「&lt;」、「&lt;=」</p>
<p>※比較演算子の「&gt;」、「&gt;=」、「&lt;」、「&lt;=」は数値を想定しています。</p>
<p>　Exp）</p>
<p>　　- '{{ VAR_status }} match(active)'</p>
<p>　　- '{{ VAR_status }} == active'</p>
<p>　　- 'register変数match(active)'</p>
<p>　※activeなどの条件判定する文字列をクォーテーションで囲む必要はありません。</p>
<p>and/orによる複合条件</p>
<p>　or条件を行いたい場合、判定条件の間にORを記述します。</p>
<p>　Exp）</p>
<p>　　- '{{ VAR_status }} == 1　OR {{ VAR_status }} == 2'</p>
<p>　and条件を行いたい場合、複数行に分けて記述するとand条件になります。</p>
<p>　Exp）</p>
<p>　　- '{{ VAR_status }} == 1　OR {{ VAR_status }} == 2'</p>
<p>　　- '{{ VAR_sub_status }} == 1'</p>
</td>
</tr>
<tr class="row-even"><td><p>exec_when</p></td>
<td><p>任意</p></td>
<td><p>ループ毎の条件判定です。(continue条件)</p>
<p>with_itemsが記述されている場合に条件判定を行います。</p>
<p>条件にマッチしていれば該当ループのcommandを実行します。</p>
<p>マッチしていなければ次のループへ移ります。</p>
<p>条件式</p>
<p>　when:と同様の記述が行えます。</p>
</td>
</tr>
<tr class="row-odd"><td><p>failed_when</p></td>
<td><p>任意</p></td>
<td><p>command実行後(ループ毎)のstdoutの内容に対する条件判定です。</p>
<p>with_itemsが記述されている場合に条件判定を行います。</p>
<p>条件にマッチしていれば正常とします。</p>
<p>マッチしていなければ異常とし、対話ファイルを異常終了させます。</p>
<p>条件式</p>
<p>　変数具体値判定</p>
<p>　stdout 比較演算子 文字列</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">registerパラメータの有効範囲</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;assword:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">status</span><span class="nv"> </span><span class="s">httpd&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd_status_register</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">restart</span><span class="nv"> </span><span class="s">httpd&#39;</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd_status_register no match(running)</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">status</span><span class="nv"> </span><span class="s">mysql&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql_status_register</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">restart</span><span class="nv"> </span><span class="s">mysql&#39;</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql_status_register no match(running)</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">6行目のhttpd_status_registerは、11行目のcommandモジュール内のregisterで別の変数(mysql_status_register)に値を設定している為、10行目までが有効範囲となります。</div>
</div>
</div>
<p>例)　with_itemsで定義した変数はregister/when以外でitem.Xでスコープすることが出来ます。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_item1</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">   </span><span class="c1">#item.0</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_item2</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">   </span><span class="c1">#item.1</span>
<span class="nt">exec_when</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">active&#39;</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">VAR_status</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;register変数</span><span class="nv"> </span><span class="s">match({{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}})&#39;</span>
<span class="nt">failed_when</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;stdout</span><span class="nv"> </span><span class="s">match({{</span><span class="nv"> </span><span class="s">item.1</span><span class="nv"> </span><span class="s">}})&#39;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例）commandモジュールで、下記コマンドを実行したい場合</div>
<div class="line-block">
<div class="line">・systemctl start httpd</div>
<div class="line">・systemctl start mysql</div>
</div>
</div>
<div class="line-block">
<div class="line">対話ファイルの記述とwith_itemsで使用する変数の具体値は以下の様になります。</div>
</div>
<div class="line-block">
<div class="line">▼対話ファイルの記述内容</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;systemctl</span><span class="nv">  </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}</span><span class="nv">  </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.1</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">  </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.2</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.3</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_status_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">    </span><span class="c1"># item.0</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_service_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">   </span><span class="c1"># item.1</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_prompt_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">    </span><span class="c1"># item.2</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_timeout_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">   </span><span class="c1"># item.3</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">▼with_itemsで使用する変数の具体値</div>
</div>
<div class="line-block">
<div class="line">　VAR_status_list:　　　　　 VAR_service_list:</div>
<div class="line">　- start　　　　　　　　　　- httpd</div>
<div class="line">　- start　　　　　　　　　　- mysql</div>
<div class="line">　VAR_prompt_list:　　　　　 VAR_timeout_list:</div>
<div class="line">　 - コマンドプロンプト　　　 - 10</div>
<div class="line">　 - コマンドプロンプト　　　 - 10</div>
<div class="line">　 - コマンドプロンプト　　　 - 10</div>
</div>
<div class="line-block">
<div class="line">例3-1)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。</span>
<span class="c1"># パスワードが必要な場合</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w">   </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># VAR_hosts_makeというITA変数がホスト変数ファイルに記載されている場合、</span>
<span class="c1"># hostsファイルをcatします。記載されていない場合は、スキップします。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /etc/hosts</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VAR_hosts_make is define</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例3-2)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。</span>
<span class="c1"># パスワードが必要な場合</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w">   </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># VAR_hosts_makeというITA変数がホスト変数ファイルに記載されている場合、</span>
<span class="c1"># hostsファイルをcatします。記載されていない場合は、スキップします。</span>
<span class="c1"># catにより、標準出力されたhostsファイルの内容をresult_stdoutに退避します。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /etc/hosts</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result_stdout</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VAR_hosts_make is define</span>

<span class="c1"># VAR_hosts_makeというITA変数がホスト変数ファイルに記載されている場合、</span>
<span class="c1"># command実行します。記載されていない場合は、スキップします。</span>
<span class="c1"># with_itemsの複数具体値変数に設定されている具体値数分command実行します。</span>
<span class="c1"># ループ毎の条件判定として、hostsファイルに「ipアドレス ホスト名」が該当しない場合</span>
<span class="c1"># command実行します。</span>
<span class="c1"># hostsファイルの最終行にechoによる、「IPアドレス ホスト名」を追記します。</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;echo</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}</span><span class="nv">  </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.1</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">&gt;&gt;</span><span class="nv"> </span><span class="s">/etc/hosts&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VAR_hosts_make is define</span>
<span class="w">    </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_hosts_ip</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">      </span><span class="c1"># item.0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_hosts_name</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">   </span><span class="c1"># item.1</span>
<span class="w">    </span><span class="nt">exec_when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result_stdout no match({{ item.0 }} *{{ item.1 }})</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例3-3)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。</span>
<span class="c1"># パスワードが必要な場合</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w">   </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># with_itemsの複数具体値変数に設定されている具体値数分command実行します。</span>
<span class="c1"># 自動起動設定を実行します。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">enable</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_service_name_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">  </span><span class="c1"># item.0</span>

<span class="c1"># with_itemsの複数具体値変数に設定されている具体値数分command実行します。</span>
<span class="c1"># サービスの起動を実行します。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">start</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_service_name_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">  </span><span class="c1"># item.0</span>

<span class="c1"># with_itemsの複数具体値変数に設定されている具体値数分command実行します。</span>
<span class="c1"># サービスのステータスを標準出力します。</span>
<span class="c1"># 標準出力された結果の内容に、item.1の正規表現がある場合、正となります。</span>
<span class="c1"># 例えば、VAR_service_status_listの具体値をrunningと設定し、サービスが起動している場合、</span>
<span class="c1"># 「Active: active (running)」のrunnigが一致するので正となります。(次のループに移ります)</span>
<span class="c1"># そうでない場合は、異常と判断し、対話ファイルは異常終了となります。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;systemctl</span><span class="nv"> </span><span class="s">status</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_service_name_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">  </span><span class="c1"># item.0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_service_status_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">  </span><span class="c1"># item.1</span>
<span class="w">    </span><span class="nt">failed_when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stdout match({{ item.1 }})</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例3-4)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。</span>
<span class="c1"># パスワードが必要な場合</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w">   </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># with_itemsの複数具体値変数に設定されている具体値数分command実行します。</span>
<span class="c1"># commandに「{{ item.0 }}」のみの記述をする場合は、ダブルクォーテーションで囲みます。</span>
<span class="c1"># promptやtimeoutでwith_itemsを利用する場合、具体値数に注意が必要です。</span>
<span class="c1"># prompt→command→prompt→command→prompt ・・・(以下ループ)となり、command数+1</span>
<span class="c1"># 設定する必要があります。(timeoutも同様)</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.1</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.2</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_command_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">  </span><span class="c1"># item.0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_prompt_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">    </span><span class="c1"># item.1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_timeout_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">    </span><span class="c1"># item.2</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">例3-5)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。</span>
<span class="c1"># パスワードが必要な場合</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w">   </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># with_itemsの複数具体値変数に設定されている具体値数分command実行します。</span>
<span class="c1"># 代入値管理の具体値に{{ item.X }} を設定することができます。その際は対話ファイルに記載する</span>
<span class="c1"># item.Xより具体値に記載するitem.Xの数値が大きくなるようにしてください。</span>
<span class="c1"># 今回の例で実行するcommandは「systemctl status ky_pioneer_execute-workflow.service」</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_command_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">      </span><span class="c1"># item.0</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_service_name_list</span><span class="nv"> </span><span class="s">}}&#39;</span><span class="w">  </span><span class="c1"># item.1</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">※ VAR_command_list      ・・・ systemctl status {{ item.1 }}</div>
<div class="line">※ VAR_service_name_list ・・・ ky_pioneer_execute-workflow.service</div>
</div>
<div class="line-block">
<div class="line">例3-6)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># プロンプト以外の文字列で待合せが必要な場合は、expect/execの組合せでする。</span>
<span class="c1"># パスワードが必要な場合</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w">   </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># and/orによる複合条件の記述例です。</span>
<span class="c1"># or条件を行いたい場合、if文を横に記述することができます。</span>
<span class="c1"># and条件を行いたい場合、複数行に分けて記述するとand条件になります。</span>
<span class="c1"># 今回、whenを例にしていますが、exec_when、failed_whenも同様です。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo aaa</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;root@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10 == 9 OR 10 != 9 OR 10 &gt;= 9</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10 &gt; 9 OR 10 &lt;= 9 OR 10 &lt; 9</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
</section>
<section id="localaction">
<h5>⑤localactionモジュール<a class="headerlink" href="#localaction" title="この見出しへのパーマリンク">¶</a></h5>
<div class="line-block">
<div class="line">Ansible/Ansible Automation Controllerサーバ上でコマンドを実行します。</div>
<div class="line">localactionモジュールの書式</div>
</div>
<table class="docutils align-left">
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>必須/任意</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>localaction</p></td>
<td><p>必須</p></td>
<td><p>実行するコマンドを指定します。</p>
<p>confセクションのtimeoutパラメータでのタイマ監視は適用外です。</p>
<p>コマンドが完了するまで次のステップに進みません。</p>
</td>
</tr>
<tr class="row-odd"><td><p>ignore_errors</p></td>
<td><p>任意</p></td>
<td><p>コマンドの実行結果が異常でも次に進む場合に「yes」を指定します。</p>
<p>「no」の場合は、異常の場合に対話ファイルを異常終了します。</p>
<p>デフォルトは「no」。</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">例4-1)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Symphony実行時の各Movementで共有するディレクトリ({{ __symphony_workflowdir__ }})にホスト毎のディレクトリを設けて、hostsファイルを退避します。</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">localaction</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mkdir -p 755 {{ __symphony_workflowdir__ }}/{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat /etc/hosts</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">stdout_file</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__symphony_workflowdir__</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}/hosts&#39;</span>
<span class="w">    </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root@{{ __loginhostname__ }}</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
</section>
</section>
<section id="id67">
<h4>正規表記<a class="headerlink" href="#id67" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">下記のコマンド及びパラメータに記述された文字列は正規表記で評価されます。</div>
</div>
<ul class="simple">
<li><p>expectモジュール</p></li>
<li><p>stateモジュールのpromptパラメータ</p></li>
<li><p>commandモジュールのpromptパラメータ</p></li>
</ul>
<div class="line-block">
<div class="line">正規表記で記述した文字列にメタ文字「(){}.など」を含む場合、メタ文字の前にエスケープ文字「\」を挿入する必要があります。</div>
</div>
<div class="line-block">
<div class="line">正しい例)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">XAMPP Developer Files ¥[Y¥/n¥] exec_list</span><span class="p p-Indicator">:</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">誤った例)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">XAMPP Developer Files [Y/n] exec_list</span><span class="p p-Indicator">:</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">stateモジュールとcommandモジュールは、実行したコマンドの結果（標準出力）の取り出しを行っています。取り出す上での留意事項を以下に記述します。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">実行したコマンドの結果（標準出力）とプロンプトの区切り</div>
<div class="line">実行したコマンドの結果（標準出力）とプロンプトの区切りをpromptパラメータで指定された文字列で行います。実行したコマンドの結果（標準出力）の判定やファイルへの保存を行う場合は、正規表記で .*付の後方一致は記述しないでください。実行したコマンドの結果（標準出力）が取り出せません。</div>
<div class="line"><br /></div>
<div class="line">.* 付の後方一致の正規表記の例</div>
<div class="line">'<strong>.*</strong>[\#\$\%] $''</div>
<div class="line"><br /></div>
</div>
</li>
<li><div class="line-block">
<div class="line">エスケープシーケンスの対応</div>
<div class="line">構築対象機器に依存しますが、構築対象機器から送られてくるプロンプトの直前にOperating</div>
<div class="line">System Commandシーケンスが付加されている場合があります。promptパラメータで指定された文字列の直前にあるエスケープシーケンスを排除しています。</div>
</div>
</li>
</ol>
</section>
<section id="id68">
<h4>複数具体値変数使用時の注意事項<a class="headerlink" href="#id68" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">対話ファイルで複数具体値変数が使用出来るパラメータは、commandモジュールのwith_itemsパラメータのみです。これ以外で使用した場合、作業実行時にエラーとなります。</div>
</div>
</section>
<section id="id69">
<h4>コマンドプロンプト以外のプロンプトを処理する場合の注意事項<a class="headerlink" href="#id69" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">コマンドプロンプト以外のプロンプトを処理する場合、execモジュールとexpectモジュールの組合せで対話ファイルを作成してください。commandとstateモジュールでは処理できません。</div>
</div>
<div class="line-block">
<div class="line">例)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># ssh-keygenを対話ファイルで処理する。</span>

<span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>


<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># ssh接続　パスワード認証</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;assword:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># ssh-keygenコマンド実行</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ssh-keygen</span>

<span class="c1"># 以降がコマンドプロンプト以外のプロンプトに対する処理</span>
<span class="c1"># 秘密鍵ファイルのパスを設定</span>
<span class="c1"># expectは正規表記で評価されるので、エスケープが必要なメタ文字にはエスケープ文字(\)を挿入する必要があります。</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;id_rsa\):&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_id_rsa_path</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># パスフレーズを設定</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;</span><span class="nv"> </span><span class="s">passphrase\):&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_passphrase</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># パスフレーズを確認</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;</span><span class="nv"> </span><span class="s">passphrase</span><span class="nv"> </span><span class="s">again:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_passphrase</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># 生成された 秘密鍵ファイルを確認</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;ls</span><span class="nv"> </span><span class="s">-al</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">VAR_id_rsa_path</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># ssh接続クローズ</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">※ VAR_id_rsa_path　・・・　秘密鍵ファイルのパスを設定します。</div>
<div class="line">※ VAR_passphrase 　・・・　パスフレーズを設定します。</div>
<div class="line"><br /></div>
<div class="line">◎リターンしたい場合</div>
<div class="line">変数使用の場合は具体値を空白(未入力)にします。</div>
<div class="line">変数を使用していない場合は空文字列(コーテーションを2個並べます)を記載します。</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&#39;</span>
</pre></div>
</div>
</section>
<section id="id70">
<h4>対話ファイル終了時の注意事項<a class="headerlink" href="#id70" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">対話ファイルの最後に、セッションを終了するコマンドを投入するようにしてください。</div>
<div class="line">最終行のモジュールが終了するとセッションをクローズします。最終行にファイルコピーなど処理に時間がかかるコマンドが記載されている場合、コマンド終了前にセッションがクローズされコマンドが異常終了してしまう場合があります。</div>
</div>
<div class="line-block">
<div class="line">例)</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>

<span class="nt">exec_list</span><span class="p">:</span>
<span class="c1"># ssh接続　パスワード認証</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;assword:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># ファイルコピー</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;cp</span><span class="nv"> </span><span class="s">-rfp</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">VAR_src_path</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">VAR_dest_path</span><span class="nv"> </span><span class="s">}}&#39;</span>

<span class="c1"># 直前のコマンド終了をコマンドプロンプトで待ち合わせ、exitコマンドを投入する記載を対話ファイルの最後に挿入</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exit</span>
</pre></div>
</div>
</section>
<section id="yaml">
<span id="ansible-pioneer-things-to-keep-in-mind-when-writing-dialogue-files-in-yaml-format"></span><h4>対話ファイルをyaml形式で記載する際の注意事項<a class="headerlink" href="#yaml" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">対話ファイルはyaml形式のファイルとして扱います。以下のようなYAML形式に準じていない記載があると対話モジュールのアップロード時や作業実行時にエラーとなります。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">各モジュールのパラメータに変数を記載している場合でパラメータ全体をクォーテーションで囲んでいない場合。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">各パラメータを定数のみで記載している場合で、定数の終端が「<strong>:</strong>」の場合など、パラメータ全体をクォーテーションで囲んでいない場合。</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">各モジュールのパラメータは、パラメータ全体をクォーテーションで囲むことを推奨します。</div>
</div>
<div class="line-block">
<div class="line">正しい例）</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;assword:&#39;</span>
<span class="w">  </span><span class="nt">exec</span><span class="p">:</span><span class="w">  </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginpassword__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;ls&#39;</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;echo</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">exec_when</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">item.1</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">run&#39;</span>
<span class="w">  </span><span class="nt">with_items</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_echo</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_exec_when</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_failed_when</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">failed_when</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stdout == match({{ item.2 }})</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_command</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">parameter</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_p1</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_p2</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="nt">success_exit</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;yes&#39;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">誤った例）</div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span>- expect: assword:
  exec:  {{ __loginpassword__ }}
- expect: {{ __loginuser__ }}@{{ __loginhostname__ }}
  exec: ls
- command: echo {{ item.0 }}
  prompt: {{ __loginuser__ }}@{{ __loginhostname__ }}
  exec_when:
    - {{ item.1 }} == run
  with_items:
    - {{ VAR_echo }}
    - {{ VAR_exec_when }}
    - {{ VAR_failed_when }}
  failed_when:
    - stdout == match({{ item.2 }})
- state: {{ VAR_command }}
  prompt: {{ __loginuser__ }}@{{ __loginhostname__ }}
  parameter:
    - {{ VAR_p1 }}
    - {{ VAR_p2 }}
  success_exit: yes
</pre></div>
</div>
</section>
<section id="lang">
<h4>構築対象機器のログインユーザーのLANGについての注意事項<a class="headerlink" href="#lang" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">ログインユーザーの「LANG」は、「UTF-8/euc/shift_jis」の3種類についてサポートしています。</div>
<div class="line">ログインユーザーの「LANG」の設定は機器一覧より行ってください。</div>
<div class="line">「euc/shift_jis」を設定した場合、構築対象機器との通信制御で使用しているpexpectモジュールのUTF-8へのデコード処理の特性で対話ファイルを正しく処理出来ない場合があります。</div>
</div>
<ul class="simple">
<li><p>一部の全角文字( ①②等)をUTF-8にデコード出来ません。デコード出来ない文字は??で表示されます。</p></li>
<li><p>一部の全角文字( － 等)をexpect等のプロンプト待ちで使用した場合、「LANG」がUTF-8では待ち受けが正しく出来ますが、LANGが「euc/shift_jis」では待ち受けがタイムアウトしてしまいます。</p></li>
</ul>
</section>
<section id="id71">
<h4>構築対象機器へ投入するコマンドの終端コードについての注意事項<a class="headerlink" href="#id71" title="この見出しへのパーマリンク">¶</a></h4>
<p>構築対象機器へ投入するコマンドの終端コードは「LF」を送信します。構築対象機器のコマンド終端コードが「CRLF」の場合、対話ファイルで構築対象機器に投入するコマンドの末尾に「r」を追加してください。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">conf</span><span class="p">:</span>
<span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nt">exec_list</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expect</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;password:&#39;</span>
<span class="w">    </span><span class="nt">exec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;XXXXXXXX\r&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_command</span><span class="nv"> </span><span class="s">}}\r&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_state</span><span class="nv"> </span><span class="s">}}\r&#39;</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">__loginuser__</span><span class="nv"> </span><span class="s">}}@{{</span><span class="nv"> </span><span class="s">__loginhostname__</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">    </span><span class="nt">parameter</span><span class="p">:</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_parameter1</span><span class="nv"> </span><span class="s">}}&#39;</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">VAR_parameter2</span><span class="nv"> </span><span class="s">}}&#39;</span>
</pre></div>
</div>
</section>
</section>
<section id="backyard">
<h3>BackYardコンテンツ<a class="headerlink" href="#backyard" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id72">
<h4>変数自動登録<a class="headerlink" href="#id72" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">変数解析対象の資材をアップロードした場合、アップロードされた資材から変数を取出します。</div>
</div>
<table class="docutils align-left" id="id151">
<caption><span class="caption-text">モード別アップロードした資材の変数の扱い</span><a class="headerlink" href="#id151" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 71%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>メニュー</p></th>
<th class="head"><p>Ansible-Pioneer</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Playbook素材集</p></td>
<td><p>×</p></td>
</tr>
<tr class="row-odd"><td><p>ロールパッケージ管理</p></td>
<td><p>×</p></td>
</tr>
<tr class="row-even"><td><p>対話ファイル素材集</p></td>
<td><p>○</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">なお、取出すタイミングは 自動プロセスの起動周期 に依存します。</div>
</div>
</section>
</section>
</section>
<section id="id73">
<h2>付録<a class="headerlink" href="#id73" title="この見出しへのパーマリンク">¶</a></h2>
<section id="ansibleita">
<span id="ansible-pioneer-the-linkage-between-the-input-data-used-during-ansible-execution-and-ita-menu"></span><h3>Ansible実行時に使用される投入データとITAメニューの紐づけ<a class="headerlink" href="#ansibleita" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">各ITAメニューより情報を抜出してAnsible実行に必要な投入データを作ります。この際、機器一覧のパスワードや代入値管理でSensitive設定をONした変数の具体値がansible-vaultで暗号化されています。</div>
<div class="line">投入データはZIP形式で「 <a class="reference internal" href="#ansible-pioneer-check-operation-status"><span class="std std-ref">作業状態確認</span></a> 」よりダウンロードが可能です。</div>
<div class="line">ダウンロードした投入データを所定のディレクトリに解凍することで、Ansibleを直接実行することも可能です。</div>
<div class="line"><br /></div>
<div class="line">各種データとITAメニューの関係性は以下の通りです。</div>
</div>
<section id="id74">
<h4>Ansible-Pioneer投入データ<a class="headerlink" href="#id74" title="この見出しへのパーマリンク">¶</a></h4>
<table class="docutils align-left" id="id152">
<caption><span class="caption-text">Ansible-Pioneer投入データ</span><a class="headerlink" href="#id152" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 22%" />
<col style="width: 22%" />
<col style="width: 33%" />
<col style="width: 22%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>メニューグループ</p></th>
<th class="head"><p>メニュー</p></th>
<th class="head"><p>項目</p></th>
<th class="head"><p>ディレクトリ解凍時のパス</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Ansible-Legacy</p></td>
<td><p>Playbook素材集</p></td>
<td><p>プレイブック素材</p></td>
<td><p>/child_playbooks</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible 共通</p></td>
<td><p>テンプレート管理</p></td>
<td><p>テンプレート素材</p></td>
<td><p>/template_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible 共通</p></td>
<td><p>ファイル管理</p></td>
<td><p>ファイル素材</p></td>
<td><p>/copy_files</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Pioneer</p></td>
<td><p>代入値管理</p></td>
<td><p>ファイル素材</p></td>
<td><p>/upload_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible 共通</p></td>
<td><p>グローバル変数管理</p></td>
<td><p>変数名/具体値</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Pioneer</p></td>
<td><p>代入値管理</p></td>
<td><p>変数名/具体値(文字列)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Pioneer</p></td>
<td><p>代入値管理</p></td>
<td><p>変数名/具体値(ファイル)</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Pioneer</p></td>
<td><p>template 管理</p></td>
<td><p>テンプレート素材</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Pioneer</p></td>
<td><p>ファイル管理</p></td>
<td><p>ファイル変数名</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>プロトコル</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインユーザ ID</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><div class="line-block">
<div class="line">ログインパスワード</div>
<div class="line">※ansible-vault で暗号化</div>
</div>
</td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>ホスト名</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>Pioneer利用情報</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Pioneer</p></td>
<td><p>Movement一覧</p></td>
<td><p>並列実行数</p></td>
<td><p>/host_vars</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>ssh 認証鍵ファイル</p></td>
<td><p>/ssh_key_files</p></td>
</tr>
<tr class="row-even"><td><p>Ansible共通</p></td>
<td><p>インターフェース情報</p></td>
<td><p>オプションパラメータ</p></td>
<td><p>/AnsibleExecOption.txt</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Pioneer</p></td>
<td><p>Movement 一覧</p></td>
<td><p>オプションパラメータ</p></td>
<td><p>/AnsibleExecOption.txt</p></td>
</tr>
<tr class="row-even"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>ログインユーザ ID</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><div class="line-block">
<div class="line">ログインパスワード</div>
<div class="line">※ansible-vault で暗号化</div>
</div>
</td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>ホスト名</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>IP アドレス</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>インベントリファイル追加オプション</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><p>Pioneer利用情報</p></td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-even"><td><p>Ansible共通</p></td>
<td><p>機器一覧</p></td>
<td><div class="line-block">
<div class="line">接続オプション</div>
<div class="line">※ansible_ssh_extra_args の値</div>
</div>
</td>
<td><p>/hosts</p></td>
</tr>
<tr class="row-odd"><td><p>Ansible-Pioneer</p></td>
<td><p>Playbook 素材集</p></td>
<td><p>プレイブック素材</p></td>
<td><p>/playbook.yml</p></td>
</tr>
<tr class="row-even"><td><p>Ansible-Pioneer</p></td>
<td><div class="line-block">
<div class="line">Movement-Playbook紐付</div>
<div class="line">（Movement-対話種別紐付、Movement-ロール紐付）</div>
</div>
</td>
<td><p>インクルード順序</p></td>
<td><p>/playbook.yml</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="id75">
<h3>Ansible実行時に作成される結果データ<a class="headerlink" href="#id75" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">[投入データ]をansibleで実行した結果を[結果データ]としてZIP形式で保存します。</div>
<div class="line">[結果データ]はZIP形式で「 <a class="reference internal" href="#ansible-pioneer-check-operation-status"><span class="std std-ref">作業状態確認</span></a> 」よりダウンロードが可能です。</div>
</div>
<section id="id76">
<h4>Ansible-Pioneer結果データに保存されるファイル一覧<a class="headerlink" href="#id76" title="この見出しへのパーマリンク">¶</a></h4>
<table class="docutils align-left" id="id153">
<caption><span class="caption-text">Ansible-Pioneer結果データに保存されるファイル一覧</span><a class="headerlink" href="#id153" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 18%" />
<col style="width: 45%" />
<col style="width: 18%" />
<col style="width: 18%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ファイル名</p></th>
<th class="head"><p>記録内容</p></th>
<th class="head"><p>Ansible Coreの場合</p></th>
<th class="head"><p>Ansible Automation Controllerの場合</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>result.txt</p></td>
<td><p>Ansibleの実行結果を記録</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>xxx.pid</p></td>
<td><div class="line-block">
<div class="line">Ansible-playbbokコマンドのプロセスIDを記録するファイル</div>
<div class="line">xxx: Ansible-playbbokコマンドのプロセスID</div>
</div>
</td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>pioneer.xxx</p></td>
<td><div class="line-block">
<div class="line">PioneerモジュールのプロセスIDを記録するファイル。</div>
<div class="line">xxx: PioneerモジュールのプロセスID</div>
</div>
</td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>error.log</p></td>
<td><div class="line-block">
<div class="line">作業実行時にITAがなにかしらのエラーによりエラーメッセージを出力した場合、または、Ansible-playbbokコマンドがなにかとらのエラーによりエラーメッセージを出力した場合のエラー出力先ファイル</div>
<div class="line">作業実行確認のエラーログに表示に表示される内容</div>
</div>
</td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>exec.log</p></td>
<td><div class="line-block">
<div class="line">Ansible-playbbokが出力した実行ログを一部加工したログファイル</div>
<div class="line">作業実行確認の実行ログに表示される内容</div>
</div>
</td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>exec.log.org</p></td>
<td><p>Ansible-playbbokが出力した実行ログ</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
<tr class="row-even"><td><p>Ita_&lt;mode名&gt;_executions_jobtpl_&lt;作業番号&gt;_&lt;グループ番号&gt;</p></td>
<td><div class="line-block">
<div class="line">分割された実行ログファイル</div>
<div class="line">ファイル名の命名規則は <a class="reference internal" href="ansible_legacyrole.html#ansible-legacyrole-check-operation-status"><span class="std std-ref">作業状態確認</span></a> の実行ログ表示を参照してください。</div>
</div>
</td>
<td></td>
<td><p>〇</p></td>
</tr>
<tr class="row-odd"><td><p>forced.txt</p></td>
<td><p>緊急停止をした場合の記録ファイル</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>user_files</p></td>
<td><p>実行したplaybookでITA独自変数「__workflowdir__」になにかしらのファイル出力をした場合のファイルが記録されるディレクトリ。</p></td>
<td><p>〇</p></td>
<td><p>〇</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="ansible-pioneer-option-parameter-list">
<span id="id77"></span><h3>オプションパラメータ一覧<a class="headerlink" href="#ansible-pioneer-option-parameter-list" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">インターフェース情報とMovement一覧のオプションパラメータについて説明します。</div>
<div class="line">ITAでは、以下の順番でansible-playbookのオプションパラメータを設定するので、単一の値しか許容していないパラメータを複数定義した場合、Movement一覧=&gt;オプションパラメータのパラメータが有効になります。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">Ansible共通=&gt;インターフェース情報=&gt;オプションパラメータ</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Movement一覧=&gt;オプションパラメータ</div>
</div>
</li>
</ul>
<div class="line-block">
<div class="line">▼実行エンジンがAnsible Coreの場合</div>
<div class="line">　　実行エンジンがAnsible Coreの場合、ansible-playbookコマンドのオプションパラメータを入力します。</div>
<div class="line">　　ansible-playbookコマンドのオプションパラメータの仕様については、以下のコマンドを実行して表示されたヘルプを参照してください。</div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ansible-playbook -h
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line">▼実行エンジンがAnsible Core以外の場合</div>
<div class="line">　　以下の表は実行エンジンがAnsible Core以外の場合に、指定可能なオプションパラメータです。</div>
<div class="line"><br /></div>
</div>
<table class="docutils align-left" id="id154">
<caption><span class="caption-text">実行エンジンがAnsible Core以外の場合に指定可能なオプションパラメータ一覧</span><a class="headerlink" href="#id154" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 17%" />
<col style="width: 25%" />
<col style="width: 42%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>オプションパラメータ</p></th>
<th class="head"><p>指定方法</p></th>
<th class="head"><p>Ansible Automation Controllerの設定箇所</p></th>
<th class="head"><p>備考</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">-v</div>
<div class="line">--verbose</div>
</div>
</td>
<td><div class="line-block">
<div class="line">-v</div>
<div class="line">-vv</div>
<div class="line">-vvv</div>
<div class="line">-vvvv</div>
<div class="line">-vvvvv</div>
<div class="line">--verbose</div>
</div>
</td>
<td><p>テンプレート 画面の[詳細]に指定した vの数を設定</p></td>
<td><div class="line-block">
<div class="line">・vの合計値を適用</div>
<div class="line">・--verboseは、-vと同様</div>
<div class="line">例：--verbose -vvv の場合、-vvvvと同様</div>
<div class="line">・vを6以上指定した場合 、vは5の指定となる</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">-f</div>
<div class="line">--forks</div>
</div>
</td>
<td><div class="line-block">
<div class="line">-f FORKS</div>
<div class="line">--forks=FORKS</div>
</div>
</td>
<td><p>テンプレートの[フォーク]に指定したFORKSが設定される</p></td>
<td><div class="line-block">
<div class="line">・FORKSには数値を指定</div>
<div class="line">・複数定義した場合、最後に定義したパラメータが有効</div>
<div class="line">例：-f 1-forks=10の場合、--forks=10が有効となる</div>
<div class="line">・数値以外が指定された場合、エラーとなる</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">-l</div>
<div class="line">--limit</div>
</div>
</td>
<td><div class="line-block">
<div class="line">-l SUBSET</div>
<div class="line">--limit=SUBSET</div>
</div>
</td>
<td><p>テンプレートの[制限]に指定したSUBMITが設定される</p></td>
<td><div class="line-block">
<div class="line">・SUBSET:機器一覧にあるホスト名</div>
<div class="line">・複数定義した場合、最後に定義したパラメータが有効</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">-e</div>
<div class="line">--extra-vars</div>
</div>
</td>
<td><div class="line-block">
<div class="line">-e EXTRA_VARS</div>
<div class="line">--extra-vars=EXTRA_VARS</div>
</div>
</td>
<td><p>テンプレートの[追加変数]に変数名:具体値の形式で設定される</p></td>
<td><div class="line-block">
<div class="line">・EXTRA_VARS:変数名、具体値をjson形式またはyaml形式</div>
<div class="line">例：json形式の場合 -extra-vars={&quot;VAR_1&quot;:&quot;directory&quot;,&quot;VAR_2&quot;:&quot;0755&quot;}</div>
<div class="line">yaml形式の場合 -extra-vars=VAR_1:directorynVAR_2:0755</div>
<div class="line">・複数定義した場合、最後に定義したパラメータが有効</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">-t</div>
<div class="line">--tags</div>
</div>
</td>
<td><div class="line-block">
<div class="line">-t TAGS</div>
<div class="line">--tags=TAGS</div>
</div>
</td>
<td><p>テンプレートの[ジョブタグ]に設定したTAGSが設定される</p></td>
<td><div class="line-block">
<div class="line">・TAGS:タグ名</div>
<div class="line">・複数個のパラメータを許容</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">-b</div>
<div class="line">--become</div>
</div>
</td>
<td><div class="line-block">
<div class="line">-b</div>
<div class="line">--become</div>
</div>
</td>
<td><p>テンプレートのオプション[権限昇格の有効化]がチェックされる</p></td>
<td><p>・少なくとも1つ指定すればパラメータが有効</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">-D</div>
<div class="line">--diff</div>
</div>
</td>
<td><div class="line-block">
<div class="line">-D</div>
<div class="line">--diff</div>
</div>
</td>
<td><p>テンプレートの[変更]の表示が有効化される</p></td>
<td><p>・少なくとも1つ指定すればパラメータが有効</p></td>
</tr>
<tr class="row-odd"><td><p>--skip-tags</p></td>
<td><p>--skip-tags=SKIP_TAGS</p></td>
<td><p>テンプレートの[スキップタグ]に設定したSKIP_TAGSが設定される</p></td>
<td><div class="line-block">
<div class="line">・SKIP_TAGS:スキップタグ名</div>
<div class="line">・複数個のパラメータを許容</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>--st art-at-task</p></td>
<td><p>--start-at-task=START_AT_TASK</p></td>
<td><p>※Ansible Automation ControllerのWebUI には--start-at-taskの表示はない。</p></td>
<td><p>・複数定義した場合、最後に定義したパラメータが有効</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">-ufc</div>
<div class="line">--use _fact_cache</div>
</div>
</td>
<td><div class="line-block">
<div class="line">-ufc</div>
<div class="line">--use_fact_cache</div>
</div>
</td>
<td><p>テンプレートのオプション[ファクトキャッシュの有効化]がチェックされる</p></td>
<td><p>・少なくとも1つ指定すればパラメータが有効</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">-as</div>
<div class="line">--allow_simultaneous</div>
</div>
</td>
<td><div class="line-block">
<div class="line">-as</div>
<div class="line">--allow_simultaneous</div>
</div>
</td>
<td><p>テンプレートのオプション[同時実行ジョブの有効化]がチェックされる</p></td>
<td><p>・少なくとも1つ指定すればパラメータが有効</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">-jsc</div>
<div class="line">--jobslice_count</div>
</div>
</td>
<td><div class="line-block">
<div class="line">-jscジョブスライス数</div>
<div class="line">--job_slice_count=ジョブスライス数</div>
</div>
</td>
<td><p>テンプレートの[ジョブスライス数]に指定したジョブスライス数が設定される</p></td>
<td><div class="line-block">
<div class="line">・ジョブスライス数には数値を指定</div>
<div class="line">・複数定義した場合、最後に定義したパラメータが有効</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※Ansible Automation Controllerのオプションパラメータの仕様については、Ansible Automation Controllerユーザーガイドのジョブテンプレートの説明を参照してください。</div>
</div>
</section>
<section id="ansible-automation-controllerita">
<h3>Ansible Automation ControllerでITA独自変数を利用する場合の留意事項<a class="headerlink" href="#ansible-automation-controllerita" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">下記ITA独自変数を利用してファイル出力をするPlyabookを含むMovementをクラスタ構成のAnsible Automation Controllerで作業実行した場合の留意事項について記載します。</div>
<div class="line"><br /></div>
<div class="line">　対象のITA独自変数</div>
<div class="line">　・ __workflowdir__</div>
<div class="line">　・ __conductor_workflowdir__</div>
<div class="line">　・ __movement_status_filepath__</div>
<div class="line">　・ __parameters_dir_for_epc__</div>
<div class="line">　・ __parameters_file_dir_for_epc__</div>
<div class="line">　・ __parameter_dir__</div>
<div class="line">　・ __parameters_file_dir__</div>
<div class="line"><br /></div>
</div>
<section id="id78">
<h4>ITA独自変数を利用して作成したファイルの取り扱い<a class="headerlink" href="#id78" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">ITA独自変数を利用して作成したファイルの出力先ディレクトリパスはAnsible Automation ControllerのITA作業用ディレクトリ配下「/var/lib/exastro」に設定されます。Movement実行前に結果データをAnsible Automation Controller（各実行ノード）のITA作業用ディレクトリ配下「/var/lib/exastro」にファイル転送します。Movement実行でここに作成されたファイルは、Movement実行後に各Ansible Automation Controller（各実行ノード）より結果データに上書きモードでファイル転送します。同一ファイル名でファイルを作成している場合、更新したファイルが結果データに正しく反映されない場合があります。</div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../../_images/original_hensu.png"><img alt="../../../../_images/original_hensu.png" src="../../../../_images/original_hensu.png" style="width: 7.49606in; height: 5.84593in;" /></a>
</figure>
<ol class="arabic">
<li><div class="line-block">
<div class="line">Movementをconductorから実行している場合、Movement実行前に該当conductorインスタンス配下のファイルをAnsible Automation Controller（各実行ノード）のITA作業用ディレクトリ配下にファイル転送</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Movement実行前に該当Movement配下のファイルをAnsible Automation Controller（各実行ノード）のITA作業用ディレクトリにファイル転送</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Movementをconductorから実行している場合、Movement実行後にAnsible Automation Controller（各実行ノード）のITA作業用ディレクトリの該当Movementで作成したファイルを結果データにファイル転送</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Movement実行後にAnsible Automation Controller（各実行ノード）のITA作業用ディレクトリの該当conductorインスタンス配下に作成したファイルを結果データにファイル転送</div>
</div>
</li>
</ol>
</section>
<section id="id79">
<h4>留意事項<a class="headerlink" href="#id79" title="この見出しへのパーマリンク">¶</a></h4>
<ol class="arabic">
<li><div class="line-block">
<div class="line">ファイル名はansible「__loginhostname__」を含めるなどして、Movementに紐づいているターゲットホスト毎に同一ファイル名に出力しないように工夫してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">conductorから実行する場合、複数のMovementで同一ファイル名への出力しないよう工夫してください。</div>
</div>
</li>
</ol>
</section>
</section>
<section id="ansible-pioneer-data-resources-deleted-when-executing">
<span id="id80"></span><h3>実行時データ削除で削除されるデータリソース<a class="headerlink" href="#ansible-pioneer-data-resources-deleted-when-executing" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">インターフェース情報の実行時データ削除で「削除する」を選択した場合に、削除されるデータリソースを以下に列挙します。</div>
</div>
<table class="docutils align-left" id="id155">
<caption><span class="caption-text">実行時データ削除で削除されるデータリソース一覧(Ansible Automation Controller側)</span><a class="headerlink" href="#id155" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>データリソース</p></th>
<th class="head" rowspan="2"><p>リソースタイプ</p></th>
<th class="head"><p>実行エンジン</p></th>
<th class="head" rowspan="2"><p>備考</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Ansible Automation Controller</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>ITA作業用ディレクトリ</p>
<p>/var/lib/exastro/ita_&lt;区分&gt;_executions_10桁の作業番号</p>
</td>
<td><p>ディレクトリ</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>SCM管理ディレクトリ</p>
<p>/var/lib/awx/projects/ita_&lt;区分&gt;_executions_作業番号</p>
</td>
<td><p>ディレクトリ</p></td>
<td><p>※</p></td>
<td><p>※プロジェクトリソースの削除により削除される</p></td>
</tr>
<tr class="row-odd"><td><p>インベントリ</p>
<p>リソース名: ita_&lt;区分&gt;_executions_inventory_作業番号_通番</p>
</td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>認証情報</p>
<p>リソース名: ita_&lt;区分&gt;_executions_credential_作業番号_通番</p>
<p>　　　　　　ita_&lt;区分&gt;_executions_vault_credential_作業番号</p>
<p>　　　　　　ita_&lt;区分&gt;_executions_git_credential_作業番号</p>
</td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>プロジェクト</p>
<p>リソース名: ita_&lt;区分&gt;_executions_project_作業番号</p>
</td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>ジョブテンプレート</p>
<p>リソース名: ita_&lt;区分&gt;_executions_jobtpl_作業番号_通番</p>
</td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>ワークフロージョブテンプレート</p>
<p>リソース名: ita_&lt;区分&gt;_executions_workflowtpl_作業番号</p>
</td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>ジョブ</p>
<p>リソース名: Job番号—ita_&lt;区分&gt;_executions_workflowtpl_作業番号</p>
<p>　　　　　　Job番号—ita_&lt;区分&gt;_executions_jobtpl_作業番号</p>
</td>
<td><p>リソース</p></td>
<td><p>〇</p></td>
<td></td>
</tr>
</tbody>
</table>
<table class="docutils align-left" id="id156">
<caption><span class="caption-text">実行時データ削除で削除されるデータリソース一覧(ITA側)</span><a class="headerlink" href="#id156" title="このテーブルへのパーマリンク">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head" rowspan="2"><p>データリソース</p></th>
<th class="head" rowspan="2"><p>リソースタイプ</p></th>
<th class="head"><p>実行エンジン</p></th>
<th class="head" rowspan="2"><p>備考</p></th>
</tr>
<tr class="row-even"><th class="head"><p>Ansible Automation Controller</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>Git リポジトリ</p>
<p>ワークスペース共有パス/driver/ansible/git_repositories/&lt;区分&gt;_作業番号</p>
</td>
<td><p>Gitリポジトリ</p></td>
<td><p>〇</p></td>
<td><p>ディレクトリごと削除</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


</div>


<div id="articleNavigation">
  <ul>
  </ul>
</div>


<div id="pageTopLink">
  <a href="#container"><i>↑</i> Page Top</a>
</div>

</article>
</div>
</main>
</div><!-- End #contents -->
<div id="footer">
  <footer class="divInner">
    <small>Copyright © 2019-2023 NEC Corporation</small>
    <small><a href="/terms/ja.html">サイト規約</a></small>
  </footer>
</div><!-- End #footer -->

<div id="overlay"></div>
<div id="grayBack"></div>

</div><!-- End #container -->
  </body>
</html>