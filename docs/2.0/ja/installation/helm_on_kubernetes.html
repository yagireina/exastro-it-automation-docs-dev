
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <title>1. Helm chart (Kubernetes) &#8212; Documentation  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/option.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/exastro_documents.css?v=2" />
    <link rel="stylesheet" type="text/css" href="../../../_static/swagger/swagger-ui.css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="../../../_static/translations.js"></script>
    <script src="../../../_static/jquery-3.6.3.min.js"></script>
    <script src="../../../_static/exastro_documents.js?v=1"></script>
    <script src="../../../_static/swagger/swagger-ui-bundle.js"></script>
    <script src="../../../_static/swagger/swagger-ui-standalone-preset.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="検索" href="../../../search.html" />
    <link rel="next" title="2. アップグレード" href="upgrade.html" />
    <link rel="prev" title="インストール" href="index.html" /> 
  </head>
<body id="page" class="ja">


<div id="container">

<div id="header">
  <header class="divInner">
    <!-- Exastro logo -->
    <div id="logo"><a href="/"><img src="../../../_static/img/exastro.svg" alt="Exastro"></a></div>
    <!-- Project name -->
    <div id="projectName"><a href="../../../index.html">Documentation</a></div>
    <!-- Heaedr navigation -->
    <div id="headerSearch">
      <form class="search" action="../../../search.html" method="get">
        <input type="text" name="q" aria-labelledby="searchlabel">
        <button type="submit" value="検索"><img src="../../../_static/img/search.png" alt="検索"></button>
      </form>
    </div>
  </header>
</div><!-- End #header -->


<div id="toolbar">
  <div class="divInner">
    
    <div id="documentVersion">
      <dl>
        <dt>Document version</dt>
        <dd>
          <div>
            <select name="version" onchange="location.href=value;">
                file_path: 2.0/ja/installation/helm_on_kubernetes
                  <option value="#"
                  selected
                  >current</option>
                file_path: 2.0/ja/installation/helm_on_kubernetes
                  <option value="#"
                  selected
                  >2.0 (current)</option>
                file_path: 2.1/ja/installation/helm_on_kubernetes
            </select>
          </div>
        </dd>
      </dl>
    </div>

    <div id="documentLanguage">
      <dl>
        <dt>Language</dt>
        <dd>
          <div>
            <select name="lang" onchange="location.href=value;">
                file_path: 2.0/ja/installation/helm_on_kubernetes
                hasdoc: True
                  <option value="#"
                  selected
                  >日本語</option>
                file_path: 2.0/en/installation/helm_on_kubernetes
                hasdoc: False
            </select>
          </div>
        </dd>
      </dl>
    </div>
    <div id="toolbarNavigation">
      <ul>
        <li class="prev"><a href="index.html" title="前のトピックへ">インストール</a></li>
        <li class="next"><a href="upgrade.html" title="次のトピックへ"><span class="section-number">2. </span>アップグレード</a></li>
      </ul>
    </div>
  </div>
</div><!-- End #toolbar -->

<div id="sideMenu">

  <div id="menuButton"></div>
  
  <aside class="divInner">
    <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Exastro IT Automation Documentation 2.0</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#id1">日本語</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../configuration/index.html">構成・構築ガイド</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">インストール</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">1. Helm chart (Kubernetes)</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id1">1.1. 目的</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id2">1.2. 前提条件</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id3">1.3. インストールの準備</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id11">1.4. インストール</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="upgrade.html">2. アップグレード</a></li>
<li class="toctree-l4"><a class="reference internal" href="uninstall.html">3. アンインストール</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../manuals/index.html">マニュアル</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/index.html">リファレンス</a></li>
<li class="toctree-l3"><a class="reference internal" href="../contribute/index.html">貢献</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    <!-- <ul>
      <li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">索引</a></li>
    </ul> -->
    
  </aside>
</div><!-- End #sideMenu -->


<div id="tableOfContents">
  <div id="tocButton"></div>
  <ul>
<li><a class="reference internal" href="#">1. Helm chart (Kubernetes)</a><ul>
<li><a class="reference internal" href="#id1">1.1. 目的</a></li>
<li><a class="reference internal" href="#id2">1.2. 前提条件</a></li>
<li><a class="reference internal" href="#id3">1.3. インストールの準備</a><ul>
<li><a class="reference internal" href="#helm">1.3.1. Helm リポジトリの登録</a></li>
<li><a class="reference internal" href="#id4">1.3.2. デフォルト設定値の取得</a></li>
<li><a class="reference internal" href="#service-setting">1.3.3. サービス公開の設定</a><ul>
<li><a class="reference internal" href="#id6">パラメータ</a></li>
<li><a class="reference internal" href="#id7">設定例</a></li>
</ul>
</li>
<li><a class="reference internal" href="#database-setup">1.3.4. データベース連携</a></li>
<li><a class="reference internal" href="#db">1.3.5. アプリケーションの DB ユーザ設定</a><ul>
<li><a class="reference internal" href="#id9">設定例</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gitlab">1.3.6. GitLab 連携設定</a></li>
<li><a class="reference internal" href="#exastro">1.3.7. Exastro システム管理者の作成</a></li>
<li><a class="reference internal" href="#persistent-volume">1.3.8. 永続ボリュームの設定</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11">1.4. インストール</a><ul>
<li><a class="reference internal" href="#id13">1.4.1. 永続ボリュームの作成</a></li>
<li><a class="reference internal" href="#id14">1.4.2. インストール</a></li>
<li><a class="reference internal" href="#id15">1.4.3. 管理コンソールへのログイン</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>


<div id="contents">
<main class="divInner">

 <div id="breadcrumbs">
  <ul>
    <li><a href="../../../index.html">HOME</a></li>
    <li><a href="../../index.html">Exastro IT Automation Documentation 2.0</a></li>
    <li><a href="index.html">インストール</a></li>
    
    <li><span class="section-number">1. </span>Helm chart (Kubernetes)</li>
  </ul>
</div>

<div id="article">
<article class="divInner">
<div class="body" role="main">

  <script>
$(window).on('load', function () {
   setTimeout(function(){
     for (var i = 0; i < $("table.filter-table").length; i++) {
       $("[id^='ft-data-" + i + "-2-r']").removeAttr("checked");
       $("[id^='select-all-" + i + "-2']").removeAttr("checked");
       $("[id^='ft-data-" + i + "-2-r'][value^='可']").prop('checked', true);
       $("[id^='ft-data-" + i + "-2-r'][value*='必須']").prop('checked', true);
       tFilterGo(i);
     }
   },200);
});
</script><section id="helm-chart-kubernetes">
<h1><span class="section-number">1. </span>Helm chart (Kubernetes)<a class="headerlink" href="#helm-chart-kubernetes" title="この見出しへのパーマリンク">¶</a></h1>
<section id="id1">
<h2><span class="section-number">1.1. </span>目的<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">¶</a></h2>
<div class="line-block">
<div class="line">本書では、Exastro IT Automation を利用する際に必要となる、Exastro Platform および Exastro IT Automation を導入する手順について説明します。</div>
</div>
</section>
<section id="id2">
<h2><span class="section-number">1.2. </span>前提条件<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">¶</a></h2>
<ul>
<li><p>クライアント要件</p>
<div class="line-block">
<div class="line">動作確認が取れているクライアントアプリケーションのバージョンは下記のとおりです。</div>
</div>
<table class="docutils align-default" id="id18">
<caption><span class="caption-number">表 1.3 </span><span class="caption-text">クライアント要件</span><a class="headerlink" href="#id18" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>アプリケーション</p></th>
<th class="head"><p>バージョン</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Helm</p></td>
<td><p>v3.9.x</p></td>
</tr>
<tr class="row-odd"><td><p>kubectl</p></td>
<td><p>1.23</p></td>
</tr>
</tbody>
</table>
</li>
<li><p>デプロイ環境</p>
<div class="line-block">
<div class="line">動作確認が取れているコンテナ環境の最小要求リソースとバージョンは下記のとおりです。</div>
</div>
<table class="docutils align-default" id="id19">
<caption><span class="caption-number">表 1.4 </span><span class="caption-text">デプロイ環境</span><a class="headerlink" href="#id19" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>リソース種別</p></th>
<th class="head"><p>要求リソース</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPU</p></td>
<td><p>2 Cores (3.0 GHz)</p></td>
</tr>
<tr class="row-odd"><td><p>Memory</p></td>
<td><p>4GB</p></td>
</tr>
<tr class="row-even"><td><p>Storage (Container image size)</p></td>
<td><p>10GB</p></td>
</tr>
<tr class="row-odd"><td><p>Kubernetes</p></td>
<td><p>1.23 以上</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">要求リソースは Exastro IT Automation のコア機能に対する値です。同一クラスタ上に Keycloak や MariaDB などの外部ツールをデプロイする場合は、その分のリソースが別途必要となります。</div>
<div class="line">データベースおよびファイルの永続化のために、別途ストレージ領域を用意する必要があります。</div>
<div class="line">Storage サイズには、Exastro IT Automation が使用する入出力データのファイルは含まれていないため、利用状況に応じて容量を見積もる必要があります。</div>
</div>
</div>
</li>
<li><p>通信要件</p>
<ul class="simple">
<li><p>クライアントからデプロイ先のコンテナ環境にアクセスできる必要があります。</p></li>
<li><p>Platform 管理者用と一般ユーザー用の2つ通信ポートが使用となります。</p></li>
<li><p>コンテナ環境からコンテナイメージの取得のために、Docker Hub に接続できる必要があります。</p></li>
</ul>
</li>
<li><p>外部コンポーネント</p>
<ul class="simple">
<li><p>MariaDB、もしくは、MySQL サーバ</p></li>
<li><p>GitLab リポジトリ、および、アカウントの払い出しが可能なこと</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">GitLab 環境を同一クラスタに構築する場合は、GitLab のシステム要件に対応する最小要件を追加で容易する必要があります。</div>
<div class="line">Database 環境を同一クラスタに構築する場合は、使用する Database のシステム要件に対応する最小要件を定義する必要があります</div>
</div>
</div>
</li>
</ul>
</section>
<section id="id3">
<h2><span class="section-number">1.3. </span>インストールの準備<a class="headerlink" href="#id3" title="この見出しへのパーマリンク">¶</a></h2>
<section id="helm">
<h3><span class="section-number">1.3.1. </span>Helm リポジトリの登録<a class="headerlink" href="#helm" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Exastro システムは、以下の2つのアプリケーションから構成されています。</div>
<div class="line">Exastro の全ツールは同一の Helm リポジトリ上に存在しています。</div>
</div>
<ul class="simple">
<li><p>共通基盤 (Exastro Platform)</p></li>
<li><p>Exastro IT Automation</p></li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>リポジトリ</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://exastro-suite.github.io/exastro-helm/">https://exastro-suite.github.io/exastro-helm/</a></p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-number">リスト 1.1 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id20" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1"># Exastro システムの Helm リポジトリを登録</span>
<span class="linenos">2</span>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>exastro<span class="w"> </span>https://exastro-suite.github.io/exastro-helm/<span class="w"> </span>-n<span class="w"> </span>exastro
<span class="linenos">3</span><span class="c1"># リポジトリ情報の更新</span>
<span class="linenos">4</span>helm<span class="w"> </span>repo<span class="w"> </span>update
</pre></div>
</div>
</div>
</section>
<section id="id4">
<h3><span class="section-number">1.3.2. </span>デフォルト設定値の取得<a class="headerlink" href="#id4" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">投入するパラメータを管理しやすくするために、下記のコマンドから共通基盤 values.yaml のデフォルト値を出力します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-number">リスト 1.2 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id21" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>helm<span class="w"> </span>show<span class="w"> </span>values<span class="w"> </span>exastro/exastro<span class="w"> </span>&gt;<span class="w"> </span>exastro.yaml
</pre></div>
</div>
</div>
<details>
  <summary>exastro.yaml</summary><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1"># Default values for Exastro.</span>
<span class="linenos">  2</span><span class="c1"># This is a YAML-formatted file.</span>
<span class="linenos">  3</span><span class="c1"># Declare variables to be passed into your templates.</span>
<span class="linenos">  4</span><span class="nt">global</span><span class="p">:</span>
<span class="linenos">  5</span><span class="w">  </span><span class="nt">itaGlobalDefinition</span><span class="p">:</span>
<span class="linenos">  6</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ita-global</span>
<span class="linenos">  7</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">  8</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">  9</span><span class="w">      </span><span class="nt">registry</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io&quot;</span>
<span class="linenos"> 10</span><span class="w">      </span><span class="nt">organization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exastro</span>
<span class="linenos"> 11</span><span class="w">      </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exastro-it-automation</span>
<span class="linenos"> 12</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="linenos"> 13</span><span class="w">      </span><span class="nt">DEFAULT_LANGUAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ja&quot;</span>
<span class="linenos"> 14</span><span class="w">      </span><span class="nt">LANGUAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;en&quot;</span>
<span class="linenos"> 15</span><span class="w">      </span><span class="nt">CONTAINER_BASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;kubernetes&quot;</span>
<span class="linenos"> 16</span><span class="w">      </span><span class="nt">TZ</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Asia/Tokyo&quot;</span>
<span class="linenos"> 17</span><span class="w">      </span><span class="nt">STORAGEPATH</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/storage/&quot;</span>
<span class="linenos"> 18</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos"> 19</span><span class="w">      </span><span class="nt">ENCRYPT_KEY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 20</span><span class="w">    </span><span class="nt">persistence</span><span class="p">:</span>
<span class="linenos"> 21</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos"> 22</span><span class="w">      </span><span class="nt">accessMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="linenos"> 23</span><span class="w">      </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
<span class="linenos"> 24</span><span class="w">      </span><span class="nt">volumeType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostPath</span><span class="w"> </span><span class="c1"># e.g.) hostPath or AKS</span>
<span class="linenos"> 25</span><span class="w">      </span><span class="nt">storageClass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="c1"># e.g.) azurefile or - (None)</span>
<span class="linenos"> 26</span><span class="w">      </span><span class="c1"># matchLabels:</span>
<span class="linenos"> 27</span><span class="w">      </span><span class="c1">#   release: &quot;stable&quot;</span>
<span class="linenos"> 28</span><span class="w">      </span><span class="c1"># matchExpressions:</span>
<span class="linenos"> 29</span><span class="w">      </span><span class="c1">#   - {key: environment, operator: In, values: [dev]}</span>
<span class="linenos"> 30</span><span class="w">  </span><span class="nt">gitlabDefinition</span><span class="p">:</span>
<span class="linenos"> 31</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitlab</span>
<span class="linenos"> 32</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos"> 33</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="linenos"> 34</span><span class="w">      </span><span class="nt">GITLAB_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
<span class="linenos"> 35</span><span class="w">      </span><span class="nt">GITLAB_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;gitlab&quot;</span>
<span class="linenos"> 36</span><span class="w">      </span><span class="nt">GITLAB_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;80&quot;</span>
<span class="linenos"> 37</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos"> 38</span><span class="w">      </span><span class="nt">GITLAB_ROOT_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 39</span><span class="w">  </span><span class="nt">itaDatabaseDefinition</span><span class="p">:</span>
<span class="linenos"> 40</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ita-database</span>
<span class="linenos"> 41</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos"> 42</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="linenos"> 43</span><span class="w">      </span><span class="nt">DB_VENDOR</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb&quot;</span>
<span class="linenos"> 44</span><span class="w">      </span><span class="nt">DB_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb&quot;</span>
<span class="linenos"> 45</span><span class="w">      </span><span class="nt">DB_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3306&quot;</span>
<span class="linenos"> 46</span><span class="w">      </span><span class="nt">DB_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ITA_DB&quot;</span>
<span class="linenos"> 47</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos"> 48</span><span class="w">      </span><span class="nt">DB_ADMIN_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 49</span><span class="w">      </span><span class="nt">DB_ADMIN_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 50</span><span class="w">      </span><span class="nt">DB_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 51</span><span class="w">      </span><span class="nt">DB_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 52</span><span class="w">  </span><span class="nt">pfGlobalDefinition</span><span class="p">:</span>
<span class="linenos"> 53</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pf-global</span>
<span class="linenos"> 54</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos"> 55</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos"> 56</span><span class="w">      </span><span class="nt">registry</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io&quot;</span>
<span class="linenos"> 57</span><span class="w">      </span><span class="nt">organization</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exastro</span>
<span class="linenos"> 58</span><span class="w">      </span><span class="nt">package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exastro-platform</span>
<span class="linenos"> 59</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="linenos"> 60</span><span class="w">      </span><span class="nt">DEFAULT_LANGUAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ja&quot;</span>
<span class="linenos"> 61</span><span class="w">      </span><span class="nt">LANGUAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;en&quot;</span>
<span class="linenos"> 62</span><span class="w">      </span><span class="nt">TZ</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Asia/Tokyo&quot;</span>
<span class="linenos"> 63</span><span class="w">      </span><span class="nt">PYTHONIOENCODING</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">utf-8</span>
<span class="linenos"> 64</span><span class="w">      </span><span class="nt">PLATFORM_API_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
<span class="linenos"> 65</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos"> 66</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos"> 67</span><span class="w">      </span><span class="nt">PLATFORM_WEB_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
<span class="linenos"> 68</span><span class="w">      </span><span class="nt">PLATFORM_WEB_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-web&quot;</span>
<span class="linenos"> 69</span><span class="w">      </span><span class="nt">PLATFORM_WEB_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos"> 70</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos"> 71</span><span class="w">      </span><span class="nt">ENCRYPT_KEY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 72</span><span class="w">    </span><span class="nt">persistence</span><span class="p">:</span>
<span class="linenos"> 73</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos"> 74</span><span class="w">      </span><span class="nt">accessMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="linenos"> 75</span><span class="w">      </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
<span class="linenos"> 76</span><span class="w">      </span><span class="nt">volumeType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostPath</span><span class="w"> </span><span class="c1"># e.g.) hostPath or AKS</span>
<span class="linenos"> 77</span><span class="w">      </span><span class="nt">storageClass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="c1"># e.g.) azurefile or - (None)</span>
<span class="linenos"> 78</span><span class="w">      </span><span class="c1"># matchLabels:</span>
<span class="linenos"> 79</span><span class="w">      </span><span class="c1">#   release: &quot;stable&quot;</span>
<span class="linenos"> 80</span><span class="w">      </span><span class="c1"># matchExpressions:</span>
<span class="linenos"> 81</span><span class="w">      </span><span class="c1">#   - {key: environment, operator: In, values: [dev]}</span>
<span class="linenos"> 82</span><span class="w">  </span><span class="nt">keycloakDefinition</span><span class="p">:</span>
<span class="linenos"> 83</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">keycloak</span>
<span class="linenos"> 84</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos"> 85</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="linenos"> 86</span><span class="w">      </span><span class="nt">API_KEYCLOAK_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
<span class="linenos"> 87</span><span class="w">      </span><span class="nt">API_KEYCLOAK_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;keycloak&quot;</span>
<span class="linenos"> 88</span><span class="w">      </span><span class="nt">API_KEYCLOAK_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8080&quot;</span>
<span class="linenos"> 89</span><span class="w">      </span><span class="nt">KEYCLOAK_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
<span class="linenos"> 90</span><span class="w">      </span><span class="nt">KEYCLOAK_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;keycloak&quot;</span>
<span class="linenos"> 91</span><span class="w">      </span><span class="nt">KEYCLOAK_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8080&quot;</span>
<span class="linenos"> 92</span><span class="w">      </span><span class="nt">KEYCLOAK_MASTER_REALM</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;master&quot;</span>
<span class="linenos"> 93</span><span class="w">      </span><span class="nt">KEYCLOAK_DB_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;keycloak&quot;</span>
<span class="linenos"> 94</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos"> 95</span><span class="w">      </span><span class="nt">KEYCLOAK_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 96</span><span class="w">      </span><span class="nt">KEYCLOAK_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 97</span><span class="w">      </span><span class="nt">KEYCLOAK_DB_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 98</span><span class="w">      </span><span class="nt">KEYCLOAK_DB_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 99</span><span class="w">  </span><span class="nt">itaDefinition</span><span class="p">:</span>
<span class="linenos">100</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ita</span>
<span class="linenos">101</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">102</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="linenos">103</span><span class="w">      </span><span class="nt">ITA_WEB_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
<span class="linenos">104</span><span class="w">      </span><span class="nt">ITA_WEB_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ita-web-server&quot;</span>
<span class="linenos">105</span><span class="w">      </span><span class="nt">ITA_WEB_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">106</span><span class="w">      </span><span class="nt">ITA_API_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
<span class="linenos">107</span><span class="w">      </span><span class="nt">ITA_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ita-api-organization&quot;</span>
<span class="linenos">108</span><span class="w">      </span><span class="nt">ITA_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8080&quot;</span>
<span class="linenos">109</span><span class="w">      </span><span class="nt">ITA_API_ADMIN_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
<span class="linenos">110</span><span class="w">      </span><span class="nt">ITA_API_ADMIN_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ita-api-admin&quot;</span>
<span class="linenos">111</span><span class="w">      </span><span class="nt">ITA_API_ADMIN_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8080&quot;</span>
<span class="linenos">112</span><span class="w">  </span><span class="nt">pfDatabaseDefinition</span><span class="p">:</span>
<span class="linenos">113</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pf-database</span>
<span class="linenos">114</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">115</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="linenos">116</span><span class="w">      </span><span class="nt">DB_VENDOR</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb&quot;</span>
<span class="linenos">117</span><span class="w">      </span><span class="nt">DB_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb&quot;</span>
<span class="linenos">118</span><span class="w">      </span><span class="nt">DB_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3306&quot;</span>
<span class="linenos">119</span><span class="w">      </span><span class="nt">DB_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform&quot;</span>
<span class="linenos">120</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos">121</span><span class="w">      </span><span class="nt">DB_ADMIN_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">122</span><span class="w">      </span><span class="nt">DB_ADMIN_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">123</span><span class="w">      </span><span class="nt">DB_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">124</span><span class="w">      </span><span class="nt">DB_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">125</span><span class="w">  </span><span class="nt">databaseDefinition</span><span class="p">:</span>
<span class="linenos">126</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb</span>
<span class="linenos">127</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">128</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos">129</span><span class="w">      </span><span class="nt">MARIADB_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">130</span><span class="w">    </span><span class="nt">persistence</span><span class="p">:</span>
<span class="linenos">131</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">132</span><span class="w">      </span><span class="nt">reinstall</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="linenos">133</span><span class="w">      </span><span class="nt">accessMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="linenos">134</span><span class="w">      </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
<span class="linenos">135</span><span class="w">      </span><span class="nt">volumeType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostPath</span><span class="w"> </span><span class="c1"># e.g.) hostPath or AKS</span>
<span class="linenos">136</span><span class="w">      </span><span class="nt">storageClass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="c1"># e.g.) azurefile or - (None)</span>
<span class="linenos">137</span><span class="w">      </span><span class="c1"># matchLabels:</span>
<span class="linenos">138</span><span class="w">      </span><span class="c1">#   release: &quot;stable&quot;</span>
<span class="linenos">139</span><span class="w">      </span><span class="c1"># matchExpressions:</span>
<span class="linenos">140</span><span class="w">      </span><span class="c1">#   - {key: environment, operator: In, values: [dev]}</span>
<span class="linenos">141</span>
<span class="linenos">142</span><span class="nt">exastro-it-automation</span><span class="p">:</span>
<span class="linenos">143</span><span class="w">  </span><span class="nt">ita-api-admin</span><span class="p">:</span>
<span class="linenos">144</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">145</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">146</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/exastro-it-automation-api-admin&quot;</span>
<span class="linenos">147</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">148</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">149</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">150</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">151</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">152</span>
<span class="linenos">153</span><span class="w">  </span><span class="nt">ita-api-organization</span><span class="p">:</span>
<span class="linenos">154</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">155</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">156</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/exastro-it-automation-api-organization&quot;</span>
<span class="linenos">157</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">158</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">159</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">160</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">161</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">162</span>
<span class="linenos">163</span><span class="w">  </span><span class="nt">ita-by-ansible-execute</span><span class="p">:</span>
<span class="linenos">164</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">165</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">166</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/exastro-it-automation-by-ansible-execute&quot;</span>
<span class="linenos">167</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">168</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">169</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">170</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">171</span><span class="w">      </span><span class="nt">ANSIBLE_AGENT_IMAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/exastro-it-automation-by-ansible-agent&quot;</span>
<span class="linenos">172</span><span class="w">      </span><span class="nt">ANSIBLE_AGENT_IMAGE_TAG</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">173</span><span class="w">    </span><span class="nt">serviceAccount</span><span class="p">:</span>
<span class="linenos">174</span><span class="w">      </span><span class="nt">create</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="linenos">175</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ita-by-ansible-execute-sa&quot;</span>
<span class="linenos">176</span>
<span class="linenos">177</span><span class="w">  </span><span class="nt">ita-by-ansible-legacy-role-vars-listup</span><span class="p">:</span>
<span class="linenos">178</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">179</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">180</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">181</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">182</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/exastro-it-automation-by-ansible-legacy-role-vars-listup&quot;</span>
<span class="linenos">183</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">184</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">185</span>
<span class="linenos">186</span><span class="w">  </span><span class="nt">ita-by-ansible-towermaster-sync</span><span class="p">:</span>
<span class="linenos">187</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">188</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">189</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">190</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">191</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/exastro-it-automation-by-ansible-towermaster-sync&quot;</span>
<span class="linenos">192</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">193</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">194</span>
<span class="linenos">195</span><span class="w">  </span><span class="nt">ita-by-conductor-synchronize</span><span class="p">:</span>
<span class="linenos">196</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">197</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">198</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">199</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">200</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/exastro-it-automation-by-conductor-synchronize&quot;</span>
<span class="linenos">201</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">202</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">203</span>
<span class="linenos">204</span><span class="w">  </span><span class="nt">ita-by-menu-create</span><span class="p">:</span>
<span class="linenos">205</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">206</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">207</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">208</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">209</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/exastro-it-automation-by-menu-create&quot;</span>
<span class="linenos">210</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">211</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">212</span>
<span class="linenos">213</span><span class="w">  </span><span class="nt">ita-database-setup-job</span><span class="p">:</span>
<span class="linenos">214</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">215</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">216</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">217</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">218</span>
<span class="linenos">219</span><span class="w">  </span><span class="nt">ita-web-server</span><span class="p">:</span>
<span class="linenos">220</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">221</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">222</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/exastro-it-automation-web-server&quot;</span>
<span class="linenos">223</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">224</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">225</span>
<span class="linenos">226</span><span class="nt">exastro-platform</span><span class="p">:</span>
<span class="linenos">227</span><span class="w">  </span><span class="nt">platform-api</span><span class="p">:</span>
<span class="linenos">228</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">229</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/exastro-platform-api&quot;</span>
<span class="linenos">230</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">231</span>
<span class="linenos">232</span><span class="w">  </span><span class="nt">platform-auth</span><span class="p">:</span>
<span class="linenos">233</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">234</span><span class="w">      </span><span class="c1"># Please set the URL to access</span>
<span class="linenos">235</span><span class="w">      </span><span class="nt">EXTERNAL_URL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">236</span><span class="w">      </span><span class="nt">EXTERNAL_URL_MNG</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">237</span><span class="w">    </span><span class="nt">ingress</span><span class="p">:</span>
<span class="linenos">238</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">239</span><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="linenos">240</span><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exastro-suite.example.local</span>
<span class="linenos">241</span><span class="w">          </span><span class="nt">paths</span><span class="p">:</span>
<span class="linenos">242</span><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="linenos">243</span><span class="w">              </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="linenos">244</span><span class="w">              </span><span class="nt">backend</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
<span class="linenos">245</span><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exastro-suite-mng.example.local</span>
<span class="linenos">246</span><span class="w">          </span><span class="nt">paths</span><span class="p">:</span>
<span class="linenos">247</span><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="linenos">248</span><span class="w">              </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="linenos">249</span><span class="w">              </span><span class="nt">backend</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;httpMng&quot;</span>
<span class="linenos">250</span><span class="w">    </span><span class="nt">service</span><span class="p">:</span>
<span class="linenos">251</span><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="linenos">252</span><span class="w">      </span><span class="c1"># http:</span>
<span class="linenos">253</span><span class="w">      </span><span class="c1">#   nodePort: 30080</span>
<span class="linenos">254</span><span class="w">      </span><span class="c1"># httpMng:</span>
<span class="linenos">255</span><span class="w">      </span><span class="c1">#   nodePort: 30081</span>
<span class="linenos">256</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">257</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/exastro-platform-auth&quot;</span>
<span class="linenos">258</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">259</span>
<span class="linenos">260</span><span class="w">  </span><span class="nt">platform-migration</span><span class="p">:</span>
<span class="linenos">261</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">262</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/exastro-platform-migration&quot;</span>
<span class="linenos">263</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">264</span>
<span class="linenos">265</span><span class="w">  </span><span class="nt">platform-web</span><span class="p">:</span>
<span class="linenos">266</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">267</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/exastro-platform-web&quot;</span>
<span class="linenos">268</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">269</span>
<span class="linenos">270</span><span class="w">  </span><span class="nt">mariadb</span><span class="p">:</span>
<span class="linenos">271</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">272</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">273</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb&quot;</span>
<span class="linenos">274</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10.9&quot;</span>
<span class="linenos">275</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">276</span><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<span class="linenos">277</span><span class="w">      </span><span class="nt">requests</span><span class="p">:</span>
<span class="linenos">278</span><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;256Mi&quot;</span>
<span class="linenos">279</span><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1m&quot;</span>
<span class="linenos">280</span><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
<span class="linenos">281</span><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2Gi&quot;</span>
<span class="linenos">282</span><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4&quot;</span>
<span class="linenos">283</span>
<span class="linenos">284</span><span class="w">  </span><span class="nt">keycloak</span><span class="p">:</span>
<span class="linenos">285</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">286</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">287</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;exastro/keycloak&quot;</span>
<span class="linenos">288</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">289</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">290</span><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<span class="linenos">291</span><span class="w">      </span><span class="nt">requests</span><span class="p">:</span>
<span class="linenos">292</span><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;256Mi&quot;</span>
<span class="linenos">293</span><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1m&quot;</span>
<span class="linenos">294</span><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
<span class="linenos">295</span><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2Gi&quot;</span>
<span class="linenos">296</span><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4&quot;</span>
</pre></div>
</div>
</details><div class="line-block">
<div class="line">以降の手順では、この <code class="file docutils literal notranslate"><span class="pre">exastro.yaml</span></code> に対してインストールに必要なパラメータを設定してきいます。</div>
</div>
</section>
<section id="service-setting">
<span id="id5"></span><h3><span class="section-number">1.3.3. </span>サービス公開の設定<a class="headerlink" href="#service-setting" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Exastro サービスを公開するための代表的な3つの設定方法について紹介します。</div>
</div>
<ul class="simple">
<li><p>Ingress</p></li>
<li><p>LoadBalancer</p></li>
<li><p>NodePort</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">ここで紹介する方法以外にもサービス公開方法はあります。ユーザの環境ごとに適切な構成・設定を選択してください。</div>
</div>
</div>
<section id="id6">
<h4>パラメータ<a class="headerlink" href="#id6" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">利用可能なパラメータについては下記を参照してください。</div>
</div>
<table class="filter-table docutils align-left" id="id22">
<caption><span class="caption-number">表 1.5 </span><span class="caption-text">Exastro Platform 認証機能のオプションパラメータ</span><a class="headerlink" href="#id22" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>exastro-platform.platform-auth.extraEnv.EXTERNAL_URL</p></td>
<td><div class="line-block">
<div class="line">Exastro Platform エンドポイントの公開URL。</div>
<div class="line">リバースプロキシや PAT(Port Address Transport) などにより、Exastro のエンドポイントと公開時の URL に齟齬が発生することで、サービス接続に失敗する場合に設定をする必要があります。</div>
</div>
</td>
<td><p>可</p></td>
<td><div class="line-block">
<div class="line">公開用エンドポイントのURL</div>
<div class="line">(http[s]://your-exastro.domain:port)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.platform-auth.extraEnv.EXTERNAL_URL_MNG</p></td>
<td><div class="line-block">
<div class="line">Exastro Platform 管理コンソールのエンドポイントの公開URL。</div>
<div class="line">リバースプロキシや PAT(Port Address Transport) などにより、Exastro のエンドポイントと公開時の URL に齟齬が発生することで、サービス接続に失敗する場合に設定をする必要があります。</div>
</div>
</td>
<td><p>可</p></td>
<td><div class="line-block">
<div class="line">公開用エンドポイントのURL</div>
<div class="line">(http[s]://your-exastro.domain:port)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>exastro-platform.platform-auth.ingress.enabled</p></td>
<td><p>Exastro Platform における Ingress 利用の要否</p></td>
<td><p>可</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">true</strong> (デフォルト): Exastro Platform にアクセスするための Ingress Controller をデプロイします。</div>
<div class="line"><strong class="program">false</strong> : Ingress Controller をデプロイしません。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.platform-auth.ingress.hosts[0].host</p></td>
<td><div class="line-block">
<div class="line">Exastro Platform 管理コンソールエンドポイントのホスト名、もしくは、FQDN</div>
<div class="line">別途、DNSへのレコード登録が必要です。</div>
</div>
</td>
<td><p>可 (Ingress利用時)</p></td>
<td><p>&quot;exastro-suite.example.local&quot;</p></td>
</tr>
<tr class="row-even"><td><p>exastro-platform.platform-auth.ingress.hosts[0].paths[0].path</p></td>
<td><p>Exastro Platform 管理コンソールエンドポイントのパスのルール</p></td>
<td><p>不可</p></td>
<td><p>&quot;/&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.platform-auth.ingress.hosts[0].paths[0].pathType</p></td>
<td><p>Exastro Platform 管理コンソールエンドポイントのパスの一致条件</p></td>
<td><p>不可</p></td>
<td><p>&quot;Prefix&quot;</p></td>
</tr>
<tr class="row-even"><td><p>exastro-platform.platform-auth.ingress.hosts[0].paths[0].backend</p></td>
<td><p>Exastro Platform 管理コンソールのサービス名</p></td>
<td><p>不可</p></td>
<td><p>&quot;http&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.platform-auth.ingress.hosts[1].host</p></td>
<td><div class="line-block">
<div class="line">Exastro Platform エンドポイントのホスト名、もしくは、FQDN</div>
<div class="line">別途、DNSへのレコード登録が必要です。</div>
</div>
</td>
<td><p>可 (Ingress利用時)</p></td>
<td><p>&quot;exastro-suite-mng.example.local&quot;</p></td>
</tr>
<tr class="row-even"><td><p>exastro-platform.platform-auth.ingress.hosts[1].paths[0].path</p></td>
<td><p>Exastro Platform エンドポイントのパスのルール</p></td>
<td><p>不可</p></td>
<td><p>&quot;/&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.platform-auth.ingress.hosts[1].paths[0].pathType</p></td>
<td><p>Exastro Platform エンドポイントのパスの一致条件</p></td>
<td><p>不可</p></td>
<td><p>&quot;Prefix&quot;</p></td>
</tr>
<tr class="row-even"><td><p>exastro-platform.platform-auth.ingress.hosts[1].paths[0].backend</p></td>
<td><p>Exastro Platform エンドポイントのエンドポイントのサービス名</p></td>
<td><p>不可</p></td>
<td><p>&quot;httpMng&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.platform-auth.service.type</p></td>
<td><p>Exastro Platform のサービスタイプ</p></td>
<td><p>可</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">ClusterIP</strong> (デフォルト): Ingress Controller を利用する場合などに選択</div>
<div class="line"><strong class="program">LoadBalancer</strong> : LoadBalancer を利用する場合に選択</div>
<div class="line"><strong class="program">NodePort</strong> : NodePort を利用する場合に選択</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>exastro-platform.platform-auth.service.http.nodePort</p></td>
<td><div class="line-block">
<div class="line">Exastro Platform のサービス用公開ポート番号</div>
</div>
</td>
<td><p>可 (NodePort利用時)</p></td>
<td><p>&quot;30080&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.platform-auth.service.httpMng.nodePort</p></td>
<td><div class="line-block">
<div class="line">Exastro Platform のシステム管理用公開ポート番号</div>
</div>
</td>
<td><p>可 (NodePort利用時)</p></td>
<td><p>&quot;30081&quot;</p></td>
</tr>
<tr class="row-even"><td><p>exastro-platform.platform-auth.image.repository</p></td>
<td><p>コンテナイメージのリポジトリ名</p></td>
<td><p>不可</p></td>
<td><p>&quot;exastro/exastro-platform-auth&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.platform-auth.image.tag</p></td>
<td><p>コンテナイメージのタグ</p></td>
<td><p>不可</p></td>
<td><p>&quot;1.0.6&quot;</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id7">
<h4>設定例<a class="headerlink" href="#id7" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">各サービス公開方法の設定例を下記に記載します。</div>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-SW5ncmVzcw==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-SW5ncmVzcw==" name="SW5ncmVzcw==" role="tab" tabindex="0">Ingress</button><button aria-controls="panel-0-TG9hZEJhbGFuY2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-TG9hZEJhbGFuY2Vy" name="TG9hZEJhbGFuY2Vy" role="tab" tabindex="-1">LoadBalancer</button><button aria-controls="panel-0-Tm9kZVBvcnQ=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-Tm9kZVBvcnQ=" name="Tm9kZVBvcnQ=" role="tab" tabindex="-1">NodePort</button></div><div aria-labelledby="tab-0-SW5ncmVzcw==" class="sphinx-tabs-panel group-tab" id="panel-0-SW5ncmVzcw==" name="SW5ncmVzcw==" role="tabpanel" tabindex="0"><ul class="simple" id="ingress-setting">
<li><p>特徴</p></li>
</ul>
<div class="line-block">
<div class="line">パブリッククラウドなどで Ingress Controller が利用可能な場合、Ingress を使ったサービス公開ができます。</div>
<div class="line">クラスタ内にロードバランサーを構築して、ユーザ自身が運用したい場合などにメリットがあります。</div>
</div>
<ul class="simple">
<li><p>設定例</p></li>
</ul>
<div class="line-block">
<div class="line">サービス公開用のドメイン情報を Ingress に登録することでDNSを使ったサービス公開を行います。</div>
<div class="line">Azure におけるドメイン名の確認方法については <a class="reference internal" href="../configuration/kubernetes/aks.html#aks-dns"><span class="std std-ref">ドメイン名の確認</span></a> を確認してください。</div>
<div class="line">クラウドプロバイダ毎に必要な <kbd class="kbd docutils literal notranslate">annotations</kbd> を指定してください。</div>
<div class="line">下記は、AKS の Ingress Controller を使用する際の例を記載しています。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-number">リスト 1.3 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id23" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">232</span><span class="w"> </span>platform-auth:
<span class="linenos">233</span><span class="w"> </span>  extraEnv:
<span class="linenos">234</span><span class="w"> </span>    # Please set the URL to access
<span class="linenos">235</span><span class="gd">-    EXTERNAL_URL: &quot;&quot;</span>
<span class="linenos">236</span><span class="gd">-    EXTERNAL_URL_MNG: &quot;&quot;</span>
<span class="linenos">237</span><span class="gi">+    EXTERNAL_URL: &quot;http://exastro-suite.xxxxxxxxxxxxxxxxxx.japaneast.aksapp.io&quot;</span>
<span class="linenos">238</span><span class="gi">+    EXTERNAL_URL_MNG: &quot;http://exastro-suite-mng.xxxxxxxxxxxxxxxxxx.japaneast.aksapp.io&quot;</span>
<span class="linenos">239</span><span class="w"> </span>  ingress:
<span class="linenos">240</span><span class="w"> </span>    enabled: true
<span class="linenos">241</span><span class="gi">+    annotations:</span>
<span class="linenos">242</span><span class="gi">+      kubernetes.io/ingress.class: addon-http-application-routing</span>
<span class="linenos">243</span><span class="gi">+      nginx.ingress.kubernetes.io/proxy-body-size: 100m</span>
<span class="linenos">244</span><span class="gi">+      nginx.ingress.kubernetes.io/proxy-buffer-size: 256k</span>
<span class="linenos">245</span><span class="gi">+      nginx.ingress.kubernetes.io/server-snippet: |</span>
<span class="linenos">246</span><span class="gi">+        client_header_buffer_size 100k;</span>
<span class="linenos">247</span><span class="gi">+        large_client_header_buffers 4 100k;</span>
<span class="linenos">248</span><span class="w"> </span>    hosts:
<span class="linenos">249</span><span class="gd">-      - host: exastro-suite.example.local</span>
<span class="linenos">250</span><span class="gi">+      - host: exastro-suite.xxxxxxxxxxxxxxxxxx.japaneast.aksapp.io</span>
<span class="linenos">251</span><span class="w"> </span>        paths:
<span class="linenos">252</span><span class="w"> </span>          - path: /
<span class="linenos">253</span><span class="w"> </span>            pathType: Prefix
<span class="linenos">254</span><span class="w"> </span>            backend: &quot;http&quot;
<span class="linenos">255</span><span class="gd">-      - host: exastro-suite-mng.example.local</span>
<span class="linenos">256</span><span class="gi">+      - host: exastro-suite-mng.xxxxxxxxxxxxxxxxxx.japaneast.aksapp.io</span>
<span class="linenos">257</span><span class="w"> </span>        paths:
<span class="linenos">258</span><span class="w"> </span>          - path: /
<span class="linenos">259</span><span class="w"> </span>            pathType: Prefix
<span class="linenos">260</span><span class="w"> </span>            backend: &quot;httpMng&quot;
</pre></div>
</div>
</div>
</div><div aria-labelledby="tab-0-TG9hZEJhbGFuY2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-TG9hZEJhbGFuY2Vy" name="TG9hZEJhbGFuY2Vy" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>特徴</p></li>
</ul>
<div class="line-block">
<div class="line">パブリッククラウドなどで LoadBalancer が利用可能な場合、LoadBalancer を使ったサービス公開ができます。</div>
<div class="line">Ingress とは異なり、クラスタ外部(多くは、パブリッククラウドのサービス上)にロードバランサーがデプロイされるため、ユーザ自身が運用する必要がないことにメリットがあります。</div>
</div>
<ul class="simple">
<li><p>設定例</p></li>
</ul>
<div class="line-block">
<div class="line"><kbd class="kbd docutils literal notranslate">service.type</kbd> に <kbd class="kbd docutils literal notranslate">LoadBalancer</kbd> を設定することで、LoadBalancer を使ったサービス公開ができます。</div>
<div class="line">下記は、LoadBalancer を使用する際の例を記載しています。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-number">リスト 1.4 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id24" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">232</span><span class="w"> </span>platform-auth:
<span class="linenos">233</span><span class="w"> </span>  extraEnv:
<span class="linenos">234</span><span class="w"> </span>    # Please set the URL to access
<span class="linenos">235</span><span class="gd">-    EXTERNAL_URL: &quot;&quot;</span>
<span class="linenos">236</span><span class="gd">-    EXTERNAL_URL_MNG: &quot;&quot;</span>
<span class="linenos">237</span><span class="gi">+    EXTERNAL_URL: &quot;https://your-exastro.domain&quot;</span>
<span class="linenos">238</span><span class="gi">+    EXTERNAL_URL_MNG: &quot;https://your-exastro-mng.domain&quot;</span>
<span class="linenos">239</span><span class="w"> </span>  ingress:
<span class="linenos">240</span><span class="gd">-    enabled: true</span>
<span class="linenos">241</span><span class="gi">+    enabled: false</span>
<span class="linenos">242</span><span class="w"> </span>    hosts:
<span class="linenos">243</span><span class="w"> </span>      - host: exastro-suite.example.local
<span class="linenos">244</span><span class="w"> </span>        paths:
<span class="linenos">245</span><span class="w"> </span>          - path: /
<span class="linenos">246</span><span class="w"> </span>            pathType: Prefix
<span class="linenos">247</span><span class="w"> </span>            backend: &quot;http&quot;
<span class="linenos">248</span><span class="w"> </span>      - host: exastro-suite-mng.example.local
<span class="linenos">249</span><span class="w"> </span>        paths:
<span class="linenos">250</span><span class="w"> </span>          - path: /
<span class="linenos">251</span><span class="w"> </span>            pathType: Prefix
<span class="linenos">252</span><span class="w"> </span>            backend: &quot;httpMng&quot;
<span class="linenos">253</span><span class="w"> </span>  service:
<span class="linenos">254</span><span class="gd">-    type: ClusterIP</span>
<span class="linenos">255</span><span class="gi">+    type: LoadBalancer</span>
<span class="linenos">256</span><span class="w"> </span>    # http:
<span class="linenos">257</span><span class="w"> </span>    #   nodePort: 30080
<span class="linenos">258</span><span class="w"> </span>    # httpMng:
<span class="linenos">259</span><span class="w"> </span>    #   nodePort: 30081
</pre></div>
</div>
</div>
</div><div aria-labelledby="tab-0-Tm9kZVBvcnQ=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-Tm9kZVBvcnQ=" name="Tm9kZVBvcnQ=" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>特徴</p></li>
</ul>
<div class="line-block">
<div class="line">ユーザ自身の環境でロードバランサーを準備する、もしくは、検証などの環境では NodePort を使ったサービス公開ができます。</div>
<div class="line">Ingress や LoadBalancer とは異なり、ネイティブな Kubernetes で利用可能です。</div>
</div>
<ul class="simple">
<li><p>設定例</p></li>
</ul>
<div class="line-block">
<div class="line"><kbd class="kbd docutils literal notranslate">service.type</kbd> に <kbd class="kbd docutils literal notranslate">NodePort</kbd> を設定することで、NodePort を使ったサービス公開ができます。</div>
<div class="line">下記は、NodePort を使用する際の例を記載しています。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-number">リスト 1.5 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id25" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">232</span><span class="w"> </span> platform-auth:
<span class="linenos">233</span><span class="w"> </span>   extraEnv:
<span class="linenos">234</span><span class="w"> </span>     # Please set the URL to access
<span class="linenos">235</span><span class="w"> </span>-    EXTERNAL_URL: &quot;&quot;
<span class="linenos">236</span><span class="w"> </span>-    EXTERNAL_URL_MNG: &quot;&quot;
<span class="linenos">237</span><span class="w"> </span>+    EXTERNAL_URL: &quot;http://10.10.10.10:30080&quot;
<span class="linenos">238</span><span class="w"> </span>+    EXTERNAL_URL_MNG: &quot;http://10.10.10.10:30081&quot;
<span class="linenos">239</span><span class="w"> </span>   ingress:
<span class="linenos">240</span><span class="gd">-    enabled: true</span>
<span class="linenos">241</span><span class="gi">+    enabled: false</span>
<span class="linenos">242</span><span class="w"> </span>     hosts:
<span class="linenos">243</span><span class="w"> </span>       - host: exastro-suite.example.local
<span class="linenos">244</span><span class="w"> </span>         paths:
<span class="linenos">245</span><span class="w"> </span>           - path: /
<span class="linenos">246</span><span class="w"> </span>             pathType: Prefix
<span class="linenos">247</span><span class="w"> </span>             backend: &quot;http&quot;
<span class="linenos">248</span><span class="w"> </span>       - host: exastro-suite-mng.example.local
<span class="linenos">249</span><span class="w"> </span>         paths:
<span class="linenos">250</span><span class="w"> </span>           - path: /
<span class="linenos">251</span><span class="w"> </span>             pathType: Prefix
<span class="linenos">252</span><span class="w"> </span>             backend: &quot;httpMng&quot;
<span class="linenos">253</span><span class="w"> </span>   service:
<span class="linenos">254</span><span class="gd">-    type: ClusterIP</span>
<span class="linenos">255</span><span class="gd">-    # http:</span>
<span class="linenos">256</span><span class="gd">-    #   nodePort: 30080</span>
<span class="linenos">257</span><span class="gd">-    # httpMng:</span>
<span class="linenos">258</span><span class="gd">-    #   nodePort: 30081</span>
<span class="linenos">259</span><span class="gi">+    type: NodePort</span>
<span class="linenos">260</span><span class="gi">+    http:</span>
<span class="linenos">261</span><span class="gi">+      nodePort: 30080</span>
<span class="linenos">262</span><span class="gi">+    httpMng:</span>
<span class="linenos">263</span><span class="gi">+      nodePort: 30081</span>
</pre></div>
</div>
</div>
</div></div>
</section>
</section>
<section id="database-setup">
<span id="id8"></span><h3><span class="section-number">1.3.4. </span>データベース連携<a class="headerlink" href="#database-setup" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Exastro サービスを利用するためには、CMDB やオーガナイゼーションの管理のためのデータベースが必要となります。</div>
<div class="line">データベース利用時の3つの設定方法について説明します。</div>
</div>
<ul class="simple">
<li><p>外部データベース</p></li>
<li><p>データベースコンテナ</p></li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-1-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-1-1-0" name="1-0" role="tab" tabindex="0">外部データベース</button><button aria-controls="panel-1-1-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-1-1-1" name="1-1" role="tab" tabindex="-1">データベースコンテナ</button></div><div aria-labelledby="tab-1-1-0" class="sphinx-tabs-panel" id="panel-1-1-0" name="1-0" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>特徴</p></li>
</ul>
<div class="line-block">
<div class="line">マネージドデータベースや別途用意した Kubernetes クラスタ外のデータベースを利用します。</div>
<div class="line">Kubernetes クラスタ外にあるため、環境を分離して管理することが可能です。</div>
</div>
<ul class="simple">
<li><p>設定例</p></li>
</ul>
<div class="line-block">
<div class="line">外部データベースを操作するために必要な接続情報を設定します。</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line"><strong class="command">DB_ADMIN_USER</strong> で指定するDBの管理ユーザには、データベースとユーザを作成する権限が必要です。</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">認証情報などはすべて平文で問題ありません。(Base64エンコードは不要)</div>
</div>
</div>
<ol class="arabic">
<li><p>Exastro IT Automation 用データベースの設定</p>
<div class="line-block">
<div class="line">データベースの接続情報を設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id26">
<caption><span class="caption-number">表 1.6 </span><span class="caption-text">共通設定 (Exastro IT Automation 用データベース) のオプションパラメータ</span><a class="headerlink" href="#id26" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.name</p></td>
<td><p>Exastro IT Automation 用データベースの定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;ita-database&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.enabled</p></td>
<td><p>Exastro IT Automation 用データベースの定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.config.DB_VENDOR</p></td>
<td><p>Exastro IT Automation 用データベースで使用するデータベース</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;mariadb&quot;</strong> (デフォルト): MariaDB を利用</div>
<div class="line"><strong class="program">&quot;mysql&quot;</strong>: MySQL を利用</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.config.DB_HOST</p></td>
<td><div class="line-block">
<div class="line">Exastro IT Automation 用データベース利用するDB</div>
<div class="line">デフォルト状態では、同一の Kubernetes クラスタ内にデプロイされるコンテナを指定しています。</div>
<div class="line">クラスタ外部の DB を利用する場合には設定が必要となります。</div>
</div>
</td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;mariadb&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.config.DB_PORT</p></td>
<td><p>Exastro IT Automation 用データベースで利用するポート番号(TCP)</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;3306&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.config.DB_DATABASE</p></td>
<td><p>Exastro IT Automation 用データベースで利用するデータベース名</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;platform&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.secret.DB_ADMIN_USER</p></td>
<td><p>Exastro IT Automation 用データベースで利用する管理権限を持つDBユーザ名</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.secret.DB_ADMIN_PASSWORD</p></td>
<td><p>Exastro IT Automation 用データベースで利用する管理権限を持つDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名のパスワード</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.secret.DB_USER</p></td>
<td><div class="line-block">
<div class="line">Exastro IT Automation 用データベースに作成するDBユーザ名。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.secret.DB_PASSWORD</p></td>
<td><p>Exastro IT Automation 用データベースに作成するDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id27">
<div class="code-block-caption"><span class="caption-number">リスト 1.6 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id27" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">39</span><span class="w"> </span> itaDatabaseDefinition:
<span class="linenos">40</span><span class="w"> </span>   name: ita-database
<span class="linenos">41</span><span class="w"> </span>   enabled: true
<span class="linenos">42</span><span class="w"> </span>   config:
<span class="linenos">43</span><span class="gd">-     DB_VENDOR: &quot;mariadb&quot;</span>
<span class="linenos">44</span><span class="gd">-     DB_HOST: &quot;mariadb&quot;</span>
<span class="linenos">45</span><span class="gd">-     DB_PORT: &quot;3306&quot;</span>
<span class="linenos">46</span><span class="gi">+     DB_VENDOR: &quot;mariadb&quot;                # mariadb or mysql</span>
<span class="linenos">47</span><span class="gi">+     DB_HOST: &quot;your.database.endpoint&quot;   # データベースのエンドポイント</span>
<span class="linenos">48</span><span class="gi">+     DB_PORT: &quot;3306&quot;                     # データベース接続ポート</span>
<span class="linenos">49</span><span class="w"> </span>     DB_DATABASE: &quot;ITA_DB&quot;               # 変更不要
<span class="linenos">50</span><span class="w"> </span>   secret:
<span class="linenos">51</span><span class="gd">-     DB_ADMIN_USER: &quot;&quot;</span>
<span class="linenos">52</span><span class="gd">-     DB_ADMIN_PASSWORD: &quot;&quot;s</span>
<span class="linenos">53</span><span class="gi">+     DB_ADMIN_USER: &quot;your-admin-account&quot;      # データベースの管理権限を持つユーザ</span>
<span class="linenos">54</span><span class="gi">+     DB_ADMIN_PASSWORD: &quot;your-admin-password&quot; # データベースの管理権限を持つユーザのパスワード</span>
<span class="linenos">55</span><span class="w"> </span>     DB_USER: &quot;&quot;
<span class="linenos">56</span><span class="w"> </span>     DB_PASSWORD: &quot;&quot;
</pre></div>
</div>
</div>
</li>
<li><p>Exastro 共通基盤用データベースの設定</p>
<div class="line-block">
<div class="line">データベースの接続情報を設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id28">
<caption><span class="caption-number">表 1.7 </span><span class="caption-text">共通設定 (Exastro 共通基盤用データベース) のオプションパラメータ</span><a class="headerlink" href="#id28" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.name</p></td>
<td><p>認証機能用データベースの定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;pf-database&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.enabled</p></td>
<td><p>認証機能用データベースの定義の有効有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.config.DB_VENDOR</p></td>
<td><p>認証機能用データベースで使用するデータベース</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;mariadb&quot;</strong> (デフォルト): MariaDB を利用</div>
<div class="line"><strong class="program">&quot;mysql&quot;</strong>: MySQL を利用</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.config.DB_HOST</p></td>
<td><div class="line-block">
<div class="line">認証機能用データベース利用するDB</div>
<div class="line">デフォルト状態では、同一の Kubernetes クラスタ内にデプロイされるコンテナを指定しています。</div>
<div class="line">クラスタ外部の DB を利用する場合には設定が必要となります。</div>
</div>
</td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;mariadb&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.config.DB_PORT</p></td>
<td><p>認証機能用データベースで利用するポート番号(TCP)</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;3306&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.config.DB_DATABASE</p></td>
<td><p>認証機能用データベースで利用するデータベース名</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;platform&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.secret.DB_ADMIN_USER</p></td>
<td><p>認証機能用データベースで利用する管理権限を持つDBユーザ名</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.secret.DB_ADMIN_PASSWORD</p></td>
<td><p>認証機能用データベースで利用する管理権限を持つDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名のパスワード</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.secret.DB_USER</p></td>
<td><div class="line-block">
<div class="line">認証機能用データベースに作成するDBユーザ名。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.secret.DB_PASSWORD</p></td>
<td><p>認証機能用データベースに作成するDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id29">
<div class="code-block-caption"><span class="caption-number">リスト 1.7 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id29" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">112</span><span class="w"> </span> pfDatabaseDefinition:
<span class="linenos">113</span><span class="w"> </span>   name: auth-database
<span class="linenos">114</span><span class="w"> </span>   enabled: true
<span class="linenos">115</span><span class="w"> </span>   config:
<span class="linenos">116</span><span class="gd">-     DB_VENDOR: &quot;mariadb&quot;</span>
<span class="linenos">117</span><span class="gd">-     DB_HOST: &quot;mariadb&quot;</span>
<span class="linenos">118</span><span class="gd">-     DB_PORT: &quot;3306&quot;</span>
<span class="linenos">119</span><span class="gi">+     DB_VENDOR: &quot;mariadb&quot;                # mariadb or mysql</span>
<span class="linenos">120</span><span class="gi">+     DB_HOST: &quot;your.database.endpoint&quot;   # データベースのエンドポイント</span>
<span class="linenos">121</span><span class="gi">+     DB_PORT: &quot;3306&quot;                     # データベース接続ポート</span>
<span class="linenos">122</span><span class="w"> </span>     DB_DATABASE: &quot;platform&quot;             # 変更不要
<span class="linenos">123</span><span class="w"> </span>   secret:
<span class="linenos">124</span><span class="gd">-     DB_ADMIN_USER: &quot;&quot;</span>
<span class="linenos">125</span><span class="gd">-     DB_ADMIN_PASSWORD: &quot;&quot;</span>
<span class="linenos">126</span><span class="gi">+     DB_ADMIN_USER: &quot;your-admin-account&quot;      # データベースの管理者ユーザ</span>
<span class="linenos">127</span><span class="gi">+     DB_ADMIN_PASSWORD: &quot;your-admin-password&quot; # データベースの管理者ユーザのパスワード</span>
<span class="linenos">128</span><span class="w"> </span>     DB_USER: &quot;&quot;
<span class="linenos">129</span><span class="w"> </span>     DB_PASSWORD: &quot;&quot;
</pre></div>
</div>
</div>
</li>
<li><p>データベースコンテナの無効化</p>
<div class="line-block">
<div class="line">データベースコンテナが起動しないように設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id30">
<caption><span class="caption-number">表 1.8 </span><span class="caption-text">共通設定 (Exastro 共用データベース) のオプションパラメータ</span><a class="headerlink" href="#id30" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.databaseDefinition.name</p></td>
<td><p>Exastro 共用データベースの定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;mariadb&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.databaseDefinition.enabled</p></td>
<td><p>Exastro 共用データベースの定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.databaseDefinition.secret.MARIADB_ROOT_PASSWORD</p></td>
<td><p>Exastro 共用データベースの root アカウントに設定するパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.databaseDefinition.persistence.enabled</p></td>
<td><p>Exastro 共用データベースのデータ永続化の有効フラグ</p></td>
<td><p>可</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;true&quot;</strong> (デフォルト): データを永続化する</div>
<div class="line"><strong class="program">&quot;false&quot;</strong>: データを永続化しない</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>global.databaseDefinition.persistence.reinstall</p></td>
<td><p>再インストール時にデータ領域の初期化の要否</p></td>
<td><p>可 (データ永続化時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;true&quot;</strong> (デフォルト): データを初期化(削除)する</div>
<div class="line"><strong class="program">&quot;false&quot;</strong>: データを初期化(削除)しない</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>global.databaseDefinition.persistence.accessMode</p></td>
<td><p>永続ボリュームのアクセスモードの指定。</p></td>
<td><p>不可</p></td>
<td><p>&quot;ReadWriteOnce&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.databaseDefinition.persistence.size</p></td>
<td><p>永続ボリュームのディスク容量</p></td>
<td><p>可 (データ永続化時)</p></td>
<td><p>&quot;20Gi&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.databaseDefinition.persistence.volumeType</p></td>
<td><p>永続ボリュームのボリュームタイプ</p></td>
<td><p>可 (現在無効)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;hostPath&quot;</strong> (デフォルト): Kubernetes クラスタのノード上にデータを保存(非推奨)</div>
<div class="line"><strong class="program">&quot;AKS&quot;</strong>: AKS のストレージクラスを利用</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>global.databaseDefinition.persistence.storageClass</p></td>
<td><p>永続ボリュームにストレージクラスを利用する場合のクラスを指定</p></td>
<td><p>可 (データ永続化時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;-&quot;</strong> (デフォルト): ストレージクラスを指定しない。</div>
<div class="line"><strong class="program">ストレージクラス名</strong>: クラウドプロバイダなどから提供されるストレージクラス名を指定。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id31">
<div class="code-block-caption"><span class="caption-number">リスト 1.8 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id31" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">270</span><span class="w"> </span> mariadb:
<span class="linenos">271</span><span class="gd">-   enabled: true</span>
<span class="linenos">272</span><span class="gi">+   enabled: false</span>
</pre></div>
</div>
</div>
</li>
</ol>
</div><div aria-labelledby="tab-1-1-1" class="sphinx-tabs-panel" hidden="true" id="panel-1-1-1" name="1-1" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>特徴</p></li>
</ul>
<div class="line-block">
<div class="line">Kubernetes クラスタ内にデプロイしたデータベースコンテナを利用します。</div>
<div class="line">Exastro と同じ Kubernetes クラスタにコンテナとして管理できます。</div>
</div>
<ul class="simple">
<li><p>設定例</p></li>
</ul>
<div class="line-block">
<div class="line">データベースコンテナの root パスワードを作成し、他のコンテナからもアクセスできるように作成した root アカウントのパスワードを設定します。</div>
<div class="line">また、データベースのデータを永続化するために利用するストレージを指定します。</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line"><strong class="command">DB_ADMIN_USER</strong> で指定するDBの管理ユーザには、データベースとユーザを作成する権限が必要です。</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">認証情報などはすべて平文で問題ありません。(Base64エンコードは不要)</div>
</div>
</div>
<ol class="arabic" id="configuration-database-container">
<li><p>データベースコンテナの設定</p>
<div class="line-block">
<div class="line">データベースコンテナの root パスワードを設定します。</div>
<div class="line">また、データベースのデータを永続化するために利用するストレージを指定します。</div>
</div>
<table class="filter-table docutils align-left" id="id32">
<caption><span class="caption-number">表 1.9 </span><span class="caption-text">共通設定 (Exastro 共用データベース) のオプションパラメータ</span><a class="headerlink" href="#id32" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.databaseDefinition.name</p></td>
<td><p>Exastro 共用データベースの定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;mariadb&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.databaseDefinition.enabled</p></td>
<td><p>Exastro 共用データベースの定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.databaseDefinition.secret.MARIADB_ROOT_PASSWORD</p></td>
<td><p>Exastro 共用データベースの root アカウントに設定するパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.databaseDefinition.persistence.enabled</p></td>
<td><p>Exastro 共用データベースのデータ永続化の有効フラグ</p></td>
<td><p>可</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;true&quot;</strong> (デフォルト): データを永続化する</div>
<div class="line"><strong class="program">&quot;false&quot;</strong>: データを永続化しない</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>global.databaseDefinition.persistence.reinstall</p></td>
<td><p>再インストール時にデータ領域の初期化の要否</p></td>
<td><p>可 (データ永続化時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;true&quot;</strong> (デフォルト): データを初期化(削除)する</div>
<div class="line"><strong class="program">&quot;false&quot;</strong>: データを初期化(削除)しない</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>global.databaseDefinition.persistence.accessMode</p></td>
<td><p>永続ボリュームのアクセスモードの指定。</p></td>
<td><p>不可</p></td>
<td><p>&quot;ReadWriteOnce&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.databaseDefinition.persistence.size</p></td>
<td><p>永続ボリュームのディスク容量</p></td>
<td><p>可 (データ永続化時)</p></td>
<td><p>&quot;20Gi&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.databaseDefinition.persistence.volumeType</p></td>
<td><p>永続ボリュームのボリュームタイプ</p></td>
<td><p>可 (現在無効)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;hostPath&quot;</strong> (デフォルト): Kubernetes クラスタのノード上にデータを保存(非推奨)</div>
<div class="line"><strong class="program">&quot;AKS&quot;</strong>: AKS のストレージクラスを利用</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>global.databaseDefinition.persistence.storageClass</p></td>
<td><p>永続ボリュームにストレージクラスを利用する場合のクラスを指定</p></td>
<td><p>可 (データ永続化時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;-&quot;</strong> (デフォルト): ストレージクラスを指定しない。</div>
<div class="line"><strong class="program">ストレージクラス名</strong>: クラウドプロバイダなどから提供されるストレージクラス名を指定。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-2-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-2-2-0" name="2-0" role="tab" tabindex="0">Storage Class 利用</button><button aria-controls="panel-2-2-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-2-2-1" name="2-1" role="tab" tabindex="-1">hostPath 利用</button></div><div aria-labelledby="tab-2-2-0" class="sphinx-tabs-panel" id="panel-2-2-0" name="2-0" role="tabpanel" tabindex="0"><div class="literal-block-wrapper docutils container" id="id33">
<div class="code-block-caption"><span class="caption-number">リスト 1.9 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id33" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">125</span><span class="w"> </span>   databaseDefinition:
<span class="linenos">126</span><span class="w"> </span>     name: mariadb
<span class="linenos">127</span><span class="w"> </span>     enabled: true
<span class="linenos">128</span><span class="w"> </span>     secret:
<span class="linenos">129</span><span class="gd">-     MARIADB_ROOT_PASSWORD: &quot;&quot;</span>
<span class="linenos">130</span><span class="gi">+     MARIADB_ROOT_PASSWORD: &quot;root-password&quot;  # データベースコンテナの root のパスワード</span>
<span class="linenos">131</span><span class="w"> </span>     persistence:
<span class="linenos">132</span><span class="w"> </span>       enabled: true
<span class="linenos">133</span><span class="w"> </span>       reinstall: false
<span class="linenos">134</span><span class="w"> </span>       accessMode: ReadWriteOnce
<span class="linenos">135</span><span class="gd">-      size: 20Gi</span>
<span class="linenos">136</span><span class="gd">-      volumeType: hostPath # e.g.) hostPath or AKS</span>
<span class="linenos">137</span><span class="gd">-      storageClass: &quot;-&quot; # e.g.) azurefile or - (None)</span>
<span class="linenos">138</span><span class="gi">+      size: XXGi                                       # 必要な容量に変更</span>
<span class="linenos">139</span><span class="gi">+      volumeType: AKS                                  # AKS を選択</span>
<span class="linenos">140</span><span class="gi">+      storageClass: &quot;exastro-suite-azurefile-csi-nfs&quot;  # 利用する Storage Class を指定</span>
</pre></div>
</div>
</div>
</div><div aria-labelledby="tab-2-2-1" class="sphinx-tabs-panel" hidden="true" id="panel-2-2-1" name="2-1" role="tabpanel" tabindex="0"><div class="literal-block-wrapper docutils container" id="id34">
<div class="code-block-caption"><span class="caption-number">リスト 1.10 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id34" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">125</span><span class="w"> </span>   databaseDefinition:
<span class="linenos">126</span><span class="w"> </span>     name: mariadb
<span class="linenos">127</span><span class="w"> </span>     enabled: true
<span class="linenos">128</span><span class="w"> </span>     secret:
<span class="linenos">129</span><span class="gd">-     MARIADB_ROOT_PASSWORD: &quot;&quot;</span>
<span class="linenos">130</span><span class="gi">+     MARIADB_ROOT_PASSWORD: &quot;root-password&quot;  # コンテナデータベースの root のパスワード</span>
<span class="linenos">131</span><span class="w"> </span>     persistence:
<span class="linenos">132</span><span class="w"> </span>       enabled: true
<span class="linenos">133</span><span class="w"> </span>       reinstall: false
<span class="linenos">134</span><span class="w"> </span>       accessMode: ReadWriteOnce
<span class="linenos">135</span><span class="gd">-      size: 20Gi</span>
<span class="linenos">136</span><span class="gd">-      volumeType: hostPath # e.g.) hostPath or AKS</span>
<span class="linenos">137</span><span class="gi">+      size: XXGi                                       # 必要な容量に変更</span>
<span class="linenos">138</span><span class="gi">+      volumeType: hostPath                             # AKS を選択</span>
<span class="linenos">139</span><span class="w"> </span>       storageClass: &quot;-&quot; # e.g.) azurefile or - (None)
</pre></div>
</div>
</div>
</div></div>
</li>
<li><p>Exastro IT Automation 用データベースの設定</p>
<div class="line-block">
<div class="line">Exastro IT Automation コンテナがデータベースに接続できるようにするために、<a class="reference internal" href="#database-setup"><span class="std std-ref">データベース連携</span></a> で作成した root アカウントのパスワードを設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id35">
<caption><span class="caption-number">表 1.10 </span><span class="caption-text">共通設定 (Exastro IT Automation 用データベース) のオプションパラメータ</span><a class="headerlink" href="#id35" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.name</p></td>
<td><p>Exastro IT Automation 用データベースの定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;ita-database&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.enabled</p></td>
<td><p>Exastro IT Automation 用データベースの定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.config.DB_VENDOR</p></td>
<td><p>Exastro IT Automation 用データベースで使用するデータベース</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;mariadb&quot;</strong> (デフォルト): MariaDB を利用</div>
<div class="line"><strong class="program">&quot;mysql&quot;</strong>: MySQL を利用</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.config.DB_HOST</p></td>
<td><div class="line-block">
<div class="line">Exastro IT Automation 用データベース利用するDB</div>
<div class="line">デフォルト状態では、同一の Kubernetes クラスタ内にデプロイされるコンテナを指定しています。</div>
<div class="line">クラスタ外部の DB を利用する場合には設定が必要となります。</div>
</div>
</td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;mariadb&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.config.DB_PORT</p></td>
<td><p>Exastro IT Automation 用データベースで利用するポート番号(TCP)</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;3306&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.config.DB_DATABASE</p></td>
<td><p>Exastro IT Automation 用データベースで利用するデータベース名</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;platform&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.secret.DB_ADMIN_USER</p></td>
<td><p>Exastro IT Automation 用データベースで利用する管理権限を持つDBユーザ名</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.secret.DB_ADMIN_PASSWORD</p></td>
<td><p>Exastro IT Automation 用データベースで利用する管理権限を持つDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名のパスワード</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.secret.DB_USER</p></td>
<td><div class="line-block">
<div class="line">Exastro IT Automation 用データベースに作成するDBユーザ名。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.secret.DB_PASSWORD</p></td>
<td><p>Exastro IT Automation 用データベースに作成するDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id36">
<div class="code-block-caption"><span class="caption-number">リスト 1.11 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id36" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">39</span><span class="w"> </span> itaDatabaseDefinition:
<span class="linenos">40</span><span class="w"> </span>   name: ita-database
<span class="linenos">41</span><span class="w"> </span>   enabled: true
<span class="linenos">42</span><span class="w"> </span>   config:
<span class="linenos">43</span><span class="w"> </span>     DB_VENDOR: &quot;mariadb&quot;
<span class="linenos">44</span><span class="w"> </span>     DB_HOST: &quot;mariadb&quot;
<span class="linenos">45</span><span class="w"> </span>     DB_PORT: &quot;3306&quot;
<span class="linenos">46</span><span class="w"> </span>     DB_DATABASE: &quot;ITA_DB&quot;
<span class="linenos">47</span><span class="w"> </span>   secret:
<span class="linenos">48</span><span class="gd">-     DB_ADMIN_USER: &quot;&quot;</span>
<span class="linenos">49</span><span class="gd">-     DB_ADMIN_PASSWORD: &quot;&quot;</span>
<span class="linenos">50</span><span class="gi">+     DB_ADMIN_USER: &quot;root&quot;                    # root を指定</span>
<span class="linenos">51</span><span class="gi">+     DB_ADMIN_PASSWORD: &quot;your-admin-password&quot; # 「1.  データベースコンテナの設定」で設定したコンテナデータベースの root のパスワード</span>
<span class="linenos">52</span><span class="w"> </span>     DB_USER: &quot;&quot;
<span class="linenos">53</span><span class="w"> </span>     DB_PASSWORD: &quot;&quot;
</pre></div>
</div>
</div>
</li>
<li><p>Exastro 共通基盤用データベースの設定</p>
<div class="line-block">
<div class="line">Exastro 共通基盤のコンテナがデータベースに接続できるようにするために、「1.  データベースコンテナの設定」で作成した root アカウントのパスワードを設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id37">
<caption><span class="caption-number">表 1.11 </span><span class="caption-text">共通設定 (Exastro 共通基盤用データベース) のオプションパラメータ</span><a class="headerlink" href="#id37" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.name</p></td>
<td><p>認証機能用データベースの定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;pf-database&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.enabled</p></td>
<td><p>認証機能用データベースの定義の有効有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.config.DB_VENDOR</p></td>
<td><p>認証機能用データベースで使用するデータベース</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;mariadb&quot;</strong> (デフォルト): MariaDB を利用</div>
<div class="line"><strong class="program">&quot;mysql&quot;</strong>: MySQL を利用</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.config.DB_HOST</p></td>
<td><div class="line-block">
<div class="line">認証機能用データベース利用するDB</div>
<div class="line">デフォルト状態では、同一の Kubernetes クラスタ内にデプロイされるコンテナを指定しています。</div>
<div class="line">クラスタ外部の DB を利用する場合には設定が必要となります。</div>
</div>
</td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;mariadb&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.config.DB_PORT</p></td>
<td><p>認証機能用データベースで利用するポート番号(TCP)</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;3306&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.config.DB_DATABASE</p></td>
<td><p>認証機能用データベースで利用するデータベース名</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;platform&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.secret.DB_ADMIN_USER</p></td>
<td><p>認証機能用データベースで利用する管理権限を持つDBユーザ名</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.secret.DB_ADMIN_PASSWORD</p></td>
<td><p>認証機能用データベースで利用する管理権限を持つDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名のパスワード</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.secret.DB_USER</p></td>
<td><div class="line-block">
<div class="line">認証機能用データベースに作成するDBユーザ名。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.secret.DB_PASSWORD</p></td>
<td><p>認証機能用データベースに作成するDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id38">
<div class="code-block-caption"><span class="caption-number">リスト 1.12 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id38" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">112</span><span class="w"> </span> pfDatabaseDefinition:
<span class="linenos">113</span><span class="w"> </span>   name: auth-database
<span class="linenos">114</span><span class="w"> </span>   enabled: true
<span class="linenos">115</span><span class="w"> </span>   config:
<span class="linenos">116</span><span class="w"> </span>     DB_VENDOR: &quot;mariadb&quot;
<span class="linenos">117</span><span class="w"> </span>     DB_HOST: &quot;mariadb&quot;
<span class="linenos">118</span><span class="w"> </span>     DB_PORT: &quot;3306&quot;
<span class="linenos">119</span><span class="w"> </span>     DB_DATABASE: &quot;platform&quot;
<span class="linenos">120</span><span class="w"> </span>   secret:
<span class="linenos">121</span><span class="gd">-     DB_ADMIN_USER: &quot;&quot;</span>
<span class="linenos">122</span><span class="gd">-     DB_ADMIN_PASSWORD: &quot;&quot;</span>
<span class="linenos">123</span><span class="gi">+     DB_ADMIN_USER: &quot;root&quot;                    # root を指定</span>
<span class="linenos">124</span><span class="gi">+     DB_ADMIN_PASSWORD: &quot;your-admin-password&quot; # 「1.  データベースコンテナの設定」で設定したコンテナデータベースの root のパスワード</span>
<span class="linenos">125</span><span class="w"> </span>     DB_USER: &quot;&quot;
<span class="linenos">126</span><span class="w"> </span>     DB_PASSWORD: &quot;&quot;
</pre></div>
</div>
</div>
</li>
</ol>
</div></div>
</section>
<section id="db">
<span id="installation-kubernetes-keycloak"></span><h3><span class="section-number">1.3.5. </span>アプリケーションの DB ユーザ設定<a class="headerlink" href="#db" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Exastro でアプリケーションのために作成する DB ユーザの設定をします。</div>
</div>
<section id="id9">
<h4>設定例<a class="headerlink" href="#id9" title="この見出しへのパーマリンク">¶</a></h4>
<div class="line-block">
<div class="line">下記のアプリケーションが利用・作成する DB ユーザをそれぞれ設定します。</div>
</div>
<ul class="simple">
<li><p>Exastro IT Automation</p></li>
<li><p>Exastro 共通基盤</p></li>
<li><p>Keycloak</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">認証情報などはすべて平文で問題ありません。(Base64エンコードは不要)</div>
</div>
</div>
<ol class="arabic">
<li><p>Exastro IT Automation 用データベースの設定</p>
<div class="line-block">
<div class="line">アプリケーションが利用・作成する DB ユーザを設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id39">
<caption><span class="caption-number">表 1.12 </span><span class="caption-text">共通設定 (Exastro IT Automation 用データベース) のオプションパラメータ</span><a class="headerlink" href="#id39" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.name</p></td>
<td><p>Exastro IT Automation 用データベースの定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;ita-database&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.enabled</p></td>
<td><p>Exastro IT Automation 用データベースの定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.config.DB_VENDOR</p></td>
<td><p>Exastro IT Automation 用データベースで使用するデータベース</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;mariadb&quot;</strong> (デフォルト): MariaDB を利用</div>
<div class="line"><strong class="program">&quot;mysql&quot;</strong>: MySQL を利用</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.config.DB_HOST</p></td>
<td><div class="line-block">
<div class="line">Exastro IT Automation 用データベース利用するDB</div>
<div class="line">デフォルト状態では、同一の Kubernetes クラスタ内にデプロイされるコンテナを指定しています。</div>
<div class="line">クラスタ外部の DB を利用する場合には設定が必要となります。</div>
</div>
</td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;mariadb&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.config.DB_PORT</p></td>
<td><p>Exastro IT Automation 用データベースで利用するポート番号(TCP)</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;3306&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.config.DB_DATABASE</p></td>
<td><p>Exastro IT Automation 用データベースで利用するデータベース名</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;platform&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.secret.DB_ADMIN_USER</p></td>
<td><p>Exastro IT Automation 用データベースで利用する管理権限を持つDBユーザ名</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.secret.DB_ADMIN_PASSWORD</p></td>
<td><p>Exastro IT Automation 用データベースで利用する管理権限を持つDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名のパスワード</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.secret.DB_USER</p></td>
<td><div class="line-block">
<div class="line">Exastro IT Automation 用データベースに作成するDBユーザ名。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.secret.DB_PASSWORD</p></td>
<td><p>Exastro IT Automation 用データベースに作成するDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id40">
<div class="code-block-caption"><span class="caption-number">リスト 1.13 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id40" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">39</span><span class="w"> </span> itaDatabaseDefinition:
<span class="linenos">40</span><span class="w"> </span>   name: ita-database
<span class="linenos">41</span><span class="w"> </span>   enabled: true
<span class="linenos">42</span><span class="w"> </span>   config:
<span class="linenos">43</span><span class="w"> </span>     DB_VENDOR: &quot;mariadb&quot;
<span class="linenos">44</span><span class="w"> </span>     DB_HOST: &quot;mariadb&quot;
<span class="linenos">45</span><span class="w"> </span>     DB_PORT: &quot;3306&quot;
<span class="linenos">46</span><span class="w"> </span>     DB_DATABASE: &quot;ITA_DB&quot;
<span class="linenos">47</span><span class="w"> </span>   secret:
<span class="linenos">48</span><span class="w"> </span>     DB_ADMIN_USER: &quot;&quot;
<span class="linenos">49</span><span class="w"> </span>     DB_ADMIN_PASSWORD: &quot;&quot;
<span class="linenos">50</span><span class="gd">-     DB_USER: &quot;&quot;</span>
<span class="linenos">51</span><span class="gd">-     DB_PASSWORD: &quot;&quot;</span>
<span class="linenos">52</span><span class="gi">+     DB_USER: &quot;ita-db-user&quot;                # Exastro IT Automation のアプリが使うDBユーザ</span>
<span class="linenos">53</span><span class="gi">+     DB_PASSWORD: &quot;ita-db-user-password&quot;   # Exastro IT Automation のアプリが使うDBユーザのパスワード</span>
</pre></div>
</div>
</div>
</li>
<li><p>Keycloak 用データベースの設定</p>
<div class="line-block">
<div class="line">アプリケーションが利用・作成する DB ユーザを設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id41">
<caption><span class="caption-number">表 1.13 </span><span class="caption-text">共通設定 (Keycloak) のオプションパラメータ</span><a class="headerlink" href="#id41" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.keycloakDefinition.name</p></td>
<td><p>Keycloak の定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.enabled</p></td>
<td><p>Keycloak の定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.API_KEYCLOAK_PROTOCOL</p></td>
<td><p>Keycloak API エンドポイントのプロトコル</p></td>
<td><p>可 (外部Keycloak利用時)</p></td>
<td><p>&quot;http”</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.API_KEYCLOAK_HOST</p></td>
<td><p>Keycloak API エンドポイントのホスト名、もしくは、FQDN</p></td>
<td><p>可 (外部Keycloak利用時)</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.API_KEYCLOAK_PORT</p></td>
<td><p>Keycloak API エンドポイントのポート番号</p></td>
<td><p>可 (外部Keycloak利用時)</p></td>
<td><p>&quot;8080&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.KEYCLOAK_PROTOCOL</p></td>
<td><p>Keycloak エンドポイントのプロトコル</p></td>
<td><p>可 (外部Keycloak利用時)</p></td>
<td><p>&quot;http&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.KEYCLOAK_HOST</p></td>
<td><p>Keycloak エンドポイントのホスト名、もしくは、FQDN</p></td>
<td><p>可 (外部Keycloak利用時)</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.KEYCLOAK_PORT</p></td>
<td><p>Keycloak API エンドポイントのポート番号</p></td>
<td><p>可 (外部Keycloak利用時)</p></td>
<td><p>&quot;8080&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.KEYCLOAK_MASTER_REALM</p></td>
<td><p>Keycloak のマスターレルム名</p></td>
<td><p>可</p></td>
<td><p>&quot;master&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.KEYCLOAK_DB_DATABASE</p></td>
<td><p>Keycloak が利用するデータベース名</p></td>
<td><p>可</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.secret.KEYCLOAK_USER</p></td>
<td><div class="line-block">
<div class="line">Keycloak のマスターレルムにおける管理権限を持ったユーザ名を指定。</div>
<div class="line">指定した Keycloak ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.secret.KEYCLOAK_PASSWORD</p></td>
<td><p>Keycloak のマスターレルムにおける管理権限を持ったユーザに設定するパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.secret.KEYCLOAK_DB_USER</p></td>
<td><div class="line-block">
<div class="line">Keycloak が使用するデータベースユーザ。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.secret.KEYCLOAK_DB_PASSWORD</p></td>
<td><p>Keycloak が使用するデータベースユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id42">
<div class="code-block-caption"><span class="caption-number">リスト 1.14 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id42" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 82</span><span class="w"> </span> keycloakDefinition:
<span class="linenos"> 83</span><span class="w"> </span>   name: keycloak
<span class="linenos"> 84</span><span class="w"> </span>   enabled: true
<span class="linenos"> 85</span><span class="w"> </span>   config:
<span class="linenos"> 86</span><span class="w"> </span>     API_KEYCLOAK_PROTOCOL: &quot;http&quot;
<span class="linenos"> 87</span><span class="w"> </span>     API_KEYCLOAK_HOST: &quot;keycloak&quot;
<span class="linenos"> 88</span><span class="w"> </span>     API_KEYCLOAK_PORT: &quot;8080&quot;
<span class="linenos"> 89</span><span class="w"> </span>     KEYCLOAK_PROTOCOL: &quot;http&quot;
<span class="linenos"> 90</span><span class="w"> </span>     KEYCLOAK_HOST: &quot;keycloak&quot;
<span class="linenos"> 91</span><span class="w"> </span>     KEYCLOAK_PORT: &quot;8080&quot;
<span class="linenos"> 92</span><span class="w"> </span>     KEYCLOAK_MASTER_REALM: &quot;master&quot;
<span class="linenos"> 93</span><span class="w"> </span>     KEYCLOAK_DB_DATABASE: &quot;keycloak&quot;
<span class="linenos"> 94</span><span class="w"> </span>   secret:
<span class="linenos"> 95</span><span class="w"> </span>     KEYCLOAK_USER: &quot;&quot;
<span class="linenos"> 96</span><span class="w"> </span>     KEYCLOAK_PASSWORD: &quot;&quot;
<span class="linenos"> 97</span><span class="gd">-     KEYCLOAK_DB_USER: &quot;&quot;</span>
<span class="linenos"> 98</span><span class="gd">-     KEYCLOAK_DB_PASSWORD: &quot;&quot;</span>
<span class="linenos"> 99</span><span class="gi">+     KEYCLOAK_DB_USER: &quot;keycloak-db-user&quot;               # Keycloak が使うDBユーザ</span>
<span class="linenos">100</span><span class="gi">+     KEYCLOAK_DB_PASSWORD: &quot;keycloak-db-user-password&quot;  # Keycloak が使うDBユーザのパスワード</span>
</pre></div>
</div>
</div>
</li>
<li><p>Exastro 共通基盤用データベースの設定</p>
<div class="line-block">
<div class="line">アプリケーションが利用・作成する DB ユーザを設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id43">
<caption><span class="caption-number">表 1.14 </span><span class="caption-text">共通設定 (Exastro 共通基盤用データベース) のオプションパラメータ</span><a class="headerlink" href="#id43" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.name</p></td>
<td><p>認証機能用データベースの定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;pf-database&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.enabled</p></td>
<td><p>認証機能用データベースの定義の有効有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.config.DB_VENDOR</p></td>
<td><p>認証機能用データベースで使用するデータベース</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;mariadb&quot;</strong> (デフォルト): MariaDB を利用</div>
<div class="line"><strong class="program">&quot;mysql&quot;</strong>: MySQL を利用</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.config.DB_HOST</p></td>
<td><div class="line-block">
<div class="line">認証機能用データベース利用するDB</div>
<div class="line">デフォルト状態では、同一の Kubernetes クラスタ内にデプロイされるコンテナを指定しています。</div>
<div class="line">クラスタ外部の DB を利用する場合には設定が必要となります。</div>
</div>
</td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;mariadb&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.config.DB_PORT</p></td>
<td><p>認証機能用データベースで利用するポート番号(TCP)</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;3306&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.config.DB_DATABASE</p></td>
<td><p>認証機能用データベースで利用するデータベース名</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;platform&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.secret.DB_ADMIN_USER</p></td>
<td><p>認証機能用データベースで利用する管理権限を持つDBユーザ名</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.secret.DB_ADMIN_PASSWORD</p></td>
<td><p>認証機能用データベースで利用する管理権限を持つDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名のパスワード</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.secret.DB_USER</p></td>
<td><div class="line-block">
<div class="line">認証機能用データベースに作成するDBユーザ名。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.secret.DB_PASSWORD</p></td>
<td><p>認証機能用データベースに作成するDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id44">
<div class="code-block-caption"><span class="caption-number">リスト 1.15 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id44" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">112</span><span class="w"> </span> pfDatabaseDefinition:
<span class="linenos">113</span><span class="w"> </span>   name: auth-database
<span class="linenos">114</span><span class="w"> </span>   enabled: true
<span class="linenos">115</span><span class="w"> </span>   config:
<span class="linenos">116</span><span class="w"> </span>     DB_VENDOR: &quot;mariadb&quot;
<span class="linenos">117</span><span class="w"> </span>     DB_HOST: &quot;mariadb&quot;
<span class="linenos">118</span><span class="w"> </span>     DB_PORT: &quot;3306&quot;
<span class="linenos">119</span><span class="w"> </span>     DB_DATABASE: &quot;platform&quot;
<span class="linenos">120</span><span class="w"> </span>   secret:
<span class="linenos">121</span><span class="w"> </span>     DB_ADMIN_USER: &quot;&quot;
<span class="linenos">122</span><span class="w"> </span>     DB_ADMIN_PASSWORD: &quot;&quot;
<span class="linenos">123</span><span class="gd">-     DB_USER: &quot;&quot;</span>
<span class="linenos">124</span><span class="gd">-     DB_PASSWORD: &quot;&quot;</span>
<span class="linenos">125</span><span class="gi">+     DB_USER: &quot;pf-db-user&quot;           # Exastro 共通基盤が使うDBユーザ</span>
<span class="linenos">126</span><span class="gi">+     DB_PASSWORD: &quot;pf-db-password&quot;   # Exastro 共通基盤が使うDBユーザのパスワード</span>
</pre></div>
</div>
</div>
</li>
</ol>
</section>
</section>
<section id="gitlab">
<span id="installation-kubernetes-gitlablinkage"></span><h3><span class="section-number">1.3.6. </span>GitLab 連携設定<a class="headerlink" href="#gitlab" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">GitLab 連携のための接続情報を登録します。</div>
</div>
<table class="filter-table docutils align-left" id="id45">
<caption><span class="caption-number">表 1.15 </span><span class="caption-text">共通設定 (GitLab) のオプションパラメータ</span><a class="headerlink" href="#id45" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.gitlabDefinition.name</p></td>
<td><p>GitLab の定義名</p></td>
<td><p>不可</p></td>
<td><p>gitlab</p></td>
</tr>
<tr class="row-odd"><td><p>global.gitlabDefinition.enabled</p></td>
<td><p>GitLab の定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.gitlabDefinition.config.GITLAB_PROTOCOL</p></td>
<td><p>GitLab エンドポイントのプロトコル</p></td>
<td><p>可</p></td>
<td><p>http</p></td>
</tr>
<tr class="row-odd"><td><p>global.gitlabDefinition.config.GITLAB_HOST</p></td>
<td><p>GitLab エンドポイントへのホスト名、もしくは、FQDN</p></td>
<td><p>可</p></td>
<td><p>gitlab</p></td>
</tr>
<tr class="row-even"><td><p>global.gitlabDefinition.config.GITLAB_PORT</p></td>
<td><p>GitLab エンドポイントのポート番号</p></td>
<td><p>可</p></td>
<td><p>80</p></td>
</tr>
<tr class="row-odd"><td><p>global.gitlabDefinition.secret.GITLAB_ROOT_TOKEN</p></td>
<td><p>GitLab の root 権限アカウントのアクセストークン</p></td>
<td><p>必須</p></td>
<td><p>アクセエストークン(平文)</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">GITLAB_ROOT_TOKEN は下記の権限スコープが割り当てられたトークンが必要です。</div>
<div class="line">・api</div>
<div class="line">・write_repository</div>
<div class="line">・sudo</div>
</div>
</div>
<div class="line-block">
<div class="line">下記は、GitLab 連携の設定例を記載しています。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id46">
<div class="code-block-caption"><span class="caption-number">リスト 1.16 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id46" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">30</span><span class="w"> </span>   gitlabDefinition:
<span class="linenos">31</span><span class="w"> </span>     name: gitlab
<span class="linenos">32</span><span class="w"> </span>     enabled: true
<span class="linenos">33</span><span class="w"> </span>     config:
<span class="linenos">34</span><span class="w"> </span> -     GITLAB_PROTOCOL: &quot;http&quot;
<span class="linenos">35</span><span class="w"> </span> -     GITLAB_HOST: &quot;gitlab&quot;
<span class="linenos">36</span><span class="w"> </span> -     GITLAB_PORT: &quot;80&quot;
<span class="linenos">37</span><span class="w"> </span> +     GITLAB_PROTOCOL: &quot;接続プロトコル http or https&quot;
<span class="linenos">38</span><span class="w"> </span> +     GITLAB_HOST: &quot;接続先&quot;
<span class="linenos">39</span><span class="w"> </span> +     GITLAB_PORT: &quot;接続ポート&quot;
<span class="linenos">40</span><span class="w"> </span>     secret:
<span class="linenos">41</span><span class="w"> </span> -     GITLAB_ROOT_TOKEN: &quot;&quot;
<span class="linenos">42</span><span class="w"> </span> +     GITLAB_ROOT_TOKEN: &quot;GitLabのRoot権限を持ったトークン&quot;
</pre></div>
</div>
</div>
</section>
<section id="exastro">
<span id="create-system-manager"></span><h3><span class="section-number">1.3.7. </span>Exastro システム管理者の作成<a class="headerlink" href="#exastro" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Keycloak セットアップ時に Exastro システム管理者の初期ユーザを作成するための情報を設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id47">
<caption><span class="caption-number">表 1.16 </span><span class="caption-text">共通設定 (Keycloak) のオプションパラメータ</span><a class="headerlink" href="#id47" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 13%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.keycloakDefinition.name</p></td>
<td><p>Keycloak の定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.enabled</p></td>
<td><p>Keycloak の定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.API_KEYCLOAK_PROTOCOL</p></td>
<td><p>Keycloak API エンドポイントのプロトコル</p></td>
<td><p>可 (外部Keycloak利用時)</p></td>
<td><p>&quot;http”</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.API_KEYCLOAK_HOST</p></td>
<td><p>Keycloak API エンドポイントのホスト名、もしくは、FQDN</p></td>
<td><p>可 (外部Keycloak利用時)</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.API_KEYCLOAK_PORT</p></td>
<td><p>Keycloak API エンドポイントのポート番号</p></td>
<td><p>可 (外部Keycloak利用時)</p></td>
<td><p>&quot;8080&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.KEYCLOAK_PROTOCOL</p></td>
<td><p>Keycloak エンドポイントのプロトコル</p></td>
<td><p>可 (外部Keycloak利用時)</p></td>
<td><p>&quot;http&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.KEYCLOAK_HOST</p></td>
<td><p>Keycloak エンドポイントのホスト名、もしくは、FQDN</p></td>
<td><p>可 (外部Keycloak利用時)</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.KEYCLOAK_PORT</p></td>
<td><p>Keycloak API エンドポイントのポート番号</p></td>
<td><p>可 (外部Keycloak利用時)</p></td>
<td><p>&quot;8080&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.KEYCLOAK_MASTER_REALM</p></td>
<td><p>Keycloak のマスターレルム名</p></td>
<td><p>可</p></td>
<td><p>&quot;master&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.KEYCLOAK_DB_DATABASE</p></td>
<td><p>Keycloak が利用するデータベース名</p></td>
<td><p>可</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.secret.KEYCLOAK_USER</p></td>
<td><div class="line-block">
<div class="line">Keycloak のマスターレルムにおける管理権限を持ったユーザ名を指定。</div>
<div class="line">指定した Keycloak ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.secret.KEYCLOAK_PASSWORD</p></td>
<td><p>Keycloak のマスターレルムにおける管理権限を持ったユーザに設定するパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.secret.KEYCLOAK_DB_USER</p></td>
<td><div class="line-block">
<div class="line">Keycloak が使用するデータベースユーザ。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.secret.KEYCLOAK_DB_PASSWORD</p></td>
<td><p>Keycloak が使用するデータベースユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id48">
<div class="code-block-caption"><span class="caption-number">リスト 1.17 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id48" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 82</span><span class="w"> </span> keycloakDefinition:
<span class="linenos"> 83</span><span class="w"> </span>   name: keycloak
<span class="linenos"> 84</span><span class="w"> </span>   enabled: true
<span class="linenos"> 85</span><span class="w"> </span>   config:
<span class="linenos"> 86</span><span class="w"> </span>     API_KEYCLOAK_PROTOCOL: &quot;http&quot;
<span class="linenos"> 87</span><span class="w"> </span>     API_KEYCLOAK_HOST: &quot;keycloak&quot;
<span class="linenos"> 88</span><span class="w"> </span>     API_KEYCLOAK_PORT: &quot;8080&quot;
<span class="linenos"> 89</span><span class="w"> </span>     KEYCLOAK_PROTOCOL: &quot;http&quot;
<span class="linenos"> 90</span><span class="w"> </span>     KEYCLOAK_HOST: &quot;keycloak&quot;
<span class="linenos"> 91</span><span class="w"> </span>     KEYCLOAK_PORT: &quot;8080&quot;
<span class="linenos"> 92</span><span class="w"> </span>     KEYCLOAK_MASTER_REALM: &quot;master&quot;
<span class="linenos"> 93</span><span class="w"> </span>     KEYCLOAK_DB_DATABASE: &quot;keycloak&quot;
<span class="linenos"> 94</span><span class="w"> </span>   secret:
<span class="linenos"> 95</span><span class="gd">-     KEYCLOAK_USER: &quot;&quot;</span>
<span class="linenos"> 96</span><span class="gd">-     KEYCLOAK_PASSWORD: &quot;&quot;</span>
<span class="linenos"> 97</span><span class="gi">+     KEYCLOAK_USER: &quot;admin&quot;               # Exastro システムの管理者</span>
<span class="linenos"> 98</span><span class="gi">+     KEYCLOAK_PASSWORD: &quot;admin-password&quot;  # Exastro システムの管理者のパスワード</span>
<span class="linenos"> 99</span><span class="w"> </span>     KEYCLOAK_DB_USER: &quot;&quot;
<span class="linenos">100</span><span class="w"> </span>     KEYCLOAK_DB_PASSWORD: &quot;&quot;
</pre></div>
</div>
</div>
</section>
<section id="persistent-volume">
<span id="id10"></span><h3><span class="section-number">1.3.8. </span>永続ボリュームの設定<a class="headerlink" href="#persistent-volume" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">データベースのデータ永続化 (クラスタ内コンテナがある場合)、および、ファイルの永続化のために、永続ボリュームを設定する必要があります。</div>
<div class="line">永続ボリュームの詳細については、 <a class="reference external" href="https://kubernetes.io/ja/docs/concepts/storage/persistent-volumes/#%E6%B0%B8%E7%B6%9A%E3%83%9C%E3%83%AA%E3%83%A5%E3%83%BC%E3%83%A0">永続ボリューム - Kubernetes</a> を参照してください。</div>
</div>
<div class="line-block">
<div class="line">ストレージ利用時の2つの方法について説明します。</div>
</div>
<ul class="simple">
<li><p>マネージドディスク</p></li>
<li><p>Kubernetes ノードのディレクトリ</p></li>
</ul>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-3-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-3-3-0" name="3-0" role="tab" tabindex="0">マネージドディスク</button><button aria-controls="panel-3-3-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-3-3-1" name="3-1" role="tab" tabindex="-1">Kubernetes ノードのディレクトリ</button></div><div aria-labelledby="tab-3-3-0" class="sphinx-tabs-panel" id="panel-3-3-0" name="3-0" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>特徴</p></li>
</ul>
<div class="line-block">
<div class="line">パブリッククラウドで提供されるストレージサービスを利用することでストレージの構築や維持管理が不要となります。</div>
</div>
<ul class="simple">
<li><p>設定例</p></li>
</ul>
<div class="line-block">
<div class="line">Azure のストレージを利用する場合、下記のように StorageClass を定義することで利用が可能です。</div>
<div class="line">詳細は、 <a class="reference external" href="https://learn.microsoft.com/ja-jp/azure/aks/concepts-storage#storage-classes">Azure Kubernetes Service (AKS) でのアプリケーションのストレージ オプション</a> を参照してください。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id49">
<div class="code-block-caption"><span class="caption-number">リスト 1.18 </span><span class="caption-text">storage-class-exastro-suite.yaml</span><a class="headerlink" href="#id49" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="w">apiVersion: storage.k8s.io/v1</span>
<span class="linenos"> 2</span><span class="w">kind: StorageClass</span>
<span class="linenos"> 3</span><span class="w">metadata:</span>
<span class="linenos"> 4</span><span class="w"> </span> name: exastro-suite-azurefile-csi-nfs
<span class="linenos"> 5</span><span class="w">provisioner: file.csi.azure.com</span>
<span class="linenos"> 6</span><span class="w">allowVolumeExpansion: true</span>
<span class="linenos"> 7</span><span class="w">parameters:</span>
<span class="linenos"> 8</span><span class="w"> </span> protocol: nfs
<span class="linenos"> 9</span><span class="w">mountOptions:</span>
<span class="linenos">10</span><span class="w"> </span> - nconnect=8
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id50">
<div class="code-block-caption"><span class="caption-number">リスト 1.19 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id50" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 5</span><span class="w"> </span> itaGlobalDefinition:
<span class="linenos"> 6</span><span class="w"> </span>   persistence:
<span class="linenos"> 7</span><span class="w"> </span>     enabled: true
<span class="linenos"> 8</span><span class="w"> </span>     accessMode: ReadWriteMany
<span class="linenos"> 9</span><span class="w"> </span>     size: 10Gi
<span class="linenos">10</span><span class="w"> </span>     volumeType: hostPath # e.g.) hostPath or AKS
<span class="linenos">11</span><span class="gd">-      storageClass: &quot;-&quot; # e.g.) azurefile or - (None)</span>
<span class="linenos">12</span><span class="gi">+      storageClass: &quot;azurefile&quot; # e.g.) azurefile or - (None)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">※ 下記は、<a class="reference internal" href="#database-setup"><span class="std std-ref">データベース連携</span></a> で設定済みです。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id51">
<div class="code-block-caption"><span class="caption-number">リスト 1.20 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id51" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos">39</span><span class="w"> </span> databaseDefinition:
<span class="linenos">40</span><span class="w"> </span>   persistence:
<span class="linenos">41</span><span class="w"> </span>     enabled: true
<span class="linenos">42</span><span class="w"> </span>     reinstall: false
<span class="linenos">43</span><span class="w"> </span>     accessMode: ReadWriteOnce
<span class="linenos">44</span><span class="w"> </span>     size: 20Gi
<span class="linenos">45</span><span class="w"> </span>     volumeType: hostPath # e.g.) hostPath or AKS
<span class="linenos">46</span><span class="gd">-      storageClass: &quot;-&quot; # e.g.) azurefile or - (None)</span>
<span class="linenos">47</span><span class="gi">+      storageClass: &quot;exastro-suite-azurefile-csi-nfs&quot; # e.g.) azurefile or - (None)</span>
</pre></div>
</div>
</div>
</div><div aria-labelledby="tab-3-3-1" class="sphinx-tabs-panel" hidden="true" id="panel-3-3-1" name="3-1" role="tabpanel" tabindex="0"><ul class="simple">
<li><p>特徴</p></li>
</ul>
<div class="line-block">
<div class="line">Kubernetes のノード上のストレージ領域を利用するため、別途ストレージを調達する必要はありませんが、この方法は非推奨のため検証や開発時のみの利用</div>
</div>
<div class="admonition danger">
<p class="admonition-title">危険</p>
<div class="line-block">
<div class="line">データの永続化自体は可能ですが、コンピュートノードの増減や変更によりデータが消えてしまう可能性があるため本番環境では使用しないでください。</div>
<div class="line">また、Azure で構築した AKS クラスタは、クラスタを停止すると AKS クラスターの Node が解放されるため、保存していた情報は消えてしまいます。そのため、Node が停止しないように注意が必要となります。</div>
</div>
</div>
<ul class="simple">
<li><p>利用例</p></li>
</ul>
<div class="line-block">
<div class="line">hostPath を使用した例を記載します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id52">
<div class="code-block-caption"><span class="caption-number">リスト 1.21 </span><span class="caption-text">pv-database.yaml (データベース用ボリューム)</span><a class="headerlink" href="#id52" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="w"># pv-database.yaml</span>
<span class="linenos"> 2</span><span class="w">apiVersion: v1</span>
<span class="linenos"> 3</span><span class="w">kind: PersistentVolume</span>
<span class="linenos"> 4</span><span class="w">metadata:</span>
<span class="linenos"> 5</span><span class="w"> </span> name: pv-database
<span class="linenos"> 6</span><span class="w">spec:</span>
<span class="linenos"> 7</span><span class="w"> </span> capacity:
<span class="linenos"> 8</span><span class="w"> </span>   storage: 20Gi
<span class="linenos"> 9</span><span class="w"> </span> accessModes:
<span class="linenos">10</span><span class="w"> </span>   - ReadWriteOnce
<span class="linenos">11</span><span class="w"> </span> persistentVolumeReclaimPolicy: Retain
<span class="linenos">12</span><span class="w"> </span> hostPath:
<span class="linenos">13</span><span class="w"> </span>   path: /var/data/exastro-suite/exastro-platform/database
<span class="linenos">14</span><span class="w"> </span>   type: DirectoryOrCreate
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id53">
<div class="code-block-caption"><span class="caption-number">リスト 1.22 </span><span class="caption-text">pv-ita-common.yaml (ファイル用ボリューム)</span><a class="headerlink" href="#id53" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="w"># pv-ita-common.yaml</span>
<span class="linenos"> 2</span><span class="w">apiVersion: v1</span>
<span class="linenos"> 3</span><span class="w">kind: PersistentVolume</span>
<span class="linenos"> 4</span><span class="w">metadata:</span>
<span class="linenos"> 5</span><span class="w"> </span> name: pv-ita-common
<span class="linenos"> 6</span><span class="w">spec:</span>
<span class="linenos"> 7</span><span class="w"> </span> capacity:
<span class="linenos"> 8</span><span class="w"> </span>   storage: 10Gi
<span class="linenos"> 9</span><span class="w"> </span> accessModes:
<span class="linenos">10</span><span class="w"> </span>   - ReadWriteMany
<span class="linenos">11</span><span class="w"> </span> persistentVolumeReclaimPolicy: Retain
<span class="linenos">12</span><span class="w"> </span> hostPath:
<span class="linenos">13</span><span class="w"> </span>   path: /var/data/exastro-suite/exastro-it-automation/ita-common
<span class="linenos">14</span><span class="w"> </span>   type: DirectoryOrCreate
</pre></div>
</div>
</div>
</div></div>
</section>
</section>
<section id="id11">
<span id="id12"></span><h2><span class="section-number">1.4. </span>インストール<a class="headerlink" href="#id11" title="この見出しへのパーマリンク">¶</a></h2>
<section id="id13">
<h3><span class="section-number">1.4.1. </span>永続ボリュームの作成<a class="headerlink" href="#id13" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line"><a class="reference internal" href="#persistent-volume"><span class="std std-ref">永続ボリュームの設定</span></a> で作成したマニフェストファイルを適用し、ボリュームを作成します。</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># pv-database.yaml</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>pv-database.yaml

<span class="c1"># pv-ita-common.yaml</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>pv-ita-common.yaml
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 確認</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pv
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>NAME<span class="w">            </span>CAPACITY<span class="w">   </span>ACCESS<span class="w"> </span>MODES<span class="w">   </span>RECLAIM<span class="w"> </span>POLICY<span class="w">   </span>STATUS<span class="w">      </span>CLAIM<span class="w">   </span>STORAGECLASS<span class="w">   </span>REASON<span class="w">   </span>AGE
pv-database<span class="w">     </span>20Gi<span class="w">       </span>RWO<span class="w">            </span>Retain<span class="w">           </span>Available<span class="w">                                   </span>19s
pv-ita-common<span class="w">   </span>10Gi<span class="w">       </span>RWX<span class="w">            </span>Retain<span class="w">           </span>Available<span class="w">                                   </span>9s
</pre></div>
</div>
</section>
<section id="id14">
<h3><span class="section-number">1.4.2. </span>インストール<a class="headerlink" href="#id14" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">Helm バージョンとアプリケーションのバージョンについては下記を確認してください。</div>
</div>
<table class="docutils align-left" id="id54">
<caption><span class="caption-number">表 1.17 </span><span class="caption-text">Helm チャートとアプリケーションのバージョン</span><a class="headerlink" href="#id54" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 17%" />
<col style="width: 17%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Chart Version</p></th>
<th class="head"><p>Exastro Version</p></th>
<th class="head"><p>Exastro IT Automation</p></th>
<th class="head"><p>Exastro Platform</p></th>
<th class="head"><p>リリースシナリオ</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1.0.2</p></td>
<td><p>2.1.0</p></td>
<td><p>2.0.3</p></td>
<td><p>1.4.0</p></td>
<td><p>Exastro IT Automation Version 2.0 GA リリース</p></td>
</tr>
<tr class="row-odd"><td><p>...</p></td>
<td><p>...</p></td>
<td><p>...</p></td>
<td><p>...</p></td>
<td><p>...</p></td>
</tr>
<tr class="row-even"><td><p>1.1.x</p></td>
<td><p>2.2.x</p></td>
<td><p>2.1.x</p></td>
<td><p>1.x.0</p></td>
<td><p>Exastro IT Automation Version 2.1 GA リリース(予定)</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">インストール時にサービスの公開方法によって、アクセス方法が異なります。</div>
<div class="line">Ingress, LoadBalancer, NodePort それぞれの方法について説明します。</div>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-SW5ncmVzcw==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-SW5ncmVzcw==" name="SW5ncmVzcw==" role="tab" tabindex="0">Ingress</button><button aria-controls="panel-4-TG9hZEJhbGFuY2Vy" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-TG9hZEJhbGFuY2Vy" name="TG9hZEJhbGFuY2Vy" role="tab" tabindex="-1">LoadBalancer</button><button aria-controls="panel-4-Tm9kZVBvcnQ=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-Tm9kZVBvcnQ=" name="Tm9kZVBvcnQ=" role="tab" tabindex="-1">NodePort</button></div><div aria-labelledby="tab-4-SW5ncmVzcw==" class="sphinx-tabs-panel group-tab" id="panel-4-SW5ncmVzcw==" name="SW5ncmVzcw==" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Helm コマンドを使い Kubernetes 環境にインストールを行います。</p>
<div class="literal-block-wrapper docutils container" id="id55">
<div class="code-block-caption"><span class="caption-number">リスト 1.23 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id55" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>helm<span class="w"> </span>install<span class="w"> </span>exastro<span class="w"> </span>exastro/exastro<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>--create-namespace<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--values<span class="w"> </span>exastro.yaml
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id56">
<div class="code-block-caption"><span class="caption-number">リスト 1.24 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id56" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>NAME:<span class="w"> </span>exastro
LAST<span class="w"> </span>DEPLOYED:<span class="w"> </span>Sat<span class="w"> </span>Jan<span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">15</span>:00:02<span class="w"> </span><span class="m">2023</span>
NAMESPACE:<span class="w"> </span>exastro
STATUS:<span class="w"> </span>deployed
REVISION:<span class="w"> </span><span class="m">1</span>
TEST<span class="w"> </span>SUITE:<span class="w"> </span>None
NOTES:
Exastro<span class="w"> </span>install<span class="w"> </span>completion!

<span class="m">1</span>.<span class="w"> </span>Execute<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span><span class="nb">command</span><span class="w"> </span>and<span class="w"> </span><span class="nb">wait</span><span class="w"> </span><span class="k">until</span><span class="w"> </span>the<span class="w"> </span>pod<span class="w"> </span>becomes<span class="w"> </span><span class="s2">&quot;Running&quot;</span><span class="w"> </span>or<span class="w"> </span><span class="s2">&quot;Completed&quot;</span>:

<span class="w">  </span><span class="c1"># NOTE: You can also append &quot;-w&quot; to the command or wait until the state changes with &quot;watch command&quot;</span>

<span class="w">  </span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--namespace<span class="w"> </span>exastro

<span class="m">2</span>.<span class="w"> </span>Get<span class="w"> </span>the<span class="w"> </span>ENCRYPT_KEY<span class="w"> </span>by<span class="w"> </span>running<span class="w"> </span>these<span class="w"> </span>commands:

<span class="w">  </span><span class="c1"># Exastro IT Automation ENCRYPT_KEY</span>
<span class="w">  </span>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>ita-secret-ita-global<span class="w"> </span>-n<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d

<span class="w">  </span><span class="c1"># Exastro Platform ENCRYPT_KEY</span>
<span class="w">  </span>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>platform-secret-pf-global<span class="w"> </span>-n<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d

<span class="w">  </span>!!!<span class="w"> </span>Please<span class="w"> </span>save<span class="w"> </span>the<span class="w"> </span>output<span class="w"> </span>ENCRYPT_KEY<span class="w"> </span>carefully.<span class="w"> </span>!!!

<span class="m">3</span>.<span class="w"> </span>Run<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span><span class="nb">command</span><span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>the<span class="w"> </span>application<span class="w"> </span>URL<span class="w"> </span>and<span class="w"> </span>go<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>URL<span class="w"> </span>or<span class="w"> </span>go<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>displayed<span class="w"> </span>URL:
<span class="w">  </span>*************************
<span class="w">  </span>*<span class="w"> </span>Service<span class="w"> </span>Console<span class="w">       </span>*
<span class="w">  </span>*************************
<span class="w">  </span>http://exastro-suite.example.local/

<span class="w">  </span>*************************
<span class="w">  </span>*<span class="w"> </span>Administrator<span class="w"> </span>Console<span class="w"> </span>*
<span class="w">  </span>*************************
<span class="w">  </span>http://exastro-suite-mng.example.local/auth/


<span class="c1"># Note: You can display this note again by executing the following command.</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">以下、上記の出力結果に従って操作をします。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">インストール状況確認</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">コマンドラインから以下のコマンドを入力して、インストールが完了していることを確認します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id57">
<div class="code-block-caption"><span class="caption-number">リスト 1.25 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id57" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pod の一覧を取得</span>
kubectl<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>-n<span class="w"> </span>exastro

<span class="p">|</span><span class="w"> </span>正常動作している場合は、すべて<span class="w"> </span>“Running”<span class="w"> </span>もしくは<span class="w"> </span>“Completed”<span class="w"> </span>となります。
<span class="p">|</span><span class="w"> </span>※正常に起動するまで数分かかる場合があります。
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id58">
<div class="code-block-caption"><span class="caption-number">リスト 1.26 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id58" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>NAME<span class="w">                                                      </span>READY<span class="w">   </span>STATUS<span class="w">      </span>RESTARTS<span class="w">   </span>AGE
ita-by-menu-create-7fccfc7f57-7cc2f<span class="w">                       </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-by-conductor-synchronize-9dc6cfbdf-vp64z<span class="w">              </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-api-admin-85b7d8f977-cxr58<span class="w">                            </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-api-organization-5c5f4b86cb-rmf4g<span class="w">                     </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-by-ansible-execute-6cd6d4d5fd-wkxjd<span class="w">                   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-by-ansible-legacy-role-vars-listup-67dbf5586f-dhdb2<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-by-ansible-towermaster-sync-5674448c55-t9592<span class="w">          </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-web-server-7dbf6fd6ff-2s7s4<span class="w">                           </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
platform-auth-5b57bc57bd-h4k2g<span class="w">                            </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
platform-web-9f9d486fd-zf5vb<span class="w">                              </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
mariadb-67dd78cc76-nthtf<span class="w">                                  </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
platform-api-8655864fbf-t5xxf<span class="w">                             </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-setup-wv2t6<span class="w">                                           </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">   </span><span class="m">0</span><span class="w">          </span>11m
keycloak-7f7cdccb6b-rf4rj<span class="w">                                 </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
platform-setup-8vv2x<span class="w">                                      </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">   </span><span class="m">0</span><span class="w">          </span>11m
</pre></div>
</div>
</div>
<ol class="arabic" start="3">
<li><p>暗号化キーのバックアップ</p>
<div class="line-block">
<div class="line">Exastro システムのパスワードや認証情報といった機密情報はすべて暗号化されています。</div>
<div class="line">必ず、下記で取得した暗号化キーをバックアップして、適切に保管してください。</div>
</div>
<div class="admonition danger">
<p class="admonition-title">危険</p>
<div class="line-block">
<div class="line">暗号化キーを紛失した場合、バックアップデータからシステムを復旧した際にデータの復号ができなくなります。</div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id59">
<div class="code-block-caption"><span class="caption-number">リスト 1.27 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id59" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exastro IT Automation ENCRYPT_KEY</span>
kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>ita-secret-ita-global<span class="w"> </span>-n<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id60">
<div class="code-block-caption"><span class="caption-number">リスト 1.28 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id60" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">JnIoXzJtPic2MXFqRl1yI1chMj8hWzQrNypmVn41Pk8</span><span class="o">=</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id61">
<div class="code-block-caption"><span class="caption-number">リスト 1.29 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id61" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exastro Platform ENCRYPT_KEY</span>
kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>platform-secret-pf-global<span class="w"> </span>-n<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id62">
<div class="code-block-caption"><span class="caption-number">リスト 1.30 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id62" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">bHFZe2VEVVM2PmFeQDMqNG4oZT4lTlglLjJJekxBTHE</span><span class="o">=</span>
</pre></div>
</div>
</div>
</li>
<li><p>接続確認</p>
<div class="line-block">
<div class="line">出力結果に従って、<span class="menuselection">Administrator Console</span> の URL にアクセスします。</div>
<div class="line">下記は、実行例のため <a class="reference internal" href="#service-setting"><span class="std std-ref">サービス公開の設定</span></a> で設定したホスト名に読み替えてください。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id63">
<div class="code-block-caption"><span class="caption-number">リスト 1.31 </span><span class="caption-text">出力結果(例)</span><a class="headerlink" href="#id63" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>*************************
*<span class="w"> </span>Service<span class="w"> </span>Console<span class="w">       </span>*
*************************
http://exastro-suite.example.local/

*************************
*<span class="w"> </span>Administrator<span class="w"> </span>Console<span class="w"> </span>*
*************************
http://exastro-suite-mng.example.local/auth/
</pre></div>
</div>
</div>
<table class="docutils align-left" id="id64">
<caption><span class="caption-number">表 1.18 </span><span class="caption-text">接続確認用URL</span><a class="headerlink" href="#id64" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>管理コンソール</p></td>
<td><p><a class="reference external" href="http://exastro-suite-mng.example.local/auth/">http://exastro-suite-mng.example.local/auth/</a></p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div><div aria-labelledby="tab-4-TG9hZEJhbGFuY2Vy" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-TG9hZEJhbGFuY2Vy" name="TG9hZEJhbGFuY2Vy" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Helm コマンドを使い Kubernetes 環境にインストールを行います。</p>
<div class="literal-block-wrapper docutils container" id="id65">
<div class="code-block-caption"><span class="caption-number">リスト 1.32 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id65" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>helm<span class="w"> </span>install<span class="w"> </span>exastro<span class="w"> </span>exastro/exastro<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>--create-namespace<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--values<span class="w"> </span>exastro.yaml
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id66">
<div class="code-block-caption"><span class="caption-number">リスト 1.33 </span><span class="caption-text">出力結果(例)</span><a class="headerlink" href="#id66" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>NAME:<span class="w"> </span>exastro
LAST<span class="w"> </span>DEPLOYED:<span class="w"> </span>Sat<span class="w"> </span>Jan<span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">15</span>:00:02<span class="w"> </span><span class="m">2023</span>
NAMESPACE:<span class="w"> </span>exastro
STATUS:<span class="w"> </span>deployed
REVISION:<span class="w"> </span><span class="m">1</span>
TEST<span class="w"> </span>SUITE:<span class="w"> </span>None
NOTES:
Exastro<span class="w"> </span>install<span class="w"> </span>completion!

<span class="m">1</span>.<span class="w"> </span>Execute<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span><span class="nb">command</span><span class="w"> </span>and<span class="w"> </span><span class="nb">wait</span><span class="w"> </span><span class="k">until</span><span class="w"> </span>the<span class="w"> </span>pod<span class="w"> </span>becomes<span class="w"> </span><span class="s2">&quot;Running&quot;</span><span class="w"> </span>or<span class="w"> </span><span class="s2">&quot;Completed&quot;</span>:

<span class="w">  </span><span class="c1"># NOTE: You can also append &quot;-w&quot; to the command or wait until the state changes with &quot;watch command&quot;</span>

<span class="w">  </span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--namespace<span class="w"> </span>exastro

<span class="m">2</span>.<span class="w"> </span>Get<span class="w"> </span>the<span class="w"> </span>ENCRYPT_KEY<span class="w"> </span>by<span class="w"> </span>running<span class="w"> </span>these<span class="w"> </span>commands:

<span class="w">  </span><span class="c1"># Exastro IT Automation ENCRYPT_KEY</span>
<span class="w">  </span>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>ita-secret-ita-global<span class="w"> </span>-n<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d

<span class="w">  </span><span class="c1"># Exastro Platform ENCRYPT_KEY</span>
<span class="w">  </span>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>platform-secret-pf-global<span class="w"> </span>-n<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d

<span class="w">  </span>!!!<span class="w"> </span>Please<span class="w"> </span>save<span class="w"> </span>the<span class="w"> </span>output<span class="w"> </span>ENCRYPT_KEY<span class="w"> </span>carefully.<span class="w"> </span>!!!

<span class="m">3</span>.<span class="w"> </span>Run<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span><span class="nb">command</span><span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>the<span class="w"> </span>application<span class="w"> </span>URL<span class="w"> </span>and<span class="w"> </span>go<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>URL<span class="w"> </span>or<span class="w"> </span>go<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>displayed<span class="w"> </span>URL:
<span class="w">  </span><span class="c1"># NOTE: It may take a few minutes for the LoadBalancer IP to be available.</span>
<span class="w">  </span><span class="c1">#       You can watch the status of by running &#39;kubectl get --namespace exastro svc -w platform-auth&#39;</span>

<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">NODE_SVC_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>platform-auth<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.spec.ports[0].nodePort}&quot;</span><span class="k">)</span>
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">NODE_MGT_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>platform-auth<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.spec.ports[1].nodePort}&quot;</span><span class="k">)</span>
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">NODE_IP</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>platform-auth<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.status.loadBalancer.ingress[0].ip}&quot;</span><span class="k">)</span>
<span class="w">  </span><span class="c1"># *************************</span>
<span class="w">  </span><span class="c1"># * Administrator Console *</span>
<span class="w">  </span><span class="c1"># *************************</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span>http://<span class="nv">$NODE_IP</span>:<span class="nv">$NODE_MGT_PORT</span>/auth/

<span class="w">  </span><span class="c1"># *************************</span>
<span class="w">  </span><span class="c1"># * Service Console       *</span>
<span class="w">  </span><span class="c1"># *************************</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span>http://<span class="nv">$NODE_IP</span>:<span class="nv">$NODE_SVC_PORT</span>

<span class="c1"># Note: You can display this note again by executing the following command.</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">以下、上記の出力結果に従って操作をします。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">インストール状況確認</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">コマンドラインから以下のコマンドを入力して、インストールが完了していることを確認します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id67">
<div class="code-block-caption"><span class="caption-number">リスト 1.34 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id67" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pod の一覧を取得</span>
kubectl<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>-n<span class="w"> </span>exastro

<span class="p">|</span><span class="w"> </span>正常動作している場合は、すべて<span class="w"> </span>“Running”<span class="w"> </span>もしくは<span class="w"> </span>“Completed”<span class="w"> </span>となります。
<span class="p">|</span><span class="w"> </span>※正常に起動するまで数分かかる場合があります。
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id68">
<div class="code-block-caption"><span class="caption-number">リスト 1.35 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id68" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>NAME<span class="w">                                                      </span>READY<span class="w">   </span>STATUS<span class="w">      </span>RESTARTS<span class="w">   </span>AGE
ita-by-menu-create-7fccfc7f57-7cc2f<span class="w">                       </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-by-conductor-synchronize-9dc6cfbdf-vp64z<span class="w">              </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-api-admin-85b7d8f977-cxr58<span class="w">                            </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-api-organization-5c5f4b86cb-rmf4g<span class="w">                     </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-by-ansible-execute-6cd6d4d5fd-wkxjd<span class="w">                   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-by-ansible-legacy-role-vars-listup-67dbf5586f-dhdb2<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-by-ansible-towermaster-sync-5674448c55-t9592<span class="w">          </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-web-server-7dbf6fd6ff-2s7s4<span class="w">                           </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
platform-auth-5b57bc57bd-h4k2g<span class="w">                            </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
platform-web-9f9d486fd-zf5vb<span class="w">                              </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
mariadb-67dd78cc76-nthtf<span class="w">                                  </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
platform-api-8655864fbf-t5xxf<span class="w">                             </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-setup-wv2t6<span class="w">                                           </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">   </span><span class="m">0</span><span class="w">          </span>11m
keycloak-7f7cdccb6b-rf4rj<span class="w">                                 </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
platform-setup-8vv2x<span class="w">                                      </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">   </span><span class="m">0</span><span class="w">          </span>11m
</pre></div>
</div>
</div>
<ol class="arabic" start="3">
<li><p>暗号化キーのバックアップ</p>
<div class="line-block">
<div class="line">Exastro システムのパスワードや認証情報といった機密情報はすべて暗号化されています。</div>
<div class="line">必ず、下記で取得した暗号化キーをバックアップして、適切に保管してください。</div>
</div>
<div class="admonition danger">
<p class="admonition-title">危険</p>
<div class="line-block">
<div class="line">暗号化キーを紛失した場合、バックアップデータからシステムを復旧した際にデータの復号ができなくなります。</div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id69">
<div class="code-block-caption"><span class="caption-number">リスト 1.36 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id69" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exastro IT Automation ENCRYPT_KEY</span>
kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>ita-secret-ita-global<span class="w"> </span>-n<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id70">
<div class="code-block-caption"><span class="caption-number">リスト 1.37 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id70" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">JnIoXzJtPic2MXFqRl1yI1chMj8hWzQrNypmVn41Pk8</span><span class="o">=</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id71">
<div class="code-block-caption"><span class="caption-number">リスト 1.38 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id71" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exastro Platform ENCRYPT_KEY</span>
kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>platform-secret-pf-global<span class="w"> </span>-n<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id72">
<div class="code-block-caption"><span class="caption-number">リスト 1.39 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id72" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">bHFZe2VEVVM2PmFeQDMqNG4oZT4lTlglLjJJekxBTHE</span><span class="o">=</span>
</pre></div>
</div>
</div>
</li>
<li><p>接続確認</p>
<div class="line-block">
<div class="line">1. で実行した <strong class="command">helm install</strong> の出力結果のコマンドをコンソール上に貼り付けて実行します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id73">
<div class="code-block-caption"><span class="caption-number">リスト 1.40 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id73" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># helm install コマンドの実行結果を貼り付けて実行</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE_SVC_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>platform-auth<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.spec.ports[0].nodePort}&quot;</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE_MGT_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>platform-auth<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.spec.ports[1].nodePort}&quot;</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE_IP</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>platform-auth<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.status.loadBalancer.ingress[0].ip}&quot;</span><span class="k">)</span>
<span class="c1"># *************************</span>
<span class="c1"># * Administrator Console *</span>
<span class="c1"># *************************</span>
<span class="nb">echo</span><span class="w"> </span>http://<span class="nv">$NODE_IP</span>:<span class="nv">$NODE_MGT_PORT</span>/auth/

<span class="c1"># *************************</span>
<span class="c1"># * Service Console       *</span>
<span class="c1"># *************************</span>
<span class="nb">echo</span><span class="w"> </span>http://<span class="nv">$NODE_IP</span>:<span class="nv">$NODE_SVC_PORT</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">出力結果に従って、<span class="menuselection">Administrator Console</span> の URL にアクセスします。</div>
<div class="line">下記は、実行例のため実際のコマンド実行結果に読み替えてください。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id74">
<div class="code-block-caption"><span class="caption-number">リスト 1.41 </span><span class="caption-text">出力結果(例)</span><a class="headerlink" href="#id74" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>*************************
*<span class="w"> </span>Administrator<span class="w"> </span>Console<span class="w"> </span>*
*************************
http://172.16.20.XXX:32031/auth/

*************************
*<span class="w"> </span>Service<span class="w"> </span>Console<span class="w">       </span>*
*************************
http://172.16.20.XXX:31798
</pre></div>
</div>
</div>
<table class="docutils align-left" id="id75">
<caption><span class="caption-number">表 1.19 </span><span class="caption-text">接続確認用URL</span><a class="headerlink" href="#id75" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>管理コンソール</p></td>
<td><p><a class="reference external" href="http://172.16.20.xxx:32031/auth/">http://172.16.20.xxx:32031/auth/</a></p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div><div aria-labelledby="tab-4-Tm9kZVBvcnQ=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-Tm9kZVBvcnQ=" name="Tm9kZVBvcnQ=" role="tabpanel" tabindex="0"><ol class="arabic">
<li><p>Helm コマンドを使い Kubernetes 環境にインストールを行います。</p>
<div class="literal-block-wrapper docutils container" id="id76">
<div class="code-block-caption"><span class="caption-number">リスト 1.42 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id76" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>helm<span class="w"> </span>install<span class="w"> </span>exastro<span class="w"> </span>exastro/exastro<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>--create-namespace<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--values<span class="w"> </span>exastro.yaml
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id77">
<div class="code-block-caption"><span class="caption-number">リスト 1.43 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id77" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>NAME:<span class="w"> </span>exastro
LAST<span class="w"> </span>DEPLOYED:<span class="w"> </span>Sun<span class="w"> </span>Jan<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">12</span>:18:02<span class="w"> </span><span class="m">2023</span>
NAMESPACE:<span class="w"> </span>exastro
STATUS:<span class="w"> </span>deployed
REVISION:<span class="w"> </span><span class="m">1</span>
TEST<span class="w"> </span>SUITE:<span class="w"> </span>None
NOTES:
Exastro<span class="w"> </span>install<span class="w"> </span>completion!

<span class="m">1</span>.<span class="w"> </span>Execute<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span><span class="nb">command</span><span class="w"> </span>and<span class="w"> </span><span class="nb">wait</span><span class="w"> </span><span class="k">until</span><span class="w"> </span>the<span class="w"> </span>pod<span class="w"> </span>becomes<span class="w"> </span><span class="s2">&quot;Running&quot;</span><span class="w"> </span>or<span class="w"> </span><span class="s2">&quot;Completed&quot;</span>:

<span class="w">  </span><span class="c1"># NOTE: You can also append &quot;-w&quot; to the command or wait until the state changes with &quot;watch command&quot;</span>

<span class="w">  </span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--namespace<span class="w"> </span>exastro

<span class="m">2</span>.<span class="w"> </span>Get<span class="w"> </span>the<span class="w"> </span>ENCRYPT_KEY<span class="w"> </span>by<span class="w"> </span>running<span class="w"> </span>these<span class="w"> </span>commands:

<span class="w">  </span><span class="c1"># Exastro IT Automation ENCRYPT_KEY</span>
<span class="w">  </span>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>ita-secret-ita-global<span class="w"> </span>-n<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d

<span class="w">  </span><span class="c1"># Exastro Platform ENCRYPT_KEY</span>
<span class="w">  </span>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>platform-secret-pf-global<span class="w"> </span>-n<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d

<span class="w">  </span>!!!<span class="w"> </span>Please<span class="w"> </span>save<span class="w"> </span>the<span class="w"> </span>output<span class="w"> </span>ENCRYPT_KEY<span class="w"> </span>carefully.<span class="w"> </span>!!!

<span class="m">3</span>.<span class="w"> </span>Run<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span><span class="nb">command</span><span class="w"> </span>to<span class="w"> </span>get<span class="w"> </span>the<span class="w"> </span>application<span class="w"> </span>URL<span class="w"> </span>and<span class="w"> </span>go<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>URL<span class="w"> </span>or<span class="w"> </span>go<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>displayed<span class="w"> </span>URL:


<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">NODE_SVC_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>platform-auth<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.spec.ports[0].nodePort}&quot;</span><span class="k">)</span>
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">NODE_MGT_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>platform-auth<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.spec.ports[1].nodePort}&quot;</span><span class="k">)</span>
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">NODE_IP</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.items[0].status.addresses[0].address}&quot;</span><span class="k">)</span>
<span class="w">  </span><span class="c1"># *************************</span>
<span class="w">  </span><span class="c1"># * Administrator Console *</span>
<span class="w">  </span><span class="c1"># *************************</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span>http://<span class="nv">$NODE_IP</span>:<span class="nv">$NODE_MGT_PORT</span>/auth/

<span class="w">  </span><span class="c1"># *************************</span>
<span class="w">  </span><span class="c1"># * Service Console       *</span>
<span class="w">  </span><span class="c1"># *************************</span>
<span class="w">  </span><span class="nb">echo</span><span class="w"> </span>http://<span class="nv">$NODE_IP</span>:<span class="nv">$NODE_SVC_PORT</span>

<span class="c1"># Note: You can display this note again by executing the following command.</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">以下、上記の出力結果に従って操作をします。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">インストール状況確認</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">コマンドラインから以下のコマンドを入力して、インストールが完了していることを確認します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id78">
<div class="code-block-caption"><span class="caption-number">リスト 1.44 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id78" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pod の一覧を取得</span>
kubectl<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>-n<span class="w"> </span>exastro

<span class="p">|</span><span class="w"> </span>正常動作している場合は、すべて<span class="w"> </span>“Running”<span class="w"> </span>もしくは<span class="w"> </span>“Completed”<span class="w"> </span>となります。
<span class="p">|</span><span class="w"> </span>※正常に起動するまで数分かかる場合があります。
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id79">
<div class="code-block-caption"><span class="caption-number">リスト 1.45 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id79" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>NAME<span class="w">                                                      </span>READY<span class="w">   </span>STATUS<span class="w">      </span>RESTARTS<span class="w">   </span>AGE
ita-by-menu-create-7fccfc7f57-7cc2f<span class="w">                       </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-by-conductor-synchronize-9dc6cfbdf-vp64z<span class="w">              </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-api-admin-85b7d8f977-cxr58<span class="w">                            </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-api-organization-5c5f4b86cb-rmf4g<span class="w">                     </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-by-ansible-execute-6cd6d4d5fd-wkxjd<span class="w">                   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-by-ansible-legacy-role-vars-listup-67dbf5586f-dhdb2<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-by-ansible-towermaster-sync-5674448c55-t9592<span class="w">          </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-web-server-7dbf6fd6ff-2s7s4<span class="w">                           </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
platform-auth-5b57bc57bd-h4k2g<span class="w">                            </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
platform-web-9f9d486fd-zf5vb<span class="w">                              </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
mariadb-67dd78cc76-nthtf<span class="w">                                  </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
platform-api-8655864fbf-t5xxf<span class="w">                             </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
ita-setup-wv2t6<span class="w">                                           </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">   </span><span class="m">0</span><span class="w">          </span>11m
keycloak-7f7cdccb6b-rf4rj<span class="w">                                 </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>11m
platform-setup-8vv2x<span class="w">                                      </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">   </span><span class="m">0</span><span class="w">          </span>11m
</pre></div>
</div>
</div>
<ol class="arabic" start="3">
<li><p>暗号化キーのバックアップ</p>
<div class="line-block">
<div class="line">Exastro システムのパスワードや認証情報といった機密情報はすべて暗号化されています。</div>
<div class="line">必ず、下記で取得した暗号化キーをバックアップして、適切に保管してください。</div>
</div>
<div class="admonition danger">
<p class="admonition-title">危険</p>
<div class="line-block">
<div class="line">暗号化キーを紛失した場合、バックアップデータからシステムを復旧した際にデータの復号ができなくなります。</div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id80">
<div class="code-block-caption"><span class="caption-number">リスト 1.46 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id80" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exastro IT Automation ENCRYPT_KEY</span>
kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>ita-secret-ita-global<span class="w"> </span>-n<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id81">
<div class="code-block-caption"><span class="caption-number">リスト 1.47 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id81" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">JnIoXzJtPic2MXFqRl1yI1chMj8hWzQrNypmVn41Pk8</span><span class="o">=</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id82">
<div class="code-block-caption"><span class="caption-number">リスト 1.48 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id82" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exastro Platform ENCRYPT_KEY</span>
kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>platform-secret-pf-global<span class="w"> </span>-n<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id83">
<div class="code-block-caption"><span class="caption-number">リスト 1.49 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id83" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">bHFZe2VEVVM2PmFeQDMqNG4oZT4lTlglLjJJekxBTHE</span><span class="o">=</span>
</pre></div>
</div>
</div>
</li>
<li><p>接続確認</p>
<div class="line-block">
<div class="line">1. で実行した <strong class="command">helm install</strong> の出力結果のコマンドをコンソール上に貼り付けて実行します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id84">
<div class="code-block-caption"><span class="caption-number">リスト 1.50 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id84" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">NODE_SVC_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>platform-auth<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.spec.ports[0].nodePort}&quot;</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE_MGT_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>platform-auth<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.spec.ports[1].nodePort}&quot;</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE_IP</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.items[0].status.addresses[0].address}&quot;</span><span class="k">)</span>
<span class="c1"># *************************</span>
<span class="c1"># * Administrator Console *</span>
<span class="c1"># *************************</span>
<span class="nb">echo</span><span class="w"> </span>http://<span class="nv">$NODE_IP</span>:<span class="nv">$NODE_MGT_PORT</span>/auth/

<span class="c1"># *************************</span>
<span class="c1"># * Service Console       *</span>
<span class="c1"># *************************</span>
<span class="nb">echo</span><span class="w"> </span>http://<span class="nv">$NODE_IP</span>:<span class="nv">$NODE_SVC_PORT</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">出力結果に従って、<span class="menuselection">Administrator Console</span> の URL にアクセスします。</div>
<div class="line">下記は、実行例のため実際のコマンド実行結果に読み替えてください。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id85">
<div class="code-block-caption"><span class="caption-number">リスト 1.51 </span><span class="caption-text">出力結果(例)</span><a class="headerlink" href="#id85" title="このコードへのパーマリンク">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>*************************
*<span class="w"> </span>Administrator<span class="w"> </span>Console<span class="w"> </span>*
*************************
http://172.16.20.xxx:30081/auth/

*************************
*<span class="w"> </span>Service<span class="w"> </span>Console<span class="w">       </span>*
*************************
http://172.16.20.xxx:30080
</pre></div>
</div>
</div>
<table class="docutils align-left" id="id86">
<caption><span class="caption-number">表 1.20 </span><span class="caption-text">接続確認用URL</span><a class="headerlink" href="#id86" title="このテーブルへのパーマリンク">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>管理コンソール</p></td>
<td><p><a class="reference external" href="http://172.16.20.xxx:30081/auth/">http://172.16.20.xxx:30081/auth/</a></p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div></div>
</section>
<section id="id15">
<h3><span class="section-number">1.4.3. </span>管理コンソールへのログイン<a class="headerlink" href="#id15" title="この見出しへのパーマリンク">¶</a></h3>
<div class="line-block">
<div class="line">以下の画面が表示された場合、<span class="menuselection">Administration Console</span> を選択して、ログイン画面を開きます。</div>
</div>
<figure class="align-default" id="id16">
<a class="reference internal image-reference" href="../../../_images/administrator-console.png"><img alt="administrator-console" src="../../../_images/administrator-console.png" style="width: 600px;" /></a>
</figure>
<div class="line-block">
<div class="line">ログイン ID とパスワードは <a class="reference internal" href="#create-system-manager"><span class="std std-ref">Exastro システム管理者の作成</span></a> で登録した、<kbd class="kbd docutils literal notranslate">KEYCLOAK_USER</kbd> 及び <kbd class="kbd docutils literal notranslate">KEYCLOAK_PASSWORD</kbd> です。</div>
</div>
<figure class="align-default" id="id17">
<a class="reference internal image-reference" href="../../../_images/exastro-login.png"><img alt="login" src="../../../_images/exastro-login.png" style="width: 300px;" /></a>
</figure>
<div class="line-block">
<div class="line">Keycloak の管理画面が開きます。</div>
</div>
<figure class="align-default" id="keycloak">
<a class="reference internal image-reference" href="../../../_images/keycloak-home.png"><img alt="login" src="../../../_images/keycloak-home.png" style="width: 600px;" /></a>
</figure>
<div class="line-block">
<div class="line">ログインが確認できたら、<a class="reference internal" href="../manuals/platform_management/organization.html"><span class="doc">Organization (オーガナイゼーション)</span></a> の作成を行います。</div>
</div>
</section>
</section>
</section>


</div>


<div id="articleNavigation">
  <ul>
    <li class="prev"><a href="index.html" title="前のトピックへ"><span>前のトピックへ</span>インストール</a></li>
    <li class="next"><a href="upgrade.html" title="次のトピックへ"><span>次のトピックへ</span><span class="section-number">2. </span>アップグレード</a></li>
  </ul>
</div>


<div id="pageTopLink">
  <a href="#container"><i>↑</i> Page Top</a>
</div>

</article>
</div>
</main>
</div><!-- End #contents -->
<div id="footer">
  <footer class="divInner">
    <small>Copyright © 2019-2023 NEC Corporation</small>
    <small><a href="/terms/ja.html">サイト規約</a></small>
  </footer>
</div><!-- End #footer -->

<div id="overlay"></div>
<div id="grayBack"></div>

</div><!-- End #container -->
  </body>
</html>