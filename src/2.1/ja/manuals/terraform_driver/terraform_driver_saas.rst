=====================
Terraform-saas-driver
=====================

はじめに
========

| 本書では、ITAの機能および操作方法について説明します。

Terraform-driver概要
====================

| 本章ではTerraformおよびTerraform-driverについて説明します。


Terraformについて
-----------------

| TerraformとはHashiCorp社が提供するインフラストラクチャを効率化するオーケストレーションツールです。
|  HCL(HashiCorp ConfigurationLanguage)という言語でコード化したインフラストラクチャ構成について、実行計画を生成したうえで構築を実行します。
| また、Policy as Codeによるアクセスポリシーをコード化して管理することが可能です。
| Terraformの詳細情報については、Terraformの製品マニュアルを参照してください。

Terrform-driverについて
-----------------------

| Terraform-deriverはITAシステムのオプションとして機能し、ITAシステムで登録したTerraformに対し、Organizationの作成、Workspaceの作成、作業の実行（Plan/ PolicyCheck / Apply）および作業ログの取得を行うことができます。
| 作業の実行（Plan /Apply）に利用するModuleファイルや、PolicyCheckを行うためのPolicyファイルをITAシステム上で部品化し、再利用できるよう管理することができます。

.. image:: /images/ja/diagram/overview.png
   :width: 6.68819in
   :height: 3.35972in
   :alt: Exastro概要

**図** **1.2-1 ITAシステム概要**

| また、Terraform-driverは、Module中の変数を画面から設定することができます。
| 詳細は本書「2 Terraform-driverでの変数取り扱い 」をご参照ください。

Terraform-driverでの変数取り扱い
================================

変数の種類
----------

| Terraform-driverでは、Module中の変数の具体値をITAの設定画面から設定することができます。

| ※設定方法の詳細は、本書 「 6.2.13 代入値管理 」を参照してください。
| Module中の変数で、ITAの変数として扱える変数は以下の1種類があります。

+----------+----------------------------------------------------------+
| 種類     | 内容                                                     |
+==========+==========================================================+
| 通常変数 | 変数名に対して具体値を定義できる変数です。               |
|          |                                                          |
|          | Module内の変数は HCL（HashiCorp Configuration            |
|          | Language）の変数ルールに従い                             |
|          | 以下の形式で記述してくださ                               |
|          | い。この場合「xxx」がModuleから変数として抜出されます。  |
|          |                                                          |
|          | また、typeとdefault値を設定することができます。          |
|          |                                                          |
|          | この場合、                                               |
|          | 「○○」がtypeとして、「△△」がdefaultとして抜出されます。  |
|          |                                                          |
|          | typeとdefaultの設定は必須ではありません。                |
|          |                                                          |
|          | +------------------+                                     |
|          | | variable “xxx” { |                                     |
|          | |                  |                                     |
|          | | type = ○○        |                                     |
|          | |                  |                                     |
|          | | default = △△     |                                     |
|          | |                  |                                     |
|          | | ～省略~          |                                     |
|          | |                  |                                     |
|          | | }                |                                     |
|          | +------------------+                                     |
+----------+----------------------------------------------------------+

変数の抜出および具体値登録
--------------------------

| ITAにアップロードされたModule素材から変数を抜出して具体値を登録できます。
| 抜出した変数の具体値は「\ *6.2.12*\ 代入値自動登録」「\ *6.2.13*\ 代入値管理」で具体値を登録します。
| 登録された変数と具体値は、作業実行時にTerraform側のWorkspaceで管理するVariablesに対し、「変数名」が「Key」、「具体値」が「Value」として登録されます。

変数のタイプについて
--------------------

| 変数内でtypeを設定することができます。
| Module内の変数は HCL（HashiCorp ConfigurationLanguage）の変数ルールに従い記述してください。

| ITA内で扱う変数は以下の通りです。
| 記入例は「 8.1 Module素材記入例」をご参照ください。

+----------+----------+----------+----------+----------+----------+
| type     | 詳細     | 代\      | メンバ\  | typeの\  | d\       |
|          |          | 入順序   | ー変数   | 記述例   | efaultの\|
|          |          |          |          |          | 記述例   |
|          |          |          |          |          |          |
|          |          | 対象※1   | 対象※2   | 記述例   |          |
+==========+==========+==========+==========+==========+==========+
| string   | 文\      | ×        | ×        | string   | あいう   |
|          | 字列型。 |          |          |          |          |
+----------+----------+----------+----------+----------+----------+
| number   | 数値型。 | ×        | ×        | number   | 2022     |
+----------+----------+----------+----------+----------+----------+
| bool     | trueまた\| ×        | ×        | bool     | true     |
|          | はfalse  |          |          |          |          |
+----------+----------+----------+----------+----------+----------+
| list     | 配列型。 | 〇       | ×        | list     | [“あ”,   |
|          |          |          |          | (string) | “い”,    |
|          |          |          |          |          | “う”]    |
+----------+----------+----------+----------+----------+----------+
| set      | 配列型。 | 〇       | ×        | set      | [1, 2,   |
|          | ユニーク\|          |          | (number) | 3]       |
|          | な値の設\|          |          |          |          |
|          | 定が求め\|          |          |          |          |
|          | られる。 |          |          |          |          |
|          |          |          |          |          |          |
|          | I\       |          |          |          |          |
|          | TA上では\|          |          |          |          |
|          | 具体値が\|          |          |          |          |
|          | ユニーク\|          |          |          |          |
|          | か否かは\|          |          |          |          |
|          | 判定され\|          |          |          |          |
|          | ません。 |          |          |          |          |
+----------+----------+----------+----------+----------+----------+
| tuple    | 配\      | ×        | 〇       | tuple(   | [“       |
|          | 列型。予\|          |          | [string, | あいう”, |
|          | めn番目\ |          |          | number]) | 2022]    |
|          | にどのty\|          |          |          |          |
|          | peを設定\|          |          |          |          |
|          | するか決\|          |          |          |          |
|          | めておく\|          |          |          |          |
|          | 必要があ\|          |          |          |          |
|          | ります。 |          |          |          |          |
|          |          |          |          |          |          |
|          | 値\      |          |          |          |          |
|          | の入力数\|          |          |          |          |
|          | が決めら\|          |          |          |          |
|          | れている\|          |          |          |          |
|          | のでITA\ |          |          |          |          |
|          | 上ではメ\|          |          |          |          |
|          | ンバー変\|          |          |          |          |
|          | 数として\|          |          |          |          |
|          | プルダウ\|          |          |          |          |
|          | ンで選択\|          |          |          |          |
|          | します。 |          |          |          |          |
+----------+----------+----------+----------+----------+----------+
| map      | key-va\  | ×        | ×        | map      | { “key”  |
|          | lue型。I |          |          | (string) | =        |
|          | TA上では\|          |          |          | “value”  |
|          | map型が\ |          |          |          | }        |
|          | 一つ以上\|          |          |          |          |
|          | 含まれて\|          |          |          |          |
|          | いるtype\|          |          |          |          |
|          | を設定し\|          |          |          |          |
|          | た場合、\|          |          |          |          |
|          | type情報\|          |          |          |          |
|          | からKEY\ |          |          |          |          |
|          | 値を特定\|          |          |          |          |
|          | できない\|          |          |          |          |
|          | ので、代\|          |          |          |          |
|          | 入値を設\|          |          |          |          |
|          | 定する場\|          |          |          |          |
|          | 合はHCL\ |          |          |          |          |
|          | 設定をON\|          |          |          |          |
|          | にしてく\|          |          |          |          |
|          | ださい。 |          |          |          |          |
|          |          |          |          |          |          |
|          | HCL設定\ |          |          |          |          |
|          | について\|          |          |          |          |
|          | の説明は\|          |          |          |          |
|          | 「6.2\   |          |          |          |          |
|          | .12  代\ |          |          |          |          |
|          | 入値自動\|          |          |          |          |
|          | 登録」ま\|          |          |          |          |
|          | たは「\  |          |          |          |          |
|          | 6.2.13\  |          |          |          |          |
|          | 代入値\  |          |          |          |          |
|          | 管理」を\|          |          |          |          |
|          | ご参照く\|          |          |          |          |
|          | ださい。 |          |          |          |          |
+----------+----------+----------+----------+----------+----------+
| object   | key-v\   | ×        | 〇       | object({ | {        |
|          | alue型。 |          |          |          |          |
|          |          |          |          | key =    | “key” =  |
|          | ITA上で\ |          |          | number   | 2022     |
|          | はkeyを\ |          |          |          |          |
|          | メンバー |          |          | })       | }        |
|          | 変数とし\|          |          |          |          |
|          | て扱いま\|          |          |          |          |
|          | す。key\ |          |          |          |          |
|          | 名に日本\|          |          |          |          |
|          | 語は含ま\|          |          |          |          |
|          | ないでく\|          |          |          |          |
|          | ださい。 |          |          |          |          |
+----------+----------+----------+----------+----------+----------+
| any      | すべ\    | ×        | ×        | any      | あいう   |
|          | てに適合\|          |          |          |          |
|          | する型。 |          |          |          |          |
|          |          |          |          |          |          |
|          | ITA上で\ |          |          |          |          |
|          | はstring\|          |          |          |          |
|          | 型と同じ\|          |          |          |          |
|          | 扱いとな\|          |          |          |          |
|          | ります。 |          |          |          |          |
+----------+----------+----------+----------+----------+----------+
| 記載なし | ty\      | ×        | ×        |          | あいう   |
|          | peを記載\|          |          |          |          |
|          | しなかっ\|          |          |          |          |
|          | た場合、 |          |          |          |          |
|          | ITA上では|          |          |          |          |
|          | string型 |          |          |          |          |
|          | と同じ扱\|          |          |          |          |
|          | いになり |          |          |          |          |
|          | ます。   |          |          |          |          |
+----------+----------+----------+----------+----------+----------+ 

|  ※1 …代入順序

| 変数に複数具体値を設定する際の先頭から代入する順序です。
| 変数または階層構造の変数の最下層の変数のタイプがlist,setの場合、代入値自動登録設定メニュー/代入値管理メニューにて設定可能です。

例: 変数タイプがlistの場合
**************************

- tfファイルと登録値

  .. code-block:: bash 
  
     variable "VAR_hoge" {
        type = list(string)
     }

  
#. | 代入値例(代入値自動登録設定)

   .. list-table:: 代入値例
      :widths: 5 10 10 5 10
      :header-rows: 1
      :align: left
   
      * - 項番
        - 変数名
        - メンバー変数
        - 代入順序
        - 具体値
      * -  1
        -  VAR_hoge
        -  入力不要
        -  1
        -  あいう
      * - 2
        - VAR_hoge
        - 入力不要
        - 2
        - かきく   
    
 
#. | Terraformに送信される値

   .. code-block:: bash 
   
      ["あいう","かきく"] 
   
例： 階層構造の変数の最下層の変数タイプがsetの場合
**************************************************

- tfファイルと登録値

  .. code-block:: bash 
  
     variable "VAR_hoge" {
        type = object({
           key = set(number)
        })
     }
    


#. | 代入値例(代入値自動登録設定/代入値管理) 

   .. list-table:: 代入値例
      :widths: 5 10 10 5 10
      :header-rows: 1
      :align: left
   
      * - 項番
        - 変数名
        - メンバー変数
        - 代入順序
        - 具体値
      * -  1
        -  VAR_hoge
        -  key
        -  1
        -  1
      * - 2
        - VAR_hoge
        - key
        - 2
        - 2   

#. | Terraformに送信される値

   .. code-block:: bash 
   
      {
          key = [1,2]
      }    
 
| ※2 …メンバー変数

| 変数がkey-value型である場合のkey名です。
| 変数のタイプがobjectの場合、<KEY>= <TYPE>の<KEY>をメンバー変数とします。
| 変数のタイプがtupleの場合、tuple内に定義した変数を先頭から[0],[1],[2]…と採番してメンバー変数となります。

| 変数のタイプが変数ネスト管理メニューの登録対象の場合、最大繰返数をもとに[0],[1],[2]…と採番してメンバー変数となります。
| 変数ネストに関しては「2.6 変数ネスト管理」をご参照ください。

例: 変数タイプがobjectの場合
****************************

- tfファイルと登録値
  
.. code-block:: bash 

   variable "VAR_hoge" {
       type = object({
         NAME = string,
         IP = string
       })
       default = {
         “NAME” = “machine_01”,
         “IP” = “127.0.0.1”
      }
   }

#. | 代入値例(代入値自動登録設定/代入値管理)

   .. list-table:: 代入値例
      :widths: 5 10 10 5 10
      :header-rows: 1
      :align: left
   
      * - 項番
        - 変数名
        - メンバー変数
        - 代入順序
        - 具体値
      * -  1
        -  VAR_hoge
        -  NAME
        -  入力不可
        -  my_machine
      * - 2
        - VAR_hoge
        - IP
        - 入力不可
        - 192.168.01  
#. | Terraformに送信される値

   .. code-block:: bash
   
      {
          NAME = "my_machine"
          IP = "192.168.1"
      } 
   
例: 変数のタイプがtupleの場合
*****************************

- tfファイルと登録値

.. code-block:: bash

   variable "VAR_hoge" {
       type = tuple([string,number])
       default = ["aaa",2022]
   }      

#. | 代入値例(代入値自動登録設定/代入値管理)

   .. list-table:: 代入値例
      :widths: 5 10 10 5 10
      :header-rows: 1
      :align: left
   
      * - 項番
        - 変数名
        - メンバー変数
        - 代入順序
        - 具体値
      * -  1
        -  VAR_hoge
        -  [0]
        -  入力不可
        -  bbb
      * -  2
        -  VAR_hoge
        -  [1]
        -  入力不可
        -  2023

#. | Terraformに送信される値

   .. code-block:: bash
   
      ["bbb", 2023]  

例: 変数のタイプがネスト管理対象の場合
**************************************

- tfファイルと登録値

.. code-block:: bash
   
   variable "VAR_hoge"{
       type = list(set(string))
       default = [
         ["aaa","bbb"]
         ["ccc","ddd"]
       ]
   }       


#. |  代入値例(代入値自動登録設定/代入値管理)

   .. list-table:: 代入値例
      :widths: 5 10 10 5 10
      :header-rows: 1
      :align: left
   
      * - 項番
        - 変数名
        - メンバー変数
        - 代入順序
        - 具体値
      * -  1
        -  VAR_hoge
        -  [0]
        -  1
        -  あああ
      * -  2
        -  VAR_hoge
        -  [0]
        -  2
        -  いいい
      * - 3
        - VAR_hoge
        - [1]
        - 1
        - ううう
      * - 4
        - VAR_hoge
        - [1]
        - 2
        - えええ
            
#. | Terraformに送信される値

   .. code-block:: bash 
   
      [
         [“あああ”, “いいい”],
         [“ううう”, “えええ”]
      ]
       

Terraform-driver コンソールメニュー構成
=======================================

| 本章では、ITAコンソールのメニュー構成について説明します

メニュー/画面一覧
-----------------

1. ITA\ 基本コンソールのメニュー

| Terraform-driverで利用するITA基本コンソールのメニュー一覧を以下に記述します。

.. list-table:: 3.1-1 基本コンソール メニュー/画面一覧
   :widths: 3 10 10 20
   :header-rows: 1
   :align: left

   * - No
     - メニューグループ
     - メニュー・画面
     - 説明
   * - 1
     - ITA基本コンソール
     - オペレーション一覧
     - オペレーション一覧をメンテナンス(閲覧/登録/更新/廃止)できます。

2. Terraform-driverコンソールのメニュー

| Terraform-driverコンソールのメニュー一覧を以下に記述します。
   
.. list-table:: 3.1-2Terraform-driverコンソールメニュー/画面一覧 
   :widths: 3 10 3 20
   :header-rows: 1
   :align: left

   * - No
     - メニュー・画面
     - 非表示メニュー※1
     - 説明
   * - 1
     - インタフェース情報
     - 
     - ITAと連携するTerraformの情報を管理します。
   * - 2
     - Organizations管理
     - 
     - Terraformで利用するOrganizationの情報を管理します。     
   * - 3
     - Workspaces管理
     - 
     - Terraformで利用するWorkspaceの情報を管理します。
   * - 4
     - Movement一覧
     - 
     - Symphonyに登録するMovement一覧を管理します。
   * - 5
     - Module素材集
     -
     - Moduleファイルを管理します。
   * - 6
     - Policies管理
     -
     - Policyファイルを管理します。 
   * - 7
     - Policy Sets管理
     -
     - | Policy Setを管理します。
       | Policy SetはPolicyおよびWorkspaceと紐づけることで、作業実行時に対象のWorkspaceに対してPolicyを有効にします。        
   * - 8
     - PolicySet-Policy紐付管理
     -
     - PolicySetとPolicyの紐付けを管理します。
   * - 9
     - PolicySet-Workspace紐付管理
     -
     - PolicySetとWorkspaceの紐付けを管理します。
   * - 10
     - Movement-Module紐付
     -
     - MovementとModule素材の関連付けを管理します。
   * - 11
     - 変数ネスト管理
     -
     - Module素材集で登録したtfファイルで定義されている変数のタイプがlist,setかつ、その変数の中でlist,set,tuple,objectが定義されている場合、メンバー変数の最大繰返数を管理します。
   * - 12
     - 代入値自動登録
     - 
     - パラメータシートのメニューに登録されているオぺレーション毎の項目や値を紐付けるMovementと変数を管理します
   * - 13
     - 代入値管理
     -
     - 代入値管理
   * - 14
     - 作業実行
     - 
     - 作業実行するMovementとオペレーションを選択し実行を指示します。
   * - 15
     - 作業状態確認
     - 
     - 作業実行状態を表示します。
   * - 16
     - 作業管理
     - 
     - 作業実行履歴を管理します。
   * - 17
     - Movement変数紐付管理
     - 〇
     - Movementと変数の紐付を管理します。
   * - 18
     - メンバー変数管理
     - 〇
     - メンバー変数を管理します。
   * - 19
     - Movement変数紐付管理
     - 〇
     - Movementと変数名の紐付を管理します。
   * - 20
     - 連携先Terrraform管理
     - 
     -  ITAと連携されているTerraformに登録されているOrganization, Workspace,Policy,PolicySetの一覧表示および削除をすることができます。     

.. note:: 

   |  ※1非表示メニューは、バックヤード機能でデータの登録・更新を行うメニューです。
   |  Terraform-CLI-driver機能をインストールした状態では表示されないメニューに設定されています。
   | 非表示メニューを表示するには、「管理コンソール/ロール・メニュー紐付管理」で各メニューの復活処理を行います。
   | 詳細は「利用手順マニュアル_管理コンソール」を参照してください。
   | 尚、データの更新を行うとバックヤード機能が正しく動作しなくなります。データの更新はしないで下さい。
 


Terraform-driver利用手順
========================

| 各Terraformコンソールの利用手順について説明します

Terraform作業フロー
-------------------

| 各Terraformコンソールにおける標準的な作業フローは以下のとおりです。
| 各作業の詳細は次項に記載しています。
| ITA基本コンソールの利用方法は、「利用手順マニュアル_基本コンソール」を参照してください。
| 以下は、Terraformで作業を実行するまでの流れです。

.. figure:: /images/ja/terraform-driver/common/terraform_flow2.png
   :align: left
   :width: 5.69236in
   :height: 3.36528in
|

.. figure:: /images/ja/terraform-driver/common/terraform_flow3.png
   :align: left
   :width: 5.69236in
   :height: 3.36528in

- 作業フロー詳細と参照先

#. | 投入オペレーション名の登録

   | ITA基本コンソールのオペレーション一覧の画面から、作業用の投入オペレーション名を登録します。
   | 詳細は「6.1.1 オペレーション一覧」を参照してください。

#. | インターフェース情報の登録

   | ITAシステムと連携するTerraformの情報を登録します。
   | 詳細は「6.2.1 インターフェース情報」を参照してください。

#. | Organizationの登録と連携

   | Organizationの情報を登録し、Terraformとの連携を行います。
   | 詳細は「6.2.2 Organizations管理」を参照してください。

#. | Workspaceの登録と連携
   | Workspaceの情報を登録し、Terraformとの連携を行います。
   | 詳細は「6.2.3 Workspaces管理」を参照してください。

#. | 作業パターン(Movement)の登録

   | 作業用のMovementを登録します。
   | 詳細は「6.2.4 Movement一覧」を参照してください。

#. | Module素材の登録
   
   | 作業で実行するModuleファイルを登録します。
   | 詳細は「6.2.5 Module素材集」を参照してください。

#. | Policyの登録（必要に応じて実施）

   | 作業実行前に行うPolicyCheckで実行するPolicyファイルを登録します。
   | 詳細は「6.2.6 Policies管理」を参照してください。
  

#. | PolicySetの登録 （必要に応じて実施）

   | Policyを適用するWorkspaceと紐付けるためのPolicySetを登録します。
   | 詳細は「6.2.7 Policy Sets管理」を参照してください。

#. | PolicySetにPolicyを指定
 
   | PolicySetとPolicyの紐付けを登録します。
   |  詳細は「\ *6.2.8* PolicySet-Policy紐付管理」を参照してください。

#. | PolicySetにWorkspaceを指定
        
   | PolicySetとWorkspaceの紐付けを登録します。
   | 詳細は「6.2.9 PolicySet-Workspace紐付管理」を参照してください。

#. | MovementにModule素材を指定

   | 登録したMovementにModule素材を指定します。
   | 詳細は「6.2.10 Movement-Module紐付」を参照してください。
   
#. | 最大繰返数の設定（必要に応じて実施）
   
   | メンバー変数の最大繰返数を設定します。
   | 詳細は「6.2.11 変数ネスト管理」を参照してください。


#. | 変数値の設定（必要に応じて実施）

   | Movementに登録したModule素材内で定義した変数の値を設定します。
   | 変数を利用していない場合、設定は不要です。
   | 詳細は「6.2.12 代入値自動登録」「6.2.13 代入値管理」を参照してください。
   
#. | 作業実行

   | 実行日時、投入オペレーションを選択して設定して処理の実行を指示します。
   | 詳細は「6.2.14 作業実行」を参照してください。

#. | 作業状態確認

   | 実行した作業の状態がリアルタイムで表示されます。
   | また、作業の緊急停止や、実行ログ、エラーログを監視することができます。
   | 詳細は「6.2.15 作業状態確認」を参照してください。

#. | 作業履歴確認
   
   | 実行した作業の一覧が表示され履歴が確認できます。
   | 詳細は「6.2.16 作業管理」を参照してください。
 

Terraform-driverでのPolicyの適用
================================

Policy/PolicySet/Workspaceの紐付けについて
------------------------------------------

| Policyを適用させるために、Policyに関する各設定登録をした後に紐付設定をする必要があります。

| 最初に「6.2.6 Policies管理」で登録したPolicyと「6.2.7 PolicySets管理」で登録したPolicySetを
| 「6.2.8 PolicySet-Policy紐付管理 」にて紐付けをします。

| 次に「6.2.3 Workspaces管理 」で登録したWorkspaceと「6.2.7 Policy Sets管理 」で登録したPolicySetを
| 「6.2.9 PolicySet-Workspace紐付管理 」にて紐付けをします。

| 作業実行時にMovementに紐付いたWorkspaceに対し、PolicySetとそれに紐付けられたPolicyが適用されます。

.. image:: saas/image5.png
   :align: left
   :width: 6.69236in
   :height: 3.36528in

**図** **5.1- 1 Policy/PolicySet/Workspaceの紐付けについて**

Terraform-driver機能・操作方法説明
==================================

| 本章では、Terraform-driverで利用する各コンソールの機能について説明します。

基本コンソール
--------------

| 本節では、ITA基本コンソールでの操作について記載します。
| 本作業はITA基本コンソールマニュアルを参照して、ITA基本コンソール画面内で作業を実施してください。

オペレーション一覧
******************


#. | [オペレーション一覧]画面では、オーケストレータで実行する作業対象ホストに対するオペレーションを管理します。作業はITA基本コンソール内メニューより選択します。

   .. image:: saas/image6.png
      :alt: オペレーション一覧
      :align: left
      :width: 6.1872in
      :height: 3.08693in

**図** **6.1- 1 サブメニュー画面（オペレーション一覧）**

| 登録方法の詳細は、関連マニュアルの「利用手順マニュアル_基本コンソール」をご参照下さい。

Terraform-driverコンソール
--------------------------

| 本節では、Terraformコンソールでの操作について記載します。

インターフェース情報
********************

#. | [インターフェース情報]では、ITAシステムと連携するTerraformの情報をメンテナンス（閲覧／更新）することができます。
   | 連携対象となるTerraformのHostnameと、TerraformのUserが発行したUserTokenが必要となります。

   .. image:: saas/image7.png
      :alt: インターフェース情報
      :width: 5.73383in
      :height: 3.24695in

   **図** **6.2.1- 1 サブメニュー画面（インターフェース情報）**

#. | 「一覧」-「更新」ボタンより、インターフェース情報の登録を行います。
   | インターフェース情報が未登録または、複数レコード登録されている状態で作業実行した場合、\ **作業実行は想定外エラーとなります**\ 。

   .. image:: saas/image8.png
      :alt: インターフェース情報
      :width: 5.42609in
      :height: 1.08958in

   **図** **6.2.1- 2 登録画面（インターフェース情報）**

#. | インターフェース情報画面の項目一覧は以下のとおりです。

.. table:: 6.2.1-1 項目一覧（インタフェース情報）
   
   +-----------+-----------+-----------+-----------+-----------+
   | 項目      | 説明      | 入力\     | 入\       | 制\       |   
   |           |           | 必須      | 力形式    | 約事項    |   
   |           |           |           |           |           |   
   +===========+===========+===========+===========+===========+
   | Hostname  | ITAシ\    | ○         | 手動入力  | 最大長    |   
   |           | ステムが\ |           |           | 256バイト |   
   |           | 連携する\ |           |           |           |   
   |           | 対象であ\ |           |           |           |   
   |           | るTerrafo\|           |           |           |   
   |           | rmのHostn\|           |           |           |   
   |           | ameを入力\|           |           |           |   
   |           | します。  |           |           |           |   
   +-----------+-----------+-----------+-----------+-----------+
   | User      | Terrafo\  | ○         | 手動入力  | 最大長    |   
   | Token     | rmの[User\|           |           | 256バイト |   
   |           | Settings\ |           |           |           |   
   |           | ]より発行\|           |           |           |   
   |           | したUser\ |           |           |           |   
   |           | To\       |           |           |           |   
   |           | kenを入力\|           |           |           |   
   |           | します。  |           |           |           |   
   +-----+-----+-----------+-----------+-----------+-----------+
   | Pro\| Add\| プロキ\   |           | 手動入力  |           | 
   | xy  | ress| シサーバ\ |           |           |           |
   |     |     | のアドレ\ |           |           |           |
   |     |     | スを入力\ |           |           |           |
   |     |     | します。  |           |           |           |
   |     |     |           |           |           |           |
   |     |     | ITAが\    |           |           |           |
   |     |     | プロキシ\ |           |           |           |
   |     |     | 環境下に\ |           |           |           |
   |     |     | ある場合\ |           |           |           |
   |     |     | 、Terraf\ |           |           |           |  
   |     |     | ormまでの\|           |           |           |
   |     |     | 疎通のた\ |           |           |           |
   |     |     | めに設定\ |           |           |           |
   |     |     | が必要な\ |           |           |           |
   |     |     | 場合があ\ |           |           |           |
   |     |     | ります。  |           |           |           |
   |     +-----+-----------+-----------+-----------+-----------+
   |     | Port| プロ\     |           | 手動入力  |           |
   |     |     | キシサー\ |           |           |           |
   |     |     | バのポー\ |           |           |           |
   |     |     | トを入力\ |           |           |           |
   |     |     | します。  |           |           |           |
   |     |     |           |           |           |           |
   |     |     | ITAが\    |           |           |           |
   |     |     | プロキシ\ |           |           |           |
   |     |     | 環境下に\ |           |           |           |
   |     |     | ある場合\ |           |           |           |
   |     |     | 、Terraf\ |           |           |           | 
   |     |     | ormまでの\|           |           |           |
   |     |     | 疎通のた\ |           |           |           |
   |     |     | めに設定\ |           |           |           |
   |     |     | が必要な\ |           |           |           |
   |     |     | 場合があ\ |           |           |           |
   |     |     | ります。  |           |           |           |
   +-----+-----+-----------+-----------+-----------+-----------+
   | 状\       | 「 \      | ○         | 手動入力  | 最小値\   |   
   | 態監視周\ | 6.2.15 \  |           |           | 1000\     |   
   | 期（単位\ | 作業状態\ |           |           | ミリ秒    |   
   | ミリ秒）  | 確認 」\  |           |           |           |   
   |           | で表示さ\ |           |           |           |   
   |           | れるログ\ |           |           |           |   
   |           | のリフレ\ |           |           |           |   
   |           | ッシュ間\ |           |           |           |   
   |           | 隔を入力\ |           |           |           |   
   |           | します。  |           |           |           |   
   |           | 通常は300\|           |           |           |   
   |           | 0ミリ秒程\|           |           |           |   
   |           | 度が推奨\ |           |           |           |   
   |           | 値です。  |           |           |           |   
   +-----------+-----------+-----------+-----------+-----------+
   | 進行状態\ | 「6.\     | ○         | 手動入力  | ー        |   
   | 表示行数  | 2.15 作業\|           |           |           |   
   |           | 状態確認\ |           |           |           |   
   |           | 」での\   |           |           |           |   
   |           | 進行ログ\ |           |           |           |   
   |           | ・エラー\ |           |           |           |   
   |           | ログの最\ |           |           |           |   
   |           | 大表示行\ |           |           |           |   
   |           | 数を入力\ |           |           |           |   
   |           | します。  |           |           |           |   
   |           |           |           |           |           |   
   |           | ステ\     |           |           |           |   
   |           | ータスが[\|           |           |           |   
   |           | 未実行]、\|           |           |           |   
   |           | [準備中]\ |           |           |           |   
   |           | 、[実行中\|           |           |           |   
   |           | ]、[実行\ |           |           |           |   
   |           | 中(遅延)\ |           |           |           |   
   |           | ]の場合、\|           |           |           |   
   |           | 指定した\ |           |           |           |   
   |           | 行数でロ\ |           |           |           |   
   |           | グを出力\ |           |           |           |   
   |           | します。  |           |           |           |   
   |           |           |           |           |           |   
   |           | ステー\   |           |           |           |   
   |           | タスが[完\|           |           |           |   
   |           | 了]、[完\ |           |           |           |   
   |           | 了(異常)]\|           |           |           |   
   |           | 、[想定外\|           |           |           |   
   |           | エラー]、\|           |           |           |   
   |           | [緊急停止\|           |           |           |   
   |           | ]、[未実\ |           |           |           |   
   |           | 行(予約)]\|           |           |           |   
   |           | 、[予約取\|           |           |           |   
   |           | 消]の場合\|           |           |           |   
   |           | 、指定し\ |           |           |           |   
   |           | た行数で\ |           |           |           |   
   |           | はなくす\ |           |           |           |   
   |           | べてのロ\ |           |           |           |   
   |           | グを出力\ |           |           |           |   
   |           | します。  |           |           |           |   
   |           |           |           |           |           |   
   |           | 環境毎に\ |           |           |           |   
   |           | チューニ\ |           |           |           |   
   |           | ングを要\ |           |           |           |   
   |           | しますが\ |           |           |           |   
   |           | 、通常は\ |           |           |           |   
   |           | 1000行程\ |           |           |           |   
   |           | 度が推奨\ |           |           |           |   
   |           | 値です。  |           |           |           |   
   +-----------+-----------+-----------+-----------+-----------+
   | NULL連携  | 代入値\   | ○         | リ\       |           |   
   |           | 自動登録\ |           | スト選択  |           |   
   |           | 設定でパ\ |           |           |           |   
   |           | ラメータ\ |           |           |           |   
   |           | シートの\ |           |           |           |   
   |           | 具体値が\ |           |           |           |   
   |           | NULL(空白\|           |           |           |   
   |           | )の場合に\|           |           |           |   
   |           | 、代\     |           |           |           |   
   |           | 入値管理\ |           |           |           |   
   |           | への登録\ |           |           |           |   
   |           | を\       |           |           |           |   
   |           | NUL\      |           |           |           |   
   |           | L(空白)の\|           |           |           |   
   |           | 値で行う\ |           |           |           |   
   |           | か設定し\ |           |           |           |   
   |           | ます。代\ |           |           |           |   
   |           | 入値自動\ |           |           |           |   
   |           | 登録設定\ |           |           |           |   
   |           | メニュー\ |           |           |           |   
   |           | の「NULL\ |           |           |           |   
   |           | 連携」が\ |           |           |           |   
   |           | 空白の場\ |           |           |           |   
   |           | 合この値\ |           |           |           |   
   |           | が適用さ\ |           |           |           |   
   |           | れます。  |           |           |           |   
   |           |           |           |           |           |   
   |           | ・        |           |           |           |   
   |           | 「有効」\ |           |           |           |   
   |           | の場合、\ |           |           |           |   
   |           | パラメー\ |           |           |           |   
   |           | タシート\ |           |           |           |   
   |           | の値がど\ |           |           |           |   
   |           | のような\ |           |           |           |   
   |           | 値でも\   |           |           |           |   
   |           | 代入値管\ |           |           |           |   
   |           | 理への登\ |           |           |           |   
   |           | 録が行わ\ |           |           |           |   
   |           | れます。  |           |           |           |   
   |           |           |           |           |           |   
   |           | ・        |           |           |           |   
   |           | 「無効」\ |           |           |           |   
   |           | の場合、\ |           |           |           |   
   |           | パラメー\ |           |           |           |   
   |           | タシート\ |           |           |           |   
   |           | に値が入\ |           |           |           |   
   |           | っている\ |           |           |           |   
   |           | 場合のみ\ |           |           |           |   
   |           | 代入値管\ |           |           |           |   
   |           | 理への登\ |           |           |           |   
   |           | 録が行わ\ |           |           |           |   
   |           | れます。  |           |           |           |   
   +-----------+-----------+-----------+-----------+-----------+
   | 備考      | 自由記述\ | ー        | 手動入力  | 最大長4\  |   
   |           | 欄です。  |           |           | 000バイト |   
   +-----------+-----------+-----------+-----------+-----------+


Organizations管理
******************

#. | [Organizations管理]では、Terraformで利用するOrganizationについてのメンテナンス（閲覧/登録/更新/廃止）を行います。
   | また、ITAシステムに登録したOrganizationをTerraformへ連携（登録/更新/削除）することができます。

   ..  image:: saas/image9.png
       :alt: サブメニュー画面（Organizations管理）
       :width: 5.88051in
       :height: 2.62023in
   
   **図** **6.2.2- 1サブメニュー画面（Organizations管理）**

#. | 「登録」-「登録開始」ボタンより、Organization情報の登録を行います。

   ..  image:: saas/image10.png
       :alt: 登録画面（Organizations管理）
       :width: 5.84317in
       :height: 1.19615in

   **図** **6.2.2- 2 登録画面（Organizations管理）**

#. | Organizationを「登録」した後、「一覧/更新」より「連携状態チェック」ボタンをクリックすると、Terraformとの連携状態を確認できます。連携状態に応じてTerrraformへの連携（登録/更新/削除）ボタンがアクティブに変わり、クリックすることでTerraformとの連携を実行できます。
   | OrganizationがTerraformに連携（登録）されていない状態で作業実行した場合、\ **作業実行は想定外エラーとなります**\ 。

   | 「6.2.1インターフェース情報」で登録した「Hostname」および「UserToken」に誤りがあると、Terraformとの連携が失敗し、連携状態に以下のメッセージが表示されます。
   | 『Terraformとの接続に失敗しました。インターフェース情報を確認して下さい。』

   | Workspaces管理ボタンをクリックすると、対象のOrganizationの「6.2.3Workspaces管理 」へ遷移します。

   ..  image:: saas/image11.png
       :alt: Terraform連携（Organizations管理)
       :width: 5.30198in
       :height: 1.36637in

   **図** **6.2.2-3 Terraform連携（Organizations管理）**

#. | Organizations管理画面の項目一覧は以下のとおりです。

.. table:: 6.2.2-1 項目一覧（Organizations管理）

   +-----------------------+-----------+-----------+-----------+-----------+
   | 項目                  | 説明      | 入力必須  | 入\       | 制\       |
   |                       |           |           | 力形式    | 約事項    |
   |                       |           |           |           |           |
   +=======================+===========+===========+===========+===========+
   | Org\                  | Organiz\  | ○         | 手動入力  | 最大長\   |
   | anization             | ationの名\|           |           | 40バイト  |
   | Name                  | 前を入力\ |           |           |           |
   |                       | します。  |           |           |           |
   |                       |           |           |           |           |
   |                       | 半角英数\ |           |           |           |
   |                       | 字と記号\ |           |           |           |
   |                       | \_ -\     |           |           |           |
   |                       | （ア\     |           |           |           |
   |                       | ンダーバ\ |           |           |           |
   |                       | ーとハイ\ |           |           |           |
   |                       | フン）の\ |           |           |           |
   |                       | み利用可\ |           |           |           |
   |                       | 能です。  |           |           |           |
   +-----------------------+-----------+-----------+-----------+-----------+
   | Email\                | O\        | ○         | 手動入力  | 最大長\   |
   | address               | rganizati\|           |           | 128バイト |
   |                       | onのEmail\|           |           |           |
   |                       | addr\     |           |           |           |
   |                       | essを入力\|           |           |           |
   |                       | します。  |           |           |           |
   +-----------+-----------+-----------+-----------+-----------+-----------+
   | Terr\     | 連携状態\ | 連携状\   | ー        | ー        |           |
   | aform連携 | チェック  | 態チェッ\ |           |           |           |
   |           |           | クを実行\ |           |           |           |
   |           |           | するボタ\ |           |           |           |
   |           |           | ンです。  |           |           |           |
   |           +-----------+-----------+-----------+-----------+-----------+
   |           | 連携状態  | 対象の\   | ー        | ー        |           |
   |           |           | Organizat\|           |           |           | 
   |           |           | ionについ\|           |           |           | 
   |           |           | て、Terr\ |           |           |           |
   |           |           | aformとの\|           |           |           |
   |           |           | 連携状態\ |           |           |           |
   |           |           | が表示さ\ |           |           |           |
   |           |           | れます。  |           |           |           |
   |           |           |           |           |           |           |
   |           |           | Terr\     |           |           |           |
   |           |           | aform側に\|           |           |           |
   |           |           | 登録され\ |           |           |           |
   |           |           | ていない\ |           |           |           |
   |           |           | 場合は『\ |           |           |           |
   |           |           | 登録なし\ |           |           |           |
   |           |           | 』。登録\ |           |           |           |
   |           |           | されてい\ |           |           |           |
   |           |           | るがEmail\|           |           |           |
   |           |           | addres\   |           |           |           |
   |           |           | sに差異が\|           |           |           |
   |           |           | ある場合\ |           |           |           |
   |           |           | は『更新\ |           |           |           |
   |           |           | あり』。  |           |           |           |
   |           |           | 登録され\ |           |           |           |
   |           |           | ている場\ |           |           |           |
   |           |           | 合は『登\ |           |           |           |
   |           |           | 録済み』\ |           |           |           |
   |           |           | と表示さ\ |           |           |           |
   |           |           | れます。  |           |           |           |
   |           +-----------+-----------+-----------+-----------+-----------+
   |           | 登録      | 登録を\   | ー        | ー        |           |
   |           |           | 実行する\ |           |           |           |
   |           |           | ボタンで\ |           |           |           | 
   |           |           | す。『登\ |           |           |           |
   |           |           | 録なし』\ |           |           |           |
   |           |           | の場合に\ |           |           |           |
   |           |           | アクティ\ |           |           |           |
   |           |           | ブ化され\ |           |           |           |
   |           |           | ます。ク\ |           |           |           |
   |           |           | リックす\ |           |           |           |
   |           |           | ることで\ |           |           |           |
   |           |           | Terrafor\ |           |           |           |
   |           |           | mに対象の\|           |           |           |
   |           |           | Organizat\|           |           |           |
   |           |           | ionを登録\|           |           |           |
   |           |           | します。  |           |           |           |
   |           +-----------+-----------+-----------+-----------+-----------+
   |           | 更新      | 更新\     | ー        | ー        |           |   
   |           |           | を実行す\ |           |           |           |
   |           |           | るボタン\ |           |           |           |
   |           |           | です。『\ |           |           |           |
   |           |           | 更新あり\ |           |           |           |
   |           |           | 』の場合\ |           |           |           |
   |           |           | にアクテ\ |           |           |           |
   |           |           | ィブ化さ\ |           |           |           |
   |           |           | れます。  |           |           |           |
   |           |           | クリック\ |           |           |           |
   |           |           | すること\ |           |           |           |
   |           |           | でTerraf\ |           |           |           |
   |           |           | ormに登録\|           |           |           |
   |           |           | されてい\ |           |           |           |
   |           |           | る対象のO\|           |           |           |
   |           |           | rganizati\|           |           |           |
   |           |           | onのEmail\|           |           |           |
   |           |           | addr\     |           |           |           |
   |           |           | essを更新\|           |           |           |
   |           |           | します。  |           |           |           |
   |           +-----------+-----------+-----------+-----------+-----------+
   |           | 削除      | 削除を実\ | ー        | ー        |           |
   |           |           | 行するボ\ |           |           |           |
   |           |           | タンです\ |           |           |           |
   |           |           | 。『登録\ |           |           |           |
   |           |           | 済み』『\ |           |           |           |
   |           |           | 更新あり\ |           |           |           |
   |           |           | 』の場合\ |           |           |           |
   |           |           | にアクテ\ |           |           |           |
   |           |           | ィブ化さ\ |           |           |           |
   |           |           | れます。  |           |           |           |
   |           |           | クリック\ |           |           |           |
   |           |           | すること\ |           |           |           |
   |           |           | でTerraf\ |           |           |           |
   |           |           | ormに登録\|           |           |           |
   |           |           | されてい\ |           |           |           |
   |           |           | る対象の\ |           |           |           |
   |           |           | Organizat\|           |           |           |
   |           |           | ionを削除\|           |           |           |
   |           |           | します。  |           |           |           |
   |           |           |           |           |           |           |
   |           |           | ※削除した\|           |           |           |
   |           |           | Organizat\|           |           |           |
   |           |           | ionは元に\|           |           |           |
   |           |           | 戻すこと\ |           |           |           | 
   |           |           | ができま\ |           |           |           |
   |           |           | せん。ま\ |           |           |           |
   |           |           | た、Organ\|           |           |           |
   |           |           | ization配\|           |           |           |
   |           |           | 下にある\ |           |           |           |
   |           |           | Workspac\ |           |           |           |
   |           |           | eも削除さ\|           |           |           | 
   |           |           | れます。  |           |           |           |
   +-----------+-----------+-----------+-----------+-----------+-----------+
   | Works\                | 「 \      | ー        | ー        |           |
   | paces管理             | 6.2.3\    |           |           |           |
   |                       | Workspa\  |           |           |           |
   |                       | ces管理\  |           |           |           |
   |                       | 」へ遷移\ |           |           |           |
   |                       | するボタ\ |           |           |           |
   |                       | ンです。  |           |           |           |
   +-----------------------+-----------+-----------+-----------+-----------+
   | 備考                  | 自由記述\ | ー        | 手動入力  | 最大長4\  |
   |                       | 欄です。  |           |           | 000バイト |
   +-----------------------+-----------+-----------+-----------+-----------+

Workspaces管理
**************


#. | [Workspaces管理]では、Terraformで利用するWorkspaceについてのメンテナンス（閲覧/登録/更新/廃止/ソース削除）を行います。
   | また、ITAシステムに登録したWorkspaceをTerraformへ連携（登録/更新/削除/リソース削除）することができます。WorkspaceはOrganizationに紐付くため、先に「6.2.2 Organizations管理 」で対象を登録しておく必要があります。

   .. image:: saas/image12.png
      :alt: サブメニュー画面（Workspaces管理）
      :width: 5.42602in
      :height: 3.05224in

   **図** **6.2.3-1 サブメニュー画面（Workspaces管理）**

#. | 「登録」-「登録開始」ボタンより、Workspace情報の登録を行います。

   ..  image:: saas/image13.png
       :alt: 登録画面（Workspaces管理）
       :width: 4.968in
       :height: 1.33226in

   **図** **6.2.3-2 登録画面（Workspaces管理）**

#. | Workspaceを「登録」した後、「一覧/更新」より「連携状態チェック」ボタンをクリックすると、Terraformとの連携状態を確認できます。
   | 連携状態に応じてTerrraformへの連携（登録/更新/削除/リソース削除）ボタンがアクティブに変わり、クリックすることでTerraformとの連携を実行できます。
   | OrganizationがTerraformに連携（登録）されていない状態で作業実行した場合、\ **作業実行は想定外エラーとなります**\ 。

   | 「6.2.1インターフェース情報」で登録した「Hostname」および「UserToken」に誤りがあると、Terraformとの連携が失敗し、連携状態に以下のメッセージが表示されます。
   | 『Terraformとの接続に失敗しました。インターフェース情報を確認して下さい。』
   | また、選択したOrganizationがTerraformに連携（登録）されていない場合も同様のメッセージが表示されます。

   | Organizationのリンクをクリックすると、対象の「6.2.2 Organizations管理 」へと遷移します。
   | Movement一覧ボタンをクリックすると、対象のOrganization:Workspaceの「6.2.4 Movement一覧 」へ遷移します。

   | PolicySet-Workspace紐付管理ボタンをクリックすると、対象のOrganization:Workspaceの「6.2.8 PolicySet-Policy紐付管理 」へ遷移します。

   | {{※ image14,15 画像にIPアドレスが表示されているため割愛してます。}}

   **図 6.2.3-2 Terraform連携（Workspaces管理）**

#. | Workspaces管理画面の項目一覧は以下のとおりです。

.. table:: 6.2.3-1項目一覧（Workspaces管理）
                           
   +-----------------------------------+-----------+-----------+-----------+-----------+
   | 項目                              | 説明      | 入力\     | 入\       | 制\       |
   |                                   |           | 必須      | 力形式    | 約事項    |
   |                                   |           |           |           |           |
   +===================================+===========+===========+===========+===========+
   | Org\                              | 「\       | ○         | リ\       |           |
   | anization\                        | 6.2.2\    |           | スト選択  |           |
   | Name                              | O\        |           |           |           |
   |                                   | rganizati\|           |           |           |
   |                                   | ons管理\  |           |           |           |
   |                                   | 」にて登\ |           |           |           |
   |                                   | 録したOrg\|           |           |           |
   |                                   | anization\|           |           |           |
   |                                   | N\        |           |           |           |
   |                                   | ameを選択\|           |           |           |
   |                                   | します。  |           |           |           |
   +-----------------------------------+-----------+-----------+-----------+-----------+
   | Workspace Name                    | Work\     | ○         | 手動入力  | 最大長    |
   |                                   | spaceの名\|           |           | 90バイト  |
   |                                   | 前を入力\ |           |           |           |
   |                                   | します。  |           |           |           |
   |                                   |           |           |           |           |
   |                                   | 半角英数\ |           |           |           |
   |                                   | 字と記号\ |           |           |           |
   |                                   | \_ -\     |           |           |           |
   |                                   | （ア\     |           |           |           |
   |                                   | ンダーバ\ |           |           |           |
   |                                   | ーとハイ\ |           |           |           |
   |                                   | フン）の\ |           |           |           |
   |                                   | み利用可\ |           |           |           |
   |                                   | 能です。  |           |           |           |
   +-----------------------------------+-----------+-----------+-----------+-----------+
   | Terraform Version                 | Terraf\   |           | 手動入力  |           |
   |                                   | ormのバー\|           |           |           |
   |                                   | ジョンを\ |           |           |           |
   |                                   | 入力しま\ |           |           |           |
   |                                   | す。空欄\ |           |           |           |
   |                                   | の場合は\ |           |           |           |
   |                                   | 連携（登\ |           |           |           |
   |                                   | 録）時に\ |           |           |           |
   |                                   | 最新のバ\ |           |           |           |
   |                                   | ージョン\ |           |           |           |
   |                                   | が自動的\ |           |           |           |
   |                                   | に適用さ\ |           |           |           |
   |                                   | れます。  |           |           |           |
   +-----------+-----------+-----------+-----------+-----------+-----------+-----------+
   | Terr\     | 連携      | 連携状態\ | 連携状\   | ー        | ー        |           |
   | aform連携 |           | チェック  | 態チェッ\ |           |           |           |
   |           |           |           | クを実行\ |           |           |           |
   |           |           |           | するボタ\ |           |           |           |
   |           |           |           | ンです。  |           |           |           |
   |           |           +-----------+-----------+-----------+-----------+-----------+
   |           |           | 連携状態  | 対象\     | ー        | ー        |           |
   |           |           |           | のWorksp\ |           |           |           |
   |           |           |           | aceについ\|           |           |           |
   |           |           |           | て、Terr\ |           |           |           |
   |           |           |           | aformとの\|           |           |           |
   |           |           |           | 連携状態\ |           |           |           |
   |           |           |           | が表示さ\ |           |           |           |
   |           |           |           | れます。  |           |           |           |
   |           |           |           |           |           |           |           |
   |           |           |           | Terrafor\ |           |           |           |
   |           |           |           | m側に登録\|           |           |           |
   |           |           |           | されてい\ |           |           |           |
   |           |           |           | ない場合\ |           |           |           |
   |           |           |           | は『登録\ |           |           |           |
   |           |           |           | なし』。  |           |           |           |
   |           |           |           | 登録され\ |           |           |           |
   |           |           |           | ているが\ |           |           |           |
   |           |           |           | Terraform\|           |           |           |
   |           |           |           | Versio\   |           |           |           |
   |           |           |           | nに差異が\|           |           |           |
   |           |           |           | ある場合\ |           |           |           |
   |           |           |           | は『更新\ |           |           |           |
   |           |           |           | あり』。  |           |           |           |
   |           |           |           | 登録され\ |           |           |           |
   |           |           |           | ている場\ |           |           |           |
   |           |           |           | 合は『登\ |           |           |           |
   |           |           |           | 録済み』\ |           |           |           |
   |           |           |           | と表示さ\ |           |           |           |
   |           |           |           | れます。  |           |           |           |
   |           |           +-----------+-----------+-----------+-----------+-----------+
   |           |           | 登録      | 登録\     | ー        | ー        |           |
   |           |           |           | を実行す\ |           |           |           |
   |           |           |           | るボタン\ |           |           |           |
   |           |           |           | です。『\ |           |           |           |
   |           |           |           | 登録なし\ |           |           |           |
   |           |           |           | 』の場合\ |           |           |           |
   |           |           |           | にアクテ\ |           |           |           |
   |           |           |           | ィブ化さ\ |           |           |           |
   |           |           |           | れます。  |           |           |           |
   |           |           |           | クリック\ |           |           |           |
   |           |           |           | すること\ |           |           |           |
   |           |           |           | でTerraf\ |           |           |           |
   |           |           |           | ormに対象\|           |           |           |
   |           |           |           | のWorksp\ |           |           |           |
   |           |           |           | aceを登録\|           |           |           |
   |           |           |           | します。  |           |           |           |
   |           |           +-----------+-----------+-----------+-----------+-----------+
   |           |           | 更新      | 更新を\   | ー        |           |           |
   |           |           |           | 実行する\ |           |           |           |
   |           |           |           | ボタンで\ |           |           |           |
   |           |           |           | す。『更\ |           |           |           |
   |           |           |           | 新あり』\ |           |           |           |
   |           |           |           | の場合に\ |           |           |           |
   |           |           |           | アクティ\ |           |           |           |
   |           |           |           | ブ化され\ |           |           |           |
   |           |           |           | ます。ク\ |           |           |           |
   |           |           |           | リックす\ |           |           |           |
   |           |           |           | ることで\ |           |           |           |
   |           |           |           | Terrafor\ |           |           |           |
   |           |           |           | mに登録さ\|           |           |           |
   |           |           |           | れている\ |           |           |           |
   |           |           |           | 対象のWo\ |           |           |           |
   |           |           |           | rkspaceの\|           |           |           |
   |           |           |           | Terraform\|           |           |           |
   |           |           |           | Vers\     |           |           |           |
   |           |           |           | ionを更新\|           |           |           |
   |           |           |           | します。  |           |           |           |
   |           |           +-----------+-----------+-----------+-----------+-----------+
   |           |           | 削除      | 削除を\   | ー        | ー        |           |
   |           |           |           | 実行する\ |           |           |           |
   |           |           |           | ボタンで\ |           |           |           |
   |           |           |           | す。『登\ |           |           |           |
   |           |           |           | 録済み』\ |           |           |           |
   |           |           |           | 『更新あ\ |           |           |           |
   |           |           |           | り』の場\ |           |           |           |
   |           |           |           | 合にアク\ |           |           |           |
   |           |           |           | ティブ化\ |           |           |           |
   |           |           |           | されます\ |           |           |           |
   |           |           |           | 。クリッ\ |           |           |           |
   |           |           |           | クするこ\ |           |           |           |
   |           |           |           | とでTerr\ |           |           |           |
   |           |           |           | aformに登\|           |           |           |
   |           |           |           | 録されて\ |           |           |           |
   |           |           |           | いる対象\ |           |           |           |
   |           |           |           | のWorksp\ |           |           |           |
   |           |           |           | aceを削除\|           |           |           |
   |           |           |           | します。  |           |           |           |
   |           |           |           |           |           |           |           |
   |           |           |           | ※Wo\      |           |           |           |
   |           |           |           | rkspaceを\|           |           |           |
   |           |           |           | 削除する\ |           |           |           |
   |           |           |           | とリソー\ |           |           |           |
   |           |           |           | スの削除\ |           |           |           |
   |           |           |           | は実行す\ |           |           |           |
   |           |           |           | ることが\ |           |           |           |
   |           |           |           | できませ\ |           |           |           |
   |           |           |           | ん。削除\ |           |           |           |
   |           |           |           | したWork\ |           |           |           |
   |           |           |           | spaceは元\|           |           |           |
   |           |           |           | に戻すこ\ |           |           |           |
   |           |           |           | とができ\ |           |           |           |
   |           |           |           | ません。  |           |           |           |
   |           +-----------+-----------+-----------+-----------+-----------+-----------+
   |           | リソ\                 | Workspac\ | ー        | ー        |           |         
   |           | ース削除              | eごとに構\|           |           |           |         
   |           |                       | 成・管理\ |           |           |           |         
   |           |                       | されたリ\ |           |           |           |         
   |           |                       | ソースの\ |           |           |           |         
   |           |                       | 削除を実\ |           |           |           |         
   |           |                       | 行するボ\ |           |           |           |         
   |           |                       | タンです\ |           |           |           |         
   |           |                       | 。『登録\ |           |           |           |         
   |           |                       | 済み』『\ |           |           |           |         
   |           |                       | 更新あり\ |           |           |           |         
   |           |                       | 』の場合\ |           |           |           |         
   |           |                       | にアクテ\ |           |           |           |         
   |           |                       | ィブ化さ\ |           |           |           |         
   |           |                       | れます。  |           |           |           |         
   |           |                       |           |           |           |           |         
   |           |                       | クリッ\   |           |           |           |         
   |           |                       | クすると\ |           |           |           |         
   |           |                       | 確認ダイ\ |           |           |           |         
   |           |                       | アログが\ |           |           |           |         
   |           |                       | 表示され[\|           |           |           |         
   |           |                       | OK]をクリ\|           |           |           |         
   |           |                       | ックする\ |           |           |           |         
   |           |                       | と「6.\   |           |           |           |         
   |           |                       | 2.15 作\  |           |           |           |         
   |           |                       | 業状態確\ |           |           |           |         
   |           |                       | 認」に遷\ |           |           |           |         
   |           |                       | 移し、対\ |           |           |           |         
   |           |                       | 象のWork\ |           |           |           |         
   |           |                       | spaceごと\|           |           |           |         
   |           |                       | に構成・\ |           |           |           |         
   |           |                       | 管理され\ |           |           |           |         
   |           |                       | たリソー\ |           |           |           |         
   |           |                       | スの削除\ |           |           |           |         
   |           |                       | が実行さ\ |           |           |           |         
   |           |                       | れます。  |           |           |           |         
   +-----------+-----------------------+-----------+-----------+-----------+-----------+
   | Mov\                              | 「 \      | ー        | ー        |           |
   | ement一覧                         | 6.2.4\    |           |           |           |
   |                                   | Movem\    |           |           |           |
   |                                   | ent一覧\  |           |           |           |
   |                                   | 」へ遷移\ |           |           |           |
   |                                   | するボタ\ |           |           |           |
   |                                   | ンです。  |           |           |           |
   +-----------------------------------+-----------+-----------+-----------+-----------+
   | P\                                | 「 \      | ー        | ー        |           |
   | olicySet- Workspace紐付管理       | 6.2.8\    |           |           |           |                      
   |                                   | PolicySet\|           |           |           |
   |                                   | -Policy紐\|           |           |           |
   |                                   | 付管理\   |           |           |           |
   |                                   | 」へ遷移\ |           |           |           |
   |                                   | するボタ\ |           |           |           |
   |                                   | ンです。  |           |           |           |
   +-----------------------------------+-----------+-----------+-----------+-----------+
   | 備考                              | 自由記述\ | ー        | 手動入力  | 最大長4\  |
   |                                   | 欄です。  |           |           | 000バイト |
   +-----------------------------------+-----------+-----------+-----------+-----------+

Movement一覧
************

#. | [Movement一覧]では、Movement名についてのメンテナンス（閲覧/登録/更新/廃止）を行います。
   | MovementはTerraform利用情報としてOrganization:Workspaceと紐付ける必要があるため、先に「6.2.2 Organizations管理 」「6.2.3 Workspaces管理 」で対象を登録しておく必要があります。

   ..  image:: saas/image16.png
       :alt: サブメニュー画面（Movement一覧）
       :width: 5.58715in
       :height: 2.50022in

   **図** **6.2.4-1 サブメニュー画面（Movement一覧）**

#. | 「登録」-「登録開始」ボタンより、Movement情報の登録を行います。

   ..  image:: saas/image17.png
       :alt: 登録画面（Movement一覧）
       :width: 5.232in
       :height: 1.56315in

   **図** **6.2.4-2 登録画面（Movement一覧）**

#. | Movement-Module紐付ボタンをクリックすると対象のMovementの「\ `6.2.10 Movement-Module紐付 <#Movement詳細>`__\ 」へ遷移します。

   ..  image:: saas/image18.png
       :alt: サブメニュー画面（Movement一覧）
       :width: 5.9018in
       :height: 1.23912in

   **図** **6.2.4-3サブメニュー画面（Movement一覧）**

#. | Movement一覧画面の項目は以下の通りです。

.. table:: 6.2.4-1 項目一覧（Movement一覧)
   
   +-----------------------+-----------+-----------+-----------+-----------+
   | 項目                  | 説明      | 入力必須  | 入\       | 制\       |
   |                       |           |           | 力形式    | 約事項    |
   +=======================+===========+===========+===========+===========+
   | M\                    | Mov\      | ○         | 手動入力  | 最大長\   |
   | ovement名             | ementの名\|           |           | 256バイト |
   |                       | 称を入力  |           |           |           |
   |                       | します。  |           |           |           |
   +-----------------------+-----------+-----------+-----------+-----------+
   | オーケス\             | 『\       | ー        | ー        | ー        |
   | トレータ              | Terrafor\ |           |           |           |
   |                       | m』が自動\|           |           |           |
   |                       | で入力さ\ |           |           |           |
   |                       | れます。  |           |           |           |
   +-----------------------+-----------+-----------+-----------+-----------+
   | 遅延\                 | Mov\      | ー        | 手動入力  | ー        |
   | タイマー              | ementが指\|           |           |           |
   |                       | 定期間遅\ |           |           |           |
   |                       | 延した場\ |           |           |           |
   |                       | 合にステ\ |           |           |           |
   |                       | ータスを\ |           |           |           |
   |                       | 遅延とし\ |           |           |           |
   |                       | て警告表\ |           |           |           |
   |                       | 示したい\ |           |           |           |
   |                       | 場合に指\ |           |           |           |
   |                       | 定期間(1\ |           |           |           |
   |                       | ～)を入力\|           |           |           |
   |                       | します。  |           |           |           |
   |                       | (単位:分)\|           |           |           |
   |                       |           |           |           |           |
   |                       | 未入力の\ |           |           |           |
   |                       | 場合は警\ |           |           |           |
   |                       | 告表示し\ |           |           |           |
   |                       | ません。  |           |           |           |
   +-----------+-----------+-----------+-----------+-----------+-----------+
   | Terrafor\ | Organ\    | 「 \      | ○         | リ\       |           |
   | m利用情報 | ization:\ | 6.2.3\    |           | スト選択  |           |
   |           | Workspace | W\        |           |           |           |
   |           |           | orkspaces\|           |           |           |
   |           |           | 管理 」\  |           |           |           |
   |           |           | にて登録\ |           |           |           |
   |           |           | した（Or\ |           |           |           |
   |           |           | ganizatio\|           |           |           |
   |           |           | nと紐付く\|           |           |           |
   |           |           | ）Worksp\ |           |           |           |
   |           |           | aceを選択\|           |           |           |
   |           |           | します。  |           |           |           |
   +-----------+-----------+-----------+-----------+-----------+-----------+
   | M\                    | 「\       | ー        | ー        |           |
   | ovement-M\            | \ `6.2.10\|           |           |           |
   | odule紐付             | Mov\      |           |           |           |
   |                       | ement-Mod\|           |           |           |
   |                       | ule紐付 <\|           |           |           |
   |                       | #Movement\|           |           |           |
   |                       | 詳細>`__\ |           |           |           |
   |                       | 」へ遷移\ |           |           |           |
   |                       | するボタ\ |           |           |           |
   |                       | ンです。  |           |           |           |
   +-----------------------+-----------+-----------+-----------+-----------+
   | 備考                  | 自由記述\ | ー        | 手動入力  | 最大長4\  |
   |                       | 欄です。  |           |           | 000バイト |
   +-----------------------+-----------+-----------+-----------+-----------+

Module素材集
************

#. |  [Module素材集]ではユーザーが作成したModuleのメンテナンス（閲覧/登録/更新/廃止）を行います。
   |  Moduleの記述などに関しては、「 7.1 Moduleの記述」を参照してください。

   ..  image:: saas/image19.png
       :alt: サブメニュー画面（Module素材集）  
       :width: 5.90718in
       :height: 2.62023in

   **図** **6.2.5-1サブメニュー画面（Module素材集）**

#. | 「登録」-「登録開始」ボタンより、Movement情報の登録を行います。

   .. image:: saas/image20.png
      :alt: 登録画面（Module素材集）  
      :width: 4.984in
      :height: 1.55941in

   **図** **6.2.5-2 登録画面（Module素材集）**

   | 「登録」の前に、「Module素材」を「事前アップロード（①）」してください。「アップロード状況（②）」にModuleのファイル名が表示されたのを確認してから、「登録」ボタンを押してください。

   ..  image:: saas/image21.png
       :width: 1.95218in
       :height: 1.22404in

#. | Movement-Module紐付ボタンをクリックすると対象のMovementの「\ `6.2.10 Movement-Module紐付 <#Movement詳細>`__\ 」へ遷移します。

   .. image:: saas/image22.png
      :alt: サブメニュー画面（Module素材集）
      :width: 6.11143in
      :height: 1.23572in

   **図** **6.2.5-3 サブメニュー画面（Module素材集）**

#. | Module素材集の項目一覧は以下のとおりです。

.. table:: 6.2.5-1 項目一覧（Module素材集）
   
   +-------------+-------------+----------+-------------+-------------+
   | 項目        |  説明       | 入力必須 | 入力形式    | 制約事項    |
   |             |             |          |             |             |
   +=============+=============+==========+=============+=============+
   | M\          | ITAで管\    | ○        | 手動入力    | 最大\       |
   | odule素材名 | 理するModul\|          |             | 長256バイト |
   |             | e素材名を入\|          |             |             |
   |             | 力します。  |          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | Module素材\ | 作\         | ○        | フ\         | 最大サイ\   |
   |             | 成したModul\|          | ァイル選択  | ズ4Gバイト  |
   |             | eファイルを\|          |             |             |
   |             | アップロー\ |          |             |             |
   |             | ドします。  |          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | Movement\   | 「6.2.10 \  | ー       | ー          |             |
   | -Module紐付 | M\          |          |             |             |
   |             | ovement-Mod\|          |             |             |
   |             | ule紐付\    |          |             |             |
   |             | へ遷移する\ |          |             |             |
   |             | ボタンです。|          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | 備考        | 自由記\     | ー       | 手動入力    | 最大長\     |
   |             | 述欄です。  |          |             | 4000バイト  |
   +-------------+-------------+----------+-------------+-------------+

#. | BackYardの処理でModuleファイル内に定義している変数を抜出します。
   | 抜出した変数は「6.2.12 代入値自動登録」や「6.2.13 代入値管理」で具体値の登録が可能になります。
   | 抜出するタイミングはリアルタイムではありませんので「6.2.12 代入値自動登録」や「6.2.13 代入値管理」で変数が扱えるまでに時間がかかる\ ※１ 場合があります。

   | ※1 抜出のタイミングは「8.2 メンテナンス方法について」の「③起動周期の変更」に記載していますので、そちらをご参照ください。


Policies管理
************

#. | [Policies管理]ではユーザーが作成したPolicyのメンテナンス（閲覧/登録/更新/廃止）を行います。
   | Policyの記述など関しては、「7.2 Policyの記述 」を参照してください。

   .. image:: saas/image23.png
      :alt: サブメニュー画面（Policies管理）
      :width: 4.97376in
      :height: 2.22019in

   **図** **6.2.6-1 サブメニュー画面（Policies管理）**

#. | 「登録」-「登録開始」ボタンより、Policyの登録を行います。

   .. image:: saas/image24.png
      :alt: 登録画面（Policies管理）
      :width: 5.016in
      :height: 1.55049in
   
   **図** **6.2.6-2 登録画面（Policies管理）**

   | 「登録」の前に、「Policy素材」を「事前アップロード（①）」してください。
   | 「アップロード状況（②）」にPlaybookのファイル名が表示されたのを確認してから、「登録」ボタンを押してください。

   .. image:: saas/image25.png
      :width: 1.91028in
      :height: 1.265in

#. | PolicySet-Policy紐付管理ボタンをクリックすると、「6.2.8 PolicySet-Policy紐付管理 」へ遷移します。
 
   ..  image:: saas/image26.png
       :alt: サブメニュー画面（Policies管理）
       :width: 5.24654in
       :height: 1.21858in

   **図** **6.2.6-3 サブメニュー画面（Policies管理）**

#. | Policies管理の項目一覧は以下のとおりです。

.. table::  6.2.6-1項目一覧（Policies管理）
   
   +-------------+-------------+----------+-------------+-------------+
   | 項目        |  説明       | 入力必須 | 入力形式    | 制約事項    |
   |             |             |          |             |             |
   +=============+=============+==========+=============+=============+
   | Policy名    | ITA\        | ○        | 手動入力    | 最大\       |
   |             | で管理するP\|          |             | 長256バイト |
   |             | olicy名を入\|          |             |             |
   |             | 力します。  |          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | Policy素材  | 作\         | ○        | フ\         | 最大サイ\   |
   |             | 成したPolic\|          | ァイル選択  | ズ4Gバイト  |
   |             | yファイルを\|          |             |             |
   |             | アップロー\ |          |             |             |
   |             | ドします。  |          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | Po\         | 「6.2.8\    | ー       | ー          |             |
   | licySet-Pol\| PolicySet\  |          |             |             |
   | icy紐付管理 | -Policy紐付\|          |             |             |
   |             | 管理 」へ\  |          |             |             |
   |             | 遷移するボ  |          |             |             |
   |             | タンです。  |          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | 備考        | 自由記\     | ー       | 手動入力    | 最大長\     |
   |             | 述欄です。  |          |             | 4000バイト  |
   +-------------+-------------+----------+-------------+-------------+


Policy Sets管理
***************

1. | [Policy Sets管理]ではPolicySetのメンテナンス（閲覧/登録/更新/廃止）を行います。
   | Policy Setは「6.2.8 PolicySet-Policy紐付管理 」「6.2.9 PolicySet-Workspace紐付管理 」でPolicyおよびWorkspaceと紐付けることで、作業実行時にWorkspaceに対してPolicyを適用させます。

   .. image:: saas/image27.png
      :alt: サブメニュー画面（Policy Sets管理）
      :width: 5.54715in
      :height: 2.47355in

   **図** **6.2.7-1 サブメニュー画面（Policy Sets管理）**

2. | 「登録」-「登録開始」ボタンより、PolicySetの登録を行います。

   ..  image:: saas/image28.png
       :alt: 登録画面（Policy Sets管理）
       :width: 5.54715in
       :height: 1.4908in

   **図** **6.2.7-2 登録画面（Policy Sets管理）**

3. |  PolicySet-Policy紐付管理ボタンをクリックすると、「6.2.8 PolicySet-Policy紐付管理」へ遷移します。
   | また、PolicySet-Workspaces紐付管理ボタンをクリックすると、「6.2.9 PolicySet-Workspace紐付管理 」へ遷移します。

   .. image:: saas/image29.png
      :alt: サブメニュー画面（Policy Sets管理）
      :width: 5.80969in
      :height: 1.22063in

   **図** **6.2.7-3 サブメニュー画面（Policy Sets管理）**

4. |  Policy Sets管理の項目一覧は以下のとおりです。

.. table:: 6.2.7-1 項目一覧（PolicySets管理）
   
   +-------------+-------------+----------+-------------+-------------+
   | 項目        |  説明       | 入力必須 | 入力形式    | 制約事項    |
   |             |             |          |             |             |
   +=============+=============+==========+=============+=============+
   | PolicySet名 | ITAで管\    | ○        | 手動入力    | 最大        |
   |             | 理するPoli\ |          |             | 長256バイト |
   |             | cySet名を入\|          |             |             |
   |             | 力します。  |          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | Po\         | 「6.2.8 \   | ー       | ー          |             |
   | licySet-Pol\| PolicySet\  |          |             |             |
   | icy紐付管理 | -Policy紐付\|          |             |             |
   |             | 管理 」へ\  |          |             |             |
   |             | 遷移するボ\ |          |             |             |
   |             | タンです。  |          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | Policy\     | 「6.2.9 \   | ー       | ー          |             |
   | Set-Workspa\| P\          |          |             |             |
   | ces紐付管理 | olicySet-Wo\|          |             |             |
   |             | rkspace紐付\|          |             |             |
   |             | 管理 」へ\  |          |             |             |
   |             | 遷移するボ\ |          |             |             |
   |             | タンです。  |          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | 備考        | 自由記\     | ー       | 手動入力    | 最大長\     |
   |             | 述欄です。  |          |             | 4000バイト  |
   +-------------+-------------+----------+-------------+-------------+


PolicySet-Policy紐付管理
************************

#. | [PolicySet-Policy紐付管理]では、「6.2.6 Policies管理 」で作成したPolicyと「6.2.7 PolicySets管理」で作成したPolicySetの紐付けについてメンテナンス（閲覧/登録/更新/廃止）を行います。

   .. image:: saas/image30.png
      :alt: サブメニュー画面（PolicySet-Policy紐付管理）
      :width: 5.7205in
      :height: 2.55355in

   **図** **6.2.8-1 サブメニュー画面（PolicySet-Policy紐付管理）**

#. | 「登録」-「登録開始」ボタンより、PolicySet-Policy紐付の登録を行います。

   .. image:: saas/image31.png
      :alt: 登録画面（PolicySet-Policy紐付管理）
      :width: 4.72317in
      :height: 1.27535in

   **図** **6.2.8-2 登録画面（PolicySet-Policy紐付管理）**

#. | Policy Setのリンクをクリックすると、対象の「6.2.7 PolicySets管理 」へ遷移します。

   | また、Policyのリンクをクリックすると、対象の「6.2.6 Policies管理 」へ遷移します。

   .. image:: saas/image32.png
      :alt: サブメニュー画面（PolicySet-Policy紐付管理）
      :width: 6.03866in
      :height: 1.23699in

   **図** **6.2.8-3 サブメニュー画面（PolicySet-Policy紐付管理）**

#. | PolicySet-Policy紐付管理の項目一覧は以下のとおりです。

.. table:: 6.2.8-1 項目一覧（PolicySet-Policy紐付け管理）
   
   +------------+--------------+----------+--------------+--------------+
   | 項目       |  説明        | 入力必須 | 入力形式     | 制約事項     |
   |            |              |          |              |              |
   +============+==============+==========+==============+==============+
   | Policy Set | 「6.2.7 \    | ○        | リスト選択   |              |
   |            | Policy\      |          |              |              |
   |            | Sets管\      |          |              |              |
   |            | 理\ 」にて\  |          |              |              |
   |            | 登録したをP\ |          |              |              |
   |            | olicySet名を\|          |              |              |
   |            | 選択します。 |          |              |              |
   +------------+--------------+----------+--------------+--------------+
   | Policy     | 「6.2.6 \    | ○        | リスト選択   |              |
   |            | Polic\       |          |              |              |
   |            | ies管理 」\  |          |              |              |
   |            | にて登録した\|          |              |              |
   |            | をPolicy名を\|          |              |              |
   |            | 選択します。 |          |              |              |
   +------------+--------------+----------+--------------+--------------+
   | 備考       | 自由\        | ー       | 手動入力     | 最大\        |
   |            | 記述欄です。 |          |              | 長4000バイト |
   +------------+--------------+----------+--------------+--------------+

PolicySet-Workspace紐付管理
***************************

#. | [PolicySet-Workspace紐付管理]では、「6.2.3 Workspaces管理 」で作成したWorkspaceと「6.2.7 PolicSets管理 」で作成したPolicySetの紐付けについてメンテナンス（閲覧/登録/更新/廃止）を行います。

   .. image:: saas/image33.png
      :alt: サブメニュー画面（PolicySet-Workspace紐付管理）
      :width: 5.74716in
      :height: 2.54022in

   **図** **6.2.9-1 サブメニュー画面（PolicySet-Workspace紐付管理）**

#. | 「登録」-「登録開始」ボタンより、PolicySet-Workspace紐付の登録を行います。

   .. image:: saas/image34.png
      :alt: 登録画面（PolicySet-Workspace紐付管理）
      :width: 4.8277in
      :height: 1.424in

   **図** **6.2.9-2 登録画面（PolicySet-Workspace紐付管理）**

#. | Policy Setのリンクをクリックすると、対象の「6.2.7 PolicySets管理 」へ遷移します。
   | また、Organization:Workspaceのリンクをクリックすると、対象の「6.2.3 Workspaces管理 」へ遷移します。

   .. image:: saas/image35.png
      :alt: サブメニュー画面（PolicySet-Workspace紐付管理）
      :width: 6.20917in
      :height: 1.28372in

   **図** **6.2.9-3 サブメニュー画面（PolicySet-Workspace紐付管理）**

#. | PolicySet-Workspace紐付管理の項目一覧は以下のとおりです。

.. table::  6.2.9-1 項目一覧（PolicySet-Workspace紐付け管理）
   
   +-------------+-------------+----------+-------------+-------------+
   | 項目        | 説明        | 入力必須 | 入力形式    | 制約事項    |
   |             |             |          |             |             |
   +=============+=============+==========+=============+=============+
   | Policy Set  | 「6.2.7 \   | ○        | リスト選択  |             |
   |             | Policy\     |          |             |             |
   |             | Sets管理\   |          |             |             |
   |             | 」にて登録\ |          |             |             |
   |             | したをPoli\ |          |             |             |
   |             | cySet名を選\|          |             |             |
   |             | 択します。  |          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | Organizatio\| 「6.2.3 \   | ○        | リスト選択  |             |
   | n:Workspace | Wor\        |          |             |             |
   |             | kspaces管理\|          |             |             |
   |             | 」にて登\   |          |             |             |
   |             | 録した（Org\|          |             |             |
   |             | anizationと\|          |             |             |
   |             | 紐付く）Wo\ |          |             |             |
   |             | rkspaceを選\|          |             |             |
   |             | 択します。  |          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | 備考        | 自由記\     | ー       | 手動入力    | 最大長\     |
   |             | 述欄です。  |          |             | 4000バイト  |
   +-------------+-------------+----------+-------------+-------------+

Movement-Module紐付
*******************

#. | [Movement-Module紐付]では、Movementで実行するModule素材のメンテナンス（閲覧/登録/更新/廃止）を行います。
   | Movementに対して複数のModule素材を紐付けることが可能です。

   .. image:: saas/image36.png
      :alt: サブメニュー画面（Movement-Module紐付）
      :width: 5.62715in
      :height: 2.50022in

   **図** **6.2.10-1 サブメニュー画面（Movement-Module紐付）**

#. | 「登録」-「登録開始」ボタンより、Movement-Module紐付の登録を行います。

   .. image:: saas/image37.png
      :alt: 登録画面（Movement-Module紐付）
      :width: 5.528in
      :height: 1.50353in

   **図** **6.2.10-2 登録画面（Movement-Module紐付）**


#. |  Movementのリンクをクリックすると、「6.2.4 Movement一覧 」へ遷移します。
   | また、Module素材のリンクをクリックすると、「6.2.5 Module素材集 」へ遷移します。

   .. image:: saas/image38.png
      :alt: サブメニュー画面（MovementMo-dule紐付
      :width: 6.04485in
      :height: 1.23292in

   **図** **6.2.10-3 サブメニュー画面（Movement-Module紐付）**

#. | Movement-Module紐付の項目一覧は以下のとおりです。

.. table:: 6.2.10-1項目一覧（Movement-Module紐付）
   
   +------------+--------------+----------+--------------+--------------+
   | 項目       | 説明         | 入力必須 | 入力形式     | 制約事項     |
   |            |              |          |              |              |
   +============+==============+==========+==============+==============+
   | Movement   | 「6.2.4\     | ○        | リスト選択   | ー           |
   |            | Mov\         |          |              |              |
   |            | ement一覧\   |          |              |              |
   |            | 」にて登録し\|          |              |              |
   |            | たMovementを\|          |              |              |
   |            | 選択します。 |          |              |              |
   +------------+--------------+----------+--------------+--------------+
   | Module素材 | 「6.2.5\     | ○        | リスト選択   | ー           |
   |            | Mod\         |          |              |              |
   |            | ule素材集\   |          |              |              |
   |            | 」で登録した\|          |              |              |
   |            | Module素材を\|          |              |              |
   |            | 選択します。 |          |              |              |
   +------------+--------------+----------+--------------+--------------+
   | 備考       | 自由\        | ー       | 手動入力     | 最大\        |
   |            | 記述欄です。 |          |              | 長4000バイト |
   +------------+--------------+----------+--------------+--------------+

変数ネスト管理
**************

1. | [変数ネスト管理]では、Module素材集で登録したtfファイルで定義されている変数のタイプがlist,setかつ、その変数の中でlist,set,tuple,objectが定義されている場合、メンバー変数の最大繰返数を閲覧及び更新できます。
   | 本メニューはModule素材集を元にBackYardがレコードを管理するため、登録・廃止・復活はできません。  
   | 変数ネストの管理対象については「9.1 Module素材記入例」をご参照ください。

   | 変数ネストの管理フロー例については「9.2変数ネスト管理フロー例」をご参照ください。

   .. image:: saas/image39.png
      :alt: サブメニュー画面（変数ネスト管理）
      :width: 6.69236in
      :height: 2.92917in

   **図** **6.2.11-1 サブメニュー画面（変数ネスト管理）**

| Module素材と変数ネスト管理登録例

   
- Module素材（tfファイル）と登録値

.. code-block:: bash 

   variable "VAR_hoge" {
       type = list(
          object({
              IP = string,
              NAME = string
          })
      )
      default = [
          { “IP” = “127.0.0.1”, “NAME” = “machine_01” },
          { “IP” = “127.0.0.2”, “NAME” = “machine_02” }
      ]
   }
   

.. list-table:: 変数ネスト管理
   :widths: 10 10 10 10
   :header-rows: 1
   :align: left

   * - 項番
     - 変数名
     - メンバー変数
     - 最大繰返数
   * - 1
     - VAR_hoge
     - 
     - 2

2. | 「一覧」-「更新」ボタンより最大繰返数の更新を行います。

   .. image:: saas/image40.png
      :alt: 更新画面（変数ネスト管理）
      :width: 6.69236in
      :height: 1.16181in

   **図** **6.2.11-2 更新画面（変数ネスト管理）**

3. | 項目一覧は以下の通りです。

.. table:: 変数ネスト管理

   +-------------+-------------+----------+-------------+-------------+
   | 項目        | 説明        | 入力必須 | 入力形式    | 制約事項    |
   |             |             |          |             |             |
   +=============+=============+==========+=============+=============+
   | 変数名      | Moveme\     | ー       | 入力不可    |             |
   |             | nt-Module紐\|          |             |             |
   |             | 付で登録し\ |          |             |             |
   |             | た資材で使\ |          |             |             |
   |             | 用している\ |          |             |             |
   |             | 変数が表示\ |          |             |             |
   |             | されます。  |          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | メンバ\     | 変数ネスト\ | ー       | 入力不可    |             |
   | ー変数名（\ | 管理対象が\ |          |             |             |
   | 繰返し有）  | メンバー変\ |          |             |             |
   |             | 数である場\ |          |             |             |
   |             | 合、メンバ\ |          |             |             |
   |             | ー変数名が\ |          |             |             |
   |             | 表示されま\ |          |             |             |
   |             | す。メンバ\ |          |             |             |
   |             | ー変数名は\ |          |             |             |
   |             | 各階層の変\ |          |             |             |
   |             | 数を「.」で\|          |             |             |
   |             | 連結して表\ |          |             |             |
   |             | 示します。  |          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | 最大繰返数  | 配列の最\   | ○        | 手動入力    | 入力値\     |
   |             | 大繰返数を1\|          |             | 1～\        |
   |             | ～99,999,99\|          |             | 99,999,999  |
   |             | 9の範囲で入\|          |             |             |
   |             | 力します。  |          |             |             |
   |             |             |          |             |             |
   |             | 初期値は\   |          |             |             |
   |             | tfファイル\ |          |             |             |
   |             | のdefaultに\|          |             |             |
   |             | 記載されて\ |          |             |             |
   |             | いる値から\ |          |             |             |
   |             | 取得した繰\ |          |             |             |
   |             | 返数が設定\ |          |             |             |
   |             | されます。  |          |             |             |
   |             |             |          |             |             |
   |             | t\          |          |             |             |
   |             | fファイルに\|          |             |             |
   |             | defaultの記\|          |             |             |
   |             | 載がない場\ |          |             |             |
   |             | 合、1が設定\|          |             |             |
   |             | されます。  |          |             |             |
   |             |             |          |             |             |
   |             | 最終更新\   |          |             |             |
   |             | 者が「Terr\ |          |             |             |
   |             | aform変数更\|          |             |             |
   |             | 新プロシー\ |          |             |             |
   |             | ジャ」でな\ |          |             |             |
   |             | い場合はMod\|          |             |             |
   |             | ule素材の更\|          |             |             |
   |             | 新により値\ |          |             |             |
   |             | が変更され\ |          |             |             |
   |             | ることはあ\ |          |             |             |
   |             | りません。  |          |             |             |
   +-------------+-------------+----------+-------------+-------------+
   | 備考        | 自由記\     | ー       | 手動入力    | 最大長\     |
   |             | 述欄です。  |          |             | 4000バイト  |
   +-------------+-------------+----------+-------------+-------------+

| ※初期登録および繰返数の更新はリアルタイムではないので、「6.2.12 代入値自動登録」や「6.2.13 代入値管理」で変数が扱えるまでに時間がかかる場合があります。
| 初期登録および繰返数の更新タイミングは「8.2メンテナンス方法について」に記載していますので、そちらをご参照ください。

4. | アクセス許可ロール
   | 変数ネスト管理に設定されるアクセス許可ロールは、該当の変数が定義されているModule素材集のアクセス許可ロールが設定されます。

代入値自動登録設定
******************

#. | [代入値自動登録]では、メニュー作成機能で作成したパラメータシート（オペレーションあり）と、Movementの変数を紐付けます。
   | 登録した情報はBackYardの処理により代入値管理に反映されます。

   | BackYardコンテンツ (2)代入値自動登録設定 に反映ルールを記載しています。

   .. image:: saas/image41.png
      :alt: サブメニュー画面（代入値自動登録）
      :width: 5.17378in
      :height: 2.47355in

   **図** **6.2.11-1 サブメニュー画面（代入値自動登録）**

#. | 「登録」-「登録開始」ボタンより、代入値管理を行います。

   .. image:: saas/image42.png
      :alt: 登録画面（代入値自動登録）
      :width: 5.14552in
      :height: 1.53333in

   **図** **6.2.11-2登録画面（代入値自動登録）**

#. | メニューIDまたは、メニュー名のリンクをクリックすると、対象のメニューへ遷移します。

   .. image:: saas/image43.png
      :alt: サブメニュー画面（代入値自動登録)
      :width: 6.69236in
      :height: 1.13681in

   **図** **6.2.11-3サブメニュー画面（代入値自動登録）**

#. | 登録画面の項目一覧は以下のとおりです。

.. table:: 6.2.11-1 項目一覧（代入値自動登録）
   
   +---------------------+----------+----------+----------+----------+
   | カラム              | 説明     | 入\      | 入 \     | 制\      |
   |                     |          | 力必須   | 力形式   | 約事項   |
   +=====================+==========+==========+==========+==========+
   | メ\                 | メニュ\  | ○        | リ\      |          |
   | ニューグ\           | ー作成機\|          | スト選択 |          |
   | ループ：\           | 能で作成\|          |          |          |
   | メニュー            | したパラ\|          |          |          |
   |                     | メータシ\|          |          |          |
   |                     | ート（オ\|          |          |          |
   |                     | ペレーシ\|          |          |          |
   |                     | ョンあり\|          |          |          |
   |                     | ）が表示\|          |          |          |
   |                     | さ\      |          |          |          |
   |                     | れます。 |          |          |          |
   |                     | 該当\    |          |          |          |
   |                     | のパラメ\|          |          |          |
   |                     | ータシー\|          |          |          |
   |                     | トを選択\|          |          |          |
   |                     | します。 |          |          |          |
   +---------------------+----------+----------+----------+----------+
   | 項目                | 選択し\  | ○        | リ\      |          |
   |                     | たパラメ\|          | スト選択 |          |
   |                     | ータシー\|          |          |          |
   |                     | トの項目\|          |          |          |
   |                     | が表示さ\|          |          |          |
   |                     | れます。 |          |          |          |
   |                     | 対象の項\|          |          |          |
   |                     | 目を選択\|          |          |          |
   |                     | します。 |          |          |          |
   +---------------------+----------+----------+----------+----------+
   | 登録方式            | Value\   | ○        | リ\      |          |
   |                     | 型：項\  |          | スト選択 |          |
   |                     | 目の設定\|          |          |          |
   |                     | 値を紐付\|          |          |          |
   |                     | けた変数\|          |          |          |
   |                     | の具体値\|          |          |          |
   |                     | とする場\|          |          |          |
   |                     | 合に選択\|          |          |          |
   |                     | します。 |          |          |          |
   |                     |          |          |          |          |
   |                     | Key \    |          |          |          |
   |                     | 型：\    |          |          |          |
   |                     | 項目の名\|          |          |          |
   |                     | 称を紐付\|          |          |          |
   |                     | けた変数\|          |          |          |
   |                     | の具体値\|          |          |          |
   |                     | とする場\|          |          |          |
   |                     | 合に選択\|          |          |          |
   |                     | します。 |          |          |          |
   |                     |          |          |          |          |
   |                     | 項目\    |          |          |          |
   |                     | の設定値\|          |          |          |
   |                     | が空白の\|          |          |          |
   |                     | 場合は紐\|          |          |          |
   |                     | 付け対象\|          |          |          |
   |                     | 外となり |          |          |          |
   |                     | ます。   |          |          |          |
   |                     |          |          |          |          |
   |                     | K\       |          |          |          |
   |                     | ey-Value\|          |          |          |
   |                     | 型：項\  |          |          |          |
   |                     | 目の名称\|          |          |          |
   |                     | (Key)と\ |          |          |          |
   |                     | 設定値(\ |          |          |          |
   |                     | Value)を\|          |          |          |
   |                     |          |          |          |          |
   |                     | 紐付\    |          |          |          |
   |                     | けた変数\|          |          |          |
   |                     | の具体値\|          |          |          |
   |                     | とする場\|          |          |          |
   |                     | 合に選択\|          |          |          |
   |                     | します。 |          |          |          |
   +---------------------+----------+----------+----------+----------+
   | Movement            | Movement\| ○        | リ\      |          |
   |                     | 一覧で\  |          | スト選択 |          |
   |                     | 登録した\|          |          |          |
   |                     | Movement\|          |          |          |
   |                     | が表示さ\|          |          |          |
   |                     | れます。 |          |          |          |
   |                     | Movement\|          |          |          |
   |                     | を選択\  |          |          |          |
   |                     | します。 |          |          |          |
   +----------+----------+----------+----------+----------+----------+
   | Key\     | 変数名   | Mov\     | ○        | リ\      | 登録方式\|
   | 情報     |          | ement-Mo\|          | スト選択 | でKey型  |
   |          |          | dule紐付\|          |          |          |
   |          |          | で登録し\|          |          | また\    |
   |          |          | た資材で\|          |          | はKey-V\ |
   |          |          | 使用して\|          |          | alue型を\|
   |          |          | いる変数 |          |          | 選\      |
   |          |          | が表示さ |          |          | 択した場\|
   |          |          | れます。 |          |          | 合は必須\|
   |          |          |          |          |          |          |
   |          |          | Key\     |          |          |          |
   |          |          | 型で具体\|          |          |          |
   |          |          | 値に紐付\|          |          |          |
   |          |          | けたい変\|          |          |          |
   |          |          | 数を選択\|          |          |          |
   |          |          | します。 |          |          |          |
   |          +----------+----------+----------+----------+----------+
   |          | メン\    | メンバー\| 変数名に\| リ\      |          |
   |          | バー変数 | 変数を持\| より変動 | スト選択 |          |
   |          |          | つ変数名\|          |          |          |
   |          |          | を選択し\|          |          |          |
   |          |          | た場合に\|          |          |          |
   |          |          | メン\    |          |          |          |
   |          |          | バー変数\|          |          |          |
   |          |          | が表示さ\|          |          |          |
   |          |          | れます。 |          |          |          |
   |          |          |          |          |          |          |
   |          |          | メ\      |          |          |          |
   |          |          | ンバー変\|          |          |          |
   |          |          | 数を選択\|          |          |          |
   |          |          | します。 |          |          |          |
   |          +----------+----------+----------+----------+----------+
   |          | 代入順序 | 複\      | 変数名に\| 手動入力 | ブランク |
   |          |          | 数具体値\| より変動 |          |          |
   |          |          | が設定で\|          |          | または、 |
   |          |          | きる変数\|          |          |          |
   |          |          | 名の場合\|          |          | 正の整数 |
   |          |          | のみ必須\|          |          |          |
   |          |          | 入力にな\|          |          |          |
   |          |          | ります。 |          |          |          |
   |          |          |          |          |          |          |
   |          |          | 具体値\  |          |          |          |
   |          |          | の代入順\|          |          |          |
   |          |          | 序（1～\ |          |          |          |
   |          |          | ）を入力\|          |          |          |
   |          |          | します。 |          |          |          |
   |          |          | 入力値に\|          |          |          |
   |          |          | 従い昇順\|          |          |          |
   |          |          | で代入さ\|          |          |          |
   |          |          | れます。 |          |          |          |
   +----------+----------+----------+----------+----------+----------+
   | Value\   | 変数名   | Mov\     | ○        | リ\      | 登\      |
   | 情報     |          | ement-Mo\|          | スト選択 | 録方式で\|
   |          |          | dule紐付\|          |          | Value型\ |
   |          |          | で登録し\|          |          | また\    |
   |          |          | た資材で\|          |          | はKey-V\ |
   |          |          | 使用して\|          |          | alue型を\|
   |          |          | いる変数\|          |          | 選\      |
   |          |          | が表示さ\|          |          | 択した場\|
   |          |          | れます。 |          |          | 合は必須 |
   |          |          |          |          |          |          |
   |          |          | Value\   |          |          |          |
   |          |          | 型で具体\|          |          |          |
   |          |          | 値に紐付\|          |          |          |
   |          |          | けたい変\|          |          |          |
   |          |          | 数を選択\|          |          |          |
   |          |          | します。 |          |          |          |
   |          +----------+----------+----------+----------+----------+
   |          | HCL設定  | 「\      | ○        | リ\      | 選\      |
   |          |          | OFF」ま\ |          | スト選択 | 択した変\|
   |          |          | たは「ON\|          |          | 数名がm\ |
   |          |          | 」を選択\|          |          | ap型の場\|
   |          |          | します。 |          |          | 合はONで\|
   |          |          |          |          |          | 設定する\|
   |          |          | BackYard\|          |          | 必要があ\|
   |          |          | の処理に\|          |          | ります。 |
   |          |          | より代入\|          |          |          |
   |          |          | 値管理に\|          |          | オペレ\  |
   |          |          | 反映する\|          |          | ーション\|
   |          |          | 際、選択\|          |          | 、Moveme\|
   |          |          | した値が\|          |          | nt、変数\|
   |          |          | 引き継が\|          |          | 名が一致\|
   |          |          | れます。 |          |          | している\|
   |          |          |          |          |          | 場合、H\ |
   |          |          |          |          |          | CL設定は\|
   |          |          |          |          |          | ONまたは\|
   |          |          |          |          |          | OFFに統\ |
   |          |          |          |          |          | 一してく\|
   |          |          |          |          |          | ださい。 |
   |          +----------+----------+----------+----------+----------+
   |          | メン\    | メンバー\| 変数名に\| リ\      |          |
   |          | バー変数 | 変数を持\| より変動 | スト選択 |          |
   |          |          | つ変数名\|          |          |          |
   |          |          | を選択し\|          |          |          |
   |          |          | た場合に\|          |          |          |
   |          |          | メン\    |          |          |          |
   |          |          | バー変数\|          |          |          |
   |          |          | が表示さ\|          |          |          |
   |          |          | れます。 |          |          |          |
   |          |          |          |          |          |          |
   |          |          | メ\      |          |          |          |
   |          |          | ンバー変\|          |          |          |
   |          |          | 数を選択\|          |          |          |
   |          |          | します。 |          |          |          |
   |          +----------+----------+----------+----------+----------+
   |          | 代入順序 | 複\      | 変数名に\| 手動入力 | ブランク |
   |          |          | 数具体値\| より変動 |          | または、\|
   |          |          | が設定で\|          |          | 正の整数\|
   |          |          | きる変数\|          |          |          |
   |          |          | 名の場合\|          |          |          |
   |          |          | のみ必須\|          |          |          |
   |          |          | 入力にな\|          |          |          |
   |          |          | ります。 |          |          |          |
   |          |          |          |          |          |          |
   |          |          | 具体値   |          |          |          |
   |          |          | の代入順 |          |          |          |
   |          |          | 序（1～  |          |          |          |
   |          |          | ）を入力 |          |          |          |
   |          |          | します。 |          |          |          |
   |          |          | 入力値に |          |          |          |
   |          |          | 従い昇順 |          |          |          |
   |          |          | で代入さ |          |          |          |
   |          |          | れます。 |          |          |          |
   +----------+----------+----------+----------+----------+----------+
   | NULL連携            | パラ\    | ー       | リ\      | ー       |          
   |                     | メータシ\|          | スト選択 |          |          
   |                     | ートの具\|          |          |          |          
   |                     | 体値がNU\|          |          |          |          
   |                     | LL(空白)\|          |          |          |          
   |                     | の場合に\|          |          |          |          
   |                     | 、代入値\|          |          |          |          
   |                     | 管理への\|          |          |          |          
   |                     | 登録をNU\|          |          |          |          
   |                     | LL(空白)\|          |          |          |          
   |                     | の値で行\|          |          |          |          
   |                     | うか設定\|          |          |          |          
   |                     | します。 |          |          |          |          
   |                     |          |          |          |          |          
   |                     | ・「有効\|          |          |          |          
   |                     | 」の場合\|          |          |          |          
   |                     | 、パラメ\|          |          |          |          
   |                     | ータシー\|          |          |          |          
   |                     | トの値が\|          |          |          |          
   |                     | どのよう\|          |          |          |          
   |                     | な値でも\|          |          |          |          
   |                     | 代入値管\|          |          |          |          
   |                     | 理への登\|          |          |          |          
   |                     | 録が行わ\|          |          |          |          
   |                     | れます。 |          |          |          |          
   |                     |          |          |          |          |          
   |                     | ・       |          |          |          |          
   |                     | 「無効」 |          |          |          |          
   |                     | の場合、 |          |          |          |          
   |                     | パラメー |          |          |          |          
   |                     | タシート |          |          |          |          
   |                     | に値が入 |          |          |          |          
   |                     | っている |          |          |          |          
   |                     | 場合のみ |          |          |          |          
   |                     | 代入値管 |          |          |          |          
   |                     | 理への登 |          |          |          |          
   |                     | 録が行わ |          |          |          |          
   |                     | れます。 |          |          |          |          
   |                     |          |          |          |          |          
   |                     | ・空\    |          |          |          |          
   |                     | 白の場合\|          |          |          |          
   |                     | 、インタ\|          |          |          |          
   |                     | ーフェー\|          |          |          |          
   |                     | ス情報の\|          |          |          |          
   |                     | 「NULL連\|          |          |          |          
   |                     | 携」の値\|          |          |          |          
   |                     | が適用さ\|          |          |          |          
   |                     | れます。 |          |          |          |          
   +---------------------+----------+----------+----------+----------+
   | 備考                | 自由記述\| ー       | 手動入力 | 最大長40\|          
   |                     | 欄です。 |          |          | 00バイト |          
   +---------------------+----------+----------+----------+----------+


| ※登録方式でKey型を選択した場合、代入値管理に反映する際にHCL設定はOFFで設定されます。
| ※メンバー変数を設定する場合は、同じ変数内のメンバー変数の具体値も全て設定してください。
| 代入値を設定しなかった他のメンバー変数でもデフォルト値が使用されることはありません。

.. figure:: /images/ja/terraform-driver/common/assignedvalue_example.png
   :alt: 代入値例
   :width: 5.21739in
   :height: 1.29408in

代入値管理
**********

#. | [代入値管理]では、オペレーションごとに、対象のMovementで利用されるModule内の変数に代入する具体値をメンテナンス（閲覧／登録／更新／廃止）できます。

   ..  image:: saas/image44.png
       :alt: サブメニュー画面（代入値管理）
       :width: 5.17378in
       :height: 2.47355in

   **図** **6.2.13-1 サブメニュー画面（代入値管理）**

#. | 「登録」-「登録開始」ボタンより、代入値管理を行います。

   .. image:: saas/image45.png
      :alt: 登録画面（代入値管理）
      :width: 6.36458in
      :height: 1.51833in

   **図** **6.2.13-2 登録画面（代入値管理）**

   | 代入値管理の変数は、「6.2.5 Module素材集」で登録されたファイルの情報から反映されます。
   | ※ 反映のタイミングは「\ \ `8.2メンテナンス方法について <#メンテナンス方法について>`__\ \ 」の「③起動周期の変更」に記載していますので、そちらをご参照ください。

#. | 代入値管理に登録した変数は、作業実行時にTerraform側のWorkspaceで管理するVariablesに対し、「変数名」が「Key」、「具体値」が「Value」として登録されます。
   | 「HCL設定」を「ON」にしていた場合は「HCL」にチェックが入った状態で登録されます。
   | 「Sensitive設定」を「ON」にしていた場合は「Sensitive」にチェックが入った状態で登録されます。

#. | 代入値管理の項目一覧は以下のとおりです。

.. table::  6.2.12-1 項目一覧（代入値管理）
   
   +-------------+-------------+-------------+-------------+-------------+
   | 項目        | 説明        | 入力必須    | 入力形式    | 制約事項    |
   |             |             |             |             |             |
   +=============+=============+=============+=============+=============+
   | オペ\       | 対象\       | ○           | リスト選択  | ー          |
   | レーション  | のオペレー\ |             |             |             |
   |             | ションを選\ |             |             |             |
   |             | 択します。  |             |             |             |
   +-------------+-------------+-------------+-------------+-------------+
   | Movement    | 対象のM\    | ○           | リスト選択  | ー          |
   |             | ovementを選\|             |             |             |
   |             | 択します。  |             |             |             |
   +-------------+-------------+-------------+-------------+-------------+
   | 変数名      | Movement\   | ○           | リスト選択  | ー          |
   |             | -Module紐付\|             |             |             |
   |             | にて登録さ\ |             |             |             |
   |             | れているMod\|             |             |             |
   |             | ule素材の中\|             |             |             |
   |             | から、選択\ |             |             |             |
   |             | されたMovem\|             |             |             |
   |             | entにアタッ\|             |             |             |
   |             | チしている\ |             |             |             |
   |             | 変数名が表\ |             |             |             |
   |             | 示されます\ |             |             |             |
   |             | 。変数を選\ |             |             |             |
   |             | 択します。  |             |             |             |
   +-------------+-------------+-------------+-------------+-------------+
   | HCL設定     | 「 \        | ○           | リスト選択  | 選択し\     |
   |             | OFF」または\|             |             | た変数名が\ |
   |             | 「ON」を選\ |             |             | map型の場合\|
   |             | 択します。  |             |             | はONで設定\ |
   |             |             |             |             | する必要が\ |
   |             | 「O\        |             |             | あります。  |
   |             | N」を選択し\|             |             |             |
   |             | た場合、Te\ |             |             | オペレー\   |
   |             | rraform側の\|             |             | ション、Mov\|
   |             | Workspaceに\|             |             | ement、変数\|
   |             | 登録する際\ |             |             | 名が一致し\ |
   |             | にその変数\ |             |             | ている場合\ |
   |             | に対する「 \|             |             | 、HCL設定は\|
   |             | HCL」を有効\|             |             | ONまたはOF\ |
   |             | にします。  |             |             | Fに統一して\|
   |             | 変数に文字\ |             |             | ください。  |
   |             | 列以外の値\ |             |             |             |
   |             | を設定する\ |             |             |             |
   |             | 際などに設\ |             |             |             |
   |             | 定します。  |             |             |             |
   +-------------+-------------+-------------+-------------+-------------+
   | メ\         | メンバー変\ | 変数名\     | リスト選択  |             |
   | ンバー変数  | 数を持つ変\ | により変動  |             |             |
   |             | 数名を選択\ |             |             |             |
   |             | した場合に\ |             |             |             |
   |             |             |             |             |             |
   |             | メンバー\   |             |             |             |
   |             | 変数が表示\ |             |             |             |
   |             | されます。  |             |             |             |
   |             |             |             |             |             |
   |             | メンバ\     |             |             |             |
   |             | ー変数を選\ |             |             |             |
   |             | 択します。  |             |             |             |
   +-------------+-------------+-------------+-------------+-------------+
   | 代入順序    | 複数具体\   | 変数名\     | 手動入力    | ブランク\   |
   |             | 値が設定で\ | により変動  |             | または、\   |
   |             | きる変数名\ |             |             | 正の整数    |
   |             | の場合のみ\ |             |             |             |
   |             | 必須入力に\ |             |             |             |
   |             | なります。  |             |             |             |
   |             |             |             |             |             |
   |             | 具体値の\   |             |             |             |
   |             | 代入順序（ \|             |             |             |
   |             | 1～）を入力\|             |             |             |
   |             | します。入\ |             |             |             |
   |             | 力値に従い\ |             |             |             |
   |             | 昇順で代入\ |             |             |             |
   |             | されます。  |             |             |             |
   +-------------+-------------+-------------+-------------+-------------+
   | デ\         | default内で\| ー          |             |             |
   | フォルト値  | 変数に紐づ\ |             |             |             |
   |             | いている具\ |             |             |             |
   |             | 体値が表示\ |             |             |             |
   |             | されます。  |             |             |             |
   +-------------+-------------+-------------+-------------+-------------+
   | Se\         | 「\         | ○           | リスト選択  |             |
   | nsitive設定 | OFF」または\|             |             |             |
   |             | 「ON」を選\ |             |             |             |
   |             | 択します。  |             |             |             |
   |             |             |             |             |             |
   |             | 「ON」を選\ |             |             |             |
   |             | 択した場合\ |             |             |             |
   |             | 、具体値を\ |             |             |             |
   |             | 暗号化しIT\ |             |             |             |
   |             | A上で表示さ\|             |             |             |
   |             | せないよう\ |             |             |             |
   |             | にします。  |             |             |             |
   |             |             |             |             |             |
   |             | ま\         |             |             |             |
   |             | たTerrafor\ |             |             |             |
   |             | m側のWorksp\|             |             |             |
   |             | aceに登録す\|             |             |             |
   |             | る際にその\ |             |             |             |
   |             | 変数に対す\ |             |             |             |
   |             | る「Sensit\ |             |             |             |
   |             | ive」を有効\|             |             |             |
   |             | にし、具体 \|             |             |             |
   |             | 値を表示さ \|             |             |             |
   |             | せないよう\ |             |             |             |
   |             | にします。  |             |             |             |
   +-------------+-------------+-------------+-------------+-------------+
   | 具体値      | オペレー \  | ○           | 手動入力    | 最大長\     |
   |             | ション/Mov\ |             |             | 8192バイト  |
   |             | ementで使用\|             |             |             |
   |             | する変数の\ |             |             |             |
   |             | 具体値を入\ |             |             |             |
   |             | 力します。  |             |             |             |
   +-------------+-------------+-------------+-------------+-------------+
   | 備考        | 自由記\     | ー          | 手動入力    | 最大長\     |
   |             | 述欄です。  |             |             | 4000バイト  |
   +-------------+-------------+-------------+-------------+-------------+

#. | ITAのバージョンをv1.5.0からv1.6.0以降へバージョンアップを行った際、代入値管理に登録済みレコードの「変数名」が「ID変換失敗(ID)」と表示されます。
   | 「2 Terraform-driverでの変数取り扱い 」における変数の抽出方法変更に伴いこの事象が発生します。
   | 「変数名」が「ID変換失敗(ID)」となった際は、対象レコードの「更新」より新たに「変数名」を設定する必要があります。


作業実行
********

#. | 作業の実行を指示します。
   | Movement一覧、オペレーション一覧からそれぞれラジオボタンで選択し、実行ボタンを押すと、「5.2.10 作業状態確認 」に遷移し、実行されます。

   .. image:: saas/image46.png
      :alt: 6.2.14-1 サブメニュー画面（作業実行）
      :width: 5.18712in
      :height: 3.83367in

   **図** **6.2.14-1 サブメニュー画面（作業実行）**

   #. | 予約日時の指定
      | 「予約日時」を入力することで、実行およびPlan確認を予約することができます。
      | 「予約日時」には、未来の日時のみ登録可能です。


   #. | Movementの指定
      | 「\ 6.2.3 Movement一覧 」で登録したMovementを選択します。

   #. | オペレーションの指定
      | 「\ `6.1.1 オペレーション一覧 <\l>`__\ 」で登録したオペレーションを選択します。

   #. | 実行
      | 「実行」ボタンをクリックすると、「5.2.10作業状態確認 」に遷移し、作業が実行されます。
      | Plan完了後にApplyが自動で実行されます。

   #. | Plan確認
      | 「Plan確認」ボタンをクリックすると、「実行」ボタンをクリックした場合同様に作業実行が開始されますが、Planのみを実行し、Applyは実行されません。

#. | Outputブロックを含むModuleがConductorから実行された場合、Outputブロックに書かれた内容がデータリレイストレージパス（Conductor実行時、各Movementで共有するディレクトリを、ITAサーバから見たディレクトリパス）にjson形式ファイルで保存されます。
   | このファイルを使用することにより、同一Conductorの別のMovementでTerraformが出力した値を使用することができます。

   | ファイルパス

   | [データリレイストレージパス]/[ConductorインスタンスID]/terraform_output_[作業No].json
   | 例：/exastro/data_relay_storage/conductor/0000000001/terraform_output_0000000001.json
   | データリレイストレージパス・・・[Conductor]-[Conductorインターフェース情報]メニューの[データリレイストレージパス]
   | ConductorインスタンスID・・・[Conductor]-[Conductor作業一覧]メニューの[ConductorインスタンスID]（左0埋め10桁）
   | 作業No.・・・[Terraform]-[作業管理]メニューの[作業No.]（左0埋め10桁）

   | 記述例

   +-----------------------------+
   | variable "VAR_sample" {     |
   |                             |
   | type = string               |
   |                             |
   | default = "sample_string"   |
   |                             |
   | }                           |
   |                             |
   | output "output_sample" {    |
   |                             |
   | value = "${var.VAR_sample}" |
   |                             |
   | }                           |
   +-----------------------------+

   | 出力例

   +----------------------------------+
   | {                                |
   |                                  |
   | "output_sample": "sample_string" |
   |                                  |
   | }                                |
   +----------------------------------+


作業状態確認
************


#. | 作業の実行状態を監視します。

   .. image:: saas/image47.png
      :alt: サブメニュー画面（作業状態確認）
      :width: 4.16142in
      :height: 3.86493in

   **図** **6.2.15-1 サブメニュー画面（作業状態確認）**

   #. | 実行状態表示
   
      | 実行状況に即し、ステータスが表示されます。
      | 「実行種別」にはPlan確認の場合には「Plan確認」、Workspaceごとに構成・管理されたリソースの削除（「5.2.2 Workspaces管理 」から実行されます。）の場合は「リソース削除」、それ以外の場合には「通常」が入ります。
     
      | 「進行状況(Initログ)」「進行状況(Planログ)」「進行状況(Applyログ)」にはTerraformで実行するコマンドterraforminit / terraform plan / terraformapplyの各実行状況のログが表示されます。
      
   
      | ステータスが想定外エラーで終了した場合、「6.2.1インターフェース情報 」の登録不備や、「6.2.2 Organizations管理 」「6.2.3 Workspaces管理 」でのTerraformとの連携（登録）がされていない、あるいはその他のWebコンテンツの登録不備が原因であれば、「進行状況(エラーログ)」にメッセージが表示されます。
      | それ以外のエラーの場合は「進行状況(エラーログ)」にメッセージが表示されません。この場合は、プロセスのログにエラー情報が記録されます。必要に応じてプロセスのログを確認ください。
      | ※プロセスのログは「\ `8.2メンテナンス方法について <#メンテナンス方法について>`__\ 」の「④ログファイル名」に記載していますので、そちらをご参照ください。
   
      | 「呼出元Symphony」には、どのSymphonyから実行されたかを表示します。
      | TerraformCLIドライバから直接実行した場合やConductorから実行した場合は空欄になります。
      | 「呼出元Conductor」には、どのConductorから実行されたかを表示します。
      | TerraformCLIドライバから直接実行した場合やSymphonyから実行した場合は空欄になります。
   
      | 「実行ユーザ」には、作業実行メニューより「実行」ボタンを押下した際のログインユーザが表示されます。
      | 「Terraform利用情報」に表示される「RUN-ID」はTerraform側で管理する実行管理のIDで、BackyardコンテンツによるTerraformとの連携処理の際に利用されます。
   
      | ※「実行種別」が「リソース削除」の場合は下記の項目が設定されません。
   
      - 呼出元Symphony
      - 呼出元Conductor
      - Movement（ID、名称、遅延データ（分）
      - オペレーション（No.、名称、ID）
      - 代入値
      - 入力データ（投入データ）

   #. | 代入値確認
      | 「確認」ボタンで「\ *6.2.13*\ 代入値管理」が表示され、作業対象のオペレーションとMovementに絞り込んだ代入値が表示されます。
   
   #. | 緊急停止/予約取り消し
      | 「緊急停止」ボタンで構築作業を停止させることができます。
      | また、実行前の「予約実行」の作業の場合は、「予約取消」ボタンが表示されます。
      | 「予約取消」ボタンで予約実行が取り消せます。
   
   #. | ログ検索
      | 実行ログ、エラーログは、フィルタリングができます。
      | 各ログのフィルタのテキストボックスに検索したい文字列を入力し、「該当行のみ表示」のチェックボックスをチェックすることで該当する行だけが表示されます。
      | 実行ログ、エラーログのリフレッシュ表示間隔と最大表示行数を、「6.2.1 インターフェース情報」の「状態監視周期（単位ミリ秒）」と「進行状態表示行数」で設定できます。
   
   #. | 投入データ
      | 実行したModule素材、Policy素材および設定した代入値の一覧をjson形式で取得したファイルを格納したzip形式ファイルをダウンロードすることができます。



   | 格納されているファイルは以下の通りです。

   .. table:: 6.2.15-1 投入データ格納ファイル
   
      +--------------------+-----------------------+-----------------------+
      | ディレクトリ名     | ファイル名            | 説明                  |
      +====================+=======================+=======================+
      | ー                 | (投入した\            | 投入し\               |
      |                    | Module素材ファイル名) | たModule素材ファイル\ |
      |                    |                       | がzipファイルの直下に\|
      |                    |                       | すべて格納されます。  |
      +--------------------+-----------------------+-----------------------+
      | ー                 | (投入した\            | 投入し\               |
      |                    | Policy素材ファイル名) | たPolicy素材ファイル\ |
      |                    |                       | がzipファイルの直下に\|
      |                    |                       | すべて格納されます。  |
      +--------------------+-----------------------+-----------------------+
      | variables          | variables.json        | 設定し\               |
      |                    |                       | た各代入値についての\ |
      |                    |                       | 「変数名(key)」「具体\|
      |                    |                       | 値(value)」「HCL設定\ |
      |                    |                       | 」「Sensitive設定」の\|
      |                    |                       | 設定値をjson形式で取\ |
      |                    |                       | 得したファイルです。  |
      |                    |                       | Sensitive設定がON(tr\ |
      |                    |                       | ue)の場合は具体値には\|
      |                    |                       | nullが設定されます。  |
      +--------------------+-----------------------+-----------------------+

   #. | 結果データ
      | 実行ログ、エラーログおよび、Terraformが生成したstateファイルを格納したzip形式ファイルをダウンロードすることができます。
      | 格納されているファイルは以下の通りです。

      .. table:: 6.2.15-2 結果データ格納ファイル
   
         +--------------------+-------------------+---------------------------+
         | ディレクトリ名     | ファイル名        | 説明                      |
         +====================+===================+===========================+
         | ー                 | plan.log          | 進行状況(Pl\              |
         |                    |                   | anログ)に出力された内容を\|
         |                    |                   | 記載したlogファイルです。 |
         +--------------------+-------------------+---------------------------+
         | ー                 | policyCheck.log   | 進行状況(policyChe\       |
         |                    |                   | ckログ)に出力された内容を\|
         |                    |                   | 記載したlogファイルです。 |
         +--------------------+-------------------+---------------------------+
         |                    | apply.log         | 進行状況(App\             |
         |                    |                   | lyログ)に出力された内容を\|
         |                    |                   | 記載したlogファイルです。 |
         +--------------------+-------------------+---------------------------+
         |                    | error.log         | 進行状況(エラ\            |
         |                    |                   | ーログ)に出力された内容を\|
         |                    |                   | 記載したlogファイルです。 |
         +--------------------+-------------------+---------------------------+
         | ー                 | sv-XXXXXX.tfstate | Terraformが生成したst\    |
         |                    |                   | ateファイルです。ファイル\|
         |                    |                   | 名はTerraformが作成するた\|
         |                    |                   | め、実行毎に異なります。  |
         |                    |                   |                           |
         |                    |                   | バックアップ\             |
         |                    |                   | 用途として、暗号化された\ |
         |                    |                   | 状態で保存されています。  |
         +--------------------+-------------------+---------------------------+

作業管理
********

#. | 作業の履歴を閲覧できます。

   | 条件を指定し「フィルタ」ボタンをクリックすると、作業一覧テーブルを表示します。
   | 「作業状態確認」ボタンで、「6.2.15作業状態確認 」に遷移し、実行状態の詳細を見ることができます。

   .. image:: saas/image48.png
      :alt: サブメニュー画面（作業管理）
      :width: 5.90718in
      :height: 2.83358in

   **図** **6.2.16-1 サブメニュー画面（作業管理）**

連携先Terrraform管理
********************

#. | 「6.2.1 インターフェース情報」に登録した情報をもとにTerraformへ接続し、Terraformに登録されているOrganizaiton/ Workspace / Policy / PolicySetの一覧をそれぞれ表示できます。
   | 表示された一覧からITAに登録された対象を、Terraformから削除することができます。
   | Workspaceごとに構成・管理されたリソースの削除を実行することができます。
   | また、PolicySetに紐付いたWorkspaceおよびPolicyの紐付けを解除することができます。

   | ※このページ上で行う操作について、ITA側の登録対象に影響はありません。

   .. image:: saas/image49.png
      :alt: サブメニュー画面（連携先Terraform管理）
      :width: 4.9671in
      :height: 2.38021in

   **図 6.2.17-1 サブメニュー画面（連携先Terraform管理）**

#. | 各一覧取得により表示される項目一覧は以下の通りです。

.. table:: 6.2.16-1 項目一覧（Organization登録管理）

   +-------------------+-------------------------------------------------+
   | 項目              | 説明                                            |
   +===================+=================================================+
   | Organization Name | Te\                                             |
   |                   | rraformに登録されているOrganizationの名前です。 |
   +-------------------+-------------------------------------------------+
   | Email address     | Organizationに登録されているEmail addressです。 |
   +-------------------+-------------------------------------------------+
   | ITAの登録状態     | 対象のOrganization Nameが「6.2.2\               |
   |                   | Organizations管理」に登録\                      |
   |                   | されている場合は「登録済み」と表示されます。登\ |
   |                   | 録されていない場合は「未登録」と表示されます。  |
   +-------------------+-------------------------------------------------+
   | 削除              | ボタンをクリックすると\                         |
   |                   | 確認ダイアログが表示され[OK]をクリックすると対\ |
   |                   | 象のOrganizationがTerraform上から削除されます。 |
   |                   |                                                 |
   |                   | ※削\                                            |
   |                   | 除したOrganizationは元に戻すことができません。  |
   +-------------------+-------------------------------------------------+

.. table:: 6.2.16-2 項目一覧（Workspace登録管理）

   +-------------------+-------------------------------------------------+
   | 項目              | 説明                                            |
   +===================+=================================================+
   | Organization Name | 対象の\                                         |
   |                   | Workspaceと紐付いているOrganizationの名前です。 |
   +-------------------+-------------------------------------------------+
   | Workspace Name    | Terraformに登録されているWorkspaceの名前です。  |
   +-------------------+-------------------------------------------------+
   | Terraform Version | 対象のWorkspaceに設定されているTerraform\       |
   |                   | Versionです。                                   |
   +-------------------+-------------------------------------------------+
   | ITAの登録状態     | 対象のWorkspace Nameが「6.2.3\                  |
   |                   | Workspaces管理」に登録                          |
   |                   | されている場合は「登録済み」と表示されます。登  |
   |                   | 録されていない場合は「未登録」と表示されます。  |
   +-------------------+-------------------------------------------------+
   | リソース削除      | ボタンをクリックすると確認ダイア\               |
   |                   | ログが表示され[OK]をクリックすると「6.2.15\     |
   |                   | \ 作業状態確認」に遷移し、対象のWorkspaceごとに\|
   |                   | 構成・管理されたリソースの削除が実行されます。  |
   |                   |                                                 |
   |                   | ※削除したリソースは元に戻すことができません。   |
   +-------------------+-------------------------------------------------+
   | 削除              | ボタンをクリックする\                           |
   |                   | と確認ダイアログが表示され[OK]をクリックすると\ |
   |                   | 対象のWorkspaceがTerraform上から削除されます。  |
   |                   |                                                 |
   |                   | ※Workspaceを削除すると\                         |
   |                   | リソースの削除は実行することができません。また\ |
   |                   | 、削除したWorkspaceは元に戻すことができません。 |
   +-------------------+-------------------------------------------------+

.. table:: 6.2.16-3 項目一覧（Policy登録管理）

   +---------------------------+-----------------------------------------+
   | 項目                      | 説明                                    |
   +===========================+=========================================+
   | Organization Name         | 対象のPolic\                            |
   |                           | yと紐付いているOrganizationの名前です。 |
   +---------------------------+-----------------------------------------+
   | Policy Name               | Terr\                                   |
   |                           | aformに登録されているPolicyの名前です。 |
   +---------------------------+-----------------------------------------+
   | ITAの登録状態             | 対象のPolicy Nameが「6.2.6\             |
   |                           | Policies管理」に登録されている場合は\   |
   |                           | 「登録済み」と表示されます。登録されて\ |
   |                           | いない場合は「未登録」と表示されます。  |
   +---------------------------+-----------------------------------------+
   | Policy Codeをダウンロード | リンク\                                 |
   |                           | をクリックすると、対象のPolicyのPolicy\ |
   |                           | Codeファイルをダウンロードできます。    |
   +---------------------------+-----------------------------------------+
   | 削除                      | ボタンをクリックすると確認ダイア\       |
   |                           | ログが表示され[OK]をクリックすると対象\ |
   |                           | のPolicyがTerraform上から削除されます。 |
   |                           |                                         |
   |                           | ※削除\                                  |
   |                           | したPolicyは元に戻すことができません。  |
   +---------------------------+-----------------------------------------+

.. table:: 6.2.16-4 項目一覧（PolicySet登録管理）

   +-------------------+-------------------------------------------------+
   | 項目              | 説明                                            |
   +===================+=================================================+
   | Organization Name | 対象の\                                         |
   |                   | PolicySetと紐付いているOrganizationの名前です。 |
   +-------------------+-------------------------------------------------+
   | PolicySet Name    | 対象のPolicySetの名前です。                     |
   +-------------------+-------------------------------------------------+
   | 紐付Workspace     | 対象\                                           |
   |                   | のPolicySetに紐付いているWorkspaceの名前です。  |
   +-------------------+-------------------------------------------------+
   | 紐付Policy        | 対象のPolicySetに紐付いているPolicyの名前です。 |
   +-------------------+-------------------------------------------------+
   | ITAの登録状態     | 対象のPolicySet Nameが「6.2.7 Policy            |
   |                   | Sets管理」に登録\                               |
   |                   | されている場合は「登録済み」と表示されます。登\ |
   |                   | 録されていない場合は「未登録」と表示されます。  |
   +-------------------+-------------------------------------------------+
   | 削除/紐付解除     | PolicySet\                                      |
   |                   | Nameに対して\                                   |
   |                   | は「削除」ボタンが、紐付Workspaceおよび紐付Pol\ |
   |                   | icyに対しては「紐付解除」ボタンが表示されます。 |
   |                   |                                                 |
   |                   | 「削除」ボタンをクリックする\                   |
   |                   | と確認ダイアログが表示され[OK]をクリックすると\ |
   |                   | 対象のPolicySetがTerraform上から削除されます。  |
   |                   |                                                 |
   |                   | 「紐\                                           |
   |                   | 付解除」ボタンをクリックすると確認ダイアログが\ |
   |                   | 表示され[OK]をクリックすると対象のWorkspaceもし\|
   |                   | くはPolicyのPolicySetとの紐付けが解除されます。 |
   |                   |                                                 |
   |                   | ※削除したPolicySetは元に戻すことができません。  |
   +-------------------+-------------------------------------------------+


構築コード記述方法
==================

| Terraform-driverでModuleおよびPolicyの記述について説明します。

Moduleの記述
------------

| Moduleファイルは、HCL（HashiCorp ConfigurationLanguage）というHashiCorp社独自の言語により記述します。
| HCLの詳細については、Terraformの製品マニュアルを参照してください。


Policyの記述
------------

| Policyファイルは、Sentinel languageいうHashiCorp社独自の言語により記述します。
| Sentinel languageの詳細については、Terraformの製品マニュアルを参照してください。

BackYard コンテンツ
-------------------

#. | 変数自動登録

   | 6.2.5 Module素材集」に登録したModule素材ファイルから変数を抽出します。
   | 変数の抽出ルールについては「 2.1 変数の種類」をご参照ください。
   | なお、取出すタイミングは「Terraform変数自動登録」プロセスの起動周期に依存します。

#. | 代入値自動登録設定

   | 連携対象としたパラメータシートのオペレーションの項目の設定値と紐付けたMovementと変数の情報を代入値管理に反映します。
   |  なお、取出すタイミングは「Terraform自動登録設定」プロセスの起動周期に依存します。
   | 代入値管理は複数の操作者が更新を行います。
   | 最終更新者が他操作者の場合は反映処理をしません。
   | 代入値自動登録設定のデータを反映したい場合は、代入値管理で該当レコードを廃止にする操作を行ってください。

| 代入値管理への反映ルールを以下に記載します。

| ① 代入値自動登録設定に登録されている情報を代入値管理へ反映時


.. table:: 代入値管理の状態確認

   +------------------+--------------+-------------------------------------+-----------------+
   | 代入値管理の状態 | 該当レコード\| 該当レコードあり                    | 該当レコード\   |      
   |                  | なし         +----------+--------------------------+ 廃止中          |
   |                  |              | = 具体値 | ≠具体値                  |                 | 
   |                  |              |          +--------------------------+                 |
   |                  |              |          | 最終更新者               |                 |
   |                  |              |          +---------------+----------+                 |
   |                  |              |          | BackYard処理  | 他操作者 |                 |
   +==================+==============+==========+===============+==========+=================+
   | 代入値管理\      | 新規レコード\| ー       | 該当レコードの| ー       | 廃止レコード\   | 
   | への反映         | 追加         |          | 具体値更新    |          | 復活            |
   +------------------+--------------+----------+---------------+----------+-----------------+


| ※該当レコード:オペレーション+Movement+変数名+HCL設定+アクセス権が同一のレコードの意

| ② 代入値自動登録設定に登録されていない情報（代入値管理のみに登録）を代入値管理へ反映

.. table:: 代入値管理の状態確認
   
   +-----------------------+-------------------------+
   | 代入値管理の状態      | 該当レコードあり        |     
   |                       +-------------------------+ 
   |                       | 最終更新者              |        
   |                       +--------------+----------+                   
   |                       | BackYard処理 | 他操作者 |                                               
   +=======================+==============+==========+
   | 代入値管理\           | 該当レコード\| ー       | 
   | への反映              | 廃止         |          | 
   +-----------------------+--------------+----------+


| ③ HCL設定について
| 代入値自動登録に設定した「HCL設定」の値は代入値管理に反映する際に同じ値が設定されます。

| ④Secure設定について
| 連携対象としたパラメータシートの項目が「パスワード」の場合は代入値管理に反映する際に「Secure設定」がONで設定されます。
| それ以外の場合はOFFで設定されます。

| ⑤アクセス許可ロールについて
|  連連携対象としたパラメータシートのレコードに設定されたオペレーションのアクセス許可ロールと、代入値自動登録のレコードに設定されたMovementのアクセス許可ロールを参照し、一致しているすべてのアクセス許可ロールが代入値管理に反映する際に設定されます。
| どちらもアクセス許可ロールが設定されていない場合（空欄の場合）は、代入値管理に反映する際も空欄が設定されます。
| また、一致するアクセス許可ロールが一つも無い場合は代入値管理にレコードが作成されません。


運用操作
========

| 本機能を活用する操作は、クライアントPCのブラウザ画面からのユーザー利用による入力だけでなく、システム運用・保守による操作もあります。用意している運用・保守の操作は次のとおりです。

メンテナンス
------------

| Terraform-driverのプロセスの開始/停止/再起動に必要なファイルは以下となります。

.. table:: 開始/停止/再起動に必要なファイル

   +----------------------------------+----------------------------------+
   | 説明                             | 対象ファイル名                   |
   +==================================+==================================+
   | Terraform作業実行監視            | ky_terraf\                       |
   |                                  | orm_cli_execute-workflow.service |
   | 未実行作業の実行を行う。         |                                  |
   +----------------------------------+----------------------------------+
   | Terraform変数自動登録            | ky_terraform_cli\                |
   |                                  | _varsautolistup-workflow.service |
   | アップロード\                    |                                  |
   | したModule素材から変数・メンバー\|                                  |
   | 変数・最大繰返数の取出しを行う。 |                                  |
   |                                  |                                  |
   | 最大\                            |                                  |
   | 繰返数をメンバー変数に反映する。 |                                  |
   +----------------------------------+----------------------------------+
   | Terraform自動登録設定            | ky_terraform_c\                  |
   |                                  | li_valautosetup-workflow.service |
   | 代入値自動登録に設定され\        |                                  |
   | た情報を代入値管理に反映を行う。 |                                  |
   +----------------------------------+----------------------------------+

| 対象ファイルは「/usr/lib/systemd/system」に格納されています。
| プロセス起動/停止/再起動の方法は次の通りです。
| root権限でコマンドを実行してください。

| ①プロセス起動

.. code-block:: bash 

   # systemctl start ky_terraform_cli_execute-workflow.service

| ②プロセス停止

.. code-block:: bash 

   # systemctl stop ky_terraform_cli_execute-workflow.service

| ③プロセス再起動

.. code-block:: bash 

   # systemctl restart ky_terraform_cli_execute-workflow.service


| 各対象ファイル名に置き換えて起動/停止/再起動を行ってください。

メンテナンス方法について
------------------------

| ①　NORMALレベルへの変更
| 以下のファイルの8行目「DEBUG」を「NORMAL」に書き換えます。
| ログレベル設定ファイル：
| :file:`<インストールディレクトリ>/ita-root/confs/backyardconfs/ita_env`

|  ②　DEBUGレベルへの変更
| 以下のファイルの8行目「NORMAL」を「DEBUG」に書き換えます。
| ログレベル設定ファイル：
| :file:`<インストールディレクトリ>/ita-root/confs/backyardconfs/ita_env`

|  ③ 起動周期の変更
| 各対象ファイルのExecStartの5番目のパラメータを変更します。（単位:秒）
| 例外を除き起動周期はデフォルト値の使用をしてください。

.. code-block:: bash 

   ExecStart=/bin/sh ${ITA_ROOT_DIR}/backyards/common/ky_loopcall-php-procedure.sh /bin/php /bin/php ${ITA_ROOT_DIR}/backyards/terraform_driver/ky_terraform_execute-workflow.php ${ITA_ROOT_DIR}/logs/backyardlogs 5 ${ITA_LOG_LEVEL} > /dev/null 2>&1

| 書き換え後、プロセス再起動(restart)後に有効になります。

| ④ ログファイル名

.. table:: ログファイル

   +----------------------------------+----------------------------------+
   |     プロセス名                   | ログファイル名                   |
   +==================================+==================================+
   | k\                               | ky_terraform_c\                  |
   | y_terraform_cli_execute-workflow | li_execute-workflow_YYYYMMDD.log |
   +----------------------------------+----------------------------------+
   | k\                               | ky_terraform_cli_exe\            |
   | y_terraform_cli_execute-workflow | cute-child-workflow_YYYYMMDD.log |
   +----------------------------------+----------------------------------+
   | ky_terra\                        | ky_terraform_cli_vars\           |
   | form_cli_varsautolistup-workflow | autolistup-workflow_YYYYMMDD.log |
   +----------------------------------+----------------------------------+
   | ky_ter\                          | ky_terraform_cli_va\             |
   | raform_cli_valautosetup-workflow | lautosetup-workflow_YYYYMMDD.log |
   +----------------------------------+----------------------------------+

| ログファイルの出力先：:file:`<インストールディレクトリ>/ita-root/logs/backyardlogs`


付録
====

Module素材記入例・登録例
------------------------

Module素材の記入例と登録例を「 4.1 Terraform作業フロー」のフロー番号と照らし合わせて記載します。

1. シンプルなパターン

   #. | string型
    
      .. figure:: /images/ja/terraform-driver/common/string.png
         :alt: string型
         :align: left
         :width: 500px
               
   #. | number型
   
      .. image:: /images/ja/terraform-driver/common/number.png
         :alt: number型
         :align: left
         :width: 500px      
   
   #. | bool型
   
      .. figure:: /images/ja/terraform-driver/common/bool.png
         :alt: bool型
         :align: left
         :width: 500px

   #. | list型
  
      .. figure:: /images/ja/terraform-driver/common/list.png
         :alt: list型
         :align: left
         :width: 500px
  
   #. | set型
   
      .. figure:: /images/ja/terraform-driver/common/set.png
         :alt: set型
         :align: left
         :width: 500px
      

   #. | tuple型
 
      .. figure:: /images/ja/terraform-driver/common/tuple.png
         :alt: tuple型
         :align: left
         :width: 500px  

   #. | map型
   
      .. figure:: /images/ja/terraform-driver/common/map.png
         :alt: map型
         :align: left
         :width: 500px
                 

   #. | object型
   
      .. figure:: /images/ja/terraform-driver/common/object.png
         :alt: object型
         :align: left
         :width: 500px  

   #. | any型
 
      .. figure:: /images/ja/terraform-driver/common/any.png
         :alt: map型
         :align: left
         :width: 500px
 

   #. | typeの記載がない

      .. figure:: /images/ja/terraform-driver/common/notype.png
         :alt: typeの記載がない
         :align: left
         :width: 500px    

#. 複雑なパターン

   #. | list型配下のlist

      .. image:: /images/ja/terraform-driver/common/list2.png
        :alt: list型配下のlist
        :align: left
        :width: 5.26236in
        :height: 2.83358in   

   #. | list型配下のobject
   
      .. figure:: /images/ja/terraform-driver/common/object2.png
         :alt: list型配下のlist
         :align: left
         :width: 500px
 

   #. | object配下のlist配下のobject

      .. figure:: /images/ja/terraform-driver/common/object3.png
         :alt: object配下のlist配下のobject
         :align: left
         :width: 500px
      
      |  

      .. figure:: /images/ja/terraform-driver/common/object4.png
         :alt: object配下のlist配下のobject
         :align: left
         :width: 500px
                

#. 特殊な型

   #. | list型配下のmap型

      .. figure:: /images/ja/terraform-driver/common/map2.png
         :alt: list型配下のmap型
         :align: left
         :width: 500px
           

変数ネスト管理フロー例
----------------------

| 変数ネスト管理の操作例を「4.1 Terraform作業フロー」のフロー番号と照らし合わせて記載します。

1. 最大繰返数を増加させる 

.. figure:: /images/ja/terraform-driver/common/Increase_number_repetitions.png
     :alt: 最大繰返数を増加させる
     :align: left
     :width: 500px 

|

.. figure:: /images/ja/terraform-driver/common/Increase_number_repetitions2.png
     :alt: 最大繰返数を増加させる
     :align: left
     :width: 500px

2. 最大繰返数を減少させる

.. figure:: /images/ja/terraform-driver/common/repeated_number_decrease.png
     :alt: 最大繰返数を減少させる
     :align: left
     :width: 500px

|

.. figure:: /images/ja/terraform-driver/common/repeated_number_decrease2.png
     :alt: 最大繰返数を減少させる
     :align: left
     :width: 500px








